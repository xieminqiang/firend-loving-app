"use strict";const t=require("./props.js"),e=require("../../libs/mixin/mpMixin.js"),i=require("../../libs/mixin/mixin.js"),n=require("../../libs/function/index.js"),a=require("../../../../common/vendor.js"),s={name:"u-rate",mixins:[e.mpMixin,i.mixin,t.props],data(){return{elId:n.guid(),elClass:n.guid(),rateBoxLeft:0,activeIndex:this.modelValue,rateWidth:0,moving:!1}},watch:{modelValue(t){this.activeIndex=t},activeIndex:"emitEvent"},emits:["update:modelValue","change"],methods:{addStyle:n.addStyle,addUnit:n.addUnit,init(){n.sleep().then((()=>{this.getRateItemRect(),this.getRateIconWrapRect()}))},async getRateItemRect(){await n.sleep(),this.$uGetRect("#"+this.elId).then((t=>{this.rateBoxLeft=t.left}))},getRateIconWrapRect(){this.$uGetRect("."+this.elClass).then((t=>{this.rateWidth=t.width}))},touchMove(t){if(!this.touchable)return;this.preventEvent(t);const e=t.changedTouches[0].pageX;this.getActiveIndex(e)},touchEnd(t){if(!this.touchable)return;this.preventEvent(t);const e=t.changedTouches[0].pageX;this.getActiveIndex(e)},clickHandler(t,e){if("ios"===n.os()&&this.moving)return;this.preventEvent(t);let i=0;i=t.changedTouches[0].pageX,this.getActiveIndex(i,!0)},emitEvent(){this.$emit("change",this.activeIndex),this.$emit("update:modelValue",this.activeIndex)},getActiveIndex(t,e=!1){if(this.disabled||this.readonly)return;const i=this.rateWidth*this.count+this.rateBoxLeft,a=t=n.range(this.rateBoxLeft,i,t)-this.rateBoxLeft;let s;if(this.allowHalf){s=Math.floor(a/this.rateWidth);const t=a%this.rateWidth;t<=this.rateWidth/2&&t>0?s+=.5:t>this.rateWidth/2&&s++}else{s=Math.floor(a/this.rateWidth);const t=a%this.rateWidth;e?t>0&&s++:t>this.rateWidth/2&&s++}this.activeIndex=Math.min(s,this.count),this.activeIndex<this.minCount&&(this.activeIndex=this.minCount),setTimeout((()=>{this.moving=!0}),10),setTimeout((()=>{this.moving=!1}),10)}},mounted(){this.init()}};if(!Array){a.resolveComponent("u-icon")()}Math;const o=a._export_sfc(s,[["render",function(t,e,i,n,s,o){return{a:a.f(Number(t.count),((e,i,n)=>a.e({a:"9695d3d1-0-"+n,b:a.p({name:Math.floor(s.activeIndex)>i?t.activeIcon:t.inactiveIcon,color:t.disabled?"#c8c9cc":Math.floor(s.activeIndex)>i?t.activeColor:t.inactiveColor,"custom-style":{padding:`0 ${o.addUnit(t.gutter/2)}`},size:t.size}),c:a.o((t=>o.clickHandler(t,i+1)),i)},t.allowHalf?{d:"9695d3d1-1-"+n,e:a.p({name:Math.ceil(s.activeIndex)>i?t.activeIcon:t.inactiveIcon,color:t.disabled?"#c8c9cc":Math.ceil(s.activeIndex)>i?t.activeColor:t.inactiveColor,"custom-style":{padding:`0 ${o.addUnit(t.gutter/2)}`},size:t.size}),f:a.o((t=>o.clickHandler(t,i+1)),i),g:a.s({width:o.addUnit(s.rateWidth/2)})}:{},{h:i}))),b:t.allowHalf,c:a.n(s.elClass),d:a.o(((...t)=>o.touchMove&&o.touchMove(...t))),e:a.o(((...t)=>o.touchEnd&&o.touchEnd(...t))),f:s.elId,g:a.s(o.addStyle(t.customStyle))}}],["__scopeId","data-v-9695d3d1"]]);wx.createComponent(o);
