"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),o=require("../../api/user.js"),n=require("../../api/order.js");if(!Array){(e.resolveComponent("u-button")+e.resolveComponent("u-modal"))()}Math||((()=>"../../uni_modules/uview-plus/components/u-button/u-button.js")+(()=>"../../uni_modules/uview-plus/components/u-modal/u-modal.js"))();const t={__name:"Withdraw",setup(t){const l=e.ref(""),i=e.ref(!1),s=e.ref({balance:0,available_balance:0,frozen_balance:0}),c=e.ref(!1),r=()=>{i.value=!0},u=()=>{i.value=!1},d=async()=>{try{const e=await n.getCompanionBalanceDetail({});e.data&&0===e.data.code&&(s.value=e.data.data||{balance:0,available_balance:0,frozen_balance:0})}catch(e){console.error("获取余额详情失败:",e)}},v=async()=>{const a=parseFloat(l.value);if(!a||a<=0)return void e.index.showToast({title:"请输入有效的提现金额",icon:"none"});if(a>s.value.available_balance/100)e.index.showToast({title:`提现金额不能超过可用余额${m(s.value.available_balance)}元`,icon:"none"});else try{e.index.showLoading({title:"提现中..."});const n=Math.round(100*a),t=await o.companionWithdraw({withdraw_amount:n});e.index.hideLoading(),t.data&&0===t.data.code?(e.index.showToast({title:"提现申请成功",icon:"success"}),l.value="",await d(),h(t.data)):e.index.showToast({title:t.message||"提现失败",icon:"none"})}catch(n){e.index.hideLoading(),console.error("提现失败:",n)}},h=a=>{e.wx$1.canIUse("requestMerchantTransfer")?e.wx$1.requestMerchantTransfer({mchId:"1724024386",appId:e.wx$1.getAccountInfoSync().miniProgram.appId,package:a.data.wx_package_info,success:e=>{console.log("微信转账成功:",e),c.value=!0},fail:a=>{console.log("微信转账失败:",a),e.index.$emit("refreshPendingWithdrawList"),e.index.navigateBack({delta:1})}}):e.wx$1.showModal({content:"你的微信版本过低，请更新至最新版本。",showCancel:!1})},m=e=>{if(!e&&0!==e)return"0.00";e.toString();const a=Math.floor(e/100),o=e%100;return 0===o?a+".00":o<10?a+".0"+o:a+"."+o},p=()=>{const e=s.value.available_balance/100;l.value=e.toFixed(2)},w=()=>{c.value=!1,setTimeout((()=>{e.index.navigateBack({delta:1})}),1e3)},b=()=>{e.index.navigateTo({url:"/subPackages/balance/record"})};return e.onMounted((()=>{d(),setTimeout((()=>{i.value=!0}),300)})),(o,n)=>({a:a._imports_0$9,b:e.o(b),c:i.value,d:e.o(r),e:e.o(u),f:l.value,g:e.o((e=>l.value=e.detail.value)),h:e.t(m(s.value.available_balance)),i:e.o(p),j:e.o(v),k:e.o(w),l:e.p({text:"确定",type:"success",shape:"circle"}),m:e.o(w),n:e.p({title:"提现已提交成功",show:c.value,content:"您的提现请求已成功提交。提现状态会在后台处理后更新，请稍后查看账户余额或联系客服确认。",closeOnClickOverlay:!0,showCancelButton:!0})})}},l=e._export_sfc(t,[["__scopeId","data-v-fb88c0fc"]]);wx.createPage(l);
