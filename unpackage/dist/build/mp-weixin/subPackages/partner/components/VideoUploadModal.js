"use strict";const e=require("../../../common/vendor.js"),o=require("../../../api/user.js"),i=require("../api/file.js"),n={__name:"VideoUploadModal",props:{show:{type:Boolean,default:!1},applicationInfo:{type:Object,default:null}},emits:["close","success"],setup(n,{emit:a}){const t=n,s=a,r=e.ref(""),l=e.ref(!1),c=e.ref(0);e.watch((()=>t.show),(e=>{var o;e&&t.applicationInfo&&t.applicationInfo.intro_video_url?r.value=t.applicationInfo.intro_video_url:e||((null==(o=t.applicationInfo)?void 0:o.intro_video_url)||(r.value=""),l.value=!1,c.value=0)}));const u=()=>{p()},p=()=>{s("close")},d=()=>{r.value="",e.index.chooseVideo({count:1,sizeType:["compressed"],sourceType:["album","camera"],maxDuration:60,camera:"back",success:async o=>{const n=o.tempFilePath,a=o.duration,t=o.size;if(a<3||a>60)e.index.showToast({title:"视频时长必须在3-60秒之间",icon:"none"});else if(t>524288e3)e.index.showToast({title:"视频文件大小不能超过500MB",icon:"none"});else{e.index.showLoading({title:"上传中...",mask:!0});try{const o=await f(n),a=await i.uploadFile({filePath:n,name:`intro_video_${Date.now()}.${o.extension}`}),t=i.getUploadResult(a);if(!t||!t.url)throw new Error("上传结果解析失败");r.value="https://sbx-server.oss-cn-shenzhen.aliyuncs.com"+t.url,e.index.hideLoading()}catch(s){e.index.hideLoading(),console.error("视频上传失败:",s),e.index.showToast({title:"上传失败，请重试",icon:"none"})}}},fail:o=>{console.error("选择视频失败:",o),o.errMsg&&!o.errMsg.includes("cancel")&&e.index.showToast({title:"选择视频失败",icon:"none"})}})},v=async()=>{if(r.value){if(!l.value)try{e.index.showLoading({title:"提交审核中..."});await o.uploadCompanionVideo({intro_video_url:r.value});e.index.hideLoading(),e.index.showToast({title:"视频提交成功，等待审核",icon:"success"}),p(),s("success",{type:"video_uploaded",message:"视频已提交审核"})}catch(i){e.index.hideLoading(),console.error("提交视频失败:",i),i.data||e.index.showToast({title:"提交失败，请重试",icon:"none"})}}else e.index.showToast({title:"请先选择视频",icon:"none"})},f=o=>new Promise(((i,n)=>{e.index.getFileInfo({filePath:o,success:e=>{const n=o.split(".").pop().toLowerCase();i({size:e.size,extension:n})},fail:e=>{console.error("获取文件信息失败:",e);const n=o.split(".").pop().toLowerCase()||"mp4";i({size:0,extension:n})}})})),h=e=>{switch(e){case"pending":return"待审核";case"approved":return"已通过";case"rejected":return"已拒绝";default:return"未知状态"}},_=e=>{switch(e){case"pending":return"您的视频正在审核中，请耐心等待";case"approved":return"视频审核已通过，可以正常上线接单";case"rejected":return""!=t.applicationInfo.remark?"原因："+t.applicationInfo.remark:"视频审核未通过，请重新上传";default:return"请上传自我介绍视频"}},w=e=>{switch(e){case"pending":return"status-pending";case"approved":return"status-approved";case"rejected":return"status-rejected";default:return""}};return(o,i)=>e.e({a:n.show},n.show?e.e({b:e.o(p),c:n.applicationInfo&&n.applicationInfo.intro_video_url},n.applicationInfo&&n.applicationInfo.intro_video_url?{d:e.t(h(n.applicationInfo.video_review_status)),e:e.n(w(n.applicationInfo.video_review_status)),f:e.t(_(n.applicationInfo.video_review_status))}:{},{g:r.value&&""!=r.value},r.value&&""!=r.value?{h:r.value,i:e.o(d)}:{j:e.o(d)},{k:l.value},l.value?{l:c.value+"%",m:e.t(c.value)}:{},{n:e.o(p),o:n.applicationInfo&&n.applicationInfo.intro_video_url},n.applicationInfo&&n.applicationInfo.intro_video_url?{p:e.t(l.value?"上传中...":"重新提交")}:{q:e.t(l.value?"上传中...":"提交审核")},{r:!r.value||l.value?1:"",s:e.o(v),t:e.o((()=>{})),v:e.o(u)}):{})}},a=e._export_sfc(n,[["__scopeId","data-v-be56003b"]]);wx.createComponent(a);
