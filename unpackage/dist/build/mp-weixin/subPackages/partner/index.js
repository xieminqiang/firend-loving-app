"use strict";const e=require("../../common/vendor.js"),o=require("../../api/user.js"),a=require("../../stores/level.js");Math||(n+l)();const n=()=>"./components/Workbench.js",l=()=>"./components/Profile.js",t={__name:"index",setup(n){const l=a.useLevelStore(),t=e.ref(0),r=e.ref(0),s=e.ref(null),c=e.ref(!1),i=e.ref(!1);e.onMounted((()=>{const o=e.index.getSystemInfoSync();t.value=o.statusBarHeight||0,g(),e.index.$on("applicationStatusChanged",u),e.index.$on("refreshApplicationInfo",d)})),e.onUnmounted((()=>{e.index.$off("applicationStatusChanged",u),e.index.$off("refreshApplicationInfo",d)}));const u=e=>{console.log("收到申请状态变化事件:",e),"video_uploaded"===e.type&&(console.log("视频上传成功，刷新申请信息"),g(),l.clearServiceLevels())},d=()=>{console.log("收到刷新申请信息事件"),g()},v=async()=>{console.log("开始下拉刷新"),i.value=!0;try{await g()}catch(o){console.error("下拉刷新失败:",o),e.index.showToast({title:"刷新失败，请重试",icon:"error",duration:2e3})}finally{setTimeout((()=>{i.value=!1}),500)}},p=()=>{console.log("刷新状态恢复")},f=()=>{console.log("刷新状态中止"),i.value=!1},g=async()=>{var e,a;try{console.log("开始请求申请信息");const n=await o.getApplicatioInfo();if(console.log("申请信息请求成功:",n),!n.data||0!==n.data.code)throw console.warn("获取申请信息失败:",(null==(e=n.data)?void 0:e.msg)||"未知错误"),c.value=!0,new Error((null==(a=n.data)?void 0:a.msg)||"获取申请信息失败");s.value=n.data.data,console.log("申请信息:",s.value),c.value=!0,console.log("数据准备完成，可以渲染Workbench组件")}catch(n){throw console.error("获取申请信息失败:",n),c.value=!0,n}},h=e=>{r.value=e},b=e=>{r.value=e.detail.current};return(o,a)=>e.e({a:!c.value},c.value?{b:e.p({applicationInfo:s.value}),c:e.p({applicationInfo:s.value}),d:r.value,e:e.o(b),f:i.value,g:e.o(v),h:e.o(p),i:e.o(f)}:{},{j:c.value},c.value?{k:0===r.value?"/static/icons/tabbar/grid-fill.png":"/static/icons/tabbar/grid.png",l:0===r.value?1:"",m:e.o((e=>h(0))),n:1===r.value?"/static/icons/tabbar/profile-fill.png":"/static/icons/tabbar/profile.png",o:1===r.value?1:"",p:e.o((e=>h(1)))}:{})}},r=e._export_sfc(t,[["__scopeId","data-v-f88d0cd9"]]);wx.createPage(r);
