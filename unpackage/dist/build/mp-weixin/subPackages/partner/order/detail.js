"use strict";const e=require("../../../common/vendor.js"),t=require("../../../common/assets.js"),n=require("../../../api/order.js"),a={__name:"detail",setup(a){const o=e.ref({}),i=e.ref(null),s=e.ref(null);e.onLoad((e=>{e.orderId&&(i.value=e.orderId),e.companion_id&&(s.value=e.companion_id),c()}));const c=async()=>{try{e.index.showLoading({title:"加载中..."});const t=await n.getCompanionOrderDetail({order_id:Number(i.value),companion_id:Number(s.value)});if(0!==t.data.code)throw new Error(t.data.msg||"获取订单详情失败");o.value={...t.data.data.order,logs:t.data.data.logs||[]}}catch(t){console.error("加载订单详情失败:",t),e.index.showToast({title:t.message||"加载失败",icon:"none"})}finally{e.index.hideLoading()}},r=t=>{t.user&&t.user.phone&&e.index.showModal({title:"电话联系",content:`是否拨打客户 ${t.user.nick_name} 的电话？`,confirmText:"拨打",cancelText:"取消",success:n=>{n.confirm&&e.index.makePhoneCall({phoneNumber:t.user.phone})}})},d=t=>{e.index.showModal({title:"确认接单",content:"确定要接受这个订单吗？",confirmText:"接单",cancelText:"取消",success:async t=>{if(t.confirm)try{e.index.showLoading({title:"处理中..."}),e.index.showToast({title:"接单成功",icon:"success"}),setTimeout((()=>{c()}),1500)}catch(n){console.error("接单失败:",n),e.index.showToast({title:n.message||"接单失败",icon:"none"})}finally{e.index.hideLoading()}}})},l=t=>{e.index.showModal({title:"拒绝订单",content:"确定要拒绝这个订单吗？",confirmText:"拒绝",cancelText:"取消",success:async t=>{if(t.confirm)try{e.index.showLoading({title:"处理中..."}),e.index.showToast({title:"已拒绝订单",icon:"success"}),setTimeout((()=>{c()}),1500)}catch(n){console.error("拒绝订单失败:",n),e.index.showToast({title:n.message||"操作失败",icon:"none"})}finally{e.index.hideLoading()}}})},u=t=>{e.index.showModal({title:"确认到达",content:"确认您已到达服务地点？",confirmText:"确认",cancelText:"取消",success:async t=>{if(t.confirm)try{e.index.showLoading({title:"更新中..."}),e.index.showToast({title:"已确认到达",icon:"success"}),setTimeout((()=>{c()}),1500)}catch(n){console.error("确认到达失败:",n),e.index.showToast({title:n.message||"操作失败",icon:"none"})}finally{e.index.hideLoading()}}})},x=t=>{t.user&&t.user.phone&&e.index.showModal({title:"电话联系",content:`是否拨打客户 ${t.user.nick_name} 的电话？`,confirmText:"拨打",cancelText:"取消",success:n=>{n.confirm&&e.index.makePhoneCall({phoneNumber:t.user.phone})}})},m=t=>{e.index.showModal({title:"确认出发",content:"确认您已开始出发前往服务地点？",confirmText:"确认",cancelText:"取消",success:async t=>{if(t.confirm)try{e.index.showLoading({title:"更新中..."}),e.index.showToast({title:"已确认出发",icon:"success"}),setTimeout((()=>{c()}),1500)}catch(n){console.error("确认出发失败:",n),e.index.showToast({title:n.message||"操作失败",icon:"none"})}finally{e.index.hideLoading()}}})},h=t=>{e.index.showModal({title:"开始服务",content:"确定要开始服务吗？",confirmText:"开始",cancelText:"取消",success:async t=>{if(t.confirm)try{e.index.showLoading({title:"更新中..."}),e.index.showToast({title:"服务已开始",icon:"success"}),setTimeout((()=>{c()}),1500)}catch(n){console.error("开始服务失败:",n),e.index.showToast({title:n.message||"操作失败",icon:"none"})}finally{e.index.hideLoading()}}})},v=t=>{e.index.showModal({title:"结束服务",content:"确定要结束服务吗？",confirmText:"结束",cancelText:"取消",success:async t=>{if(t.confirm)try{e.index.showLoading({title:"更新中..."}),e.index.showToast({title:"服务已结束",icon:"success"}),setTimeout((()=>{c()}),1500)}catch(n){console.error("结束服务失败:",n),e.index.showToast({title:n.message||"操作失败",icon:"none"})}finally{e.index.hideLoading()}}})},y=t=>{e.index.navigateTo({url:`/subPackages/partner/review?orderId=${t.id}`})},g=t=>{e.index.navigateTo({url:`/subPackages/partner/rebook?orderId=${t.id}`})},p=t=>{e.index.showModal({title:"删除订单",content:"确定要删除这个订单吗？删除后不可恢复。",confirmText:"删除",cancelText:"取消",success:async t=>{if(t.confirm)try{e.index.showLoading({title:"删除中..."}),e.index.showToast({title:"订单已删除",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),1500)}catch(n){console.error("删除订单失败:",n),e.index.showToast({title:n.message||"删除失败",icon:"none"})}finally{e.index.hideLoading()}}})},w=e=>{if(!e)return"";const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},f=(e,t)=>{if(!e&&!t)return"待确认";let n="";if(e){const t=new Date(e);n+=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${["周日","周一","周二","周三","周四","周五","周六"][t.getDay()]}`}return t&&(n&&(n+=" "),n+=t),n||"待确认"};return(n,a)=>{var i,s,c,T,_;return e.e({a:n.$imgBaseUrl+o.value.service_image_url,b:e.t(o.value.service_name),c:e.t(o.value.unit_price),d:e.t(o.value.unit),e:e.t(o.value.quantity),f:e.t(o.value.total_amount),g:e.t(null==(s=null==(i=o.value)?void 0:i.user)?void 0:s.nick_name),h:e.t(null==(T=null==(c=o.value)?void 0:c.user)?void 0:T.phone),i:e.t(o.value.service_address),j:[2,3,4,5,11].includes(o.value.status)},[2,3,4,5,11].includes(o.value.status)?{k:e.o((t=>{var n;(n=o.value).user_latitude&&n.user_longitude?e.index.openLocation({latitude:Number(n.user_latitude),longitude:Number(n.user_longitude),address:n.service_address}):e.index.showToast({title:"暂无位置信息",icon:"none"})}))}:{},{l:e.t(f(o.value.service_date,o.value.service_time)),m:e.t(o.value.order_no),n:t._imports_0$6,o:e.o((t=>{var n;(n=o.value.order_no)?e.index.setClipboardData({data:n,success:()=>{e.index.showToast({title:"订单号已复制",icon:"success"})},fail:()=>{e.index.showToast({title:"复制失败",icon:"none"})}}):e.index.showToast({title:"订单号为空",icon:"none"})})),p:o.value.start_time},o.value.start_time?{q:e.t(w(o.value.start_time))}:{},{r:o.value.end_time},o.value.end_time?{s:e.t(w(o.value.end_time))}:{},{t:e.t(w(o.value.created_at)),v:o.value.payment_time},o.value.payment_time?{w:e.t(w(o.value.payment_time))}:{},{x:o.value.remark},o.value.remark?{y:e.t(o.value.remark)}:{},{z:e.f((_=o.value.status,{2:[{text:"拒绝",action:"reject",type:"secondary"},{text:"接单",action:"accept",type:"primary"}],3:[{text:"电话联系",action:"contact",type:"secondary"},{text:"我已到达服务地点",action:"arrived",type:"primary"}],4:[{text:"电话联系",action:"call",type:"secondary"}],5:[{text:"电话联系",action:"contact",type:"secondary"},{text:"结束服务",action:"end",type:"primary"}],6:[{text:"查看评价",action:"review",type:"secondary"},{text:"删除订单",action:"delete",type:"secondary"}],7:[{text:"删除订单",action:"delete",type:"secondary"}],8:[{text:"删除订单",action:"delete",type:"secondary"}],9:[{text:"订单已取消，给客户退款中",action:"info",type:"info"}],11:[{text:"电话联系",action:"contact",type:"secondary"},{text:"我已出发",action:"depart",type:"depart"}]}[_]||[]),((t,n,a)=>({a:e.t(t.text),b:n,c:e.n(t.type),d:e.o((e=>((e,t)=>{switch(e){case"contact":r(t);break;case"accept":d();break;case"reject":l();break;case"arrived":u();break;case"depart":m();break;case"call":x(t);break;case"start":h();break;case"end":v();break;case"review":y(t);break;case"rebook":g(t);break;case"delete":p()}})(t.action,o.value)),n)})))})}}},o=e._export_sfc(a,[["__scopeId","data-v-91d616e5"]]);wx.createPage(o);
