"use strict";const e=require("../../common/vendor.js"),a=require("../../api/order.js"),n={__name:"evaluate-detail",setup(n){const{proxy:t}=e.getCurrentInstance(),o=e.ref(""),m=e.ref({}),i=e.ref({rating:0,comment:"",comment_images:[],created_at:"",is_anonymous:!1});e.onLoad((e=>{e.orderId&&(o.value=e.orderId,r(),c())}));const r=async()=>{try{e.index.showLoading({title:"加载中..."});const n=await a.getOrderDetail({order_id:Number(o.value)});if(0!==n.data.code)throw new Error(n.data.msg||"获取订单详情失败");{const e=n.data.data.order;m.value={service_name:e.service_name,service_image:e.service_image_url,unit_price:e.unit_price,unit:e.unit,quantity:e.quantity,total_amount:e.total_amount},console.log("订单详情加载成功:",e)}}catch(n){console.error("加载订单详情失败:",n),e.index.showToast({title:n.message||"加载失败",icon:"none"})}finally{e.index.hideLoading()}},c=async()=>{try{const e=await a.getOrderCommentList({order_id:Number(o.value)});if(0===e.data.code){const a=e.data.data.list||[],n=a.find((e=>0===e.is_companion)),t=a.find((e=>1===e.is_companion));n&&(i.value={rating:n.rating||5,comment:n.comment||"",comment_images:n.comment_images||[],created_at:n.comment_time||n.updated_at||"",is_anonymous:1===n.is_anonymous,user_nickname:n.user_nickname||n.user_name||"用户",user_avatar:n.head_image||""}),t&&(i.value.companion_reply={comment:t.comment||"",comment_images:t.comment_images||[],created_at:t.comment_time||t.updated_at||"",companion_nickname:t.user_nickname||t.user_name||"友伴师",companion_avatar:t.companion_img||""}),console.log("评价列表加载成功:",a),console.log("处理后的评价信息:",i.value)}else console.warn("获取评价列表失败:",e.data.message)}catch(e){console.error("加载评价列表失败:",e)}},s=e=>{if(!e)return"未知时间";const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`};return(a,n)=>e.e({a:e.unref(t).$imgBaseUrl+m.value.service_image,b:e.t(m.value.service_name),c:e.t(m.value.unit_price),d:e.t(m.value.unit),e:e.t(m.value.quantity),f:e.t(m.value.total_amount),g:e.f(5,((e,a,n)=>({a:e,b:e<=i.value.rating?1:""}))),h:e.t(i.value.rating),i:e.t(i.value.comment||"暂无评价内容"),j:i.value.comment_images&&i.value.comment_images.length>0},i.value.comment_images&&i.value.comment_images.length>0?{k:e.f(i.value.comment_images,((a,n,o)=>({a:e.unref(t).$imgBaseUrl+a,b:n,c:e.o((a=>(a=>{console.log("commentInfo.value.comment_images",i.value.comment_images);const n=i.value.comment_images.map((e=>t.$imgBaseUrl+e));e.index.previewImage({urls:n,current:a})})(n)),n)})))}:{},{l:e.t(s(i.value.created_at)),m:i.value.is_anonymous},(i.value.is_anonymous,{}),{n:i.value.companion_reply},i.value.companion_reply?e.e({o:e.unref(t).$imgBaseUrl+i.value.companion_reply.companion_avatar,p:e.t(i.value.companion_reply.companion_nickname),q:e.t(s(i.value.companion_reply.created_at)),r:e.t(i.value.companion_reply.comment),s:i.value.companion_reply.comment_images&&i.value.companion_reply.comment_images.length>0},i.value.companion_reply.comment_images&&i.value.companion_reply.comment_images.length>0?{t:e.f(i.value.companion_reply.comment_images,((a,n,o)=>({a:e.unref(t).$imgBaseUrl+a,b:n,c:e.o((a=>(a=>{const n=i.value.companion_reply.comment_images.map((e=>t.$imgBaseUrl+e));e.index.previewImage({urls:n,current:a})})(n)),n)})))}:{}):{})}},t=e._export_sfc(n,[["__scopeId","data-v-ae96aa5f"]]);wx.createPage(t);
