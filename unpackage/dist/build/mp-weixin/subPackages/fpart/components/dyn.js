"use strict";const e=require("../../../common/vendor.js"),o=require("../../../common/assets.js"),n=require("../../../api/discover.js");if(!Array){e.resolveComponent("u-popup")()}Math||(s+(()=>"../../../uni_modules/uview-plus/components/u-popup/u-popup.js"))();const s=()=>"../../../components/common/PictureDisplay.js",a={__name:"dyn",setup(s){const a=e.ref({}),t=e.ref([]),i=e.ref(!1),l=e.ref(1),m=e.ref(20),u=e.ref(!1),_=e.ref(!1),r=e.ref(!1),v=e.ref(!1),p=e.ref(""),c=async(e=!1)=>{var o;if(a.value.companion_id)try{e?(r.value=!0,l.value=1,_.value=!1):1===l.value?i.value=!0:u.value=!0;const s={companion_id:parseInt(a.value.companion_id),page:l.value,page_size:m.value},v=await n.getMomentsByCompanion(s);if(console.log("动态列表响应:",v),v.data&&0===v.data.code){const o=v.data.data;o&&o.moments_list&&(e||1===l.value?t.value=o.moments_list:t.value=[...t.value,...o.moments_list],o.moments_list.length<m.value&&(_.value=!0),console.log("动态列表数据:",t.value))}else console.error("获取动态列表失败:",(null==(o=v.data)?void 0:o.message)||"未知错误"),!e&&l.value>1&&l.value--}catch(s){console.error("获取动态列表异常:",s),!e&&l.value>1&&l.value--}finally{i.value=!1,u.value=!1,r.value=!1}},d=e=>{console.log("播放视频:",e),p.value=e,v.value=!0},f=()=>{v.value=!1,p.value=""},g=async o=>{try{const s=o.moments_info.is_praised;o.moments_info.is_praised=!s,o.moments_info.is_praised?o.moments_info.praise_num=parseInt(o.moments_info.praise_num)+1:o.moments_info.praise_num=Math.max(0,parseInt(o.moments_info.praise_num)-1);const a=await n.praiseMoment({target_id:o.moments_info.moments_id});a.data&&0===a.data.code?console.log("点赞成功"):(o.moments_info.is_praised=s,o.moments_info.praise_num=s?parseInt(o.moments_info.praise_num)+1:Math.max(0,parseInt(o.moments_info.praise_num)-1),e.index.showToast({title:"点赞失败，请重试",icon:"none"}))}catch(s){console.error("点赞失败:",s);const n=o.moments_info.is_praised;o.moments_info.is_praised=!n,o.moments_info.praise_num=n?parseInt(o.moments_info.praise_num)+1:Math.max(0,parseInt(o.moments_info.praise_num)-1),e.index.showToast({title:"网络错误，请重试",icon:"none"})}},h=()=>{console.log("触发上拉加载"),u.value||_.value||(l.value++,c())},y=()=>{console.log("触发下拉刷新"),c(!0)};return e.onMounted((async()=>{const e=getCurrentPages(),o=e[e.length-1];a.value=o.options||{},console.log("页面参数:",a.value),a.value.companion_id&&c()})),(n,s)=>e.e({a:i.value&&0===t.value.length},i.value&&0===t.value.length?{}:t.value.length>0?e.e({c:e.f(t.value,((n,s,a)=>{var t,i,l,m,u,_,r,v,p,c,f,h,y;return e.e({a:e.t(null==(t=n.moments_info)?void 0:t.time_date),b:e.t(null==(i=n.moments_info)?void 0:i.time_time),c:e.t(null==(l=n.moments_info)?void 0:l.content),d:null==(m=n.moments_info)?void 0:m.file_list},(null==(u=n.moments_info)?void 0:u.file_list)?{e:e.o(d,s),f:"ddacb059-0-"+a,g:e.p({list:null==(_=n.moments_info)?void 0:_.file_list,topicList:null==(r=n.moments_info)?void 0:r.topic_list})}:{},{h:!(null==(v=n.moments_info)?void 0:v.is_praised)},(null==(p=n.moments_info)?void 0:p.is_praised)?{}:{i:o._imports_0$3,j:e.o((e=>g(n)),s)},{k:null==(c=n.moments_info)?void 0:c.is_praised},(null==(f=n.moments_info)?void 0:f.is_praised)?{l:o._imports_1$1,m:e.o((e=>g(n)),s)}:{},{n:e.t((null==(h=n.moments_info)?void 0:h.praise_num)||0),o:e.t((null==(y=n.moments_info)?void 0:y.comments_num)||0),p:e.o((o=>(o=>{e.index.navigateTo({url:"/subPackages/record/comment",success(e){e.eventChannel.emit("getRecord",{data:o})}})})(n)),s),q:s})})),d:o._imports_2$1,e:u.value},(u.value||_.value&&t.value.length,{}),{f:_.value&&t.value.length>0}):{g:o._imports_3},{b:t.value.length>0,h:p.value,i:o._imports_8,j:e.o(f),k:e.p({show:v.value,mode:"center",safeAreaInsetBottom:!1}),l:e.o(h),m:r.value,n:e.o(y)})}},t=e._export_sfc(a,[["__scopeId","data-v-ddacb059"]]);wx.createPage(t);
