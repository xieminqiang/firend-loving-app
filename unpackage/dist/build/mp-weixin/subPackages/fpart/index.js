"use strict";const e=require("../../common/vendor.js"),o=require("../../api/user.js"),a=require("../../stores/level.js"),n=require("../../stores/user.js");Math||(l+t)();const l=()=>"./components/Workbench.js",t=()=>"./components/Profile.js",r={__name:"index",setup(l){const t=n.useUserStore(),r=a.useLevelStore(),s=e.ref(0),c=e.ref(0),i=e.ref(null),u=e.ref(!1),v=e.ref(!1);e.onMounted((()=>{const o=e.index.getSystemInfoSync();s.value=o.statusBarHeight||0,b(),e.index.$on("applicationStatusChanged",d),e.index.$on("refreshApplicationInfo",p)})),e.onUnmounted((()=>{e.index.$off("applicationStatusChanged",d),e.index.$off("refreshApplicationInfo",p)}));const d=e=>{console.log("收到申请状态变化事件:",e),"video_uploaded"===e.type&&(console.log("视频上传成功，刷新申请信息"),b(),r.clearServiceLevels())},p=()=>{console.log("收到刷新申请信息事件"),b()},f=async()=>{console.log("开始下拉刷新"),v.value=!0;try{await b()}catch(o){console.error("下拉刷新失败:",o),e.index.showToast({title:"刷新失败，请重试",icon:"error",duration:2e3})}finally{setTimeout((()=>{v.value=!1}),500)}},g=()=>{console.log("刷新状态恢复")},h=()=>{console.log("刷新状态中止"),v.value=!1},b=async()=>{var e,a;try{console.log("开始请求申请信息");const n=await o.getApplicatioInfo();if(console.log("申请信息请求成功:",n),!n.data||0!==n.data.code)throw console.warn("获取申请信息失败:",(null==(e=n.data)?void 0:e.msg)||"未知错误"),u.value=!0,new Error((null==(a=n.data)?void 0:a.msg)||"获取申请信息失败");i.value=n.data.data,console.log("申请信息:",i.value),u.value=!0,console.log("数据准备完成，可以渲染Workbench组件")}catch(n){throw console.error("获取申请信息失败:",n),u.value=!0,n}},m=e=>{c.value=e},w=e=>{c.value=e.detail.current};return(o,a)=>e.e({a:1==e.unref(t).switch},1==e.unref(t).switch?e.e({b:!u.value},u.value?{c:e.p({applicationInfo:i.value}),d:e.p({applicationInfo:i.value}),e:c.value,f:e.o(w),g:v.value,h:e.o(f),i:e.o(g),j:e.o(h)}:{},{k:u.value},u.value?{l:0===c.value?"/static/icons/tabbar/grid-fill.png":"/static/icons/tabbar/grid.png",m:0===c.value?1:"",n:e.o((e=>m(0))),o:1===c.value?"/static/icons/tabbar/profile-fill.png":"/static/icons/tabbar/profile.png",p:1===c.value?1:"",q:e.o((e=>m(1)))}:{}):{})}},s=e._export_sfc(r,[["__scopeId","data-v-8c112de3"]]);wx.createPage(s);
