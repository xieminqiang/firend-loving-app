"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),l=require("../../api/home.js"),t={__name:"detail",setup(t){const o=e.ref({}),u=e.ref(!0),s=e.ref(""),v=e.ref({}),r=e.ref({});e.onMounted((()=>{const e=getCurrentPages(),a=e[e.length-1];if(o.value=a.options||{},console.log("详情页参数:",o.value),!o.value.id)return s.value="缺少服务ID参数",void(u.value=!1);n()}));const n=async()=>{u.value=!0,s.value="";try{const a=await l.getServiceDetail(o.value.id);if(!a.data||0!==a.data.code)throw new Error(a.data&&a.data.message||"获取服务详情失败");{v.value=a.data.data;const t=o.value.price_template_id||v.value.price_template_id;if(t){console.log("加载价格模板详情, ID:",t);try{const e=await l.getPriceTemplateDetail(t);e.data&&0===e.data.code?(r.value=e.data.data,console.log("价格模板加载成功:",r.value)):console.warn("价格模板接口返回错误:",e.data)}catch(e){console.warn("获取价格模板失败:",e)}}else console.log("没有价格模板ID，跳过价格模板加载")}}catch(a){console.error("加载数据失败:",a),s.value=a.message||"加载失败，请重试"}finally{u.value=!1}},i=()=>{console.log("图片加载失败")},c=()=>{if(v.value&&v.value.image_url){const a="https://sbx-server.oss-cn-shenzhen.aliyuncs.com",l=v.value.image_url.startsWith("http")?v.value.image_url:a+v.value.image_url;console.log("预览图片URL:",l),e.index.previewImage({urls:[l],current:l,success:()=>{console.log("图片预览成功")},fail:a=>{console.error("图片预览失败:",a),e.index.showToast({title:"图片预览失败",icon:"none"})}})}else e.index.showToast({title:"图片加载中，请稍后再试",icon:"none"})},d=()=>{e.index.navigateTo({url:`/subPackages/py/friend-select?service_id=${v.value.id}`})};return(l,t)=>e.e({a:u.value},u.value||s.value?{}:e.e({c:l.$imgBaseUrl+v.value.image_url,d:e.o(i),e:e.o(c),f:e.t(v.value.name||"服务详情"),g:v.value.min_price},v.value.min_price?e.e({h:e.t(v.value.min_price),i:r.value.unit},r.value.unit?{j:e.t(r.value.unit)}:{}):{},{k:v.value.tags&&v.value.tags.length>0},v.value.tags&&v.value.tags.length>0?{l:e.f(v.value.tags,((a,l,t)=>({a:e.t(a),b:a})))}:{},{m:r.value&&r.value.levels&&r.value.levels.length>0},r.value&&r.value.levels&&r.value.levels.length>0?{n:a._imports_0,o:e.f(r.value.levels,((a,l,t)=>e.e({a:e.t(a.level_name),b:a.level_order<=2},a.level_order<=2?{c:e.t(1===a.level_order?"入门":"推荐")}:{},{d:e.t(a.price),e:e.t(a.unit),f:a.id})))}:{},{p:a._imports_1,q:e.t(v.value.description||"暂无详细说明")}),{b:!s.value,r:!u.value&&!s.value},u.value||s.value?{}:{s:e.o(d)},{t:s.value},s.value?{v:a._imports_3,w:e.t(s.value),x:e.o(n)}:{})}},o=e._export_sfc(t,[["__scopeId","data-v-8e466b25"]]);wx.createPage(o);
