"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),l=require("../../api/home.js"),t={__name:"detail",setup(t){const o=e.ref({}),s=e.ref(!0),u=e.ref(""),r=e.ref({}),v=e.ref({});e.onMounted((()=>{const e=getCurrentPages(),a=e[e.length-1];if(o.value=a.options||{},console.log("详情页参数:",o.value),!o.value.id)return u.value="缺少服务ID参数",void(s.value=!1);i()}));const i=async()=>{s.value=!0,u.value="";try{const a=await l.getServiceDetail(o.value.id);if(!a.data||0!==a.data.code)throw new Error(a.data&&a.data.message||"获取服务详情失败");{r.value=a.data.data;const t=o.value.price_template_id||r.value.price_template_id;if(t){console.log("加载价格模板详情, ID:",t);try{const e=await l.getPriceTemplateDetail(t);e.data&&0===e.data.code?(v.value=e.data.data,console.log("价格模板加载成功:",v.value)):console.warn("价格模板接口返回错误:",e.data)}catch(e){console.warn("获取价格模板失败:",e)}}else console.log("没有价格模板ID，跳过价格模板加载")}}catch(a){console.error("加载数据失败:",a),u.value=a.message||"加载失败，请重试"}finally{s.value=!1}},n=()=>{e.index.navigateBack()},c=()=>{console.log("图片加载失败")},d=()=>{if(r.value&&r.value.image_url){const a="https://sbx-server.oss-cn-shenzhen.aliyuncs.com",l=r.value.image_url.startsWith("http")?r.value.image_url:a+r.value.image_url;console.log("预览图片URL:",l),e.index.previewImage({urls:[l],current:l,success:()=>{console.log("图片预览成功")},fail:a=>{console.error("图片预览失败:",a),e.index.showToast({title:"图片预览失败",icon:"none"})}})}else e.index.showToast({title:"图片加载中，请稍后再试",icon:"none"})},g=()=>{e.index.navigateTo({url:`/subPackages/friend/friend-select?service_id=${r.value.id}`})};return(l,t)=>e.e({a:s.value},s.value||u.value?{}:e.e({c:a._imports_0$3,d:e.o(n),e:l.$imgBaseUrl+r.value.image_url,f:e.o(c),g:e.o(d),h:e.t(r.value.name||"服务详情"),i:r.value.min_price},r.value.min_price?e.e({j:e.t(r.value.min_price),k:v.value.unit},v.value.unit?{l:e.t(v.value.unit)}:{}):{},{m:r.value.tags&&r.value.tags.length>0},r.value.tags&&r.value.tags.length>0?{n:e.f(r.value.tags,((a,l,t)=>({a:e.t(a),b:a})))}:{},{o:v.value&&v.value.levels&&v.value.levels.length>0},v.value&&v.value.levels&&v.value.levels.length>0?{p:a._imports_1$3,q:e.f(v.value.levels,((a,l,t)=>e.e({a:e.t(a.level_name),b:a.level_order<=2},a.level_order<=2?{c:e.t(1===a.level_order?"入门":"推荐")}:{},{d:e.t(a.price),e:e.t(a.unit),f:a.id})))}:{},{r:a._imports_2$2,s:e.t(r.value.description||"暂无详细说明")}),{b:!u.value,t:!s.value&&!u.value},s.value||u.value?{}:{v:e.o(g)},{w:u.value},u.value?{x:a._imports_3,y:e.t(u.value),z:e.o(i)}:{})}},o=e._export_sfc(t,[["__scopeId","data-v-8968dfcc"]]);wx.createPage(o);
