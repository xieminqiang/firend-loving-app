"use strict";const e=require("../../common/vendor.js"),o=require("../../api/user.js"),n=require("../../stores/user.js"),a=require("../../stores/level.js");if(!Array){e.resolveComponent("uni-popup")()}Math;const t={__name:"index",setup(t){const s=n.useUserStore(),i=a.useLevelStore(),c=e.ref(null),r=e.ref(!0),d=e.ref(!1);e.onLoad((async()=>{const o=e.index.getSystemInfoSync();console.log("系统信息:",o),setTimeout((()=>{c.value&&c.value.open()}),500)}));const l=()=>{c.value.close(),setTimeout((()=>{e.index.navigateBack({delta:1})}),300)},u=()=>{d.value=!0,c.value.close()},g=e=>{r.value=e.show},v=()=>{e.index.navigateTo({url:"/subPackages/login/agreement"})},x=()=>{e.index.navigateTo({url:"/subPackages/login/policy"})},p=async n=>{var a;console.log("getPhoneNumber event:",n);const t=n.detail;if(t.code)try{const n=await e.index.login({provider:"weixin"});e.index.showLoading({title:"登录中...",mask:!0});const c=await o.wxLogin({login_code:n.code,phone_code:t.code});e.index.hideLoading(),c.data&&0===c.data.code?(s.setUserInfo(c.data.data.token),s.setToken(c.data.data.token.access_token),i.clearServiceLevels(),e.index.$emit("loginSuccess",{userInfo:c.data.data}),e.index.showToast({title:"登录成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack({delta:1})}),1500)):e.index.showToast({title:(null==(a=c.data)?void 0:a.msg)||"登录失败",icon:"none"})}catch(c){e.index.hideLoading(),console.error("登录失败:",c),e.index.showToast({title:"登录失败，请重试",icon:"none"})}else e.index.showToast({title:"授权失败，请重试",icon:"none"})};return(o,n)=>({a:o.$imgBaseUrl+"/img/cum/logo_small_01.jpeg",b:e.o(p),c:e.o(v),d:e.o(x),e:e.o(l),f:e.o(u),g:e.sr(c,"e8cf0ec9-0",{k:"popup"}),h:e.o(g),i:e.p({safeArea:!1,type:"center"})})}},s=e._export_sfc(t,[["__scopeId","data-v-e8cf0ec9"]]);wx.createPage(s);
