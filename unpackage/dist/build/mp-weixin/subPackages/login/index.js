"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js"),a=require("../../api/user.js"),n=require("../../stores/user.js"),t=require("../../stores/level.js");if(!Array){e.resolveComponent("uni-popup")()}Math;const s={__name:"index",setup(s){const i=n.useUserStore(),c=t.useLevelStore(),d=e.ref(null),r=e.ref(!0),l=e.ref(!1);e.onLoad((async()=>{const o=e.index.getSystemInfoSync();console.log("系统信息:",o),setTimeout((()=>{d.value&&d.value.open()}),500)}));const u=()=>{e.index.navigateBack({delta:1})},g=()=>{d.value.close(),setTimeout((()=>{u()}),300)},v=()=>{l.value=!0,d.value.close()},p=e=>{r.value=e.show},x=()=>{e.index.navigateTo({url:"/subPackages/login/agreement"})},m=()=>{e.index.navigateTo({url:"/subPackages/login/policy"})},f=async o=>{var n;console.log("getPhoneNumber event:",o);const t=o.detail;if(t.code)try{const o=await e.index.login({provider:"weixin"});e.index.showLoading({title:"登录中...",mask:!0});const s=await a.wxLogin({login_code:o.code,phone_code:t.code});e.index.hideLoading(),s.data&&0===s.data.code?(i.setUserInfo(s.data.data.token),i.setToken(s.data.data.token.access_token),c.clearServiceLevels(),e.index.$emit("loginSuccess",{userInfo:s.data.data}),e.index.showToast({title:"登录成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack({delta:1})}),1500)):e.index.showToast({title:(null==(n=s.data)?void 0:n.msg)||"登录失败",icon:"none"})}catch(s){e.index.hideLoading(),console.error("登录失败:",s),e.index.showToast({title:"登录失败，请重试",icon:"none"})}else e.index.showToast({title:"授权失败，请重试",icon:"none"})};return(a,n)=>({a:o._imports_0,b:e.o(u),c:a.$imgBaseUrl+"/img/20250812/fa380b9964f9fabea946752d163ad1a1/c2bde904-004a-414d-84eb-a95da538b9f7.png",d:e.o(f),e:e.o(x),f:e.o(m),g:e.o(g),h:e.o(v),i:e.sr(d,"961903e0-0",{k:"popup"}),j:e.o(p),k:e.p({safeArea:!1,type:"center"})})}},i=e._export_sfc(s,[["__scopeId","data-v-961903e0"]]);wx.createPage(i);
