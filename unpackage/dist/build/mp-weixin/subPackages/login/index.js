"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js"),n=require("../../api/user.js"),s=require("../../stores/user.js"),t=require("../../stores/level.js");if(!Array){e.resolveComponent("uni-popup")()}Math;const a={__name:"index",setup(a){const i=s.useUserStore(),r=t.useLevelStore(),c=e.ref(null),d=e.ref(!0),l=e.ref(!1);e.onLoad((async()=>{const o=e.index.getSystemInfoSync();console.log("系统信息:",o),setTimeout((()=>{c.value&&c.value.open()}),500)}));const u=()=>{e.index.navigateBack({delta:1})},g=()=>{c.value.close(),setTimeout((()=>{u()}),300)},v=()=>{l.value=!0,c.value.close()},p=e=>{d.value=e.show},x=()=>{e.index.navigateTo({url:"/subPackages/login/agreement"})},m=()=>{e.index.navigateTo({url:"/subPackages/login/policy"})},h=async o=>{var s;console.log("getPhoneNumber event:",o);const t=o.detail;if(t.code)try{const o=await e.index.login({provider:"weixin"});e.index.showLoading({title:"登录中...",mask:!0});const a=await n.wxLogin({login_code:o.code,phone_code:t.code});e.index.hideLoading(),a.data&&0===a.data.code?(i.setUserInfo(a.data.data.token),r.clearServiceLevels(),e.index.$emit("loginSuccess",{userInfo:a.data.data}),e.index.showToast({title:"登录成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack({delta:1})}),1500)):e.index.showToast({title:(null==(s=a.data)?void 0:s.msg)||"登录失败",icon:"none"})}catch(a){e.index.hideLoading(),console.error("登录失败:",a),e.index.showToast({title:"登录失败，请重试",icon:"none"})}else e.index.showToast({title:"授权失败，请重试",icon:"none"})};return(n,s)=>({a:o._imports_0$2,b:e.o(u),c:o._imports_1$2,d:e.o(h),e:e.o(x),f:e.o(m),g:e.o(g),h:e.o(v),i:e.sr(c,"16262a5d-0",{k:"popup"}),j:e.o(p),k:e.p({safeArea:!1,type:"center"})})}},i=e._export_sfc(a,[["__scopeId","data-v-16262a5d"]]);wx.createPage(i);
