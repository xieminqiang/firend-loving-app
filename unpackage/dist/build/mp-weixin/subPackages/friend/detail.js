"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),l=require("../../api/friends.js"),t=require("../../stores/level.js"),i={__name:"detail",setup(i){const r=e.ref({}),o=t.useLevelStore(),v=e.ref(0),n=e.ref({}),s=e.ref([]),u=e.ref([]),d=e.computed((()=>n.value.level_order&&o.sortedServiceLevels.length?o.sortedServiceLevels.find((e=>e.level_order===n.value.level_order)):null)),c=[];return e.onMounted((async()=>{await o.fetchServiceLevels();const e=getCurrentPages(),a=e[e.length-1];r.value=a.options||{},console.log("页面参数:",r.value),console.log("经纬度参数:",{latitude:r.value.latitude,longitude:r.value.longitude}),r.value.id&&r.value.city_code&&(async()=>{var e;try{const a={city_code:r.value.city_code,application_id:r.value.id};r.value.latitude&&r.value.longitude&&(a.latitude=parseFloat(r.value.latitude),a.longitude=parseFloat(r.value.longitude));const t=await l.getCityServices(a);if(console.log("城市服务信息响应:",t),t.data&&0===t.data.code){const e=t.data.data;console.log("城市服务数据:",e),e&&(n.value={avatar:e.avatar,nickname:e.nickname||"未知用户",verified:!0,age:e.age,weight:e.weight,height:e.height,distance:e.distance,tags:e.tags||[],level_order:e.level_order,levelIcon:"",gender:e.gender||""},e.photos&&e.photos.length>0&&(s.value=e.photos.map((e=>({img:e})))),e.services&&e.services.length>0&&(u.value=e.services))}else console.error("获取城市服务失败:",(null==(e=t.data)?void 0:e.message)||"未知错误")}catch(a){console.error("获取城市服务异常:",a)}})()})),(l,t)=>{var i,o,g,_;return e.e({a:n.value.avatar,b:e.t(n.value.nickname),c:n.value.verified&&d.value},n.value.verified&&d.value?{d:null==(i=d.value)?void 0:i.icon_url}:{},{e:null==(o=d.value)?void 0:o.level_name},(null==(g=d.value)?void 0:g.level_name)?{f:e.t(null==(_=d.value)?void 0:_.level_name)}:{},{g:e.f(s.value,((e,a,l)=>({a:e.img,b:a}))),h:u.value.length>0},u.value.length>0?{i:e.f(u.value,((a,t,i)=>({a:l.$imgBaseUrl+a.service_image_url,b:e.t(a.service_name),c:e.f(a.service_tags,((a,l,t)=>({a:e.t(a),b:a}))),d:e.t(a.price),e:e.t(a.unit||"小时"),f:e.o((l=>(a=>{e.index.navigateTo({url:`/subPackages/order/submit?service_id=${a.service_id}&price_template_id=${a.price_template_id||""}&companion_id=${r.value.id}&level_order=${n.value.level_order||""}&nickname=${n.value.nickname}`})})(a)),a.title),g:a.title})))}:{j:a._imports_3},{k:0===v.value,l:a._imports_3,m:1===v.value,n:c.length>0},c.length>0?{o:e.f(c,((a,l,t)=>({a:a.avatar,b:e.t(a.name),c:e.f(5,((l,t,i)=>({a:l,b:e.n({filled:l<=a.stars})}))),d:e.t(a.stars>=4?"好评":"中评"),e:e.f(a.tags,((a,l,t)=>({a:e.t(a),b:a}))),f:e.t(a.content),g:e.t(a.date),h:l})))}:{p:a._imports_3},{q:2===v.value})}}},r=e._export_sfc(i,[["__scopeId","data-v-24088447"]]);wx.createPage(r);
