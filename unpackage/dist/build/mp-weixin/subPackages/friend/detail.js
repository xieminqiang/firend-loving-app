"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),t=require("../../api/friends.js"),l=require("../../stores/level.js"),i=require("../../stores/user.js"),r={__name:"detail",setup(r){const n=e.ref({}),{proxy:o}=e.getCurrentInstance(),s=l.useLevelStore(),u=i.useUserStore(),v=e.computed((()=>u.userInfo&&Object.keys(u.userInfo).length>0));e.computed((()=>{if(v.value)return u.userInfo}));const c=["提供项目","TA的动态","客户评价"],d=e.ref(0);const g=e.ref({}),_=e.ref([]),m=e.ref([]),f=e.computed((()=>g.value.level_order&&s.sortedServiceLevels.length?s.sortedServiceLevels.find((e=>e.level_order===g.value.level_order)):null)),p=[],h=a=>{if(!v.value)return e.index.showToast({title:"请先登录",icon:"none",duration:2e3}),void e.index.navigateTo({url:"/subPackages/login/index"});e.index.navigateTo({url:`/subPackages/order/submit?service_id=${a.service_id}&price_template_id=${a.price_template_id||""}&companion_id=${n.value.id}&level_order=${g.value.level_order||""}&nickname=${g.value.nickname}`})};return e.onMounted((async()=>{await s.fetchServiceLevels();const e=getCurrentPages(),a=e[e.length-1];n.value=a.options||{},console.log("页面参数:",n.value),console.log("经纬度参数:",{latitude:n.value.latitude,longitude:n.value.longitude}),n.value.id&&n.value.city_code&&(async()=>{var e;try{const a={city_code:n.value.city_code,application_id:n.value.id};n.value.latitude&&n.value.longitude&&(a.latitude=parseFloat(n.value.latitude),a.longitude=parseFloat(n.value.longitude));const l=await t.getCityServices(a);if(console.log("城市服务信息响应:",l),l.data&&0===l.data.code){const e=l.data.data;console.log("城市服务数据:",e),e&&(g.value={avatar:e.avatar,nickname:e.nickname||"未知用户",verified:!0,age:e.age,weight:e.weight,height:e.height,distance:e.distance,tags:e.tags||[],level_order:e.level_order,levelIcon:"",gender:e.gender||""},e.photos&&e.photos.length>0&&(_.value=e.photos.map((e=>({img:e})))),e.services&&e.services.length>0&&(m.value=e.services))}else console.error("获取城市服务失败:",(null==(e=l.data)?void 0:e.message)||"未知错误")}catch(a){console.error("获取城市服务异常:",a)}})()})),(t,l)=>{var i,r,n,s;return e.e({a:e.unref(o).$imgBaseUrl+g.value.avatar,b:e.t(g.value.nickname),c:g.value.verified&&f.value},g.value.verified&&f.value?{d:null==(i=f.value)?void 0:i.icon_url}:{},{e:null==(r=f.value)?void 0:r.level_name},(null==(n=f.value)?void 0:n.level_name)?{f:e.t(null==(s=f.value)?void 0:s.level_name)}:{},{g:g.value.tags&&g.value.tags.length>0},g.value.tags&&g.value.tags.length>0?{h:e.f(g.value.tags,((a,t,l)=>({a:e.t(a),b:a})))}:{},{i:"女"===g.value.gender?"/static/icons/friend/white_nv.png":"/static/icons/friend/white_nan.png",j:e.t(g.value.age),k:e.t(g.value.weight),l:e.t(g.value.height),m:""!==g.value.distance},""!==g.value.distance?{n:a._imports_0$5,o:e.t(g.value.distance)}:{},{p:e.f(_.value,((a,t,l)=>({a:e.unref(o).$imgBaseUrl+a.img,b:e.o((a=>{return l=t,void e.index.previewImage({urls:_.value.map((e=>o.$imgBaseUrl+e.img)),current:o.$imgBaseUrl+_.value[l].img,indicator:"number",loop:!0,show:!0,success:function(e){console.log("图片预览成功",e)},fail:function(e){console.error("图片预览失败",e)}});var l}),t),c:t}))),q:a._imports_1$2,r:a._imports_2,s:a._imports_3$2,t:e.f(c,((a,t,l)=>e.e({a:e.t(a),b:d.value===t},(d.value,{}),{c:a,d:e.n({active:d.value===t}),e:e.o((e=>function(e){d.value=e}(t)),a)}))),v:m.value.length>0},m.value.length>0?{w:e.f(m.value,((a,t,l)=>({a:e.unref(o).$imgBaseUrl+a.service_image_url,b:e.t(a.service_name),c:e.f(a.service_tags,((a,t,l)=>({a:e.t(a),b:a}))),d:e.t(a.price),e:e.t(a.unit||"小时"),f:e.o((e=>h(a)),a.title),g:a.title})))}:{x:a._imports_3},{y:0===d.value,z:a._imports_3,A:1===d.value,B:p.length>0},p.length>0?{C:e.f(p,((a,t,l)=>({a:a.avatar,b:e.t(a.name),c:e.f(5,((t,l,i)=>({a:t,b:e.n({filled:t<=a.stars})}))),d:e.t(a.stars>=4?"好评":"中评"),e:e.f(a.tags,((a,t,l)=>({a:e.t(a),b:a}))),f:e.t(a.content),g:e.t(a.date),h:t})))}:{D:a._imports_3},{E:2===d.value})}}},n=e._export_sfc(r,[["__scopeId","data-v-4ff55c92"]]);wx.createPage(n);
