"use strict";const e=require("../common/vendor.js"),o=require("../stores/user.js"),t=require("./config.js").config.production.baseUrl,s={invoke(e){var s;e.url.startsWith("http")||(e.url=t+e.url),e.timeout=6e5,e.header={...e.header,"source-client":"miniapp"};const r=o.useUserStore(),i=(null==(s=r.userInfo)?void 0:s.access_token)||(null==r?void 0:r.token);i&&(e.header.Authorization="Bearer "+i)}};e.index.addInterceptor("request",s),e.index.addInterceptor("uploadFile",s);exports.http=o=>new Promise(((t,s)=>{e.index.request({...o,success(o){if(o.statusCode>=200&&o.statusCode<300){if(console.log("222"),o.data&&void 0!==o.data.code&&0!==o.data.code)return void s(o);t(o)}else 401===o.statusCode?(e.index.showToast({icon:"none",title:"请先登录"}),s(o)):(e.index.showToast({icon:"none",title:o.data.msg||"请求错误"}),s(o))},fail(o){e.index.showToast({icon:"none",title:"网络错误，换个网络试试"}),s(o)}})}));
