"use strict";const e=require("../common/vendor.js"),t=require("../stores/user.js"),o=require("./config.js").config.production.baseUrl,s={invoke(e){var s;e.url.startsWith("http")||(e.url=o+e.url),e.timeout=6e5,e.header={...e.header,"source-client":"miniapp"};const r=null==(s=t.useUserStore().userInfo)?void 0:s.access_token;r&&(e.header.Authorization="Bearer "+r)}};e.index.addInterceptor("request",s),e.index.addInterceptor("uploadFile",s);exports.http=t=>new Promise(((o,s)=>{e.index.request({...t,success(t){if(t.statusCode>=200&&t.statusCode<300){if(console.log("222"),t.data&&void 0!==t.data.code&&0!==t.data.code)return void s(t);o(t)}else 401===t.statusCode?(e.index.showToast({icon:"none",title:"请先登录"}),s(t)):(e.index.showToast({icon:"none",title:t.data.msg||"请求错误"}),s(t))},fail(t){e.index.showToast({icon:"none",title:"网络错误，换个网络试试"}),s(t)}})}));
