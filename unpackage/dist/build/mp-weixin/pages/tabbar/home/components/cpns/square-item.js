"use strict";const e=require("../../../../../common/vendor.js"),t=require("../../../../../common/assets.js"),i=require("../../../../../api/discover.js");if(!Array){e.resolveComponent("u-avatar")()}Math||((()=>"../../../../../uni_modules/uview-plus/components/u-avatar/u-avatar.js")+o)();const o=()=>"../../../../../components/common/PictureDisplay.js",n={__name:"square-item",props:{item:{type:Object,default:()=>{}},listType:{type:Number,default:1},userLocation:{type:Object,default:null},cityStore:{type:Object,default:null}},emits:["changeShowVip","playVideo"],setup(o,{emit:n}){const s=(e,t="add",i=1)=>{const o=parseInt(e)||0;return"add"===t?o+i:"subtract"===t?Math.max(0,o-i):o},a=o,m=e=>"女"===e?{background:"rgba(252, 139, 198, 1)"}:{background:"rgba(19, 98, 235, 1)"},r=async t=>{try{const o=t.moments_info.is_praised;t.moments_info.is_praised=!o,t.moments_info.is_praised?t.moments_info.praise_num=s(t.moments_info.praise_num,"add",1):t.moments_info.praise_num=s(t.moments_info.praise_num,"subtract",1);const n=await i.praiseMoment({target_id:t.moments_info.moments_id});n.data&&0===n.data.code?console.log("点赞成功"):(t.moments_info.is_praised=o,t.moments_info.praise_num=s(t.moments_info.praise_num,o?"add":"subtract",1),e.index.showToast({title:"点赞失败，请重试",icon:"none"}))}catch(o){console.error("点赞失败:",o);const i=t.moments_info.is_praised;t.moments_info.is_praised=!i,t.moments_info.praise_num=s(t.moments_info.praise_num,i?"add":"subtract",1),e.index.showToast({title:"网络错误，请重试",icon:"none"})}},c=async(e,t,i)=>{0===a.cityStore.cityList.length&&await a.cityStore.loadCityList(),console.log("城市列表:",a.cityStore.cityList),console.log("城市列表serviceAreas:",e);const o=a.cityStore.cityList.filter((t=>e.includes(t.code.toString())));if(0===o.length)return console.warn("未找到对应的服务城市，使用第一个服务区域"),e[0];if(1===o.length)return o[0].code;let n=o[0],s=1/0;return o.forEach((e=>{if(e.latitude&&e.longitude){const o=a.cityStore.calculateDistance(t,i,e.latitude,e.longitude);o<s&&(s=o,n=e)}})),console.log(`选择最近的服务城市: ${n.name}, 距离: ${s.toFixed(2)}km`),n.code},_=async(t,i,o=null,n=null)=>{let s="/subPackages/py/detail?id="+t+"&city_code="+i;o&&n&&(s+="&latitude="+o+"&longitude="+n),e.index.navigateTo({url:s})};return(i,n)=>{var s,d,l,u,p;return e.e({a:1===o.listType&&o.item.companion_info},1===o.listType&&o.item.companion_info?{b:e.p({src:i.$imgBaseUrl+o.item.companion_info.avatar,size:"38",shape:"circle",mode:"aspectFill"}),c:e.t(o.item.companion_info.nickname),d:(p=o.item.companion_info.gender,"女"===p?"/static/find/nd_icon.png":"/static/find/nand_icon.png"),e:e.t(o.item.companion_info.age),f:e.s(m(o.item.companion_info.gender)),g:e.t(o.item.companion_info.height),h:e.t(o.item.companion_info.weight),i:e.t(o.item.companion_info.tags.join("、")),j:e.o((t=>(async t=>{try{const i=t.companion_info;if(!i||!i.service_areas||0===i.service_areas.length)return void e.index.showToast({title:"该友伴师暂无可服务区域",icon:"none"});if(1===i.service_areas.length){const e=i.service_areas[0];return void(await _(i.id,e))}if(a.userLocation){const e=await c(i.service_areas,a.userLocation.latitude,a.userLocation.longitude);await _(i.id,e,a.userLocation.latitude,a.userLocation.longitude)}else{const e=i.service_areas[0];await _(i.id,e)}}catch(i){console.error("邀约失败:",i),e.index.showToast({title:"邀约失败，请重试",icon:"none"})}})(o.item)))}:{},{k:e.t(o.item.moments_info.content),l:null==(s=o.item.moments_info)?void 0:s.file_list},(null==(d=o.item.moments_info)?void 0:d.file_list)?{m:e.p({list:null==(l=o.item.moments_info)?void 0:l.file_list,topicList:null==(u=o.item.moments_info)?void 0:u.topic_list})}:{},{n:!o.item.moments_info.is_praised},o.item.moments_info.is_praised?{}:{o:t._imports_0$3,p:e.o((e=>r(o.item)))},{q:o.item.moments_info.is_praised},o.item.moments_info.is_praised?{r:t._imports_1$1,s:e.o((e=>r(o.item)))}:{},{t:e.t(o.item.moments_info.praise_num||0),v:t._imports_2$1,w:e.t(o.item.moments_info.comments_num||0),x:e.o((t=>{return i=o.item,void e.index.navigateTo({url:"/subPackages/record/comment",success(e){e.eventChannel.emit("getRecord",{data:i})}});var i}))})}}},s=e._export_sfc(n,[["__scopeId","data-v-f0850207"]]);wx.createComponent(s);
