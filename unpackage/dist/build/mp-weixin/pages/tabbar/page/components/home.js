"use strict";const e=require("../../../../common/vendor.js"),t=require("../../../../common/assets.js"),a=require("../../../../api/friends.js"),o=require("../../../../stores/city.js"),i=require("../../../../stores/user.js");Math||(n+c)();const n=()=>"../../../../components/common/CitySelector.js",c=()=>"../../../../components/common/CityPicker.js",r={__name:"home",setup(n,{expose:c}){i.useUserStore();const r=e.ref(0),s=e.ref(44);e.onMounted((async()=>{const t=e.index.getSystemInfoSync();r.value=t.statusBarHeight||0,s.value=44,await l.initCityData(),await _()}));const l=o.useCityStore();e.computed((()=>l.currentCity));const u=e.computed((()=>l.currentCityCode));e.computed((()=>l.cityList)),e.computed((()=>l.cityIndex));const v=e.ref([]),d=e.ref({}),g=e.ref(!1),m=e.ref(!1);e.onUnmounted((()=>{}));const _=async()=>{var e;try{m.value=!0,console.log("开始加载城市服务数据，当前城市代码:",u.value);const t={city_code:u.value,application_id:15};console.log("城市服务请求参数:",t);const o=await a.getCityServices(t);if(o.data&&0===o.data.code&&o.data.data){const e=o.data.data;console.log("城市服务数据:",e),e&&(d.value={avatar:e.avatar,nickname:e.nickname||"未知用户",verified:!0,age:e.age,weight:e.weight,height:e.height,distance:e.distance,tags:e.tags||[],level_order:e.level_order,levelIcon:"",gender:e.gender||"",application_id:e.application_id||15}),e.services&&e.services.length>0?(v.value=e.services,console.log("服务数据加载成功，共",v.value.length,"条")):(v.value=[],console.log("服务数据为空"))}else console.error("获取城市服务失败:",(null==(e=o.data)?void 0:e.message)||"未知错误"),v.value=[];g.value=!0}catch(t){console.error("获取城市服务异常:",t),v.value=[],g.value=!0}finally{m.value=!1}};e.ref(!1),e.ref(!1);const p=e.ref(!1);function y(e){l.cityIndex!==e&&(console.log(`手动选择城市: ${l.cityList[e].name}`),_())}return c({refreshCurrentTab:async()=>{console.log("Home组件刷新方法被调用");try{return 0===l.cityList.length&&(console.log("城市列表为空，重新加载城市列表"),await l.loadCityList()),console.log("刷新服务数据"),await _(),!0}catch(e){throw console.error("Home组件刷新失败:",e),e}}}),(a,o)=>e.e({a:e.o((e=>p.value=!0)),b:r.value+"px",c:m.value},m.value?{}:v.value.length>0?{e:e.f(v.value,((t,o,i)=>({a:a.$imgBaseUrl+t.service_image_url,b:e.t(t.service_name),c:e.f(t.service_tags,((t,a,o)=>({a:e.t(t),b:t}))),d:e.t(t.price||0),e:e.t(t.unit||"小时"),f:t.service_id,g:e.o((a=>(t=>{console.log("跳转到服务详情页面，服务信息:",t),e.index.navigateTo({url:`/subPackages/py/fr_detail?service_id=${t.service_id}&price_template_id=${t.price_template_id||""}&companion_id=${d.value.application_id||15}&level_order=${d.value.level_order||""}&nickname=${d.value.nickname||""}&service_name=${encodeURIComponent(t.service_name)}&service_image_url=${encodeURIComponent(t.service_image_url)}&price=${t.price||0}&unit=${t.unit||"小时"}&service_tags=${encodeURIComponent(JSON.stringify(t.service_tags||[]))}`})})(t)),t.service_id)})))}:g.value&&0===v.value.length?{g:t._imports_3}:{},{d:v.value.length>0,f:g.value&&0===v.value.length,h:e.o(y),i:e.o((e=>p.value=e)),j:e.p({visible:p.value})})}},s=e._export_sfc(r,[["__scopeId","data-v-cdc23a0e"]]);wx.createComponent(s);
