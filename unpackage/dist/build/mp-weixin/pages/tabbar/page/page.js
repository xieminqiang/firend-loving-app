"use strict";const e=require("../../../common/vendor.js");require("../../../config/http.js"),Math||(r+s+o)();const o=()=>"../../../components/mq-tabbar/mq-tabbar.js",r=()=>"./components/home.js",s=()=>"./components/profile.js",a={__name:"page",setup(o,{expose:r}){const s=e.ref("home"),a=e.reactive(new Set(["home"])),n=e.ref(!1),t=e=>{a.add(e),s.value=e,console.log(`切换到 ${e} tab，已访问的tab:`,Array.from(a))};e.onMounted((()=>{console.log("页面挂载完成，当前tab:",s.value),console.log("已访问的tab:",Array.from(a))})),e.onPullDownRefresh((async()=>{if(n.value)return console.log("刷新操作正在进行中，忽略重复请求"),void e.index.stopPullDownRefresh();n.value=!0,console.log("页面级下拉刷新触发，当前tab:",s.value);const o=new Promise(((e,o)=>{setTimeout((()=>o(new Error("刷新超时"))),1e4)}));try{const r=(async()=>{var o,r,n,t;if("home"===s.value){if(a.has("home")){const s=null==(r=null==(o=e.getCurrentInstance())?void 0:o.refs)?void 0:r.homeRef;s&&s.refreshCurrentTab&&await s.refreshCurrentTab()}}else if("profile"===s.value&&a.has("profile")){const o=null==(t=null==(n=e.getCurrentInstance())?void 0:n.refs)?void 0:t.profileRef;o&&o.refreshCurrentTab&&await o.refreshCurrentTab()}})();await Promise.race([r,o]),await new Promise((e=>setTimeout(e,300))),e.index.showToast({title:"刷新成功",icon:"success",duration:1500})}catch(r){console.error("页面级下拉刷新失败:",r),e.index.showToast({title:"刷新超时"===r.message?"刷新超时，请重试":"刷新失败，请重试",icon:"error",duration:2e3})}finally{await e.nextTick$1(),setTimeout((()=>{e.index.stopPullDownRefresh(),n.value=!1,console.log("下拉刷新已停止")}),100)}})),e.onShow((()=>{console.log("页面显示，当前tab:",s.value),n.value&&(console.log("检测到异常刷新状态，强制重置"),l())})),e.onHide((()=>{console.log("页面隐藏"),l()}));const l=()=>{n.value&&(e.index.stopPullDownRefresh(),n.value=!1,console.log("强制停止刷新状态"))};return r({refreshCurrentTab:()=>{console.log("手动刷新当前tab:",s.value)},getVisitedTabs:()=>Array.from(a),currentTab:s,forceStopRefresh:l}),(o,r)=>e.e({a:a.has("home")},a.has("home")?{b:e.sr("homeRef","29e6bc45-0")}:{},{c:"home"===s.value,d:a.has("profile")},a.has("profile")?{e:e.sr("profileRef","29e6bc45-1")}:{},{f:"profile"===s.value,g:e.o(t),h:e.p({currentTab:s.value})})}},n=e._export_sfc(a,[["__scopeId","data-v-29e6bc45"]]);wx.createPage(n);
