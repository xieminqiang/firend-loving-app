"use strict";const e=require("../../../common/vendor.js");require("../../../config/http.js"),Math||(r+a+o)();const o=()=>"../../../components/mq-tabbar/mq-tabbar.js",r=()=>"./components/home.js",a=()=>"./components/profile.js",s={__name:"page",setup(o,{expose:r}){const a=e.ref("home"),s=e.reactive(new Set(["home"])),n=e.ref(!1),t=e=>{s.add(e),a.value=e,console.log(`切换到 ${e} tab，已访问的tab:`,Array.from(s))};e.onMounted((()=>{console.log("页面挂载完成，当前tab:",a.value),console.log("已访问的tab:",Array.from(s))})),e.onPullDownRefresh((async()=>{if(n.value)return console.log("刷新操作正在进行中，忽略重复请求"),void e.index.stopPullDownRefresh();n.value=!0,console.log("页面级下拉刷新触发，当前tab:",a.value);const o=new Promise(((e,o)=>{setTimeout((()=>o(new Error("刷新超时"))),1e4)}));try{const r=(async()=>{var o,r,n,t;if("home"===a.value){if(s.has("home")){const a=null==(r=null==(o=e.getCurrentInstance())?void 0:o.refs)?void 0:r.homeRef;a&&a.refreshCurrentTab&&await a.refreshCurrentTab()}}else if("profile"===a.value&&s.has("profile")){const o=null==(t=null==(n=e.getCurrentInstance())?void 0:n.refs)?void 0:t.profileRef;o&&o.refreshCurrentTab&&await o.refreshCurrentTab()}})();await Promise.race([r,o]),await new Promise((e=>setTimeout(e,300))),e.index.showToast({title:"刷新成功",icon:"success",duration:1500})}catch(r){console.error("页面级下拉刷新失败:",r),e.index.showToast({title:"刷新超时"===r.message?"刷新超时，请重试":"刷新失败，请重试",icon:"error",duration:2e3})}finally{await e.nextTick$1(),setTimeout((()=>{e.index.stopPullDownRefresh(),n.value=!1,console.log("下拉刷新已停止")}),100)}})),e.onShow((()=>{console.log("页面显示，当前tab:",a.value),n.value&&(console.log("检测到异常刷新状态，强制重置"),l())})),e.onHide((()=>{console.log("页面隐藏"),l()}));const l=()=>{n.value&&(e.index.stopPullDownRefresh(),n.value=!1,console.log("强制停止刷新状态"))};return r({refreshCurrentTab:()=>{console.log("手动刷新当前tab:",a.value)},getVisitedTabs:()=>Array.from(s),currentTab:a,forceStopRefresh:l}),(o,r)=>e.e({a:s.has("home")},s.has("home")?{b:e.sr("homeRef","59451daa-0")}:{},{c:"home"===a.value,d:s.has("profile")},s.has("profile")?{e:e.sr("profileRef","59451daa-1")}:{},{f:"profile"===a.value,g:e.o(t),h:e.p({currentTab:a.value})})}},n=e._export_sfc(s,[["__scopeId","data-v-59451daa"]]);wx.createPage(n);
