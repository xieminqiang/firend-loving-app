{"version":3,"file":"detail.js","sources":["subPackages/balance/detail.vue","subPackages/balance/detail.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"detail-container\">\n    <scroll-view \n      scroll-y \n      class=\"scroll-container\"\n      refresher-enabled\n      :refresher-triggered=\"refreshing\"\n      @refresherrefresh=\"onRefresh\"\n      @scrolltolower=\"onLoadMore\"\n    >\n      <!-- 余额明细列表 -->\n      <view class=\"balance-logs-list\">\n        <view \n          v-for=\"(item, index) in balanceLogs\" \n          :key=\"index\" \n          class=\"log-item\"\n          @click=\"goToDetailRe(item)\"\n        >\n          <!-- 左侧图标和子文本 -->\n          <view class=\"log-icon-section\">\n            <view class=\"log-icon\">\n              <image \n                :src=\"item.change_amount > 0 ? '/static/icons/common/chongzhi.png' : '/static/icons/common/koukuan.png'\" \n                class=\"icon-image\" \n                mode=\"aspectFit\"\n              />\n            </view>\n          </view>\n          \n          <!-- 中间交易描述和时间 -->\n          <view class=\"log-info-section\">\n            <view class=\"log-description\">{{ item.remark || '' }}</view>\n            <view class=\"log-time\">{{ formatTime(item.created_at) }}</view>\n          </view>\n          \n          <!-- 右侧金额 -->\n          <view class=\"log-amount-section\">\n            <text \n              class=\"amount-text\" \n              :class=\"{ 'positive': item.change_amount > 0, 'negative': item.change_amount < 0 }\"\n            >\n              {{ item.change_amount > 0 ? '+' : '' }}{{ formatAmount(item.change_amount) }}\n            </text>\n          </view>\n        </view>\n      </view>\n      \n      <!-- 加载更多提示 -->\n      <view v-if=\"hasMore && !loading\" class=\"load-more\">\n        <text class=\"load-more-text\">上拉加载更多</text>\n      </view>\n      \n      <!-- 加载中提示 -->\n      <view v-if=\"loading && currentPage > 1\" class=\"loading-more\">\n        <text class=\"loading-text\">加载中...</text>\n      </view>\n      \n      <!-- 没有更多数据提示 -->\n      <view v-if=\"!hasMore && balanceLogs.length > 0\" class=\"no-more\">\n        <text class=\"no-more-text\">没有更多数据了</text>\n      </view>\n      \n      <!-- 空状态 -->\n      <view v-if=\"balanceLogs.length === 0 && !loading\" class=\"empty-state\">\n        <text class=\"empty-text\">暂无余额明细</text>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { getBalanceLogs } from '@/api/user.js'\n\n// 响应式数据\nconst balanceLogs = ref([])\nconst currentPage = ref(1)\nconst pageSize = ref(20)\nconst refreshing = ref(false)\nconst loading = ref(false)\nconst hasMore = ref(true) // 新增：用于判断是否还有更多数据\n\n// 获取余额明细\nconst fetchBalanceLogs = async () => {\n  loading.value = true\n  try {\n    const result = await getBalanceLogs({\n      page: currentPage.value,\n      page_size: pageSize.value\n    })\n    if (result.data && result.data.code === 0) {\n      // 从响应中提取list数组\n      const newData = result.data.data?.list || []\n      \n      if (currentPage.value === 1) {\n        // 第一页：替换数据\n        balanceLogs.value = newData\n      } else {\n        // 其他页：追加数据\n        balanceLogs.value = [...balanceLogs.value, ...newData]\n      }\n      \n      console.log('余额明细:', balanceLogs.value)\n      hasMore.value = newData.length === pageSize.value // 判断是否还有更多数据\n    } else {\n      hasMore.value = false // 没有更多数据\n    }\n  } catch (error) {\n    console.error('获取余额明细失败:', error)\n  } finally {\n    loading.value = false\n  }\n}\n\n// 刷新数据\nconst onRefresh = async () => {\n  refreshing.value = true\n  try {\n    // 重置到第一页\n    currentPage.value = 1\n    await fetchBalanceLogs()\n \n  } catch (error) {\n    uni.showToast({\n      title: '刷新失败',\n      icon: 'none',\n      duration: 1500\n    })\n  } finally {\n    refreshing.value = false\n  }\n}\n\n// 加载更多数据\nconst onLoadMore = async () => {\n  if (loading.value || !hasMore.value) return\n  currentPage.value++\n  await fetchBalanceLogs()\n}\n\n// 跳转到余额明细详情\nconst goToDetailRe = (item) => {\n  uni.navigateTo({\n    url: `/subPackages/balance/detaril-re?data=${encodeURIComponent(JSON.stringify(item))}`\n  })\n}\n\n// 格式化金额（分转元）\nconst formatAmount = (amountInCents) => {\n  if (!amountInCents && amountInCents !== 0) return '0.00'\n  return (amountInCents / 100).toFixed(2)\n}\n\n// 格式化时间\nconst formatTime = (timeStr) => {\n  if (!timeStr) return ''\n  const date = new Date(timeStr)\n  const year = date.getFullYear()\n  const month = (date.getMonth() + 1).toString()\n  const day = date.getDate().toString()\n  const hour = date.getHours().toString().padStart(2, '0')\n  const minute = date.getMinutes().toString().padStart(2, '0')\n  return `${year}年${month}月${day}日 ${hour}:${minute}`\n}\n\n// 组件挂载时获取数据\nonMounted(() => {\n  fetchBalanceLogs()\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.detail-container {\n  \n  background: #ffffff;\n  height: 100vh;\n}\n\n.scroll-container {\n  height: 100%;\n}\n\n.balance-logs-list { \n    padding: 0rpx 20rpx;\n  .log-item {\n    display: flex;\n    align-items: center;\n    padding: 30rpx 0;\n    border-bottom: 1rpx solid #f0f0f0;\n    \n    &:last-child {\n      border-bottom: none;\n    }\n  }\n  \n  .log-icon-section {\n    margin-right: 20rpx;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    \n    .log-icon {\n      width: 60rpx;\n      height: 60rpx;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      margin-bottom: 8rpx;\n      \n      .icon-image {\n        width: 60rpx;\n        height: 60rpx;\n        border-radius: 30rpx;\n      }\n    }\n  }\n  \n  .log-info-section {\n    flex: 1;\n    margin-right: 20rpx;\n    \n    .log-description {\n      font-size: 28rpx;\n      color: #1a1a1a;\n      margin-bottom: 8rpx;\n      font-weight: 500;\n    }\n    \n    .log-time {\n      font-size: 24rpx;\n      color: #666666;\n    }\n  }\n  \n  .log-amount-section {\n    .amount-text {\n      font-size: 32rpx;\n      font-weight: 600;\n      \n      &.positive {\n        color: #ffa502;\n      }\n      \n      &.negative {\n        color: #1a1a1a;\n      }\n    }\n  }\n}\n\n.load-more, .loading-more, .no-more {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 20rpx 0;\n  font-size: 28rpx;\n  color: #999999;\n}\n\n.empty-state {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 400rpx;\n  \n  .empty-text {\n    font-size: 28rpx;\n    color: #999999;\n  }\n}\n</style>","import MiniProgramPage from '/Users/xiaoqiang/Documents/friemd/firend-loving-app/subPackages/balance/detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["balanceLogs","ref","currentPage","pageSize","refreshing","loading","hasMore","fetchBalanceLogs","result","getBalanceLogs","newData","_a","uni","error","onRefresh","onLoadMore","goToDetailRe","item","formatAmount","amountInCents","formatTime","timeStr","date","year","month","day","hour","minute","onMounted","MiniProgramPage"],"mappings":"kHA2EA,MAAMA,EAAcC,EAAG,IAAC,EAAE,EACpBC,EAAcD,EAAG,IAAC,CAAC,EACnBE,EAAWF,EAAG,IAAC,EAAE,EACjBG,EAAaH,EAAG,IAAC,EAAK,EACtBI,EAAUJ,EAAG,IAAC,EAAK,EACnBK,EAAUL,EAAG,IAAC,EAAI,EAGlBM,EAAmB,SAAY,OACnCF,EAAQ,MAAQ,GAChB,GAAI,CACF,MAAMG,EAAS,MAAMC,iBAAe,CAClC,KAAMP,EAAY,MAClB,UAAWC,EAAS,KAC1B,CAAK,EACD,GAAIK,EAAO,MAAQA,EAAO,KAAK,OAAS,EAAG,CAEzC,MAAME,IAAUC,EAAAH,EAAO,KAAK,OAAZ,YAAAG,EAAkB,OAAQ,CAAE,EAExCT,EAAY,QAAU,EAExBF,EAAY,MAAQU,EAGpBV,EAAY,MAAQ,CAAC,GAAGA,EAAY,MAAO,GAAGU,CAAO,EAGvDE,EAAY,MAAA,MAAA,MAAA,wCAAA,QAASZ,EAAY,KAAK,EACtCM,EAAQ,MAAQI,EAAQ,SAAWP,EAAS,KAClD,MACMG,EAAQ,MAAQ,EAEnB,OAAQO,EAAO,CACdD,EAAAA,MAAA,MAAA,QAAA,wCAAc,YAAaC,CAAK,CACpC,QAAY,CACRR,EAAQ,MAAQ,EACjB,CACH,EAGMS,EAAY,SAAY,CAC5BV,EAAW,MAAQ,GACnB,GAAI,CAEFF,EAAY,MAAQ,EACpB,MAAMK,EAAkB,CAEzB,MAAe,CACdK,EAAAA,MAAI,UAAU,CACZ,MAAO,OACP,KAAM,OACN,SAAU,IAChB,CAAK,CACL,QAAY,CACRR,EAAW,MAAQ,EACpB,CACH,EAGMW,EAAa,SAAY,CACzBV,EAAQ,OAAS,CAACC,EAAQ,QAC9BJ,EAAY,QACZ,MAAMK,EAAkB,EAC1B,EAGMS,EAAgBC,GAAS,CAC7BL,EAAAA,MAAI,WAAW,CACb,IAAK,wCAAwC,mBAAmB,KAAK,UAAUK,CAAI,CAAC,CAAC,EACzF,CAAG,CACH,EAGMC,EAAgBC,GAChB,CAACA,GAAiBA,IAAkB,EAAU,QAC1CA,EAAgB,KAAK,QAAQ,CAAC,EAIlCC,EAAcC,GAAY,CAC9B,GAAI,CAACA,EAAS,MAAO,GACrB,MAAMC,EAAO,IAAI,KAAKD,CAAO,EACvBE,EAAOD,EAAK,YAAa,EACzBE,GAASF,EAAK,SAAQ,EAAK,GAAG,SAAU,EACxCG,EAAMH,EAAK,QAAO,EAAG,SAAU,EAC/BI,EAAOJ,EAAK,SAAU,EAAC,SAAQ,EAAG,SAAS,EAAG,GAAG,EACjDK,EAASL,EAAK,WAAY,EAAC,SAAQ,EAAG,SAAS,EAAG,GAAG,EAC3D,MAAO,GAAGC,CAAI,IAAIC,CAAK,IAAIC,CAAG,KAAKC,CAAI,IAAIC,CAAM,EACnD,EAGAC,OAAAA,EAAAA,UAAU,IAAM,CACdrB,EAAkB,CACpB,CAAC,wmBCvKD,GAAG,WAAWsB,CAAe"}