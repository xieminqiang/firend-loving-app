{"version":3,"file":"record.js","sources":["subPackages/balance/record.vue","subPackages/balance/record.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"record-container\">\n    <scroll-view \n      scroll-y \n      class=\"scroll-container\"\n      refresher-enabled\n      :refresher-triggered=\"refreshing\"\n      @refresherrefresh=\"onRefresh\"\n      @scrolltolower=\"onLoadMore\"\n    >\n      <!-- 提现记录列表 -->\n      <view class=\"withdraw-records-list\">\n        <view \n          v-for=\"(item, index) in withdrawRecords\" \n          :key=\"index\" \n          class=\"record-item\"\n          @click=\"goToRecordDetail(item)\"\n        >\n          <!-- 左侧图标 -->\n          <view class=\"record-icon-section\">\n            <view class=\"record-icon\">\n              <image \n                src=\"/static/icons/profile/yue.png\" \n                class=\"icon-image\" \n                mode=\"aspectFit\"\n              />\n            </view>\n          </view>\n          \n          <!-- 中间提现信息 -->\n          <view class=\"record-info-section\">\n            <view class=\"record-description\">提现到微信零钱</view>\n            <view class=\"record-time\">{{ formatTime(item.created_at) }}</view>\n          </view>\n          \n          <!-- 右侧金额和状态 -->\n          <view class=\"record-amount-section\">\n            <view class=\"amount-text\">-{{ formatAmount(item.amount) }}</view>\n            <view class=\"status-text\">\n              <text v-if=\"item.transfer_state === 'FAIL' && item.fail_reason === 'OVERDUE_CLOSE'\">\n                超时未完成确认收款，余额已退回\n              </text>\n              <text v-else-if=\"item.transfer_state === 'FAIL'\">\n                提现失败\n              </text>\n              <text v-else>\n                {{ item.transfer_state_desc || '' }}\n              </text>\n            </view>\n          </view>\n        </view>\n      </view>\n      \n      <!-- 加载更多提示 -->\n      <view v-if=\"hasMore && !loading\" class=\"load-more\">\n        <text class=\"load-more-text\">上拉加载更多</text>\n      </view>\n      \n      <!-- 加载中提示 -->\n      <view v-if=\"loading && currentPage > 1\" class=\"loading-more\">\n        <text class=\"loading-text\">加载中...</text>\n      </view>\n      \n      <!-- 没有更多数据提示 -->\n      <view v-if=\"!hasMore && withdrawRecords.length > 0\" class=\"no-more\">\n        <text class=\"no-more-text\">没有更多数据了</text>\n      </view>\n      \n      <!-- 空状态 -->\n      <view v-if=\"withdrawRecords.length === 0 && !loading\" class=\"empty-state\">\n        <text class=\"empty-text\">暂无提现记录</text>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { getWithdrawRecords } from '@/api/user.js'\n\n// 响应式数据\nconst withdrawRecords = ref([])\nconst currentPage = ref(1)\nconst pageSize = ref(20)\nconst refreshing = ref(false)\nconst loading = ref(false)\nconst hasMore = ref(true)\n\n// 获取提现记录\nconst fetchWithdrawRecords = async () => {\n  loading.value = true\n  try {\n    const result = await getWithdrawRecords({\n      page: currentPage.value,\n      page_size: pageSize.value\n    })\n    if (result.data && result.data.code === 0) {\n      // 从响应中提取list数组\n      const newData = result.data.data?.list || []\n      \n      if (currentPage.value === 1) {\n        // 第一页：替换数据\n        withdrawRecords.value = newData\n      } else {\n        // 其他页：追加数据\n        withdrawRecords.value = [...withdrawRecords.value, ...newData]\n      }\n      \n      console.log('提现记录:', withdrawRecords.value)\n      hasMore.value = newData.length === pageSize.value // 判断是否还有更多数据\n    } else {\n      hasMore.value = false // 没有更多数据\n    }\n  } catch (error) {\n    console.error('获取提现记录失败:', error)\n  } finally {\n    loading.value = false\n  }\n}\n\n// 刷新数据\nconst onRefresh = async () => {\n  refreshing.value = true\n  try {\n    // 重置到第一页\n    currentPage.value = 1\n    await fetchWithdrawRecords()\n  } catch (error) {\n    uni.showToast({\n      title: '刷新失败',\n      icon: 'none',\n      duration: 1500\n    })\n  } finally {\n    refreshing.value = false\n  }\n}\n\n// 加载更多数据\nconst onLoadMore = async () => {\n  if (loading.value || !hasMore.value) return\n  currentPage.value++\n  await fetchWithdrawRecords()\n}\n\n// 跳转到提现记录详情\nconst goToRecordDetail = (item) => {\n  uni.navigateTo({\n    url: `/subPackages/balance/record-detail?data=${encodeURIComponent(JSON.stringify(item))}`\n  })\n}\n\n// 格式化金额（分转元）\nconst formatAmount = (amountInCents) => {\n  if (!amountInCents && amountInCents !== 0) return '0.00'\n  return (amountInCents / 100).toFixed(2)\n}\n\n// 格式化时间\nconst formatTime = (timeStr) => {\n  if (!timeStr) return ''\n  const date = new Date(timeStr)\n  const year = date.getFullYear()\n  const month = (date.getMonth() + 1).toString()\n  const day = date.getDate().toString()\n  const hour = date.getHours().toString().padStart(2, '0')\n  const minute = date.getMinutes().toString().padStart(2, '0')\n  return `${year}年${month}月${day}日 ${hour}:${minute}`\n}\n\n// 组件挂载时获取数据\nonMounted(() => {\n  fetchWithdrawRecords()\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.record-container {\n  background: #ffffff;\n  height: 100vh;\n}\n\n.scroll-container {\n  height: 100%;\n}\n\n.withdraw-records-list { \n  padding: 0rpx 20rpx;\n  \n  .record-item {\n    display: flex;\n    align-items: center;\n    padding: 30rpx 0;\n    border-bottom: 1rpx solid #f0f0f0;\n    \n    &:last-child {\n      border-bottom: none;\n    }\n  }\n  \n  .record-icon-section {\n    margin-right: 20rpx;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    \n    .record-icon {\n      width: 60rpx;\n      height: 60rpx;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      margin-bottom: 8rpx;\n      \n      .icon-image {\n        width: 60rpx;\n        height: 60rpx;\n        border-radius: 30rpx;\n      }\n    }\n  }\n  \n  .record-info-section {\n    flex: 1;\n    margin-right: 20rpx;\n    \n    .record-description {\n      font-size: 28rpx;\n      color: #1a1a1a;\n      margin-bottom: 8rpx;\n      font-weight: 500;\n    }\n    \n    .record-time {\n      font-size: 24rpx;\n      color: #666666;\n    }\n  }\n  \n  .record-amount-section {\n    text-align: right;\n    \n    .amount-text {\n      font-size: 32rpx;\n      font-weight: 600;\n      color: #1a1a1a;\n      margin-bottom: 8rpx;\n    }\n    \n    .status-text {\n      font-size: 24rpx;\n      color: #666666;\n    }\n  }\n}\n\n.load-more, .loading-more, .no-more {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 20rpx 0;\n  font-size: 28rpx;\n  color: #999999;\n}\n\n.empty-state {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 400rpx;\n  \n  .empty-text {\n    font-size: 28rpx;\n    color: #999999;\n  }\n}\n</style>","import MiniProgramPage from '/Users/xiaoqiang/Documents/friemd/firend-loving-app/subPackages/balance/record.vue'\nwx.createPage(MiniProgramPage)"],"names":["withdrawRecords","ref","currentPage","pageSize","refreshing","loading","hasMore","fetchWithdrawRecords","result","getWithdrawRecords","newData","_a","uni","error","onRefresh","onLoadMore","goToRecordDetail","item","formatAmount","amountInCents","formatTime","timeStr","date","year","month","day","hour","minute","onMounted","MiniProgramPage"],"mappings":"sJAiFA,MAAMA,EAAkBC,EAAG,IAAC,EAAE,EACxBC,EAAcD,EAAG,IAAC,CAAC,EACnBE,EAAWF,EAAG,IAAC,EAAE,EACjBG,EAAaH,EAAG,IAAC,EAAK,EACtBI,EAAUJ,EAAG,IAAC,EAAK,EACnBK,EAAUL,EAAG,IAAC,EAAI,EAGlBM,EAAuB,SAAY,OACvCF,EAAQ,MAAQ,GAChB,GAAI,CACF,MAAMG,EAAS,MAAMC,qBAAmB,CACtC,KAAMP,EAAY,MAClB,UAAWC,EAAS,KAC1B,CAAK,EACD,GAAIK,EAAO,MAAQA,EAAO,KAAK,OAAS,EAAG,CAEzC,MAAME,IAAUC,EAAAH,EAAO,KAAK,OAAZ,YAAAG,EAAkB,OAAQ,CAAE,EAExCT,EAAY,QAAU,EAExBF,EAAgB,MAAQU,EAGxBV,EAAgB,MAAQ,CAAC,GAAGA,EAAgB,MAAO,GAAGU,CAAO,EAG/DE,4DAAY,QAASZ,EAAgB,KAAK,EAC1CM,EAAQ,MAAQI,EAAQ,SAAWP,EAAS,KAClD,MACMG,EAAQ,MAAQ,EAEnB,OAAQO,EAAO,CACdD,EAAAA,MAAA,MAAA,QAAA,wCAAc,YAAaC,CAAK,CACpC,QAAY,CACRR,EAAQ,MAAQ,EACjB,CACH,EAGMS,EAAY,SAAY,CAC5BV,EAAW,MAAQ,GACnB,GAAI,CAEFF,EAAY,MAAQ,EACpB,MAAMK,EAAsB,CAC7B,MAAe,CACdK,EAAAA,MAAI,UAAU,CACZ,MAAO,OACP,KAAM,OACN,SAAU,IAChB,CAAK,CACL,QAAY,CACRR,EAAW,MAAQ,EACpB,CACH,EAGMW,EAAa,SAAY,CACzBV,EAAQ,OAAS,CAACC,EAAQ,QAC9BJ,EAAY,QACZ,MAAMK,EAAsB,EAC9B,EAGMS,EAAoBC,GAAS,CACjCL,EAAAA,MAAI,WAAW,CACb,IAAK,2CAA2C,mBAAmB,KAAK,UAAUK,CAAI,CAAC,CAAC,EAC5F,CAAG,CACH,EAGMC,EAAgBC,GAChB,CAACA,GAAiBA,IAAkB,EAAU,QAC1CA,EAAgB,KAAK,QAAQ,CAAC,EAIlCC,EAAcC,GAAY,CAC9B,GAAI,CAACA,EAAS,MAAO,GACrB,MAAMC,EAAO,IAAI,KAAKD,CAAO,EACvBE,EAAOD,EAAK,YAAa,EACzBE,GAASF,EAAK,SAAQ,EAAK,GAAG,SAAU,EACxCG,EAAMH,EAAK,QAAO,EAAG,SAAU,EAC/BI,EAAOJ,EAAK,SAAU,EAAC,SAAQ,EAAG,SAAS,EAAG,GAAG,EACjDK,EAASL,EAAK,WAAY,EAAC,SAAQ,EAAG,SAAS,EAAG,GAAG,EAC3D,MAAO,GAAGC,CAAI,IAAIC,CAAK,IAAIC,CAAG,KAAKC,CAAI,IAAIC,CAAM,EACnD,EAGAC,OAAAA,EAAAA,UAAU,IAAM,CACdrB,EAAsB,CACxB,CAAC,8oBC5KD,GAAG,WAAWsB,CAAe"}