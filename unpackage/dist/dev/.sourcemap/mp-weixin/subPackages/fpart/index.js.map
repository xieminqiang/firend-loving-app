{"version":3,"file":"index.js","sources":["subPackages/fpart/index.vue","subPackages/fpart/index.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"partner-container\" v-if=\"userStore.switch == 1\">\n\n    \n    <!-- 主内容区域 -->\n    <view class=\"main-content\">\n      <!-- 加载状态 -->\n      <view v-if=\"!dataReady\" class=\"loading-container\">\n        <view class=\"loading-spinner\"></view>\n        <text class=\"loading-text\">加载中...</text>\n      </view>\n      \n      <!-- 页面内容 - 使用scroll-view实现下拉刷新 -->\n      <scroll-view\n        v-else\n        class=\"content-scroll\"\n        scroll-y=\"true\"\n        :refresher-enabled=\"true\"\n        :refresher-triggered=\"refreshing\"\n        @refresherrefresh=\"onRefresh\"\n        @refresherrestore=\"onRefreshRestore\"\n        @refresherabort=\"onRefreshAbort\"\n      >\n        <view class=\"scroll-content\">\n          <swiper\n            class=\"content-swiper\"\n            :current=\"currentTabIndex\"\n            @change=\"onSwiperChange\"\n            :indicator-dots=\"false\"\n            :circular=\"false\"\n            :autoplay=\"false\"\n            :duration=\"300\"\n          >\n            <!-- 工作台页面 -->\n            <swiper-item>\n              <Workbench :applicationInfo=\"applicationInfo\" />\n            </swiper-item>\n            \n            <!-- 我的页面 -->\n            <swiper-item>\n              <Profile :applicationInfo=\"applicationInfo\" />\n            </swiper-item>\n          </swiper>\n        </view>\n      </scroll-view>\n    </view>\n    \n    <!-- 底部TabBar -->\n    <view v-if=\"dataReady\" class=\"tab-bar\">\n      <view \n        class=\"tab-item\" \n        :class=\"{ active: currentTabIndex === 0 }\"\n        @click=\"switchTab(0)\"\n      >\n        <image \n          :src=\"currentTabIndex === 0 ? '/static/icons/tabbar/grid-fill.png' : '/static/icons/tabbar/grid.png'\"\n          class=\"tab-icon\"\n          mode=\"aspectFit\"\n        />\n        <text class=\"tab-text\">工作台</text>\n      </view>\n      <view \n        class=\"tab-item\" \n        :class=\"{ active: currentTabIndex === 1 }\"\n        @click=\"switchTab(1)\"\n      >\n        <image \n          :src=\"currentTabIndex === 1 ? '/static/icons/tabbar/profile-fill.png' : '/static/icons/tabbar/profile.png'\"\n          class=\"tab-icon\"\n          mode=\"aspectFit\"\n        />\n        <text class=\"tab-text\">我的</text>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted, onUnmounted } from 'vue'\nimport Workbench from './components/Workbench.vue'\nimport Profile from './components/Profile.vue'\nimport { getApplicatioInfo } from '@/api/user.js'\nimport { useLevelStore } from '@/stores/level.js'\nimport { useUserStore } from '@/stores/user.js'\n// 用户状态管理\nconst userStore = useUserStore()\nconst levelStore = useLevelStore()\n\n// 状态栏高度\nconst statusBarHeight = ref(0)\n\n// 当前选中的Tab索引\nconst currentTabIndex = ref(0)\n\n// 申请信息\nconst applicationInfo = ref(null)\n\n// 数据加载状态\nconst dataReady = ref(false)\n\n// 下拉刷新状态\nconst refreshing = ref(false)\n\nonMounted(() => {\n  // 获取系统信息\n  const info = uni.getSystemInfoSync()\n  statusBarHeight.value = info.statusBarHeight || 0\n  \n  // 加载申请信息\n  loadApplicationInfo()\n  \n  // 监听申请状态变化事件\n  uni.$on('applicationStatusChanged', handleApplicationStatusChanged)\n  \n  // 监听刷新申请信息事件\n  uni.$on('refreshApplicationInfo', handleRefreshApplicationInfo)\n})\n\nonUnmounted(() => {\n  // 移除事件监听\n  uni.$off('applicationStatusChanged', handleApplicationStatusChanged)\n  uni.$off('refreshApplicationInfo', handleRefreshApplicationInfo)\n})\n\n// 处理申请状态变化事件\nconst handleApplicationStatusChanged = (event) => {\n  console.log('收到申请状态变化事件:', event)\n  \n  if (event.type === 'video_uploaded') {\n    // 视频上传成功，刷新申请信息\n    console.log('视频上传成功，刷新申请信息')\n    loadApplicationInfo()\n    \n    // 清除等级列表缓存，确保获取最新的等级信息\n    levelStore.clearServiceLevels()\n    \n    // 显示成功提示\n    // uni.showToast({\n    //   title: event.message || '操作成功',\n    //   icon: 'none'\n    // })\n  }\n}\n\n// 处理刷新申请信息事件\nconst handleRefreshApplicationInfo = () => {\n  console.log('收到刷新申请信息事件')\n  loadApplicationInfo()\n}\n\n// 下拉刷新处理\nconst onRefresh = async () => {\n  console.log('开始下拉刷新')\n  refreshing.value = true\n  \n  try {\n    // 重新加载申请信息\n    await loadApplicationInfo()\n    \n \n  } catch (error) {\n    console.error('下拉刷新失败:', error)\n    \n    // 显示刷新失败提示\n    uni.showToast({\n      title: '刷新失败，请重试',\n      icon: 'error',\n      duration: 2000\n    })\n  } finally {\n    // 延迟结束刷新状态，让用户看到刷新完成\n    setTimeout(() => {\n      refreshing.value = false\n    }, 500)\n  }\n}\n\n// 刷新状态恢复\nconst onRefreshRestore = () => {\n  console.log('刷新状态恢复')\n}\n\n// 刷新状态中止\nconst onRefreshAbort = () => {\n  console.log('刷新状态中止')\n  refreshing.value = false\n}\n\n// 加载申请信息\nconst loadApplicationInfo = async () => {\n  try {\n    console.log('开始请求申请信息')\n    const response = await getApplicatioInfo()\n    console.log('申请信息请求成功:', response)\n    \n    if (response.data && response.data.code === 0) {\n      applicationInfo.value = response.data.data\n      console.log('申请信息:', applicationInfo.value)\n      \n      // 数据加载完成，设置准备状态\n      dataReady.value = true\n      console.log('数据准备完成，可以渲染Workbench组件')\n    } else {\n      console.warn('获取申请信息失败:', response.data?.msg || '未知错误')\n      // 即使失败也要设置准备状态，避免无限加载\n      dataReady.value = true\n      \n      // 抛出错误，让调用方知道刷新失败\n      throw new Error(response.data?.msg || '获取申请信息失败')\n    }\n  } catch (error) {\n    console.error('获取申请信息失败:', error)\n    // 即使失败也要设置准备状态，避免无限加载\n    dataReady.value = true\n    \n    // 重新抛出错误\n    throw error\n  }\n}\n\n// 切换Tab\nconst switchTab = (index) => {\n  currentTabIndex.value = index\n}\n\n// swiper滑动改变时的处理\nconst onSwiperChange = (e) => {\n  currentTabIndex.value = e.detail.current\n}\n\n// 返回上一步\nconst goBack = () => {\n  uni.navigateBack()\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.partner-container {\n  height: 100vh;\n  background: #F7F8FA;\n  display: flex;\n  flex-direction: column;\n}\n\n.status-bar {\n  background: #FFFFFF;\n}\n\n.nav-bar {\n  background: #FFFFFF;\n  height: 88rpx;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 32rpx;\n  border-bottom: 1rpx solid #f0f0f0;\n  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.04);\n}\n\n.back-btn {\n  display: flex;\n  align-items: center;\n  padding: 12rpx 16rpx;\n  border-radius: 20rpx;\n  background: rgba(0, 0, 0, 0.04);\n  transition: all 0.2s;\n}\n\n.back-btn:active {\n  background: rgba(0, 0, 0, 0.08);\n  transform: scale(0.96);\n}\n\n.back-icon {\n  width: 32rpx;\n  height: 32rpx;\n  opacity: 0.8;\n}\n\n.back-text {\n  font-size: 26rpx;\n  color: #1A1A1A;\n  font-weight: 500;\n  margin-left: 8rpx;\n}\n\n.nav-title {\n  font-size: 32rpx;\n  font-weight: 600;\n  color: #1A1A1A;\n  text-align: center;\n  flex: 1;\n}\n\n.nav-placeholder {\n  width: 120rpx;\n} \n\n.main-content {\n  flex: 1;\n  overflow: hidden;\n}\n\n// 加载状态样式\n.loading-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  background: #F7F8FA;\n}\n\n.loading-spinner {\n  width: 60rpx;\n  height: 60rpx;\n  border: 4rpx solid #E5E5E5;\n  border-top: 4rpx solid #7363FF;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n  margin-bottom: 20rpx;\n}\n\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n\n.loading-text {\n  font-size: 28rpx;\n  color: #666666;\n  font-weight: 500;\n}\n\n// 内容滚动区域\n.content-scroll {\n  height: 100%;\n  background: #F7F8FA;\n}\n\n.scroll-content {\n  min-height: 100%;\n}\n\n.content-swiper {\n  height: calc(100vh - 88rpx - 60rpx);\n}\n\n/* 底部TabBar样式 */\n.tab-bar {\n  background: #FFFFFF;\n  border-top: 1rpx solid #f0f0f0;\n  display: flex;\n  align-items: center;\n  box-sizing: border-box;\n  /* 安全区域适配 - 有安全区域时使用safe-area-inset-bottom，没有时使用40rpx */\n  padding-bottom: max(40rpx, env(safe-area-inset-bottom));\n  padding-top: 10rpx;\n  box-sizing: border-box;\n}\n\n.tab-item {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  transition: all 0.3s;\n  box-sizing: border-box;\n}\n\n.tab-item:active {\n  transform: scale(0.95);\n}\n\n.tab-icon {\n  width: 50rpx;\n  height: 50rpx;\n  transition: all 0.3s;\n}\n\n.tab-text {\n  font-size: 22rpx;\n  margin-top: 6rpx;\n  color: #666666;\n  font-weight: 500;\n  transition: all 0.3s;\n  line-height: 1.2;\n  /* 防止文字被截断 */\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 100%;\n}\n\n.tab-item.active .tab-text {\n  color: #7363FF;\n  font-weight: 600;\n}\n</style> ","import MiniProgramPage from '/Users/xiaoqiang/Documents/friemd/firend-loving-app/subPackages/fpart/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["Workbench","Profile","userStore","useUserStore","levelStore","useLevelStore","statusBarHeight","ref","currentTabIndex","applicationInfo","dataReady","refreshing","onMounted","info","uni","loadApplicationInfo","handleApplicationStatusChanged","handleRefreshApplicationInfo","onUnmounted","event","onRefresh","error","onRefreshRestore","onRefreshAbort","response","getApplicatioInfo","_a","_b","switchTab","index","onSwiperChange","e","MiniProgramPage"],"mappings":"yKA+EA,MAAMA,EAAY,IAAW,4BACvBC,EAAU,IAAW,qDAK3B,MAAMC,EAAYC,EAAAA,aAAc,EAC1BC,EAAaC,EAAAA,cAAe,EAG5BC,EAAkBC,EAAG,IAAC,CAAC,EAGvBC,EAAkBD,EAAG,IAAC,CAAC,EAGvBE,EAAkBF,EAAG,IAAC,IAAI,EAG1BG,EAAYH,EAAG,IAAC,EAAK,EAGrBI,EAAaJ,EAAG,IAAC,EAAK,EAE5BK,EAAAA,UAAU,IAAM,CAEd,MAAMC,EAAOC,EAAG,MAAC,kBAAmB,EACpCR,EAAgB,MAAQO,EAAK,iBAAmB,EAGhDE,EAAqB,EAGrBD,QAAI,IAAI,2BAA4BE,CAA8B,EAGlEF,QAAI,IAAI,yBAA0BG,CAA4B,CAChE,CAAC,EAEDC,EAAAA,YAAY,IAAM,CAEhBJ,QAAI,KAAK,2BAA4BE,CAA8B,EACnEF,QAAI,KAAK,yBAA0BG,CAA4B,CACjE,CAAC,EAGD,MAAMD,EAAkCG,GAAU,CAChDL,EAAAA,uDAAY,cAAeK,CAAK,EAE5BA,EAAM,OAAS,mBAEjBL,EAAAA,uDAAY,eAAe,EAC3BC,EAAqB,EAGrBX,EAAW,mBAAoB,EAQnC,EAGMa,EAA+B,IAAM,CACzCH,EAAAA,MAAA,MAAA,MAAA,qCAAY,YAAY,EACxBC,EAAqB,CACvB,EAGMK,EAAY,SAAY,CAC5BN,EAAAA,MAAY,MAAA,MAAA,qCAAA,QAAQ,EACpBH,EAAW,MAAQ,GAEnB,GAAI,CAEF,MAAMI,EAAqB,CAG5B,OAAQM,EAAO,CACdP,EAAAA,MAAA,MAAA,QAAA,qCAAc,UAAWO,CAAK,EAG9BP,EAAAA,MAAI,UAAU,CACZ,MAAO,WACP,KAAM,QACN,SAAU,GAChB,CAAK,CACL,QAAY,CAER,WAAW,IAAM,CACfH,EAAW,MAAQ,EACpB,EAAE,GAAG,CACP,CACH,EAGMW,EAAmB,IAAM,CAC7BR,EAAAA,MAAY,MAAA,MAAA,qCAAA,QAAQ,CACtB,EAGMS,EAAiB,IAAM,CAC3BT,EAAAA,MAAY,MAAA,MAAA,qCAAA,QAAQ,EACpBH,EAAW,MAAQ,EACrB,EAGMI,EAAsB,SAAY,SACtC,GAAI,CACFD,EAAAA,MAAA,MAAA,MAAA,qCAAY,UAAU,EACtB,MAAMU,EAAW,MAAMC,oBAAmB,EAG1C,GAFAX,EAAAA,MAAY,MAAA,MAAA,qCAAA,YAAaU,CAAQ,EAE7BA,EAAS,MAAQA,EAAS,KAAK,OAAS,EAC1Cf,EAAgB,MAAQe,EAAS,KAAK,KACtCV,yDAAY,QAASL,EAAgB,KAAK,EAG1CC,EAAU,MAAQ,GAClBI,EAAAA,MAAA,MAAA,MAAA,qCAAY,wBAAwB,MAEpCA,OAAAA,QAAa,MAAA,OAAA,qCAAA,cAAaY,EAAAF,EAAS,OAAT,YAAAE,EAAe,MAAO,MAAM,EAEtDhB,EAAU,MAAQ,GAGZ,IAAI,QAAMiB,EAAAH,EAAS,OAAT,YAAAG,EAAe,MAAO,UAAU,CAEnD,OAAQN,EAAO,CACdP,MAAAA,EAAAA,MAAA,MAAA,QAAA,qCAAc,YAAaO,CAAK,EAEhCX,EAAU,MAAQ,GAGZW,CACP,CACH,EAGMO,EAAaC,GAAU,CAC3BrB,EAAgB,MAAQqB,CAC1B,EAGMC,EAAkBC,GAAM,CAC5BvB,EAAgB,MAAQuB,EAAE,OAAO,OACnC,8hBCnOA,GAAG,WAAWC,CAAe"}