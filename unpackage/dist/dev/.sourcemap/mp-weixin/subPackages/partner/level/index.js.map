{"version":3,"file":"index.js","sources":["subPackages/partner/level/index.vue","subPackages/partner/level/index.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"level-container\">\n    <!-- 主内容区域 -->\n    <view class=\"main-content\">\n      <scroll-view \n        class=\"scroll-container\" \n        scroll-y=\"true\"\n        refresher-enabled=\"true\"\n        :refresher-triggered=\"isRefreshing\"\n        @refresherrefresh=\"onRefresh\"\n        @refresherrestore=\"onRefreshRestore\"\n      >\n        <!-- 当前等级卡片 -->\n        <view class=\"current-level-card modern-card\">\n          <view class=\"level-header\">\n            <view class=\"level-info\">\n              <image \n                :src=\"currentLevel?.icon_url \" \n                class=\"level-icon\" \n                mode=\"aspectFit\" \n              />\n              <view class=\"level-details\">\n                <text class=\"level-name\">{{ currentLevel?.level_name || '见习' }}陪伴师</text>\n                <text class=\"level-description\">成长值：{{ userGrowthValue  }}</text>\n              </view>\n            </view>\n            <view class=\"commission-rate\">\n              <text class=\"rate-label\">分成比例</text>\n              <text class=\"rate-value\">{{ (currentLevel?.commission_rate || 0.65) * 100 }}%</text>\n            </view>\n          </view>\n        </view>\n\n        <!-- 升级任务卡片 -->\n        <view class=\"upgrade-task-card modern-card\">\n          <view class=\"card-header\">\n            <view class=\"header-content\">\n              <view class=\"section-indicator\"></view>\n              <view class=\"header-text\">\n                <text class=\"card-title\">升级任务</text>\n                <text class=\"card-subtitle\">完成成长值要求即可升级</text>\n              </view>\n            </view>\n          </view>\n          \n          <view class=\"upgrade-content\" v-if=\"nextLevel\">\n            <view class=\"upgrade-path\">\n              <view class=\"current-level-item\">\n                <image \n                  :src=\"currentLevel?.icon_url || '/static/icons/profile/crown.png'\" \n                  class=\"level-icon-small\" \n                  mode=\"aspectFit\" \n                />\n                <text class=\"level-name-small\">{{ currentLevel?.level_name || '见习' }}</text>\n              </view>\n              <view class=\"upgrade-arrow\">\n                <text class=\"arrow-text\">→</text>\n              </view>\n              <view class=\"next-level-item\">\n                <image \n                  :src=\"nextLevel.icon_url\" \n                  class=\"level-icon-small\" \n                  mode=\"aspectFit\" \n                />\n                <text class=\"level-name-small\">{{ nextLevel.level_name }}</text>\n              </view>\n            </view>\n            \n            <view class=\"upgrade-requirements\">\n              <text class=\"requirement-title\">升级要求：</text>\n              <text class=\"requirement-text\">{{ nextLevel.description }}</text>\n            </view>\n            \n            <view class=\"progress-section\">\n              <view class=\"progress-info\">\n                <text class=\"progress-label\">当前成长值</text>\n                <text class=\"progress-value\">{{ userGrowthValue || 0 }}</text>\n              </view>\n              <view class=\"progress-bar\">\n                <view \n                  class=\"progress-fill\" \n                  :style=\"{ width: progressPercentage + '%' }\"\n                ></view>\n              </view>\n              <view class=\"progress-target\">\n                <text class=\"target-text\">目标：{{ nextLevel.min_stars }} 成长值</text>\n              </view>\n            </view>\n          </view>\n          \n          <view class=\"max-level-tip\" v-else>\n            <text class=\"tip-text\">🎉 恭喜！您已达到最高等级</text>\n          </view>\n        </view>\n\n        <!-- 分成比例卡片 -->\n        <view class=\"commission-card modern-card\">\n          <view class=\"card-header\">\n            <view class=\"header-content\">\n              <view class=\"section-indicator\"></view>\n              <view class=\"header-text\">\n                <text class=\"card-title\">分成比例</text>\n                <text class=\"card-subtitle\">当前等级的分成比例</text>\n              </view>\n            </view>\n          </view>\n          \n          <view class=\"commission-content\">\n            <view class=\"commission-display\">\n              <text class=\"commission-value\">{{ (currentLevel?.commission_rate || 0.65) * 100 }}%</text>\n              <text class=\"commission-label\">平台分成比例</text>\n            </view>\n            <view class=\"commission-note\">\n              <text class=\"note-text\">您将获得订单金额的 {{ (currentLevel?.commission_rate || 0.65) * 100 }}% 作为收入</text>\n            </view>\n          </view>\n        </view>\n\n        <!-- 等级说明卡片 -->\n        <view class=\"level-explanation-card modern-card\">\n          <view class=\"card-header\">\n            <view class=\"header-content\">\n              <view class=\"section-indicator\"></view>\n              <view class=\"header-text\">\n                <text class=\"card-title\">等级说明</text>\n                <text class=\"card-subtitle\">成长值与接单金额规则</text>\n              </view>\n            </view>\n          </view>\n          \n          <view class=\"explanation-content\">\n            <text class=\"explanation-text\">\n              成长值规则：每接单1元获得1成长值，积累成长值可晋升更高等级，享受更多权益。\n            </text>\n          </view>\n        </view>\n\n        <!-- 等级列表卡片 -->\n        <view class=\"levels-list-card modern-card\">\n          <view class=\"card-header\">\n            <view class=\"header-content\">\n              <view class=\"section-indicator\"></view>\n              <view class=\"header-text\">\n                <text class=\"card-title\">等级列表</text>\n                <text class=\"card-subtitle\">所有等级信息</text>\n              </view>\n            </view>\n          </view>\n          \n          <view class=\"levels-list\">\n            <view \n              v-for=\"level in serviceLevels\" \n              :key=\"level.id\"\n              class=\"level-item\"\n              :class=\"{ current: level.level_order === currentLevel?.level_order }\"\n            >\n              <view class=\"level-item-content\">\n                <image \n                  :src=\"level.icon_url\" \n                  class=\"level-item-icon\" \n                  mode=\"aspectFit\" \n                />\n                <view class=\"level-item-info\">\n                  <text class=\"level-item-name\">{{ level.level_name }}</text>\n                  <text class=\"level-item-desc\">{{ level.description }}</text>\n                </view>\n                <view class=\"level-item-commission\">\n                  {{ level.commission_rate * 100 }}%\n                </view>\n              </view>\n            \n            </view>\n          </view>\n        </view>\n\n        <view style=\"height: 200rpx;\"></view>\n      </scroll-view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted } from 'vue'\nimport { getApplicatioInfo } from '@/api/user.js'\nimport { useLevelStore } from '@/stores/level.js'\n\n// 响应式数据\nconst isRefreshing = ref(false)\nconst currentLevel = ref(null)\nconst userGrowthValue = ref(0)\n\n// 获取全局store\nconst levelStore = useLevelStore()\n\n// 计算属性\nconst serviceLevels = computed(() => levelStore.sortedServiceLevels)\n\nconst nextLevel = computed(() => {\n  if (!currentLevel.value || !serviceLevels.value.length) return null\n  const currentOrder = currentLevel.value.level_order\n  return serviceLevels.value.find(level => level.level_order > currentOrder)\n})\n\nconst progressPercentage = computed(() => {\n  if (!nextLevel.value || !userGrowthValue.value) return 0\n  const current = userGrowthValue.value\n  const target = nextLevel.value.min_stars\n  const percentage = (current / target) * 100\n  return Math.min(percentage, 100)\n})\n\n\n\nconst onRefresh = async () => {\n  isRefreshing.value = true\n  try {\n    await loadData()\n  } catch (error) {\n    console.error('刷新数据失败:', error)\n  } finally {\n    isRefreshing.value = false\n  }\n}\n\nconst onRefreshRestore = () => {\n  isRefreshing.value = false\n}\n\nconst loadServiceLevels = async () => {\n  try {\n    // 使用全局store获取服务等级列表\n    await levelStore.fetchServiceLevels()\n    console.log('服务等级列表加载完成')\n  } catch (error) {\n    console.error('获取服务等级列表失败:', error)\n    uni.showToast({\n      title: '获取等级信息失败',\n      icon: 'none'\n    })\n  }\n}\n\nconst loadUserApplication = async () => {\n  try {\n    const response = await getApplicatioInfo()\n\n    if (response.data && response.data.code === 0 && response.data.data) {\n      const application = response.data\n      userGrowthValue.value = application.data.growth_value || 0\n      console.log(\"userGrowthValue.value\",userGrowthValue.value)\n      // 根据成长值确定当前等级\n      const currentLevelOrder = application.data.level_order\n      console.log(\"currentLevelOrder\",application)\n      currentLevel.value = serviceLevels.value.find(level => level.level_order === currentLevelOrder)\n    }\n  } catch (error) {\n    console.error('获取用户申请信息失败:', error)\n  }\n}\n\nconst getCurrentLevelOrder = (growthValue) => {\n  // 根据成长值确定等级\n  for (let i = serviceLevels.value.length - 1; i >= 0; i--) {\n    const level = serviceLevels.value[i]\n    if (growthValue >= level.min_stars) {\n      return level.level_order\n    }\n  }\n  return 1 // 默认见习等级\n}\n\nconst loadData = async () => {\n  await loadServiceLevels()\n  await loadUserApplication()\n}\n\n// 生命周期\nonMounted(() => {\n  // 加载数据\n  loadData()\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.level-container {\n  height: 100vh;\n  background: linear-gradient(135deg, #F7F8FA 0%, #FFFFFF 100%);\n  display: flex;\n  flex-direction: column;\n}\n\n\n\n.main-content {\n  flex: 1;\n  padding: 0 20rpx;\n  box-sizing: border-box;\n  height: 0; /* 关键：让flex子元素能够正确计算高度 */\n}\n\n.scroll-container {\n  height: 100%;\n  box-sizing: border-box;\n  flex: 1;\n  -webkit-overflow-scrolling: touch;\n  touch-action: pan-y;\n}\n\n.modern-card {\n  background: #FFFFFF;\n  border-radius: 16rpx;\n  margin-bottom: 20rpx;\n  box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.06);\n  overflow: hidden;\n}\n\n.card-header {\n  padding: 24rpx 24rpx 0 24rpx;\n \n}\n\n.header-content {\n  display: flex;\n  align-items: flex-start;\n}\n\n.header-text {\n  display: flex;\n  flex-direction: column;\n}\n\n.section-indicator {\n  width: 6rpx;\n  height: 28rpx;\n  background: linear-gradient(135deg, #7363FF 0%, #FF69DE 100%);\n  border-radius: 3rpx;\n  margin-right: 16rpx;\n  margin-top: 6rpx;\n}\n\n.header-text {\n  flex: 1;\n}\n\n.card-title {\n  display: block;\n  font-size: 28rpx;\n  font-weight: 600;\n  color: #1A1A1A;\n  margin-bottom: 6rpx;\n}\n\n.card-subtitle {\n  font-size: 22rpx;\n  color: #999999;\n}\n\n// 当前等级卡片\n.current-level-card {\n  background: #FFFFFF;\n  color: #1A1A1A;\n  margin-top: 20rpx;\n}\n\n.level-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 32rpx 24rpx;\n}\n\n.level-info {\n  display: flex;\n  align-items: center;\n}\n\n.level-icon {\n  width: 100rpx;\n  height:100rpx;\n  margin-right: 16rpx;\n}\n\n.level-details {\n  flex: 1;\n}\n\n.level-name {\n  display: block;\n  font-size: 32rpx;\n  font-weight: 600;\n  margin-bottom: 6rpx;\n  color: #7363FF;\n}\n\n.level-description {\n  font-size: 22rpx;\n  color: #666666;\n}\n\n.commission-rate {\n  text-align: right;\n  color: #7363FF;\n}\n\n.rate-label {\n  display: block;\n  font-size: 22rpx;\n  color: #999999;\n  margin-bottom: 6rpx;\n}\n\n.rate-value {\n  font-size: 28rpx;\n  font-weight: 600;\n  color: #7363FF;\n}\n\n// 升级任务卡片\n.upgrade-content {\n  padding: 24rpx;\n}\n\n.upgrade-path {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: 24rpx;\n}\n\n.current-level-item,\n.next-level-item {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  margin-top: 20rpx;\n  margin-bottom: 20rpx;\n}\n\n.level-icon-small {\n  width: 80rpx;\n  height: 80rpx;\n  margin-bottom: 8rpx;\n}\n\n.level-name-small {\n  font-size: 22rpx;\n  color: #666666;\n}\n\n.upgrade-arrow {\n  margin: 0 32rpx;\n}\n\n.arrow-text {\n  font-size: 28rpx;\n  color: #7363FF;\n  font-weight: bold;\n}\n\n.upgrade-requirements {\n  display: flex;\n  margin-bottom: 24rpx;\n}\n\n.requirement-title {\n  display: block;\n  font-size: 26rpx;\n  font-weight: 600;\n  color: #1A1A1A;\n \n}\n\n.requirement-text {\n  font-size: 24rpx;\n  color: #666666;\n \n}\n\n.progress-section {\n  background: #F7F8FA;\n  border-radius: 10rpx;\n  padding: 16rpx;\n}\n\n.progress-info {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12rpx;\n}\n\n.progress-label {\n  font-size: 22rpx;\n  color: #666666;\n}\n\n.progress-value {\n  font-size: 26rpx;\n  font-weight: 600;\n  color: #7363FF;\n}\n\n.progress-bar {\n  height: 6rpx;\n  background: #E5E5E5;\n  border-radius: 3rpx;\n  overflow: hidden;\n  margin-bottom: 8rpx;\n}\n\n.progress-fill {\n  height: 100%;\n  background: linear-gradient(90deg, #7363FF 0%, #FF69DE 100%);\n  border-radius: 4rpx;\n  transition: width 0.3s ease;\n}\n\n.progress-target {\n  text-align: right;\n}\n\n.target-text {\n  font-size: 20rpx;\n  color: #999999;\n}\n\n.max-level-tip {\n  padding: 32rpx 24rpx;\n  text-align: center;\n}\n\n.tip-text {\n  font-size: 26rpx;\n  color: #4CAF50;\n  font-weight: 600;\n}\n\n// 分成比例卡片\n.commission-content {\n  padding: 24rpx;\n}\n\n.commission-display {\n  text-align: center;\n  margin-bottom: 16rpx;\n}\n\n.commission-value {\n  display: block;\n  font-size: 40rpx;\n  font-weight: 600;\n  color: #7363FF;\n  margin-bottom: 8rpx;\n}\n\n.commission-label {\n  font-size: 22rpx;\n  color: #666666;\n}\n\n.commission-note {\n  background: #F7F8FA;\n  border-radius: 10rpx;\n  padding: 16rpx;\n}\n\n.note-text {\n  font-size: 24rpx;\n  color: #666666;\n  line-height: 1.4;\n}\n\n// 等级说明卡片\n.explanation-content {\n  padding: 24rpx;\n}\n\n.explanation-text {\n  font-size: 24rpx;\n  color: #666666;\n  line-height: 1.5;\n}\n\n// 等级列表卡片\n.levels-list {\n  padding: 24rpx;\n}\n\n.level-item {\n  border-bottom: 1rpx solid #F0F0F0;\n  padding: 16rpx 0;\n}\n\n.level-item:last-child {\n  border-bottom: none;\n}\n\n.level-item.current {\n  background: linear-gradient(135deg, rgba(115, 99, 255, 0.08) 0%, rgba(255, 105, 222, 0.08) 100%);\n  border-radius: 10rpx;\n  margin: 0 -24rpx;\n  padding: 16rpx 24rpx;\n}\n\n.level-item-content {\n  display: flex;\n  align-items: center;\n  margin-bottom: 8rpx;\n}\n\n.level-item-icon {\n  width: 54rpx;\n  height: 54rpx;\n  margin-right: 16rpx;\n}\n\n.level-item-info {\n  flex: 1;\n}\n\n.level-item-name {\n  display: block;\n  font-size: 26rpx;\n  font-weight: 600;\n  color: #1A1A1A;\n  margin-bottom: 4rpx;\n}\n\n.level-item-desc {\n  font-size: 22rpx;\n  color: #666666;\n}\n\n.level-item-commission {\n\n  color: #1A1A1A;\n  padding: 6rpx 12rpx;\n\n  box-sizing: border-box;\n}\n\n.commission-text {\n  font-size: 20rpx;\n  font-weight: 600;\n}\n\n.level-item-range {\n  margin-left: 70rpx;\n}\n\n.range-text {\n  font-size: 22rpx;\n  color: #999999;\n}\n</style> ","import MiniProgramPage from '/Users/xiaoqiang/Documents/friemd/firend-loving-app/subPackages/partner/level/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","useLevelStore","computed","uni","getApplicatioInfo","onMounted"],"mappings":";;;;;;;AA2LA,UAAM,eAAeA,cAAG,IAAC,KAAK;AAC9B,UAAM,eAAeA,cAAG,IAAC,IAAI;AAC7B,UAAM,kBAAkBA,cAAG,IAAC,CAAC;AAG7B,UAAM,aAAaC,aAAAA,cAAe;AAGlC,UAAM,gBAAgBC,cAAQ,SAAC,MAAM,WAAW,mBAAmB;AAEnE,UAAM,YAAYA,cAAQ,SAAC,MAAM;AAC/B,UAAI,CAAC,aAAa,SAAS,CAAC,cAAc,MAAM;AAAQ,eAAO;AAC/D,YAAM,eAAe,aAAa,MAAM;AACxC,aAAO,cAAc,MAAM,KAAK,WAAS,MAAM,cAAc,YAAY;AAAA,IAC3E,CAAC;AAED,UAAM,qBAAqBA,cAAQ,SAAC,MAAM;AACxC,UAAI,CAAC,UAAU,SAAS,CAAC,gBAAgB;AAAO,eAAO;AACvD,YAAM,UAAU,gBAAgB;AAChC,YAAM,SAAS,UAAU,MAAM;AAC/B,YAAM,aAAc,UAAU,SAAU;AACxC,aAAO,KAAK,IAAI,YAAY,GAAG;AAAA,IACjC,CAAC;AAID,UAAM,YAAY,YAAY;AAC5B,mBAAa,QAAQ;AACrB,UAAI;AACF,cAAM,SAAU;AAAA,MACjB,SAAQ,OAAO;AACdC,sBAAAA,MAAA,MAAA,SAAA,8CAAc,WAAW,KAAK;AAAA,MAClC,UAAY;AACR,qBAAa,QAAQ;AAAA,MACtB;AAAA,IACH;AAEA,UAAM,mBAAmB,MAAM;AAC7B,mBAAa,QAAQ;AAAA,IACvB;AAEA,UAAM,oBAAoB,YAAY;AACpC,UAAI;AAEF,cAAM,WAAW,mBAAoB;AACrCA,sBAAAA,MAAY,MAAA,OAAA,8CAAA,YAAY;AAAA,MACzB,SAAQ,OAAO;AACdA,sBAAAA,MAAc,MAAA,SAAA,8CAAA,eAAe,KAAK;AAClCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AAAA,MACF;AAAA,IACH;AAEA,UAAM,sBAAsB,YAAY;AACtC,UAAI;AACF,cAAM,WAAW,MAAMC,2BAAmB;AAE1C,YAAI,SAAS,QAAQ,SAAS,KAAK,SAAS,KAAK,SAAS,KAAK,MAAM;AACnE,gBAAM,cAAc,SAAS;AAC7B,0BAAgB,QAAQ,YAAY,KAAK,gBAAgB;AACzDD,wBAAY,MAAA,MAAA,OAAA,8CAAA,yBAAwB,gBAAgB,KAAK;AAEzD,gBAAM,oBAAoB,YAAY,KAAK;AAC3CA,wBAAAA,iEAAY,qBAAoB,WAAW;AAC3C,uBAAa,QAAQ,cAAc,MAAM,KAAK,WAAS,MAAM,gBAAgB,iBAAiB;AAAA,QAC/F;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAAA,MAAc,MAAA,SAAA,8CAAA,eAAe,KAAK;AAAA,MACnC;AAAA,IACH;AAaA,UAAM,WAAW,YAAY;AAC3B,YAAM,kBAAmB;AACzB,YAAM,oBAAqB;AAAA,IAC7B;AAGAE,kBAAAA,UAAU,MAAM;AAEd,eAAU;AAAA,IACZ,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvRD,GAAG,WAAW,eAAe;"}