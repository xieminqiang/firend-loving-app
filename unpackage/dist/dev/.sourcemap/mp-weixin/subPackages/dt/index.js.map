{"version":3,"file":"index.js","sources":["subPackages/dt/index.vue","subPackages/dt/index.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"release\" v-if=\"userStore.switch == 1\">\n\t\t<view class=\"release-nav\">\n\t\t\t<view @tap=\"toBack\">\n\t\t\t\t<u-icon color=\"#000\" size=\"24\" name=\"close\"></u-icon>\n\t\t\t</view>\n\t\t\t<view class=\"nav-title\">发布</view>\n\t\t\t<view class=\"nav-placeholder\"></view>\n\t\t</view>\n\n\t\t<view class=\"connect\">\n\t\t\t<u--textarea v-model=\"textareaValue\" class=\"textarea\" placeholder=\"请输入内容\" border=\"bottom\"></u--textarea>\n\n\t\t\t<view class=\"topic\">\n\t\t\t\t<template v-for=\"item in release.topics\" :key=\"item.topic_id\">\n\t\t\t\t\t<view class=\"topBtn\" type=\"default\">{{item.topic_desc}}</view>\n\t\t\t\t</template>\n\t\t\t</view>\n\n\t\t\t<!-- 图片/视频上传区域 -->\n\t\t\t<view class=\"upload-section\">\n\t\t\t\t<view class=\"upload-title\">添加图片/视频</view>\n\t\t\t\t<view class=\"upload-grid\">\n\t\t\t\t\t<!-- 已上传的媒体文件 -->\n\t\t\t\t<view \n\t\t\t\t\tv-for=\"(item, index) in mediaList\" \n\t\t\t\t\t:key=\"index\"\n\t\t\t\t\tclass=\"media-item\"\n\t\t\t\t\t:class=\"{ \n\t\t\t\t\t\t'video-item': item.type === 'video'\n\t\t\t\t\t}\"\n\t\t\t\t>\n\t\t\t\t\t\t<!-- 视频使用video控件 -->\n\t\t\t\t\t\t<video\n\t\t\t\t\t\t\tv-if=\"item.type === 'video'\"\n\t\t\t\t\t\t\t:src=\"proxy.$imgBaseUrl + item.url\"\n\t\t\t\t\t\t\tclass=\"media-video\"\n\t\t\t\t\t\t\tcontrols\n\t\t\t\t\t\t\tshow-center-play-btn\n\t\t\t\t\t\t\tshow-play-btn\n\t\t\t\t\t\t\tshow-fullscreen-btn\n\t\t\t\t\t\t\tshow-progress\n\t\t\t\t\t\t\tenable-progress-gesture\n\t\t\t\t\t\t\t@click=\"previewMedia(index)\"\n\t\t\t\t\t\t></video>\n\t\t\t\t\t\t<!-- 图片使用image控件 -->\n\t\t\t\t\t\t<image\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\t:src=\"proxy.$imgBaseUrl + item.url\" \n\t\t\t\t\t\t\tclass=\"media-image\" \n\t\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t\t\t@click=\"previewMedia(index)\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\n\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- 删除按钮 -->\n\t\t\t\t\t\t<view class=\"delete-btn\" @click=\"deleteMedia(index)\">\n\t\t\t\t\t\t\t<u-icon name=\"close\" color=\"#fff\" size=\"16\"></u-icon>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<!-- 添加按钮 -->\n\t\t\t\t\t<view \n\t\t\t\t\t\tv-if=\"mediaList.length < maxMediaCount\" \n\t\t\t\t\t\tclass=\"add-media-btn\"\n\t\t\t\t\t\t@click=\"showMediaPicker\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<u-icon name=\"plus\" color=\"#999\" size=\"32\"></u-icon>\n\t\t\t\t\t\t<text class=\"add-text\">添加</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<view class=\"connect-topic\">\n\t\t\t\t<view class=\"add-topic\"># 加话题</view>\n\t\t\t\t<scroll-view class=\"topic-list\" scroll-x=\"true\">\n\t\t\t\t\t<view \n\t\t\t\t\t\tclass=\"topic-item\" \n\t\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t\tactive: existTopicId.indexOf(item.topic_id) > -1\n\t\t\t\t\t\t}\" \n\t\t\t\t\t\tv-for=\"item in topicList\" \n\t\t\t\t\t\t:key=\"item.topic_id\"\n\t\t\t\t\t\t@tap=\"avtiveTopic(item)\"\n\t\t\t\t\t> \n\t\t\t\t\t\t{{item.topic_desc}}\n\t\t\t\t\t</view>\n\t\t\t\t</scroll-view>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 定位 -->\n\t\t<view class=\"address-now\" @tap=\"changeAddress\">\n\t\t\t<image class=\"address-image\" src=\"~@/static/icons/friend/address_re.png\" mode=\"\"></image>\n\t\t\t<view class=\"address-now-desc\">{{hasLocationDesc === '' ? '不显示位置': hasLocationDesc}}</view>\n\t\t</view>\n\n\n\n\n\n\t\t<!-- 媒体选择器 -->\n\t\t<u-action-sheet \n\t\t\t:show=\"showMediaActionSheet\" \n\t\t\t:actions=\"mediaActions\" \n\t\t\t@close=\"showMediaActionSheet = false\"\n\t\t\t@select=\"onMediaActionSelect\"\n\t\t></u-action-sheet>\n\n\t\t<!-- 底部固定发布按钮 -->\n\t\t<view class=\"bottom-submit-section\">\n\t\t\t<view class=\"submit-button-container\">\n\t\t\t\t<view \n\t\t\t\t\tclass=\"bottom-submit-btn\" \n\t\t\t\t\t:class=\"{ disabled: isSubmitting || !canSubmit }\"\n\t\t\t\t\t@click=\"onSubmit\"\n\t\t\t\t>\n\t\t\t\t\t<view class=\"submit-btn-content\">\n\t\t\t\t\t\t<view v-if=\"isSubmitting\" class=\"submit-loading\">\n\t\t\t\t\t\t\t<view class=\"loading-dots\">\n\t\t\t\t\t\t\t\t<view class=\"dot\"></view>\n\t\t\t\t\t\t\t\t<view class=\"dot\"></view>\n\t\t\t\t\t\t\t\t<view class=\"dot\"></view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<text class=\"submit-btn-text\" v-if=\"!isSubmitting\">发布</text>\n\t\t\t\t\t\t<text class=\"submit-btn-text\" v-else>发布中...</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\n\timport {\n\t\tonLoad\n\t} from '@dcloudio/uni-app'\n\timport {\n\t\tref,\n\t\treactive,\n\t\tcomputed,\n\t\tnextTick,\n\t\tgetCurrentInstance\n\t} from 'vue'\n\timport {\n\tgetMomentsRequest,\n\tpushMoments\n} from '@/api/discover.js'\n\timport {\n\t\tuploadFile,\n\t\tgetUploadResult\n\t} from '@/api/file.js'\n\timport { useUserStore } from '@/stores/user.js'\n\t// 用户状态管理\n\tconst userStore = useUserStore()\n\t// 获取当前实例以访问全局属性\n\tconst { proxy } = getCurrentInstance()\n\t\n\t// 模拟数据，仅用于页面展示\n\n\tconst topicList = ref([])\n\n\t// 模拟位置数据\n\tconst hasLongitude = ref(116.397128)\n\tconst hasLatitude = ref(39.916527)\n\tconst hasLocationDesc = ref('')\n\n\t\n\n\tonLoad(() => {\n\t\t// 页面加载完成，调用接口获取数据\n\t\tconsole.log('发布页面加载完成')\n\t\tloadMomentsRequest()\n\t})\n\t\n\n\t// 加载动态请求数据\n\tconst loadMomentsRequest = async () => {\n\t\ttry {\n\t\t\n\t\t\t\n\t\t\tconst response = await getMomentsRequest()\n\t\t\t\n\t\t\tif (response.data.code === 0) {\n\t\t\t\ttopicList.value = response.data.data.topic_list || []\n\t\t\t\n\t\t\t} else {\n\t\t\t\tconsole.warn('获取动态请求数据失败:', response.data.msg)\n\t\t\t}\n\t\t} catch (error) {\n\t\t\n\t\t} finally {\n\t\t\tuni.hideLoading()\n\t\t}\n\t}\n\n\tconst popupShow = ref(false)\n\tconst release = reactive({\n\t\timgList: [],\n\t\tcontent: '',\n\t\tstatus: 1,\n\t\tlocation: \"\",\n\t\tlocation_desc: \"\",\n\t\ttopics: [],\n\t\tobject_keys: []\n\t})\n\n\t// 媒体文件相关\n\tconst mediaList = ref([])\n\tconst maxMediaCount = 9\n\tconst showMediaActionSheet = ref(false)\n\tconst mediaActions = [\n\t\t{ name: '拍照', value: 'camera' },\n\t\t{ name: '从相册选择', value: 'album' },\n\t\t{ name: '拍摄视频', value: 'video' }\n\t]\n\n\t// 显示媒体选择器\n\tconst showMediaPicker = () => {\n\t\tshowMediaActionSheet.value = true\n\t}\n\n\t// 处理媒体选择\n\tconst onMediaActionSelect = (action) => {\n\t\tshowMediaActionSheet.value = false\n\t\t\n\t\tswitch (action.value) {\n\t\t\tcase 'camera':\n\t\t\t\tchooseImage('camera')\n\t\t\t\tbreak\n\t\t\tcase 'album':\n\t\t\t\tchooseImage('album')\n\t\t\t\tbreak\n\t\t\tcase 'video':\n\t\t\t\tchooseVideo()\n\t\t\t\tbreak\n\t\t}\n\t}\n\n\t// 选择图片\n\tconst chooseImage = (sourceType) => {\n\t\tuni.chooseImage({\n\t\t\tcount: maxMediaCount - mediaList.value.length,\n\t\t\tsourceType: [sourceType],\n\t\t\tsizeType: ['compressed'],\n\t\t\tsuccess: (res) => {\n\t\t\t\thandleImageSuccess(res.tempFilePaths)\n\t\t\t},\n\t\t\tfail: (err) => {\n\t\t\t\tconsole.error('选择图片失败:', err)\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '选择图片失败',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t}\n\n\t// 选择视频\n\tconst chooseVideo = () => {\n\t\tuni.chooseVideo({\n\t\t\tsourceType: ['album', 'camera'],\n\t\t\tmaxDuration: 60,\n\t\t\tcamera: 'back',\n\t\t\tsuccess: (res) => {\n\t\t\t\thandleVideoSuccess(res)\n\t\t\t},\n\t\t\tfail: (err) => {\n\t\t\t\tconsole.error('选择视频失败:', err)\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '选择视频失败',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t}\n\n\t// 处理图片选择成功\n\tconst handleImageSuccess = async (tempFilePaths) => {\n\t\tfor (const path of tempFilePaths) {\n\t\t\t// 添加到媒体列表，状态为上传中\n\t\t\tconst mediaItem = {\n\t\t\t\ttype: 'image',\n\t\t\t\turl: path,\n\t\t\t\tstatus: 'uploading',\n\t\t\t\tfilePath: path,\n\t\t\t\tfileName: path.split('/').pop() || 'image.jpg'\n\t\t\t}\n\t\t\n\t\t\t   uni.showLoading({ title: '上传中...' })\n\t\t\t// 开始上传文件\n\t\t\ttry {\n\t\t\t\tconst uploadResult = await uploadFile({\n\t\t\t\t\tfilePath: path,\n\t\t\t\t\tname: mediaItem.fileName\n\t\t\t\t})\n\t\t\t\t\n\t\t\t\t// 获取上传结果\n\t\t\t\tconst fileInfo = getUploadResult(uploadResult) \n\t\t\t\tuni.hideLoading()\n\t\t\t\tif (fileInfo) {\n\t\t\t\t\t// 更新媒体项信息\n\t\t\t\t\tmediaItem.status = 'success'\n\t\t\t\t\tmediaItem.objectKey = fileInfo.objectKey\n\t\t\t\t\tmediaItem.url = fileInfo.url\n\t\t\t\t\tmediaItem.uploadedUrl = fileInfo.url\n\t\t\t\t\t\tmediaList.value.push(mediaItem)\n\t\t\t\t\tconsole.log('图片上传成功:', fileInfo)\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('上传结果解析失败')\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('图片上传失败:', error)\n\t\t\t\tmediaItem.status = 'failed'\n\t\t\t\tmediaItem.errorMsg = error.message\n\t\t\t\t\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '图片上传失败',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\t// 处理视频选择成功\n\tconst handleVideoSuccess = async (videoRes) => {\n\t\t// 添加到媒体列表，状态为上传中\n\t\tconst mediaItem = {\n\t\t\ttype: 'video',\n\t\t\turl: videoRes.tempFilePath,\n\t\t\tcover: videoRes.thumbTempFilePath,\n\t\t\tduration: videoRes.duration,\n\t\t\tsize: videoRes.size,\n\t\t\tstatus: 'uploading',\n\t\t\tfilePath: videoRes.tempFilePath,\n\t\t\tfileName: videoRes.tempFilePath.split('/').pop() || 'video.mp4'\n\t\t}\n\t      uni.showLoading({ title: '上传中...' })\n\t\t\n\t\t// 开始上传视频文件\n\t\ttry {\n\t\t\tconst uploadResult = await uploadFile({\n\t\t\t\tfilePath: videoRes.tempFilePath,\n\t\t\t\tname: mediaItem.fileName\n\t\t\t})\n\t\t\t\n\t\t\t// 获取上传结果\n\t\t\tconst fileInfo = getUploadResult(uploadResult) \n\t\t\t uni.hideLoading()\n\t\t\tif (fileInfo) {\n\t\t\t\t// 更新媒体项信息\n\t\t\t\tmediaItem.status = 'success'\n\t\t\t\tmediaItem.objectKey = fileInfo.objectKey\n\t\t\t\tmediaItem.url = fileInfo.url\n\t\t\t\tmediaItem.uploadedUrl = fileInfo.url\n\t\t\t\tmediaItem.cover = fileInfo.cover || videoRes.thumbTempFilePath\n\t\t\t\tmediaList.value.push(mediaItem)\n\t\t\t\tconsole.log('视频上传成功:', fileInfo)\n\t\t\t} else {\n\t\t\t\tthrow new Error('上传结果解析失败')\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error('视频上传失败:', error)\n\t\t\tmediaItem.status = 'failed'\n\t\t\tmediaItem.errorMsg = error.message\n\t\t\t\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '视频上传失败',\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t}\n\t}\n\n\t// 预览媒体\n\tconst previewMedia = (index) => {\n\t\tconst item = mediaList.value[index]\n\t\tif (item.type === 'image') {\n\t\t\t// 获取所有图片的URL，用于预览\n\t\t\tconst imageItems = mediaList.value.filter(m => m.type === 'image')\n\t\t\tconst urls = imageItems.map(m => proxy.$imgBaseUrl + m.url)\n\t\t\tconst currentIndex = imageItems.findIndex(m => m === item)\n\t\t\t\n\t\t\tuni.previewImage({\n\t\t\t\turls: urls,\n\t\t\t\tcurrent: currentIndex >= 0 ? currentIndex : 0,\n\t\t\t\tindicator: 'number',\n\t\t\t\tloop: true,\n\t\t\t\tshow: true,\n\t\t\t\tsuccess: function(res) {\n\t\t\t\t\tconsole.log('图片预览成功', res);\n\t\t\t\t},\n\t\t\t\tfail: function(err) {\n\t\t\t\t\tconsole.error('图片预览失败', err);\n\t\t\t\t}\n\t\t\t});\n\t\t} else if (item.type === 'video') {\n\t\t\t// 视频直接在当前页面播放，不需要跳转\n\t\t\tconsole.log('视频播放:', item.url)\n\t\t}\n\t}\n\n\t// 删除媒体\n\tconst deleteMedia = (index) => {\n\t\tuni.showModal({\n\t\t\ttitle: '提示',\n\t\t\tcontent: '确定要删除这个文件吗？',\n\t\t\tsuccess: (res) => {\n\t\t\t\tif (res.confirm) {\n\t\t\t\t\tmediaList.value.splice(index, 1)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\t\n\t// 重新上传失败的媒体文件\n\tconst retryUpload = async (index) => {\n\t\tconst item = mediaList.value[index]\n\t\tif (item.status !== 'failed') return\n\t\t\n\t\t// 重置状态为上传中\n\t\titem.status = 'uploading'\n\t\t\n\t\ttry {\n\t\t\tconst uploadResult = await uploadFile({\n\t\t\t\tfilePath: item.filePath,\n\t\t\t\tname: item.fileName\n\t\t\t})\n\t\t\t\n\t\t\t// 获取上传结果\n\t\t\tconst fileInfo = getUploadResult(uploadResult)\n\t\t\tif (fileInfo) {\n\t\t\t\t// 更新媒体项信息\n\t\t\t\titem.status = 'success'\n\t\t\t\titem.objectKey = fileInfo.objectKey\n\t\t\t\titem.url = fileInfo.url\n\t\t\t\titem.uploadedUrl = fileInfo.url\n\t\t\t\tif (item.type === 'video') {\n\t\t\t\t\titem.cover = fileInfo.cover || item.cover\n\t\t\t\t}\n\t\t\t\tconsole.log('重新上传成功:', fileInfo)\n\t\t\t\t\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '重新上传成功',\n\t\t\t\t\ticon: 'success'\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthrow new Error('上传结果解析失败')\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error('重新上传失败:', error)\n\t\t\titem.status = 'failed'\n\t\t\titem.errorMsg = error.message\n\t\t\t\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '重新上传失败',\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t}\n\t}\n\n\tconst textareaValue = ref(\"\")\n\tconst isSubmitting = ref(false)\n\t\n\t// 计算属性：是否可以提交\n\tconst canSubmit = computed(() => {\n\t\treturn textareaValue.value.trim().length > 0\n\t})\n\n\t// 获取话题\n\tconst existTopicId = computed(() => release.topics.map(item => item.topic_id))\n\n\t//添加话题 \n\tconst avtiveTopic = (item) => {\n\t\tlet itemIndex = release.topics.indexOf(item)\n\t\tif (itemIndex === -1) {\n\t\t\trelease.topics.push(item)\n\t\t}\n\t\tif (itemIndex !== -1) {\n\t\t\trelease.topics.splice(itemIndex, 1);\n\t\t}\n\t}\n\n\t// 选择地址\n\tconst changeAddress = () => {\n\t\t// #ifdef MP-WEIXIN\n\t\tuni.chooseLocation({\n\t\t\tsuccess: (res) => {\n\t\t\t\tconst address = res.address || res.name || '已选择位置'\n\t\t\t\tconsole.log('手动选择位置', res)\n\t\t\t\t\n\t\t\t\t// 更新显示\n\t\t\t\thasLocationDesc.value = address\n\t\t\t\thasLongitude.value = res.longitude\n\t\t\t\thasLatitude.value = res.latitude\n\t\t\t\t\n\t\t\t\t// uni.showToast({\n\t\t\t\t// \ttitle: '位置选择成功',\n\t\t\t\t// \ticon: 'success',\n\t\t\t\t// \tduration: 1500\n\t\t\t\t// })\n\t\t\t},\n\t\t\tfail: (err) => {\n\t\t\t\tif (err.errMsg && err.errMsg.indexOf('cancel') === -1) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '获取位置失败',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\tconsole.error('获取位置失败:', err.errMsg)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t// #endif\n\t\t// #ifndef MP-WEIXIN\n\t\tuni.showToast({\n\t\t\ttitle: '请在微信小程序中使用地图选点',\n\t\t\ticon: 'none'\n\t\t})\n\t\t// #endif\n\t}\n\n\t// 提交\n\tconst onSubmit = async () => {\n\t\tif (!canSubmit.value || isSubmitting.value) {\n\t\t\treturn\n\t\t}\n\n\t\tisSubmitting.value = true\n\n\t\t// 处理媒体文件，区分图片和视频\n\t\tconst processedMediaList = mediaList.value\n\t\t\t.filter(item => item.status === 'success') // 只包含上传成功的文件\n\t\t\t.map(item => {\n\t\t\t\tif (item.type === 'image') {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tmedia_type: 1, // 1: 图片\n\t\t\t\t\t\tobject_key: item.objectKey,\n\t\t\t\t\t\turl: item.uploadedUrl,\n\t\t\t\t\t\tfile_name: item.fileName\n\t\t\t\t\t}\n\t\t\t\t} else if (item.type === 'video') {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tmedia_type: 2, // 2: 视频\n\t\t\t\t\t\tobject_key: item.objectKey,\n\t\t\t\t\t\turl: item.uploadedUrl,\n\t\t\t\t\t\tfile_name: item.fileName,\n\t\t\t\t\t\tcover: item.cover,\n\t\t\t\t\t\tduration: item.duration,\n\t\t\t\t\t\tsize: item.size\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.filter(Boolean) // 过滤掉undefined项\n\n\t\t// 提取object_keys\n\t\tconst objectKeys = processedMediaList.map(item => item.object_key).filter(Boolean)\n\n\t\t// 处理topics，只保留需要的字段\n\t\tconst processedTopics = release.topics.map(topic => ({\n\t\t\ttopic_id: topic.topic_id,\n\t\t\ttopic_desc: topic.topic_desc,\n\t\t\ttopic_icon: topic.topic_icon\n\t\t}))\n\n\t\tlet data = {\n\t\t\tcontent: textareaValue.value, //内容\n\t\t\tstatus: 1, // 写死为1：广场可见\n\t\t\tlocation: `${hasLongitude.value},${hasLatitude.value}`, //定位\n\t\t\tlocation_desc: hasLocationDesc.value, //定位描述\n\t\t\ttopics: processedTopics,\n\t\t\tobject_keys: objectKeys,\n\t\t\tmedia_list: processedMediaList, // 处理后的媒体列表，区分图片和视频\n\t\t\t// 分别统计图片和视频数量\n\t\t\timage_count: processedMediaList.filter(item => item.media_type === 1).length,\n\t\t\tvideo_count: processedMediaList.filter(item => item.media_type === 2).length\n\t\t}\n\n\t\tconsole.log('发布参数:', data);\n\n\t\ttry {\n\t\t\tuni.showLoading({ title: '发布中...' })\n\t\t\t\n\t\t\tconst response = await pushMoments(data)\n\t\t\t\n\t\t\tif (response.data.code === 0) {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '发布成功',\n\t\t\t\t\ticon: 'success',\n\t\t\t\t\tduration: 2000\n\t\t\t\t})\n\t\t\t\t\n\t\t\t\t// 发布成功后返回上一页\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tuni.navigateBack({\n\t\t\t\t\t\tdelta: 1\n\t\t\t\t\t})\n\t\t\t\t}, 2000)\n\t\t\t} else {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: response.data.msg || '发布失败',\n\t\t\t\t\ticon: 'none',\n\t\t\t\t\tduration: 2000\n\t\t\t\t})\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error('发布失败:', error)\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '发布失败，请重试',\n\t\t\t\ticon: 'none',\n\t\t\t\tduration: 2000\n\t\t\t})\n\t\t} finally {\n\t\t\tuni.hideLoading()\n\t\t\tisSubmitting.value = false\n\t\t}\n\t}\n\n\tconst toBack = () => {\n\t\tuni.navigateBack({\n\t\t\tdelta: 1\n\t\t})\n\t}\n</script>\n\n<style lang=\"scss\" scoped>\n\t.release {\n\t\tpadding-top: 96rpx;\n\t\tpadding-bottom: 120rpx; /* 为底部按钮留出空间 */\n\n\t\t.release-nav { \n\t\t\tdisplay: flex;\n\t\t\tjustify-content: space-between;\n\t\t\talign-items: center;\n\t\t\tmargin: 0 24rpx;\n\t\t\tposition: relative;\n\t\t\theight: 88rpx;\n\t\t\t\n\t\t\t.nav-title {\n\t\t\t\tfont-size: 32rpx;\n\t\t\t\tfont-weight: 600;\n\t\t\t\tcolor: #1A1A1A;\n\t\t\t\tletter-spacing: 0.5rpx;\n\t\t\t}\n\t\t\t\n\t\t\t.nav-placeholder {\n\t\t\t\twidth: 24rpx; /* 与关闭按钮宽度一致，保持居中 */\n\t\t\t}\n\t\t}\n\n\t\t.connect {\n\t\t\tmargin-top: 52rpx;\n\t\t\tpadding: 0 24rpx;\n\t\t\t\n\t\t\t/* 全局textarea背景透明 */\n\t\t\t:deep(textarea) {\n\t\t\t\tbackground: transparent !important;\n\t\t\t\tbackground-color: transparent !important;\n\t\t\t\tbackground-image: none !important;\n\t\t\t}\n\t\t\t\n\t\t\t/* 小程序特定样式 */\n\t\t\t:deep(.u-textarea) {\n\t\t\t\tbackground: transparent !important;\n\t\t\t}\n\t\t\t\n\t\t\t:deep(.u-textarea__field) {\n\t\t\t\tbackground: transparent !important;\n\t\t\t\tbackground-color: transparent !important;\n\t\t\t}\n\n\t\t\t\t\t\t:deep(.textarea) {\n\t\t\t\tbackground: transparent !important;\n\t\t\t\t\n\t\t\t\t/* 小程序textarea背景透明 - 覆盖所有可能的背景 */\n\t\t\t\t:deep(.u-textarea__field) {\n\t\t\t\t\tbackground: transparent !important;\n\t\t\t\t\tbackground-color: transparent !important;\n\t\t\t\t\tbackground-image: none !important;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t:deep(.u-textarea__field__textarea) {\n\t\t\t\t\tbackground: transparent !important;\n\t\t\t\t\tbackground-color: transparent !important;\n\t\t\t\t\tbackground-image: none !important;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* 直接设置textarea元素 */\n\t\t\t\t:deep(textarea) {\n\t\t\t\t\tbackground: transparent !important;\n\t\t\t\t\tbackground-color: transparent !important;\n\t\t\t\t\tbackground-image: none !important;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* 覆盖可能的边框和阴影 */\n\t\t\t\t:deep(.u-textarea__field) {\n\t\t\t\t\tborder: none !important;\n\t\t\t\t\tbox-shadow: none !important;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* 强制覆盖内联样式 */\n\t\t\t\t:deep(.u-textarea__field) {\n\t\t\t\t\tbackground: transparent !important;\n\t\t\t\t\tbackground-color: transparent !important;\n\t\t\t\t\tbackground-image: none !important;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.ql-editor::before {\n\t\t\t\t\tfont-size: 24rpx;\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\tcolor: #999;\n\t\t\t\t\tfont-style: normal;\n\t\t\t\t}\n\n\t\t\t\t.ql-editor {\n\t\t\t\t\tfont-size: 24rpx;\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\tcolor: #1a1a1a;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// 上传区域样式\n\t\t\t.upload-section {\n\t\t\t\tmargin: 20rpx 0;\n\n\t\t\t\t.upload-title {\n\t\t\t\t\tfont-size: 24rpx;\n\t\t\t\t\tcolor: #666;\n\t\t\t\t\tmargin-bottom: 16rpx;\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t}\n\n\t\t\t\t.upload-grid {\n\t\t\t\t\tdisplay: grid;\n\t\t\t\t\tgrid-template-columns: repeat(3, 1fr);\n\t\t\t\t\tgap: 12rpx;\n\t\t\t\t}\n\n\t\t\t\t.media-item {\n\t\t\t\t\tposition: relative;\n\t\t\t\t\taspect-ratio: 1;\n\t\t\t\t\tborder-radius: 12rpx;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\tbox-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.1);\n\n\t\t\t\t\t&.video-item {\n\t\t\t\t\t\t.media-image {\n\t\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t.media-image {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tobject-fit: cover;\n\t\t\t\t}\n\n\t\t\t\t.media-video {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tborder-radius: 12rpx;\n\t\t\t\t\tobject-fit: cover;\n\t\t\t\t\t/* 视频控件样式优化 */\n\t\t\t\t\tbackground: #000;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* 视频控件在小尺寸下的优化 */\n\t\t\t\t.media-video::-webkit-media-controls {\n\t\t\t\t\topacity: 0;\n\t\t\t\t\ttransition: opacity 0.3s;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.media-video:hover::-webkit-media-controls {\n\t\t\t\t\topacity: 1;\n\t\t\t\t}\n\n\t\t\t\t.delete-btn {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttop: 8rpx;\n\t\t\t\t\tright: 8rpx;\n\t\t\t\t\tbackground: rgba(0, 0, 0, 0.6);\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\twidth: 40rpx;\n\t\t\t\t\theight: 40rpx;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* 上传状态样式 */\n\t\t\t\t.upload-status {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttop: 50%;\n\t\t\t\t\tleft: 50%;\n\t\t\t\t\ttransform: translate(-50%, -50%);\n\t\t\t\t\twidth: 60rpx;\n\t\t\t\t\theight: 60rpx;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tz-index: 10;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.upload-status.uploading {\n\t\t\t\t\tbackground: rgba(115, 99, 255, 0.8);\n\t\t\t\t\tanimation: rotate 1s linear infinite;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.upload-status.failed {\n\t\t\t\t\tbackground: rgba(255, 71, 87, 0.8);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t@keyframes rotate {\n\t\t\t\t\tfrom { transform: translate(-50%, -50%) rotate(0deg); }\n\t\t\t\t\tto { transform: translate(-50%, -50%) rotate(360deg); }\n\t\t\t\t}\n\n\t\t\t\t.add-media-btn {\n\t\t\t\t\taspect-ratio: 1;\n\t\t\t\t\tborder: 2rpx dashed #ddd;\n\t\t\t\t\tborder-radius: 12rpx;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tbackground: #f8f9fe;\n\t\t\t\t\tcolor: #999;\n\n\t\t\t\t\t.add-text {\n\t\t\t\t\t\tfont-size: 22rpx;\n\t\t\t\t\t\tmargin-top: 8rpx;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t.connect-topic {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tmargin-top: 20rpx;\n\n\t\t\t\t.add-topic {\n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t\twidth: 130rpx;\n\t\t\t\t\theight: 40rpx;\n\t\t\t\t\tmargin-right: 12rpx;\n\t\t\t\t\tline-height: 40rpx;\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tborder-radius: 24rpx;\n\t\t\t\t\tbackground: rgba(234, 233, 247, 1);\n\t\t\t\t\tfont-size: 20rpx;\n\t\t\t\t\tfont-weight: 600;\n\t\t\t\t\tcolor: rgba(115, 99, 255, 1);\n\t\t\t\t}\n\n\t\t\t\t.topic-list {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\twhite-space: nowrap;\n\n\t\t\t\t\t.topic-item {\n\t\t\t\t\t\tpadding: 9rpx 20rpx;\n\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\tfont-size: 20rpx;\n\t\t\t\t\t\tmargin-right: 12rpx;\n\t\t\t\t\t\tborder-radius: 24rpx;\n\t\t\t\t\t\tbackground: rgba(242, 242, 242, 1);\n\n\t\t\t\t\t\t&.active {\n\t\t\t\t\t\t\tcolor: #7363FF;\n\t\t\t\t\t\t\tbackground: #EAE9F7;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t&:last-child {\n\t\t\t\t\t\t\tmargin-right: 180rpx;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t.topic {\n\t\t\tmargin-bottom: 8rpx;\n\t\t\tdisplay: flex;\n\t\t\tflex-wrap: wrap;\n\t\t\tjustify-content: flex-start;\n\t\t\n\t\t\t.topBtn {\n\t\t\t\tmargin-right: 10rpx;\n\t\t\t\tpadding: 10rpx;\n\t\t\t\tcolor: rgb(115, 99, 255);\n\t\t\t\tborder: 1rpx solid #999;\n\t\t\t\tfont-size: 20rpx;\n\t\t\t\tborder-radius: 10rpx;\n\t\t\t}\n\t\t}\n\n\t\t// 定位\n\t\t.address-now {\n\t\t\tmargin: 20rpx 24rpx;\n\t\t\tpadding: 12rpx 24rpx;\n\t\t\n\t\t\tborder-radius:6rpx;\n\t\t\tbackground: rgba(242, 242, 242, 1);\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: center;\n            box-sizing: border-box;\n\t\t\t.address-image {\n\t\t\t\twidth: 28rpx;\n\t\t\t\theight: 28rpx;\n\t\t\t}\n\n\t\t\t.address-now-desc {\n\t\t\t\tmargin-left: 10rpx;\n\t\t\t\tfont-size: 24rpx;\n\t\t\t\tfont-weight: 500;\n\t\t\t\tcolor: rgba(26, 26, 26, 1);\n\t\t\t}\n\t\t}\n\n\n\n\t\t// 发布设置\n\t\t.publish-setting {\n\t\t\tpadding-top: 32rpx;\n\n\t\t\t.title {\n\t\t\t\tfont-size: 28rpx;\n\t\t\t\tfont-weight: 500;\n\t\t\t\ttext-align: center;\n\t\t\t}\n\n\t\t\t.status-list {\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tmargin-top: 46rpx;\n\t\t\t\tpadding: 0 16rpx;\n\n\t\t\t\t.status-item {\n\t\t\t\t\tmargin-top: 40rpx;\n\t\t\t\t\tpadding-left: 12rpx;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\theight: 70rpx;\n\n\t\t\t\t\t.left {\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\tflex-direction: column;\n\t\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t\t\theight: 100%;\n\n\t\t\t\t\t\t.name {\n\t\t\t\t\t\t\tfont-size: 24rpx;\n\t\t\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\t\t\tcolor: #1a1a1a;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t.desc {\n\t\t\t\t\t\t\tfont-size: 20rpx;\n\t\t\t\t\t\t\tcolor: #999;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/* 底部提交按钮样式 */\n\t.bottom-submit-section {\n\t\tposition: fixed;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbackground: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(247, 248, 250, 0.95) 100%);\n\t\n\t\tpadding: 20rpx 20rpx calc(20rpx + env(safe-area-inset-bottom));\n\t\tborder-top: 1rpx solid rgba(115, 99, 255, 0.1);\n\t\n\t\tz-index: 100;\n\t}\n\n\t.submit-button-container {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t}\n\n\t.bottom-submit-btn {\n\t\twidth: 100%;\n\t\tmax-width: 660rpx;\n\t\tbackground: linear-gradient(135deg, #7363FF 0%, #FF69DE 100%);\n\t\tborder-radius: 24rpx;\n\t\tpadding: 20rpx 32rpx;\n\t\ttransition: all 0.3s ease;\n\t\t\n\t\t\n\t\t&:active:not(.disabled) {\n\t\t\ttransform: scale(0.95);\n\t\t\n\t\t}\n\t\t\n\t\t&.disabled {\n\t\t\topacity: 0.6;\n\t\t\ttransform: none !important;\n\t\t\n\t\t}\n\t}\n\n\t.submit-btn-content {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\n\t.submit-loading {\n\t\twidth: 40rpx;\n\t\theight: 40rpx;\n\t\tmargin-right: 12rpx;\n\t\tborder: 4rpx solid rgba(255, 255, 255, 0.3);\n\t\tborder-top: 4rpx solid rgba(255, 255, 255, 0.6);\n\t\tborder-radius: 50%;\n\t\tanimation: spin 1s linear infinite;\n\t}\n\n\t.submit-btn-text {\n\t\tfont-size: 28rpx;\n\t\tcolor: #FFFFFF;\n\t\tfont-weight: 600;\n\t\tletter-spacing: 0.5rpx;\n\t}\n\n\t.loading-dots {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\twidth: 40rpx;\n\t\theight: 12rpx;\n\t}\n\n\t.dot {\n\t\twidth: 8rpx;\n\t\theight: 8rpx;\n\t\tbackground: white;\n\t\tborder-radius: 50%;\n\t\tanimation: blink 1s linear infinite;\n\t}\n\n\t@keyframes blink {\n\t\t0%, 100% { opacity: 1; }\n\t\t50% { opacity: 0.5; }\n\t}\n\n\t@keyframes spin {\n\t\t0% { transform: rotate(0deg); }\n\t\t100% { transform: rotate(360deg); }\n\t}\n</style>","import MiniProgramPage from '/Users/xiaoqiang/Documents/friemd/firend-loving-app/subPackages/dt/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["maxMediaCount","userStore","useUserStore","proxy","getCurrentInstance","topicList","ref","hasLongitude","hasLatitude","hasLocationDesc","onLoad","uni","loadMomentsRequest","response","getMomentsRequest","release","reactive","mediaList","showMediaActionSheet","mediaActions","showMediaPicker","onMediaActionSelect","action","chooseImage","chooseVideo","sourceType","res","handleImageSuccess","err","handleVideoSuccess","tempFilePaths","path","mediaItem","uploadResult","uploadFile","fileInfo","getUploadResult","error","videoRes","previewMedia","index","item","imageItems","m","urls","currentIndex","deleteMedia","textareaValue","isSubmitting","canSubmit","computed","existTopicId","avtiveTopic","itemIndex","changeAddress","address","onSubmit","processedMediaList","objectKeys","processedTopics","topic","data","pushMoments","toBack","MiniProgramPage"],"mappings":"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"}