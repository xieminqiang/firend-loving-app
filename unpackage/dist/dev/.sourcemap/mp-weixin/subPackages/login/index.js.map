{"version":3,"file":"index.js","sources":["subPackages/login/index.vue","subPackages/login/index.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 主要内容区域 -->\n    <view class=\"content\">\n      \n      <!-- Logo和标题区域 -->\n      <view class=\"header-section\">\n        <view class=\"logo-container\">\n          <image :src=\"$imgBaseUrl +'/img/cum/logo_small_01.jpeg'\" class=\"logo\" mode=\"aspectFill\"></image>\n         \n        </view>\n        <view class=\"title-container\">\n          <view class=\"main-title\">欢迎来到随伴行</view>\n       \n        </view>\n      </view>\n\n      <!-- 登录按钮区域 -->\n      <view class=\"login-section\">\n        <button \n          class=\"login-button\" \n          open-type=\"getPhoneNumber\"\n          @getphonenumber=\"getPhoneNumber\">\n          <text class=\"button-text\">手机号快捷登录</text>\n        </button>\n      </view>\n\n\n    </view>\n  </view>\n\n  <!-- 服务协议弹窗 -->\n  <uni-popup ref=\"popup\" :safeArea=\"false\" type=\"center\" @change=\"onPopupChange\">\n    <view class=\"popup-container\">\n      <view class=\"popup-header\">\n        <view class=\"popup-title\">服务协议</view>\n      </view>\n      <view class=\"popup-content\">\n        <text class=\"popup-text\">\n          请您认真阅读<text class=\"highlight-text\" @click=\"showUserAgreement\">《平台服务协议》</text>、<text class=\"highlight-text\" @click=\"showPrivacyPolicy\">《隐私政策》</text>的全部条款，接受后可开始使用我们的服务\n        </text>\n      </view>\n      <view class=\"popup-buttons flex-between\">\n        <view class=\"popup-btn btn-cancel flex-center\" @click=\"handleCancel\">不同意</view>\n        <view class=\"popup-btn btn-confirm flex-center\" @click=\"handleConfirm\">同意并继续</view>\n      </view>\n    </view>\n  </uni-popup>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\nimport { wxLogin } from '@/api/user.js'\nimport { useUserStore } from '@/stores/user.js'\nimport { useLevelStore } from '@/stores/level.js'\nimport { onLoad } from '@dcloudio/uni-app'\n\nconst userStore = useUserStore()\nconst levelStore = useLevelStore()\nconst popup = ref(null)\nconst isPopupOpen = ref(true)\nconst hasAgreed = ref(false)\n\nonLoad(async () => {\n  // 获取系统信息设置状态栏高度\n  const systemInfo = uni.getSystemInfoSync()\n  console.log('系统信息:', systemInfo)\n  \n  // 延迟显示协议弹窗\n  setTimeout(() => {\n    if (popup.value) {\n      popup.value.open()\n    } \n  }, 500)\n})\n\n\n// 取消协议\nconst handleCancel = () => {\n  popup.value.close()\n  setTimeout(() => {\n    uni.navigateBack({\n      delta: 1\n    })\n  }, 300)\n}\n\n// 确认协议\nconst handleConfirm = () => {\n  hasAgreed.value = true\n  popup.value.close()\n \n}\n\nconst onPopupChange = (e) => {\n  isPopupOpen.value = e.show\n}\n\n// 显示用户协议\nconst showUserAgreement = () => {\n  uni.navigateTo({\n    url: '/subPackages/login/agreement'\n  })\n}\n\n// 显示隐私政策\nconst showPrivacyPolicy = () => {\n  uni.navigateTo({\n    url: '/subPackages/login/policy'\n  })\n}\n\n// 微信登录\nconst wechatLogin = () => {\n  uni.showToast({\n    title: '微信登录开发中',\n    icon: 'none'\n  })\n}\n\n// 手机号登录\nconst getPhoneNumber = async (e) => {\n  console.log('getPhoneNumber event:', e)\n  \n  // if (!hasAgreed.value) {\n  //   uni.showToast({\n  //     title: '请先同意服务协议',\n  //     icon: 'none'\n  //   })\n  //   if (popup.value) {\n  //     popup.value.open()\n  //   }\n  //   return\n  // }\n\n  const res = e.detail\n  if (!res.code) {\n    uni.showToast({\n      title: '授权失败，请重试',\n      icon: 'none'\n    })\n    return\n  }\n\n  try {\n    // 获取微信登录code\n    const loginRes = await uni.login({ provider: 'weixin' })\n    \n    uni.showLoading({\n      title: '登录中...',\n      mask: true\n    })\n\n    // 调用登录接口\n    const result = await wxLogin({\n      login_code: loginRes.code,\n      phone_code: res.code\n    })\n\n    uni.hideLoading()\n\n    if (result.data && result.data.code === 0) {\n      // 保存用户信息\n      userStore.setUserInfo(result.data.data.token)\n      \n      // 保存token\n    \n\t        userStore.setToken(result.data.data.token.access_token)\n\t    \n\n      // 清除等级列表缓存，确保获取用户相关的等级信息\n      levelStore.clearServiceLevels()\n      \n      // 发送登录成功事件，通知其他页面刷新数据\n      uni.$emit('loginSuccess', {\n        userInfo: result.data.data\n      })\n      \n      uni.showToast({\n        title: '登录成功',\n        icon: 'success'\n      })\n\n      // 延迟跳转到首页\n      setTimeout(() => { \n\t\t  \n       uni.navigateBack({\n       \tdelta: 1 // 返回的页面数，默认值为1，即返回上一级页面\n       });\n      }, 1500)\n    } else {\n      uni.showToast({\n        title: result.data?.msg || '登录失败',\n        icon: 'none'\n      })\n    }\n  } catch (error) {\n    uni.hideLoading()\n    console.error('登录失败:', error)\n    uni.showToast({\n      title: '登录失败，请重试',\n      icon: 'none'\n    })\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n// 通用布局样式\n.container {\n  min-height: 100vh;\n  background: #FFFFFF;\n  position: relative;\n  overflow: hidden;\n}\n\n\n.content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 120rpx 40rpx 60rpx;\n  position: relative;\n  min-height: 100vh;\n}\n\n.header-section {\n  text-align: center;\n  margin-bottom: 100rpx;\n  color: #333;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  position: relative;\n  z-index: 20;\n}\n\n.logo-container {\n  position: relative;\n\n}\n\n.logo {\n  width: 140rpx;\n  height: 140rpx;\n\n\n}\n\n\n\n\n.title-container {\n  text-align: center;\n}\n\n.main-title {\n  font-size: 40rpx;\n  font-weight: 700;\n  margin-bottom: 20rpx;\n  text-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.1);\n  color: #1A1A1A;\n  letter-spacing: 2rpx;\n}\n\n.subtitle {\n  font-size: 30rpx;\n  opacity: 0.9;\n  line-height: 1.6;\n  max-width: 500rpx;\n  color: #666;\n  font-weight: 400;\n}\n\n\n.login-section {\n  width: 100%;\n  max-width: 600rpx;\n  margin-bottom: 60rpx;\n  position: relative;\n  z-index: 20;\n}\n\n.login-button {\n  width: 100%;\n  height: 100rpx;\n  background: linear-gradient(135deg, #7363FF 0%, #FF69DE 100%);\n  color: #FFFFFF;\n  border-radius: 28rpx;\n  font-size: 34rpx;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border: none;\n  box-shadow: 0 12rpx 40rpx rgba(115, 99, 255, 0.3);\n  transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);\n  position: relative;\n  overflow: hidden;\n}\n\n.login-button:active {\n  transform: scale(0.98) translateY(2rpx);\n  background: linear-gradient(135deg, #5a52e6 0%, #e55ac7 100%);\n  box-shadow: 0 8rpx 24rpx rgba(115, 99, 255, 0.4);\n}\n\n.login-button::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.25), transparent);\n  transition: left 0.8s ease;\n}\n\n.login-button:active::before {\n  left: 100%;\n}\n\n.button-text {\n  color: white;\n  font-weight: 600;\n  text-shadow: 0 2rpx 4rpx rgba(0, 0, 0, 0.1);\n}\n\n\n\n// 弹窗样式\n.popup-container {\n  width: 600rpx;\n  background: white;\n  border-radius: 24rpx;\n  overflow: hidden;\n  box-shadow: 0 16rpx 48rpx rgba(0, 0, 0, 0.2);\n}\n\n.popup-header {\n  padding: 40rpx 32rpx 20rpx;\n  text-align: center;\n  background: linear-gradient(135deg, #7363FF 0%, #FF69DE 100%);\n}\n\n.popup-title {\n  font-size: 36rpx;\n  font-weight: 600;\n  color: white;\n}\n\n.popup-content {\n  padding: 32rpx;\n}\n\n.popup-text {\n  font-size: 28rpx;\n  line-height: 1.6;\n  color: #333;\n  text-align: center;\n}\n\n.highlight-text {\n  color: #7363FF;\n  font-weight: 600;\n}\n\n.popup-buttons {\n  display: flex;\n  padding: 0 32rpx 32rpx;\n  gap: 24rpx;\n}\n\n.popup-btn {\n  flex: 1;\n  height: 80rpx;\n  border-radius: 16rpx;\n  font-size: 28rpx;\n  font-weight: 500;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.3s ease;\n}\n\n.btn-cancel {\n  background: #F7F8FA;\n  color: #666666;\n  border: 1rpx solid #E5E5E5;\n}\n\n.btn-confirm {\n  background: linear-gradient(135deg, #7363FF 0%, #FF69DE 100%);\n  color: #FFFFFF;\n  border: none;\n}\n\n.popup-btn:active {\n  transform: scale(0.98);\n}\n\n// 通用flex布局类\n.flex-center {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.flex-column {\n  display: flex;\n  flex-direction: column;\n}\n\n.flex-between {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n</style> ","import MiniProgramPage from '/Users/xiaoqiang/Documents/friemd/firend-loving-app/subPackages/login/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["userStore","useUserStore","levelStore","useLevelStore","popup","ref","isPopupOpen","hasAgreed","onLoad","systemInfo","uni","handleCancel","handleConfirm","onPopupChange","e","showUserAgreement","showPrivacyPolicy","getPhoneNumber","res","loginRes","result","wxLogin","_a","error","MiniProgramPage"],"mappings":"2TAyDA,MAAMA,EAAYC,EAAAA,aAAc,EAC1BC,EAAaC,EAAAA,cAAe,EAC5BC,EAAQC,EAAG,IAAC,IAAI,EAChBC,EAAcD,EAAG,IAAC,EAAI,EACtBE,EAAYF,EAAG,IAAC,EAAK,EAE3BG,EAAAA,OAAO,SAAY,CAEjB,MAAMC,EAAaC,EAAG,MAAC,kBAAmB,EAC1CA,EAAAA,sDAAY,QAASD,CAAU,EAG/B,WAAW,IAAM,CACXL,EAAM,OACRA,EAAM,MAAM,KAAM,CAErB,EAAE,GAAG,CACR,CAAC,EAID,MAAMO,EAAe,IAAM,CACzBP,EAAM,MAAM,MAAO,EACnB,WAAW,IAAM,CACfM,EAAAA,MAAI,aAAa,CACf,MAAO,CACb,CAAK,CACF,EAAE,GAAG,CACR,EAGME,EAAgB,IAAM,CAC1BL,EAAU,MAAQ,GAClBH,EAAM,MAAM,MAAO,CAErB,EAEMS,EAAiBC,GAAM,CAC3BR,EAAY,MAAQQ,EAAE,IACxB,EAGMC,EAAoB,IAAM,CAC9BL,EAAAA,MAAI,WAAW,CACb,IAAK,8BACT,CAAG,CACH,EAGMM,EAAoB,IAAM,CAC9BN,EAAAA,MAAI,WAAW,CACb,IAAK,2BACT,CAAG,CACH,EAWMO,EAAiB,MAAOH,GAAM,OAClCJ,EAAAA,MAAA,MAAA,MAAA,qCAAY,wBAAyBI,CAAC,EAatC,MAAMI,EAAMJ,EAAE,OACd,GAAI,CAACI,EAAI,KAAM,CACbR,EAAAA,MAAI,UAAU,CACZ,MAAO,WACP,KAAM,MACZ,CAAK,EACD,MACD,CAED,GAAI,CAEF,MAAMS,EAAW,MAAMT,EAAG,MAAC,MAAM,CAAE,SAAU,SAAU,EAEvDA,EAAAA,MAAI,YAAY,CACd,MAAO,SACP,KAAM,EACZ,CAAK,EAGD,MAAMU,EAAS,MAAMC,UAAQ,CAC3B,WAAYF,EAAS,KACrB,WAAYD,EAAI,IACtB,CAAK,EAEDR,EAAAA,MAAI,YAAa,EAEbU,EAAO,MAAQA,EAAO,KAAK,OAAS,GAEtCpB,EAAU,YAAYoB,EAAO,KAAK,KAAK,KAAK,EAIzCpB,EAAU,SAASoB,EAAO,KAAK,KAAK,MAAM,YAAY,EAIzDlB,EAAW,mBAAoB,EAG/BQ,EAAG,MAAC,MAAM,eAAgB,CACxB,SAAUU,EAAO,KAAK,IAC9B,CAAO,EAEDV,EAAAA,MAAI,UAAU,CACZ,MAAO,OACP,KAAM,SACd,CAAO,EAGD,WAAW,IAAM,CAEhBA,EAAAA,MAAI,aAAa,CAChB,MAAO,CACf,CAAQ,CACD,EAAE,IAAI,GAEPA,EAAAA,MAAI,UAAU,CACZ,QAAOY,EAAAF,EAAO,OAAP,YAAAE,EAAa,MAAO,OAC3B,KAAM,MACd,CAAO,CAEJ,OAAQC,EAAO,CACdb,EAAAA,MAAI,YAAa,EACjBA,EAAAA,yDAAc,QAASa,CAAK,EAC5Bb,EAAAA,MAAI,UAAU,CACZ,MAAO,WACP,KAAM,MACZ,CAAK,CACF,CACH,oPC3MA,GAAG,WAAWc,CAAe"}