{"version":3,"file":"discover.js","sources":["pages/tabbar/home/components/discover.vue","/Users/xiaoqiang/Documents/friemd/firend-loving-app/pages/tabbar/home/components/discover.vue?type=component"],"sourcesContent":["<template>\n\t<view class=\"square\" >\n\n\n\t\t<square-nav></square-nav>\n\n\t<!-- \t<view class=\"square-recommend\">\n\t\t\t<u-tabs\n\t\t\t\t:list=\"tabsList\"\n\t\t\t\t:current=\"currentTabIndex\"\n\t\t\t\t@change=\"handleTabChange\"\n\t\t\t\tlineWidth=\"20\"\n\t\t\t\tlineHeight=\"2\"\n\t\t\t\t:lineColor=\"`linear-gradient(90deg, rgba(115, 99, 255, 1) 0%, rgba(255, 105, 222, 1) 100%)`\"\n\t\t\t\t:activeStyle=\"{\n\t\t\t\t\tcolor: '#7363FF',\n\t\t\t\t\tfontWeight: '500',\n\t\t\t\t\tfontSize: '24rpx'\n\t\t\t\t}\"\n\t\t\t\t:inactiveStyle=\"{\n\t\t\t\t\tcolor: '#1A1A1A',\n\t\t\t\t\tfontWeight: '400',\n\t\t\t\t\tfontSize: '24rpx'\n\t\t\t\t}\"\n\t\t\t\titemStyle=\"padding: 12rpx 22rpx; height: auto; border-radius: 30rpx;\"\n\t\t\t></u-tabs>\n\t\t</view> -->\n\n\t\t<!-- 根据isActive状态显示不同组件 -->\n\t<!-- \t<view v-show=\"isActive\" class=\"show-item\">\n\t\t\t<square-trends-item :listType=\"listTypeDesc\" @playVideo=\"handlePlayVideo\"></square-trends-item>\n\t\t</view>\t\t -->\n\t\t\t<square-trends-item \n\t\t\t\t:listType=\"listTypeDesc\" \n\t\t\t\t:userLocation=\"userLocation\"\n\t\t\t\t:cityStore=\"cityStore\"\n\t\t\t\t@playVideo=\"handlePlayVideo\">\n\t\t\t</square-trends-item>\n\t\t<!-- <view v-show=\"!isActive\" class=\"show-item\">\n\t\t\t<square-love></square-love>\n\t\t</view>\t\t\n\t\t -->\n\t</view>\n</template>\n\n<script setup>\n\timport {\n\t\tref,\n\t\tcomputed,\n\t\tonMounted\n\t} from 'vue'\n\timport {\n\t\tonLoad,\n\t\tonShow\n\t} from '@dcloudio/uni-app'\n\timport { useCityStore } from '@/stores/city.js'\n\t\n\n\timport squareNav from './cpns/square-nav'\n\timport squareTrendsItem from './cpns/square-trends-item'\n\timport squareLove from './cpns/square-love'\n\n\t// 修复：直接定义图片URL字符串，而不是使用import\n\tconst imageSrc = \"https://sbx-server.oss-cn-shenzhen.aliyuncs.com/img/cum/squarebg.png\"\n\n\t// 定义emit事件\n\tconst emit = defineEmits(['playVideo'])\n\n\t// 图片加载状态管理\n\tconst imageLoaded = ref(false)\n\n\t// 城市存储\n\tconst cityStore = useCityStore()\n\t\n\t// 定位相关状态\n\tconst userLocation = ref(null)\n\tconst locationLoading = ref(false)\n\n\t// 计算背景样式\n\tconst backgroundStyle = computed(() => {\n\t\tif (imageLoaded.value) {\n\t\t\t// 图片加载成功时显示背景图片\n\t\t\treturn {\n\t\t\t\tbackgroundImage: `url(${imageSrc})`,\n\t\t\t\tbackgroundSize: 'cover',\n\t\t\t\tbackgroundPosition: 'center',\n\t\t\t\tbackgroundRepeat: 'no-repeat'\n\t\t\t}\n\t\t}\n\t\t\n\t\t// 图片加载中时使用默认背景\n\t\treturn {\n\t\t\tbackground: '#ffffff'\n\t\t}\n\t})\n\n\t// 获取用户定位\n\tconst getUserLocation = () => {\n\t\treturn new Promise((resolve) => {\n\t\t\tlocationLoading.value = true\n\t\t\tuni.getLocation({\n\t\t\t\ttype: 'gcj02',\n\t\t\t\tsuccess: (res) => {\n\t\t\t\t\tconsole.log('获取位置成功:', res)\n\t\t\t\t\tuserLocation.value = {\n\t\t\t\t\t\tlatitude: res.latitude,\n\t\t\t\t\t\tlongitude: res.longitude\n\t\t\t\t\t}\n\t\t\t\t\tlocationLoading.value = false\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tlatitude: res.latitude,\n\t\t\t\t\t\tlongitude: res.longitude\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tfail: (err) => {\n\t\t\t\t\tconsole.log('获取位置失败:', err)\n\t\t\t\t\tuserLocation.value = null\n\t\t\t\t\tlocationLoading.value = false\n\t\t\t\t\tresolve(null)\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t}\n\n\t// 预加载图片\n\tconst preloadImage = () => {\n\t\t// 重置状态\n\t\timageLoaded.value = false\n\t\t\n\t\t// 在mini-program环境中，使用uni.getImageInfo替代Image构造函数\n\t\t// #ifdef MP\n\t\tuni.getImageInfo({\n\t\t\tsrc: imageSrc,\n\t\t\tsuccess: () => {\n\t\t\t\tconsole.log('背景图片加载成功')\n\t\t\t\timageLoaded.value = true\n\t\t\t},\n\t\t\tfail: (err) => {\n\t\t\t\tconsole.error('背景图片加载失败:', err)\n\t\t\t}\n\t\t})\n\t\t// #endif\n\t\t\n\t\t// #ifndef MP\n\t\t// 在非mini-program环境中使用Image构造函数\n\t\tconst img = new Image()\n\t\timg.onload = () => {\n\t\t\tconsole.log('背景图片加载成功')\n\t\t\timageLoaded.value = true\n\t\t}\n\t\timg.onerror = (err) => {\n\t\t\tconsole.error('背景图片加载失败:', err)\n\t\t}\n\t\timg.src = imageSrc\n\t\t// #endif\n\t}\n\n\t// u-tabs 需要的数据结构\n\tconst tabsList = ref([\n\t\t{\n\t\t\tname: '动态',\n\t\t\tvalue: 1\n\t\t},\n\t\t{\n\t\t\tname: '喜欢的人',\n\t\t\tvalue: 2\n\t\t}\n\t])\n\n\t// 当前选中的tab索引\n\tconst currentTabIndex = ref(0)\n\n\t// tabs样式切换 (保持兼容性)\n\tconst isActive = ref(true)\n\n\t// tabs绑定的value值\n\tconst listType = ref(1)\n\n\t// tabs绑定的描述\n\tconst listTypeDesc = ref(1) // 1.推荐 2.喜欢\n\n\tonShow(async () => {\n\t\t// 预加载背景图片\n\t\tpreloadImage()\n\t\t\n\t\t// 获取用户定位\n\t\tawait getUserLocation()\n\t\t\n\t\tconsole.log('discover组件显示，当前状态:', {\n\t\t\tisActive: isActive.value,\n\t\t\tlistType: listType.value,\n\t\t\tlistTypeDesc: listTypeDesc.value,\n\t\t\tuserLocation: userLocation.value\n\t\t})\n\t})\n\n\t// 组件挂载时也预加载图片\n\tonMounted(() => {\n\t\tconsole.log('discover组件挂载完成')\n\t\t// 确保组件挂载时也预加载图片\n\t\tpreloadImage()\n\t})\n\n\t// u-tabs 切换事件处理\n\tconst handleTabChange = (item) => {\n\t\tconsole.log('Tab切换:', item)\n\t\tcurrentTabIndex.value = item.index\n\t\tlistType.value = item.value\n\t\t\n\t\t// 更新 isActive 状态 (保持兼容性)\n\t\tisActive.value = item.value === 1\n\t\t\n\t\t// 更新 listTypeDesc\n\t\tif (item.value === 1) {\n\t\t\tlistTypeDesc.value = 1  // 1: 推荐列表（包含友伴师信息）\n\t\t} else if (item.value === 2) {\n\t\t\tlistTypeDesc.value = 2  // 2: 喜欢列表（暂不包含友伴师信息）\n\t\t}\n\t}\n\n\t// 保持原有的 changeIsActive 函数以兼容其他可能的调用\n\tconst changeIsActive = (index) => {\n\t\t// 找到对应的tab项\n\t\tconst tabItem = tabsList.value.find(tab => tab.value === index)\n\t\tif (tabItem) {\n\t\t\tconst tabIndex = tabsList.value.findIndex(tab => tab.value === index)\n\t\t\thandleTabChange({ index: tabIndex, value: index })\n\t\t}\n\t}\n\n\t// 处理视频播放\n\tconst handlePlayVideo = (videoPath) => {\n\t\tconsole.log('播放视频3:', videoPath)\n\t\t// 直接触发事件，让父组件监听\n\t\temit('playVideo', videoPath)\n\t}\n</script>\n\n<style lang=\"scss\">\n\t.square {\n\t\twidth: 100%;\n\t\theight: 100vh;\n\t\toverflow: hidden;\n\t\tposition: relative;\n\t\tbox-sizing: border-box;\n\t\tbackground: url(\"https://sbx-server.oss-cn-shenzhen.aliyuncs.com/img/cum/squarebg.png\") no-repeat center center;\n\t\tbackground-size: cover;\n\t\t\n\t\t.fallback-background {\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n\t\t\tz-index: -1;\n\t\t}\n\n\t\t.square-recommend {\n\t\t\tmargin: 32rpx 24rpx;\n\t\t\twidth: 30%;\n\t\t\t// 移除 flex 布局，让 u-tabs 自己处理布局\n\t\t}\n\n\n\n\n\t\t.goTopBox {\n\t\t\twidth: 100rpx;\n\t\t\theight: 100rpx;\n\t\t\t// background-image: linear-gradient(180deg, rgba(115, 99, 255, 1) 0%, rgba(255, 105, 222, 1) 100%);\n\t\t\tborder-radius: 50%;\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: center;\n\t\t\talign-items: center;\n\t\t\tposition: fixed;\n\t\t\tright: 10rpx;\n\t\t\tbottom: 350rpx;\n\t\t}\n\t}\n\n\t.example {\n\t\tz-index: 99999;\n\t\t// width: 100rpx;\n\t\t// height: 100rpx;\n\t\tbackground: transparent;\n\t\tborder-radius: 50%;\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\tposition: fixed;\n\t\tright: 10rpx;\n\t\tbottom: 200rpx;\n\t}\n\n\t.transition-button {\n\t\t/* #ifndef APP-NVUE */\n\t\twidth: 100%;\n\t\t/* #endif */\n\t\tflex: 1;\n\t\tmargin-bottom: 10px;\n\t}\n\n\t/* #ifndef APP-NVUE */\n\t.example ::v-deep .transition {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\t// width: 100rpx;\n\t\t// height: 100rpx;\n\t\tborder-radius: 50%;\n\t\ttext-align: center;\n\t\t// background-image: linear-gradient(180deg, rgba(115, 99, 255, 1) 0%, rgba(255, 105, 222, 1) 100%);\n\t\t// box-shadow: 0 0 5px 1px rgba(0, 0, 0, 0.2);\n\t}\n\n\t/* #endif */\n\n\t.go-top-icon {\n\t\twidth: 100rpx;\n\t\theight: 100rpx;\n\t}\n\t\n\t.show-item {\n\t\theight: calc(100% - 120rpx);\n\t\toverflow: hidden;\n\t}\n</style>","import Component from '/Users/xiaoqiang/Documents/friemd/firend-loving-app/pages/tabbar/home/components/discover.vue'\nwx.createComponent(Component)"],"names":["squareNav","squareTrendsItem","imageSrc","emit","__emit","imageLoaded","ref","cityStore","useCityStore","userLocation","locationLoading","computed","getUserLocation","resolve","uni","res","err","preloadImage","isActive","listType","listTypeDesc","onShow","onMounted","handlePlayVideo","videoPath","Component"],"mappings":"qIA0DC,MAAMA,EAAY,IAAW,uBACvBC,EAAmB,IAAW,+BAI9BC,EAAW,kIAGjB,MAAMC,EAAOC,EAGPC,EAAcC,EAAG,IAAC,EAAK,EAGvBC,EAAYC,EAAAA,aAAc,EAG1BC,EAAeH,EAAG,IAAC,IAAI,EACvBI,EAAkBJ,EAAG,IAAC,EAAK,EAGTK,EAAAA,SAAS,IAC5BN,EAAY,MAER,CACN,gBAAiB,OAAOH,CAAQ,IAChC,eAAgB,QAChB,mBAAoB,SACpB,iBAAkB,WAClB,EAIK,CACN,WAAY,SACZ,CACD,EAGD,MAAMU,EAAkB,IAChB,IAAI,QAASC,GAAY,CAC/BH,EAAgB,MAAQ,GACxBI,EAAAA,MAAI,YAAY,CACf,KAAM,QACN,QAAUC,GAAQ,CACjBD,EAAAA,MAAY,MAAA,MAAA,mDAAA,UAAWC,CAAG,EAC1BN,EAAa,MAAQ,CACpB,SAAUM,EAAI,SACd,UAAWA,EAAI,SACf,EACDL,EAAgB,MAAQ,GACxBG,EAAQ,CACP,SAAUE,EAAI,SACd,UAAWA,EAAI,SACrB,CAAM,CACD,EACD,KAAOC,GAAQ,CACdF,EAAAA,MAAY,MAAA,MAAA,mDAAA,UAAWE,CAAG,EAC1BP,EAAa,MAAQ,KACrBC,EAAgB,MAAQ,GACxBG,EAAQ,IAAI,CACZ,CACL,CAAI,CACJ,CAAG,EAIII,EAAe,IAAM,CAE1BZ,EAAY,MAAQ,GAIpBS,EAAAA,MAAI,aAAa,CAChB,IAAKZ,EACL,QAAS,IAAM,CACdY,EAAAA,MAAA,MAAA,MAAA,mDAAY,UAAU,EACtBT,EAAY,MAAQ,EACpB,EACD,KAAOW,GAAQ,CACdF,EAAAA,MAAA,MAAA,QAAA,mDAAc,YAAaE,CAAG,CAC9B,CACJ,CAAG,CAeD,EAGgBV,MAAI,CACpB,CACC,KAAM,KACN,MAAO,CACP,EACD,CACC,KAAM,OACN,MAAO,CACP,CACH,CAAE,EAGuBA,EAAAA,IAAI,CAAC,EAG7B,MAAMY,EAAWZ,EAAG,IAAC,EAAI,EAGnBa,EAAWb,EAAG,IAAC,CAAC,EAGhBc,EAAed,EAAG,IAAC,CAAC,EAE1Be,EAAAA,OAAO,SAAY,CAElBJ,EAAc,EAGd,MAAML,EAAiB,EAEvBE,EAAAA,MAAY,MAAA,MAAA,mDAAA,qBAAsB,CACjC,SAAUI,EAAS,MACnB,SAAUC,EAAS,MACnB,aAAcC,EAAa,MAC3B,aAAcX,EAAa,KAC9B,CAAG,CACH,CAAE,EAGDa,EAAAA,UAAU,IAAM,CACfR,EAAAA,MAAY,MAAA,MAAA,mDAAA,gBAAgB,EAE5BG,EAAc,CAChB,CAAE,EA8BD,MAAMM,EAAmBC,GAAc,CACtCV,EAAAA,qEAAY,SAAUU,CAAS,EAE/BrB,EAAK,YAAaqB,CAAS,CAC3B,kGC1OF,GAAG,gBAAgBC,CAAS"}