{"version":3,"file":"square-trends-item.js","sources":["pages/tabbar/home/components/cpns/square-trends-item.vue","/Users/xiaoqiang/Documents/friemd/firend-loving-app/pages/tabbar/home/components/cpns/square-trends-item.vue?type=component"],"sourcesContent":["<template>\n\t<scroll-view :scroll-top=\"scrollTop\" scroll-y=\"true\" class=\"scroll-Y\" \n\t\t:refresher-triggered=\"triggered\" :refresher-enabled=\"true\" :scroll-with-animation=\"true\" :show-scrollbar=\"true\"\n\t\t :enable-back-to-top=\"true\" @scroll=\"handleScroll\" @scrolltolower=\"lower\"\n\t\t@refresherrefresh=\"onRefresh\" @refresherrestore=\"onRestore\"\n\t\t>\n\t\t<view class=\"scroll-Y-item\">\n\t\t\t<u-list height=\"100%\">\n\t\t\t\t<u-list-item v-for=\"(item, index) in momentsList\" :key=\"index\">\n\t\t\t\t\t<square-item \n\t\t\t\t\t\t:item=\"item\" \n\t\t\t\t\t\t:listType=\"listType\" \n\t\t\t\t\t\t:userLocation=\"userLocation\"\n\t\t\t\t\t\t:cityStore=\"cityStore\"\n\t\t\t\t\t\t@changeShowVip=\"handleSayHello\" \n\t\t\t\t\t\t@playVideo=\"handlePlayVideo\">\n\t\t\t\t\t</square-item>\n\t\t\t\t</u-list-item>  \n\t\t\t\t<view style=\"height: 250rpx;\"></view>\n\t\t\t</u-list>\n\t\t</view>\n\t</scroll-view>\n\n\t<!-- 回到顶部 -->\n\t<view class=\"example\" v-show=\"oldScrollTop > 1000\" @tap=\"goTop\">\n\t\t<uni-transition ref=\"ani\" custom-class=\"transition\" mode-class=\"slide-right\" class=\"goTopBox\"\n\t\t\t:show=\"oldScrollTop > 1000\">\n\t\t\t<image class=\"go-top-icon\" src=\"@/static/square/go-top.png\" mode=\"\"></image>\n\t\t</uni-transition>\n\t</view>\n</template>\n\n<script setup>\n\timport {\n\t\tref,\n\t\tnextTick,\n\t\tonMounted,\n\t\twatch\n\t} from 'vue'\n\timport {\n\t\tonLoad,\n\t} from '@dcloudio/uni-app'\n\timport { getMomentsList } from '@/api/discover.js'\n\timport squareItem from './square-item'\n\n\t// 定义 props\n\tconst props = defineProps({\n\t\tlistType: {\n\t\t\ttype: Number,\n\t\t\tdefault: 1\n\t\t},\n\t\tuserLocation: {\n\t\t\ttype: Object,\n\t\t\tdefault: null\n\t\t},\n\t\tcityStore: {\n\t\t\ttype: Object,\n\t\t\tdefault: null\n\t\t}\n\t})\n\n\t// 动态列表数据\n\tconst momentsList = ref([])\n\tconst loading = ref(false)\n\tconst hasMore = ref(true)\n\t\n\t// 分页参数\n\tconst pageParams = ref({\n\t\tpage: 1,\n\t\tpage_size: 20\n\t})\n\n\tconst scrollTop = ref(0)\n\tconst oldScrollTop = ref(0)\n\tconst _freshing = ref(false)\n\tconst triggered = ref(false)\n\t\n\tconst emit = defineEmits([\"changeSayHello\", \"playVideo\"])\n\n\tonLoad(() => {\n\t\tconsole.log('获取数据888')\n\t\t_freshing.value = false;  \n\t\tpageParams.value.page = 1\n\t\t// 重新获取数据\n\t\tgetMomentsListData(1)\n\t})\n\n\t// 处理视频播放\n\tconst handlePlayVideo = (videoPath) => { \n\t\tconsole.log('播放视频2:', videoPath)\n\t\temit('playVideo', videoPath)\n\t}\n\n\t// 获取动态列表数据\n\tconst getMomentsListData = async (page = 1) => {\n\t\tconsole.log('开始获取动态列表数据，参数:', {\n\t\t\tpage,\n\t\t\tlistType: props.listType,\n\t\t\tloading: loading.value\n\t\t})\n\t\t\n\t\tif (loading.value) return\n\t\t\n\t\ttry {\n\t\t\tloading.value = true\n\t\t\t\n\t\t\tconst params = {\n\t\t\t\tlist_type: props.listType, // 1: 推荐列表 2: 喜欢列表 3: 个人动态\n\t\t\t\tpage: page,\n\t\t\t\tpage_size: pageParams.value.page_size\n\t\t\t}\n\t\t\t\n\t\t\tconsole.log('调用API参数:', params)\n\t\t\tconst response = await getMomentsList(params)\n\t\t\tconsole.log('API响应:', response)\n\t\t\t\n\t\t\tif (response.data && response.data.code === 0) {\n\t\t\t\tconst newData = response.data.data.moments_list || []\n\t\t\t\tconsole.log('获取到的数据:', newData)\n\t\t\t\t\n\t\t\t\tif (page === 1) {\n\t\t\t\t\tmomentsList.value = newData\n\t\t\t\t} else {\n\t\t\t\t\tmomentsList.value = [...momentsList.value, ...newData]\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 判断是否还有更多数据\n\t\t\t\thasMore.value = newData.length === pageParams.value.page_size\n\t\t\t\t\n\t\t\t\t// 如果还有数据，页码+1\n\t\t\t\tif (hasMore.value) {\n\t\t\t\t\tpageParams.value.page++\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.error('API返回错误:', response)\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error('获取动态列表失败:', error)\n\t\t\tuni.showToast({\n\t\t\t\ticon: 'none',\n\t\t\t\ttitle: '获取数据失败，请重试'\n\t\t\t})\n\t\t} finally {\n\t\t\tloading.value = false\n\t\t}\n\t}\n\n\t//监听listType变化，重新获取数据\n\twatch(() => props.listType, (newVal, oldVal) => {\n\t\tconsole.log('listType变化:', oldVal, '->', newVal)\n\t\tconsole.log('newVal获取数据获取数据获取数据', newVal)\n\t\tif (newVal) {\n\t\t\t// 重置分页参数\n\t\t\tpageParams.value.page = 1\n\t\t\t// 重新获取数据\n\t\t\tgetMomentsListData(1)\n\t\t}\n\t}, { immediate: true })\n\n\tconst handleScroll = (e) => {\n\t\toldScrollTop.value = e.detail.scrollTop\n\t}\n\n\t// 监听页面滚动到底部\n\tconst lower = () => {\n\t\tif (hasMore.value && !loading.value) {\n\t\t\tgetMomentsListData(pageParams.value.page)\n\t\t}\n\t}\n\n\tconst goTop = (e) => {\n\t\t// 解决view层不同步的问题\n\t\tscrollTop.value = oldScrollTop.value\n\t\tnextTick(() => {\n\t\t\tscrollTop.value = 0\n\t\t})\n\t}\n\n\tconst onRefresh = async () => {\n\t\tconsole.log('刷新中~');\n\t\tif (_freshing.value) return;\n\t\t_freshing.value = true;\n\t\ttriggered.value = true;\n\t\t// 获取动态列表的数据\n\t\tawait getMomentsListData(1)\n\t\t_freshing.value = false;\n\t\ttriggered.value = false;\n\t}\n\n\n\n\t// 自定义下拉刷新被复位\n\tconst onRestore = () => {\n\t\ttriggered.value = 'restore';\n\t\t// console.log(\"onRestore\");\n\t}\n\n\t\n\n\tconst handleSayHello = async (val) => {\n\t\temit('changeSayHello', val)\n\t}\n</script>\n\n<style lang=\"scss\" scoped>\n\t.scroll-Y {\n\t\theight: 100%;\n\t\toverflow: hidden;\n\t}\n\n\t.scroll-Y-item {\n\t\t// padding-bottom: 180rpx;\n\t}\n\n\t.example {\n\t\tz-index: 99999;\n\t\tbackground: transparent;\n\t\tborder-radius: 50%;\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\tposition: fixed;\n\t\tright: 10rpx;\n\t\tbottom: 200rpx;\n\t}\n\n\t.goTopBox {\n\t\twidth: 100rpx;\n\t\theight: 100rpx;\n\t\tborder-radius: 50%;\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\tposition: fixed;\n\t\tright: 10rpx;\n\t\tbottom: 350rpx;\n\t}\n\n\t.go-top-icon {\n\t\twidth: 100rpx;\n\t\theight: 100rpx;\n\t}\n</style>","import Component from '/Users/xiaoqiang/Documents/friemd/firend-loving-app/pages/tabbar/home/components/cpns/square-trends-item.vue'\nwx.createComponent(Component)"],"names":["squareItem","props","__props","momentsList","ref","loading","hasMore","pageParams","scrollTop","oldScrollTop","_freshing","triggered","emit","__emit","onLoad","uni","getMomentsListData","handlePlayVideo","videoPath","page","params","response","getMomentsList","newData","error","watch","newVal","oldVal","handleScroll","e","lower","goTop","nextTick","onRefresh","onRestore","handleSayHello","val","Component"],"mappings":"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"}