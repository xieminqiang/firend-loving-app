{"version":3,"file":"createAnimation.js","sources":["uni_modules/uni-transition/components/uni-transition/createAnimation.js"],"sourcesContent":["// const defaultOption = {\n// \tduration: 300,\n// \ttimingFunction: 'linear',\n// \tdelay: 0,\n// \ttransformOrigin: '50% 50% 0'\n// }\n// #ifdef APP-NVUE\nconst nvueAnimation = uni.requireNativePlugin('animation')\n// #endif\nclass MPAnimation {\n\tconstructor(options, _this) {\n\t\tthis.options = options\n\t\t// 在iOS10+QQ小程序平台下，传给原生的对象一定是个普通对象而不是Proxy对象，否则会报parameter should be Object instead of ProxyObject的错误\n\t\tthis.animation = uni.createAnimation({\n\t\t\t...options\n\t\t})\n\t\tthis.currentStepAnimates = {}\n\t\tthis.next = 0\n\t\tthis.$ = _this\n\n\t}\n\n\t_nvuePushAnimates(type, args) {\n\t\tlet aniObj = this.currentStepAnimates[this.next]\n\t\tlet styles = {}\n\t\tif (!aniObj) {\n\t\t\tstyles = {\n\t\t\t\tstyles: {},\n\t\t\t\tconfig: {}\n\t\t\t}\n\t\t} else {\n\t\t\tstyles = aniObj\n\t\t}\n\t\tif (animateTypes1.includes(type)) {\n\t\t\tif (!styles.styles.transform) {\n\t\t\t\tstyles.styles.transform = ''\n\t\t\t}\n\t\t\tlet unit = ''\n\t\t\tif(type === 'rotate'){\n\t\t\t\tunit = 'deg'\n\t\t\t}\n\t\t\tstyles.styles.transform += `${type}(${args+unit}) `\n\t\t} else {\n\t\t\tstyles.styles[type] = `${args}`\n\t\t}\n\t\tthis.currentStepAnimates[this.next] = styles\n\t}\n\t_animateRun(styles = {}, config = {}) {\n\t\tlet ref = this.$.$refs['ani'].ref\n\t\tif (!ref) return\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tnvueAnimation.transition(ref, {\n\t\t\t\tstyles,\n\t\t\t\t...config\n\t\t\t}, res => {\n\t\t\t\tresolve()\n\t\t\t})\n\t\t})\n\t}\n\n\t_nvueNextAnimate(animates, step = 0, fn) {\n\t\tlet obj = animates[step]\n\t\tif (obj) {\n\t\t\tlet {\n\t\t\t\tstyles,\n\t\t\t\tconfig\n\t\t\t} = obj\n\t\t\tthis._animateRun(styles, config).then(() => {\n\t\t\t\tstep += 1\n\t\t\t\tthis._nvueNextAnimate(animates, step, fn)\n\t\t\t})\n\t\t} else {\n\t\t\tthis.currentStepAnimates = {}\n\t\t\ttypeof fn === 'function' && fn()\n\t\t\tthis.isEnd = true\n\t\t}\n\t}\n\n\tstep(config = {}) {\n\t\t// #ifndef APP-NVUE\n\t\tthis.animation.step(config)\n\t\t// #endif\n\t\t// #ifdef APP-NVUE\n\t\tthis.currentStepAnimates[this.next].config = Object.assign({}, this.options, config)\n\t\tthis.currentStepAnimates[this.next].styles.transformOrigin = this.currentStepAnimates[this.next].config.transformOrigin\n\t\tthis.next++\n\t\t// #endif\n\t\treturn this\n\t}\n\n\trun(fn) {\n\t\t// #ifndef APP-NVUE\n\t\tthis.$.animationData = this.animation.export()\n\t\tthis.$.timer = setTimeout(() => {\n\t\t\ttypeof fn === 'function' && fn()\n\t\t}, this.$.durationTime)\n\t\t// #endif\n\t\t// #ifdef APP-NVUE\n\t\tthis.isEnd = false\n\t\tlet ref = this.$.$refs['ani'] && this.$.$refs['ani'].ref\n\t\tif(!ref) return\n\t\tthis._nvueNextAnimate(this.currentStepAnimates, 0, fn)\n\t\tthis.next = 0\n\t\t// #endif\n\t}\n}\n\n\nconst animateTypes1 = ['matrix', 'matrix3d', 'rotate', 'rotate3d', 'rotateX', 'rotateY', 'rotateZ', 'scale', 'scale3d',\n\t'scaleX', 'scaleY', 'scaleZ', 'skew', 'skewX', 'skewY', 'translate', 'translate3d', 'translateX', 'translateY',\n\t'translateZ'\n]\nconst animateTypes2 = ['opacity', 'backgroundColor']\nconst animateTypes3 = ['width', 'height', 'left', 'right', 'top', 'bottom']\nanimateTypes1.concat(animateTypes2, animateTypes3).forEach(type => {\n\tMPAnimation.prototype[type] = function(...args) {\n\t\t// #ifndef APP-NVUE\n\t\tthis.animation[type](...args)\n\t\t// #endif\n\t\t// #ifdef APP-NVUE\n\t\tthis._nvuePushAnimates(type, args)\n\t\t// #endif\n\t\treturn this\n\t}\n})\n\nexport function createAnimation(option, _this) {\n\tif(!_this) return\n\tclearTimeout(_this.timer)\n\treturn new MPAnimation(option, _this)\n}\n"],"names":["MPAnimation","options","_this","uni","type","args","aniObj","styles","animateTypes1","unit","config","ref","resolve","reject","res","animates","step","fn","obj","animateTypes2","animateTypes3","createAnimation","option"],"mappings":"6DASA,MAAMA,CAAY,CACjB,YAAYC,EAASC,EAAO,CAC3B,KAAK,QAAUD,EAEf,KAAK,UAAYE,EAAG,MAAC,gBAAgB,CACpC,GAAGF,CACN,CAAG,EACD,KAAK,oBAAsB,CAAE,EAC7B,KAAK,KAAO,EACZ,KAAK,EAAIC,CAET,CAED,kBAAkBE,EAAMC,EAAM,CAC7B,IAAIC,EAAS,KAAK,oBAAoB,KAAK,IAAI,EAC3CC,EAAS,CAAE,EASf,GARKD,EAMJC,EAASD,EALTC,EAAS,CACR,OAAQ,CAAE,EACV,OAAQ,CAAE,CACV,EAIEC,EAAc,SAASJ,CAAI,EAAG,CAC5BG,EAAO,OAAO,YAClBA,EAAO,OAAO,UAAY,IAE3B,IAAIE,EAAO,GACRL,IAAS,WACXK,EAAO,OAERF,EAAO,OAAO,WAAa,GAAGH,CAAI,IAAIC,EAAKI,CAAI,IAClD,MACGF,EAAO,OAAOH,CAAI,EAAI,GAAGC,CAAI,GAE9B,KAAK,oBAAoB,KAAK,IAAI,EAAIE,CACtC,CACD,YAAYA,EAAS,GAAIG,EAAS,CAAA,EAAI,CACrC,IAAIC,EAAM,KAAK,EAAE,MAAM,IAAO,IAC9B,GAAKA,EACL,OAAO,IAAI,QAAQ,CAACC,EAASC,IAAW,CACvC,cAAc,WAAWF,EAAK,CAC7B,OAAAJ,EACA,GAAGG,CACH,EAAEI,GAAO,CACTF,EAAS,CACb,CAAI,CACJ,CAAG,CACD,CAED,iBAAiBG,EAAUC,EAAO,EAAGC,EAAI,CACxC,IAAIC,EAAMH,EAASC,CAAI,EACvB,GAAIE,EAAK,CACR,GAAI,CACH,OAAAX,EACA,OAAAG,CACJ,EAAOQ,EACJ,KAAK,YAAYX,EAAQG,CAAM,EAAE,KAAK,IAAM,CAC3CM,GAAQ,EACR,KAAK,iBAAiBD,EAAUC,EAAMC,CAAE,CAC5C,CAAI,CACJ,MACG,KAAK,oBAAsB,CAAE,EAC7B,OAAOA,GAAO,YAAcA,EAAI,EAChC,KAAK,MAAQ,EAEd,CAED,KAAKP,EAAS,GAAI,CAEjB,YAAK,UAAU,KAAKA,CAAM,EAOnB,IACP,CAED,IAAIO,EAAI,CAEP,KAAK,EAAE,cAAgB,KAAK,UAAU,OAAQ,EAC9C,KAAK,EAAE,MAAQ,WAAW,IAAM,CAC/B,OAAOA,GAAO,YAAcA,EAAI,CACnC,EAAK,KAAK,EAAE,YAAY,CAStB,CACF,CAGA,MAAMT,EAAgB,CAAC,SAAU,WAAY,SAAU,WAAY,UAAW,UAAW,UAAW,QAAS,UAC5G,SAAU,SAAU,SAAU,OAAQ,QAAS,QAAS,YAAa,cAAe,aAAc,aAClG,YACD,EACMW,EAAgB,CAAC,UAAW,iBAAiB,EAC7CC,EAAgB,CAAC,QAAS,SAAU,OAAQ,QAAS,MAAO,QAAQ,EAC1EZ,EAAc,OAAOW,EAAeC,CAAa,EAAE,QAAQhB,GAAQ,CAClEJ,EAAY,UAAUI,CAAI,EAAI,YAAYC,EAAM,CAE/C,YAAK,UAAUD,CAAI,EAAE,GAAGC,CAAI,EAKrB,IACP,CACF,CAAC,EAEM,SAASgB,EAAgBC,EAAQpB,EAAO,CAC9C,GAAIA,EACJ,oBAAaA,EAAM,KAAK,EACjB,IAAIF,EAAYsB,EAAQpB,CAAK,CACrC"}