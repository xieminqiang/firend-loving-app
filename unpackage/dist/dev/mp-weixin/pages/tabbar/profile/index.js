"use strict";const e=require("../../../common/vendor.js"),t=require("../../../common/assets.js"),U=require("../../../stores/user.js"),y=require("../../../api/user.js"),R=require("../../../api/order.js");if(!Array){const f=e.resolveComponent("hm-tabbar"),o=e.resolveComponent("mq-tabbar");(f+o)()}const A=()=>"../../../components/hm-tabbar/hm-tabbar.js",L=()=>"../../../components/mq-tabbar/mq-tabbar.js";Math||(A+L)();const O={__name:"index",setup(f){const o=U.useUserStore(),v=e.ref(0),l=e.ref(!1),r=e.ref(null),$=e.ref(""),i=e.computed(()=>o.userInfo&&Object.keys(o.userInfo).length>0),_=e.computed(()=>{if(i.value)return o.userInfo}),s=e.ref({pending:0,inProgress:0}),b=a=>{e.index.__f__("log","at pages/tabbar/profile/index.vue:219","收到登录成功事件:",a),p(),g()},x=()=>{e.index.__f__("log","at pages/tabbar/profile/index.vue:228","收到退出登录事件"),s.value={pending:0,inProgress:0},r.value=null,$.value=""},m=a=>{e.index.__f__("log","at pages/tabbar/profile/index.vue:241","收到申请状态变化事件:",a),h()};e.onMounted(()=>{const a=e.index.getSystemInfoSync();v.value=a.statusBarHeight||0,p(),e.index.$on("loginSuccess",b),e.index.$on("logoutSuccess",x),e.index.$on("applicationStatusChanged",m)}),e.onShow(()=>{i.value&&g()}),e.onUnmounted(()=>{e.index.$off("loginSuccess",b),e.index.$off("logoutSuccess",x),e.index.$off("applicationStatusChanged",m)});const p=async()=>{var a;if(e.index.__f__("log","at pages/tabbar/profile/index.vue:287","开始加载用户数据 - isLoggedIn:",i.value),e.index.__f__("log","at pages/tabbar/profile/index.vue:288","当前用户状态:",o.userInfo),i.value){try{e.index.__f__("log","at pages/tabbar/profile/index.vue:293","用户已登录，开始请求用户信息");const n=await y.getUserInfo();if(e.index.__f__("log","at pages/tabbar/profile/index.vue:295","用户信息请求成功:",n),n.data&&n.data.code===0){const c=n.data.data;e.index.__f__("log","at pages/tabbar/profile/index.vue:300","解析用户数据:",c);const u={...c,access_token:o.userInfo.access_token||"",refresh_token:o.userInfo.refresh_token||""};o.setUserInfo(u)}else e.index.__f__("warn","at pages/tabbar/profile/index.vue:316","获取用户信息失败:",((a=n.data)==null?void 0:a.msg)||"未知错误")}catch(n){e.index.__f__("error","at pages/tabbar/profile/index.vue:319","获取用户信息失败:",n)}await h(),await g()}else e.index.__f__("log","at pages/tabbar/profile/index.vue:327","用户未登录，跳过获取用户信息")},h=async()=>{try{e.index.__f__("log","at pages/tabbar/profile/index.vue:334","开始请求申请信息");const a=await y.getApplicatioInfo();e.index.__f__("log","at pages/tabbar/profile/index.vue:336","申请信息请求成功:",a),a.data&&a.data.code===0&&(r.value=a.data.data)}catch{}},g=async()=>{try{e.index.__f__("log","at pages/tabbar/profile/index.vue:350","开始请求订单数量统计");const a=await R.getOrderCount();if(e.index.__f__("log","at pages/tabbar/profile/index.vue:352","订单数量统计请求成功:",a),a.data&&a.data.code===0){const n=a.data.data;e.index.__f__("log","at pages/tabbar/profile/index.vue:356","待服务订单数:",n.pending_service_count),e.index.__f__("log","at pages/tabbar/profile/index.vue:357","待付款订单数:",n.pending_payment_count),e.index.__f__("log","at pages/tabbar/profile/index.vue:358","进行中订单数:",n.in_service_count),s.value={pending:n.pending_payment_count||0,pending_service:n.pending_service_count||0,inProgress:n.in_service_count||0}}}catch(a){e.index.__f__("error","at pages/tabbar/profile/index.vue:368","获取订单数量失败:",a)}},I=()=>{e.index.navigateTo({url:"/subPackages/login/index"})},P=()=>{e.index.navigateTo({url:"/subPackages/login/index"})},d=a=>{e.index.__f__("log","at pages/tabbar/profile/index.vue:391","跳转到订单页面，状态:",a);const n=encodeURIComponent(a);e.index.navigateTo({url:`/subPackages/order/index?status=${n}`})},S=()=>{r.value&&r.value.status==="approved"?e.index.navigateTo({url:"/subPackages/partner/index"}):e.index.navigateTo({url:"/subPackages/friend/apply/index"})},T=()=>{e.index.navigateTo({url:"/subPackages/profile/customer-service/index"})},w=()=>{e.index.navigateTo({url:"/subPackages/settings/pages/index/index"})},k=async()=>{e.index.__f__("log","at pages/tabbar/profile/index.vue:437","开始下拉刷新"),l.value=!0;try{await p(),await new Promise(a=>setTimeout(a,800))}catch(a){e.index.__f__("error","at pages/tabbar/profile/index.vue:448","刷新失败:",a),e.index.showToast({title:"刷新失败",icon:"none",duration:1500})}finally{l.value=!1}},q=()=>{e.index.__f__("log","at pages/tabbar/profile/index.vue:460","刷新动画结束"),l.value=!1},C=a=>a?a.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):"未绑定手机号";return(a,n)=>{var c;return e.e({a:i.value},i.value?e.e({b:_.value.head_img},_.value.head_img?{c:a.$imgBaseUrl+_.value.head_img}:{d:e.t(((c=_.value.nickname)==null?void 0:c.charAt(0))||"用")},{e:e.t(_.value.nick_name||""),f:e.t(C(_.value.phone)||"未绑定手机号"),g:e.o(P)}):{h:t._imports_0$2,i:t._imports_1$3,j:t._imports_2$2,k:e.o(I)},{l:v.value+"px",m:t._imports_0$1,n:e.o(u=>d("all")),o:t._imports_4$2,p:s.value.pending>0},s.value.pending>0?{q:e.t(s.value.pending)}:{},{r:e.o(u=>d("pending_payment")),s:t._imports_5,t:s.value.pending_service>0},s.value.pending_service>0?{v:e.t(s.value.pending_service)}:{},{w:e.o(u=>d("pending_service")),x:t._imports_6$2,y:s.value.inProgress>0},s.value.inProgress>0?{z:e.t(s.value.inProgress)}:{},{A:e.o(u=>d("in_service")),B:t._imports_7,C:e.o(u=>d("completed")),D:e.unref(o).switch===1},e.unref(o).switch===1?e.e({E:t._imports_8,F:r.value&&r.value.status&&r.value.status==="approved"},r.value&&r.value.status&&r.value.status==="approved"?{}:{},{G:t._imports_0$1,H:e.o(S)}):{},{I:t._imports_9,J:t._imports_0$1,K:e.o(()=>{}),L:e.o(T),M:t._imports_10,N:t._imports_0$1,O:e.o(w),P:l.value,Q:e.o(k),R:e.o(q),S:e.unref(o).switch===1},e.unref(o).switch===1?{T:e.p({currentTab:"profile"})}:{U:e.p({currentTab:"profile"})})}}},j=e._export_sfc(O,[["__scopeId","data-v-4cb51321"]]);wx.createPage(j);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/tabbar/profile/index.js.map
