"use strict";const t=require("../../../../../common/vendor.js"),d=require("../../../../../common/assets.js"),$=require("../../../../../api/discover.js");Array||t.resolveComponent("u-avatar")();const T=()=>"../../../../../uni_modules/uview-plus/components/u-avatar/u-avatar.js";Math||(T+L)();const L=()=>"../../../../../components/common/PictureDisplay.js",S={__name:"square-item",props:{item:{type:Object,default:()=>{}},listType:{type:Number,default:1},userLocation:{type:Object,default:null},cityStore:{type:Object,default:null}},emits:["changeShowVip","playVideo"],setup(n,{emit:p}){const r=(e,i="add",o=1)=>{const s=parseInt(e)||0;return i==="add"?s+o:i==="subtract"?Math.max(0,s-o):s},m=n,_=p,y=e=>e==="女"?"/static/find/nd_icon.png":"/static/find/nand_icon.png",h=e=>e==="女"?{background:"rgba(252, 139, 198, 1)"}:{background:"rgba(19, 98, 235, 1)"},b=e=>{t.index.__f__("log","at pages/tabbar/home/components/cpns/square-item.vue:150","播放视频1:",e),_("playVideo",e)},w=e=>{t.index.navigateTo({url:"/subPackages/record/comment",success(i){i.eventChannel.emit("getRecord",{data:e})}})},l=async e=>{try{const i=e.moments_info.is_praised;e.moments_info.is_praised=!i,e.moments_info.is_praised?e.moments_info.praise_num=r(e.moments_info.praise_num,"add",1):e.moments_info.praise_num=r(e.moments_info.praise_num,"subtract",1);const o=await $.praiseMoment({target_id:e.moments_info.moments_id});o.data&&o.data.code===0?t.index.__f__("log","at pages/tabbar/home/components/cpns/square-item.vue:205","点赞成功"):(e.moments_info.is_praised=i,i?e.moments_info.praise_num=r(e.moments_info.praise_num,"add",1):e.moments_info.praise_num=r(e.moments_info.praise_num,"subtract",1),t.index.showToast({title:"点赞失败，请重试",icon:"none"}))}catch(i){t.index.__f__("error","at pages/tabbar/home/components/cpns/square-item.vue:221","点赞失败:",i);const o=e.moments_info.is_praised;e.moments_info.is_praised=!o,o?e.moments_info.praise_num=r(e.moments_info.praise_num,"add",1):e.moments_info.praise_num=r(e.moments_info.praise_num,"subtract",1),t.index.showToast({title:"网络错误，请重试",icon:"none"})}},x=e=>{t.index.showToast({title:"分享功能开发中",icon:"none"})},v=async e=>{_("changeShowVip",e)},q=async e=>{try{const i=e.companion_info;if(!i||!i.service_areas||i.service_areas.length===0){t.index.showToast({title:"该友伴师暂无可服务区域",icon:"none"});return}if(i.service_areas.length===1){const o=i.service_areas[0];await f(i.id,o);return}if(m.userLocation){const o=await C(i.service_areas,m.userLocation.latitude,m.userLocation.longitude);await f(i.id,o,m.userLocation.latitude,m.userLocation.longitude)}else{const o=i.service_areas[0];await f(i.id,o)}}catch(i){t.index.__f__("error","at pages/tabbar/home/components/cpns/square-item.vue:282","邀约失败:",i),t.index.showToast({title:"邀约失败，请重试",icon:"none"})}},C=async(e,i,o)=>{m.cityStore.cityList.length===0&&await m.cityStore.loadCityList(),t.index.__f__("log","at pages/tabbar/home/components/cpns/square-item.vue:296","城市列表:",m.cityStore.cityList),t.index.__f__("log","at pages/tabbar/home/components/cpns/square-item.vue:297","城市列表serviceAreas:",e);const s=m.cityStore.cityList.filter(a=>e.includes(a.code.toString()));if(s.length===0)return t.index.__f__("warn","at pages/tabbar/home/components/cpns/square-item.vue:304","未找到对应的服务城市，使用第一个服务区域"),e[0];if(s.length===1)return s[0].code;let c=s[0],u=1/0;return s.forEach(a=>{if(a.latitude&&a.longitude){const g=m.cityStore.calculateDistance(i,o,a.latitude,a.longitude);g<u&&(u=g,c=a)}}),t.index.__f__("log","at pages/tabbar/home/components/cpns/square-item.vue:333",`选择最近的服务城市: ${c.name}, 距离: ${u.toFixed(2)}km`),c.code},f=async(e,i,o=null,s=null)=>{let c="/subPackages/friend/detail?id="+e+"&city_code="+i;o&&s&&(c+="&latitude="+o+"&longitude="+s),t.index.navigateTo({url:c})};return(e,i)=>{var o,s,c,u;return t.e({a:n.listType===1&&n.item.companion_info},n.listType===1&&n.item.companion_info?{b:t.p({src:e.$imgBaseUrl+n.item.companion_info.avatar,size:"38",shape:"circle",mode:"aspectFill"}),c:t.t(n.item.companion_info.nickname),d:y(n.item.companion_info.gender),e:t.t(n.item.companion_info.age),f:t.s(h(n.item.companion_info.gender)),g:t.t(n.item.companion_info.height),h:t.t(n.item.companion_info.weight),i:t.t(n.item.companion_info.tags.join("、")),j:t.o(a=>q(n.item))}:{},{k:t.t(n.item.moments_info.content),l:(o=n.item.moments_info)==null?void 0:o.file_list},(s=n.item.moments_info)!=null&&s.file_list?{m:t.o(b),n:t.p({list:(c=n.item.moments_info)==null?void 0:c.file_list,topicList:(u=n.item.moments_info)==null?void 0:u.topic_list})}:{},{o:d._imports_0$19,p:t.o(a=>x(n.item)),q:!n.item.moments_info.is_praised},n.item.moments_info.is_praised?{}:{r:d._imports_1$1,s:t.o(a=>l(n.item))},{t:n.item.moments_info.is_praised},n.item.moments_info.is_praised?{v:d._imports_2,w:t.o(a=>l(n.item))}:{},{x:t.t(n.item.moments_info.praise_num||0),y:d._imports_3$3,z:t.t(n.item.moments_info.comments_num||0),A:t.o(a=>w(n.item)),B:d._imports_4$1,C:t.o(a=>v(n.item))})}}},j=t._export_sfc(S,[["__scopeId","data-v-f5ec2392"]]);wx.createComponent(j);
//# sourceMappingURL=../../../../../../.sourcemap/mp-weixin/pages/tabbar/home/components/cpns/square-item.js.map
