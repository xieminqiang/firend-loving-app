"use strict";const t=require("../../../../../common/vendor.js"),f=require("../../../../../common/assets.js"),w=require("../../../../../api/discover.js");Array||t.resolveComponent("u-avatar")();const x=()=>"../../../../../uni_modules/uview-plus/components/u-avatar/u-avatar.js";Math||(x+v)();const v=()=>"../../../../../components/common/PictureDisplay.js",q={__name:"square-item",props:{item:{type:Object,default:()=>{}},listType:{type:Number,default:1},userLocation:{type:Object,default:null},cityStore:{type:Object,default:null}},emits:["changeShowVip","playVideo"],setup(n,{emit:L}){const r=(e,i="add",o=1)=>{const s=parseInt(e)||0;return i==="add"?s+o:i==="subtract"?Math.max(0,s-o):s},m=n,g=e=>e==="女"?"/static/find/nd_icon.png":"/static/find/nand_icon.png",p=e=>e==="女"?{background:"rgba(252, 139, 198, 1)"}:{background:"rgba(19, 98, 235, 1)"},y=e=>{t.index.navigateTo({url:"/subPackages/record/comment",success(i){i.eventChannel.emit("getRecord",{data:e})}})},_=async e=>{try{const i=e.moments_info.is_praised;e.moments_info.is_praised=!i,e.moments_info.is_praised?e.moments_info.praise_num=r(e.moments_info.praise_num,"add",1):e.moments_info.praise_num=r(e.moments_info.praise_num,"subtract",1);const o=await w.praiseMoment({target_id:e.moments_info.moments_id});o.data&&o.data.code===0?t.index.__f__("log","at pages/tabbar/home/components/cpns/square-item.vue:201","点赞成功"):(e.moments_info.is_praised=i,i?e.moments_info.praise_num=r(e.moments_info.praise_num,"add",1):e.moments_info.praise_num=r(e.moments_info.praise_num,"subtract",1),t.index.showToast({title:"点赞失败，请重试",icon:"none"}))}catch(i){t.index.__f__("error","at pages/tabbar/home/components/cpns/square-item.vue:217","点赞失败:",i);const o=e.moments_info.is_praised;e.moments_info.is_praised=!o,o?e.moments_info.praise_num=r(e.moments_info.praise_num,"add",1):e.moments_info.praise_num=r(e.moments_info.praise_num,"subtract",1),t.index.showToast({title:"网络错误，请重试",icon:"none"})}},h=async e=>{try{const i=e.companion_info;if(!i||!i.service_areas||i.service_areas.length===0){t.index.showToast({title:"该友伴师暂无可服务区域",icon:"none"});return}if(i.service_areas.length===1){const o=i.service_areas[0];await d(i.id,o);return}if(m.userLocation){const o=await b(i.service_areas,m.userLocation.latitude,m.userLocation.longitude);await d(i.id,o,m.userLocation.latitude,m.userLocation.longitude)}else{const o=i.service_areas[0];await d(i.id,o)}}catch(i){t.index.__f__("error","at pages/tabbar/home/components/cpns/square-item.vue:278","邀约失败:",i),t.index.showToast({title:"邀约失败，请重试",icon:"none"})}},b=async(e,i,o)=>{m.cityStore.cityList.length===0&&await m.cityStore.loadCityList(),t.index.__f__("log","at pages/tabbar/home/components/cpns/square-item.vue:292","城市列表:",m.cityStore.cityList),t.index.__f__("log","at pages/tabbar/home/components/cpns/square-item.vue:293","城市列表serviceAreas:",e);const s=m.cityStore.cityList.filter(a=>e.includes(a.code.toString()));if(s.length===0)return t.index.__f__("warn","at pages/tabbar/home/components/cpns/square-item.vue:300","未找到对应的服务城市，使用第一个服务区域"),e[0];if(s.length===1)return s[0].code;let c=s[0],u=1/0;return s.forEach(a=>{if(a.latitude&&a.longitude){const l=m.cityStore.calculateDistance(i,o,a.latitude,a.longitude);l<u&&(u=l,c=a)}}),t.index.__f__("log","at pages/tabbar/home/components/cpns/square-item.vue:329",`选择最近的服务城市: ${c.name}, 距离: ${u.toFixed(2)}km`),c.code},d=async(e,i,o=null,s=null)=>{let c="/subPackages/py/detail?id="+e+"&city_code="+i;o&&s&&(c+="&latitude="+o+"&longitude="+s),t.index.navigateTo({url:c})};return(e,i)=>{var o,s,c,u;return t.e({a:n.listType===1&&n.item.companion_info},n.listType===1&&n.item.companion_info?{b:t.p({src:e.$imgBaseUrl+n.item.companion_info.avatar,size:"38",shape:"circle",mode:"aspectFill"}),c:t.t(n.item.companion_info.nickname),d:g(n.item.companion_info.gender),e:t.t(n.item.companion_info.age),f:t.s(p(n.item.companion_info.gender)),g:t.t(n.item.companion_info.height),h:t.t(n.item.companion_info.weight),i:t.t(n.item.companion_info.tags.join("、")),j:t.o(a=>h(n.item))}:{},{k:t.t(n.item.moments_info.content),l:(o=n.item.moments_info)==null?void 0:o.file_list},(s=n.item.moments_info)!=null&&s.file_list?{m:t.p({list:(c=n.item.moments_info)==null?void 0:c.file_list,topicList:(u=n.item.moments_info)==null?void 0:u.topic_list})}:{},{n:!n.item.moments_info.is_praised},n.item.moments_info.is_praised?{}:{o:f._imports_0$3,p:t.o(a=>_(n.item))},{q:n.item.moments_info.is_praised},n.item.moments_info.is_praised?{r:f._imports_1$1,s:t.o(a=>_(n.item))}:{},{t:t.t(n.item.moments_info.praise_num||0),v:f._imports_2$1,w:t.t(n.item.moments_info.comments_num||0),x:t.o(a=>y(n.item))})}}},C=t._export_sfc(q,[["__scopeId","data-v-f5ec2392"]]);wx.createComponent(C);
//# sourceMappingURL=../../../../../../.sourcemap/mp-weixin/pages/tabbar/home/components/cpns/square-item.js.map
