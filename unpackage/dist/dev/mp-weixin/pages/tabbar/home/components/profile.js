"use strict";const e=require("../../../../common/vendor.js"),a=require("../../../../common/assets.js"),h=require("../../../../api/user.js"),q=require("../../../../api/order.js"),L=require("../../../../stores/user.js"),A={__name:"profile",setup(O){const s=L.useUserStore(),p=e.ref(""),d=e.ref(0),l=e.ref(!1),i=e.ref(null),$=e.ref(""),r=e.computed(()=>s.userInfo&&Object.keys(s.userInfo).length>0),_=e.computed(()=>{if(r.value)return s.userInfo}),t=e.ref({pending:0,inProgress:0}),f=o=>{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:220","收到登录成功事件:",o),g(),v()},m=()=>{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:229","收到退出登录事件"),t.value={pending:0,inProgress:0},i.value=null,$.value=""},b=o=>{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:242","收到申请状态变化事件:",o),x()};e.onMounted(()=>{const o=e.index.getSystemInfoSync();d.value=o.statusBarHeight||0,d.value=o.statusBarHeight||0;const n=e.index.getAccountInfoSync();p.value=n.miniProgram.version,g(),e.index.$on("loginSuccess",f),e.index.$on("logoutSuccess",m),e.index.$on("applicationStatusChanged",b)}),e.onShow(()=>{r.value&&v()}),e.onUnmounted(()=>{e.index.$off("loginSuccess",f),e.index.$off("logoutSuccess",m),e.index.$off("applicationStatusChanged",b)});const g=async()=>{var o;if(e.index.__f__("log","at pages/tabbar/home/components/profile.vue:294","开始加载用户数据 - isLoggedIn:",r.value),e.index.__f__("log","at pages/tabbar/home/components/profile.vue:295","当前用户状态:",s.userInfo),r.value){try{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:300","用户已登录，开始请求用户信息");const n=await h.getUserInfo();if(e.index.__f__("log","at pages/tabbar/home/components/profile.vue:302","用户信息请求成功:",n),n.data&&n.data.code===0){const c=n.data.data;e.index.__f__("log","at pages/tabbar/home/components/profile.vue:307","解析用户数据:",c);const R={...c,access_token:s.userInfo.access_token||"",refresh_token:s.userInfo.refresh_token||""};s.setUserInfo(R)}else e.index.__f__("warn","at pages/tabbar/home/components/profile.vue:323","获取用户信息失败:",((o=n.data)==null?void 0:o.msg)||"未知错误")}catch(n){e.index.__f__("error","at pages/tabbar/home/components/profile.vue:326","获取用户信息失败:",n)}await x(),await v()}else e.index.__f__("log","at pages/tabbar/home/components/profile.vue:334","用户未登录，跳过获取用户信息")},x=async()=>{try{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:341","开始请求申请信息");const o=await h.getApplicatioInfo();e.index.__f__("log","at pages/tabbar/home/components/profile.vue:343","申请信息请求成功:",o),o.data&&o.data.code===0&&(i.value=o.data.data)}catch{}},v=async()=>{try{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:357","开始请求订单数量统计");const o=await q.getOrderCount();if(e.index.__f__("log","at pages/tabbar/home/components/profile.vue:359","订单数量统计请求成功:",o),o.data&&o.data.code===0){const n=o.data.data;e.index.__f__("log","at pages/tabbar/home/components/profile.vue:363","待服务订单数:",n.pending_service_count),e.index.__f__("log","at pages/tabbar/home/components/profile.vue:364","待付款订单数:",n.pending_payment_count),e.index.__f__("log","at pages/tabbar/home/components/profile.vue:365","进行中订单数:",n.in_service_count),t.value={pending:n.pending_payment_count||0,pending_service:n.pending_service_count||0,inProgress:n.in_service_count||0}}}catch(o){e.index.__f__("error","at pages/tabbar/home/components/profile.vue:375","获取订单数量失败:",o)}},I=()=>{e.index.navigateTo({url:"/subPackages/login/index"})},y=()=>{if(!r.value){e.index.showModal({title:"提示",content:"请先登录后再设置头像",confirmText:"去登录",cancelText:"取消",success:o=>{o.confirm&&e.index.navigateTo({url:"/subPackages/login/index"})}});return}e.index.navigateTo({url:"/subPackages/settings/pages/index/edit"})},u=o=>{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:419","跳转到订单页面，状态:",o);const n=encodeURIComponent(o);e.index.navigateTo({url:`/subPackages/order/index?status=${n}`})},S=()=>{e.index.navigateTo({url:"/subPackages/order/refund"})},T=()=>{i.value&&i.value.status==="approved"?e.index.navigateTo({url:"/subPackages/fpart/index"}):e.index.navigateTo({url:"/subPackages/py/apply/index"})},P=()=>{e.index.navigateTo({url:"/subPackages/profile/customer-service/index"})},k=()=>{e.index.navigateTo({url:"/subPackages/settings/pages/index/index"})},w=async()=>{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:469","开始下拉刷新"),l.value=!0;try{await g(),await new Promise(o=>setTimeout(o,800))}catch(o){e.index.__f__("error","at pages/tabbar/home/components/profile.vue:480","刷新失败:",o),e.index.showToast({title:"刷新失败",icon:"none",duration:1500})}finally{l.value=!1}},C=()=>{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:492","刷新动画结束"),l.value=!1},U=o=>o?o.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):"未绑定手机号";return(o,n)=>e.e({a:r.value},r.value?e.e({b:_.value.head_img},_.value.head_img?{c:o.$imgBaseUrl+_.value.head_img}:{d:e.t(_.value.nickname||"")},{e:e.t(_.value.nick_name||""),f:e.t(U(_.value.phone)||"未绑定手机号"),g:e.o(y)}):{h:a._imports_0$13,i:a._imports_1$7,j:a._imports_2$4,k:e.o(I)},{l:d.value+"px",m:a._imports_0$12,n:e.o(c=>u("all")),o:a._imports_4$1,p:t.value.pending>0},t.value.pending>0?{q:e.t(t.value.pending)}:{},{r:e.o(c=>u("pending_payment")),s:a._imports_5$1,t:t.value.pending_service>0},t.value.pending_service>0?{v:e.t(t.value.pending_service)}:{},{w:e.o(c=>u("pending_service")),x:a._imports_6,y:t.value.inProgress>0},t.value.inProgress>0?{z:e.t(t.value.inProgress)}:{},{A:e.o(c=>u("in_service")),B:a._imports_7$1,C:e.o(c=>u("completed")),D:a._imports_8$3,E:e.o(S),F:e.unref(s).switch===1&&r.value},e.unref(s).switch===1&&r.value?e.e({G:a._imports_9$1,H:i.value&&i.value.status==="approved"},i.value&&i.value.status==="approved"?{}:{},{I:a._imports_0$12,J:e.o(T)}):{},{K:a._imports_8$2,L:a._imports_0$12,M:e.o(()=>{}),N:e.o(P),O:a._imports_9,P:a._imports_0$12,Q:e.o(k),R:p.value!==""},p.value!==""?{S:e.t(p.value)}:{},{T:l.value,U:e.o(w),V:e.o(C)})}},B=e._export_sfc(A,[["__scopeId","data-v-aee450e5"]]);wx.createComponent(B);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/pages/tabbar/home/components/profile.js.map
