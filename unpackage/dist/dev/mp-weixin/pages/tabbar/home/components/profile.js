"use strict";const e=require("../../../../common/vendor.js"),a=require("../../../../common/assets.js"),h=require("../../../../api/user.js"),R=require("../../../../api/order.js"),q=require("../../../../stores/user.js"),L={__name:"profile",setup(B){const s=q.useUserStore(),p=e.ref(""),d=e.ref(0),l=e.ref(!1),i=e.ref(null),$=e.ref(""),r=e.computed(()=>s.userInfo&&Object.keys(s.userInfo).length>0),_=e.computed(()=>{if(r.value)return s.userInfo}),t=e.ref({pending:0,inProgress:0}),f=o=>{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:214","收到登录成功事件:",o),g(),v()},m=()=>{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:223","收到退出登录事件"),t.value={pending:0,inProgress:0},i.value=null,$.value=""},b=o=>{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:236","收到申请状态变化事件:",o),x()};e.onMounted(()=>{const o=e.index.getSystemInfoSync();d.value=o.statusBarHeight||0,d.value=o.statusBarHeight||0;const n=e.index.getAccountInfoSync();p.value=n.miniProgram.version,g(),e.index.$on("loginSuccess",f),e.index.$on("logoutSuccess",m),e.index.$on("applicationStatusChanged",b)}),e.onShow(()=>{r.value&&v()}),e.onUnmounted(()=>{e.index.$off("loginSuccess",f),e.index.$off("logoutSuccess",m),e.index.$off("applicationStatusChanged",b)});const g=async()=>{var o;if(e.index.__f__("log","at pages/tabbar/home/components/profile.vue:288","开始加载用户数据 - isLoggedIn:",r.value),e.index.__f__("log","at pages/tabbar/home/components/profile.vue:289","当前用户状态:",s.userInfo),r.value){try{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:294","用户已登录，开始请求用户信息");const n=await h.getUserInfo();if(e.index.__f__("log","at pages/tabbar/home/components/profile.vue:296","用户信息请求成功:",n),n.data&&n.data.code===0){const c=n.data.data;e.index.__f__("log","at pages/tabbar/home/components/profile.vue:301","解析用户数据:",c);const U={...c,access_token:s.userInfo.access_token||"",refresh_token:s.userInfo.refresh_token||""};s.setUserInfo(U)}else e.index.__f__("warn","at pages/tabbar/home/components/profile.vue:317","获取用户信息失败:",((o=n.data)==null?void 0:o.msg)||"未知错误")}catch(n){e.index.__f__("error","at pages/tabbar/home/components/profile.vue:320","获取用户信息失败:",n)}await x(),await v()}else e.index.__f__("log","at pages/tabbar/home/components/profile.vue:328","用户未登录，跳过获取用户信息")},x=async()=>{try{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:335","开始请求申请信息");const o=await h.getApplicatioInfo();e.index.__f__("log","at pages/tabbar/home/components/profile.vue:337","申请信息请求成功:",o),o.data&&o.data.code===0&&(i.value=o.data.data)}catch{}},v=async()=>{try{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:351","开始请求订单数量统计");const o=await R.getOrderCount();if(e.index.__f__("log","at pages/tabbar/home/components/profile.vue:353","订单数量统计请求成功:",o),o.data&&o.data.code===0){const n=o.data.data;e.index.__f__("log","at pages/tabbar/home/components/profile.vue:357","待服务订单数:",n.pending_service_count),e.index.__f__("log","at pages/tabbar/home/components/profile.vue:358","待付款订单数:",n.pending_payment_count),e.index.__f__("log","at pages/tabbar/home/components/profile.vue:359","进行中订单数:",n.in_service_count),t.value={pending:n.pending_payment_count||0,pending_service:n.pending_service_count||0,inProgress:n.in_service_count||0}}}catch(o){e.index.__f__("error","at pages/tabbar/home/components/profile.vue:369","获取订单数量失败:",o)}},I=()=>{e.index.navigateTo({url:"/subPackages/login/index"})},S=()=>{if(!r.value){e.index.showModal({title:"提示",content:"请先登录后再设置头像",confirmText:"去登录",cancelText:"取消",success:o=>{o.confirm&&e.index.navigateTo({url:"/subPackages/login/index"})}});return}e.index.navigateTo({url:"/subPackages/settings/pages/index/edit"})},u=o=>{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:413","跳转到订单页面，状态:",o);const n=encodeURIComponent(o);e.index.navigateTo({url:`/subPackages/order/index?status=${n}`})},y=()=>{i.value&&i.value.status==="approved"?e.index.navigateTo({url:"/subPackages/partner/index"}):e.index.navigateTo({url:"/subPackages/friend/apply/index"})},P=()=>{e.index.navigateTo({url:"/subPackages/profile/customer-service/index"})},T=()=>{e.index.navigateTo({url:"/subPackages/settings/pages/index/index"})},k=async()=>{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:459","开始下拉刷新"),l.value=!0;try{await g(),await new Promise(o=>setTimeout(o,800))}catch(o){e.index.__f__("error","at pages/tabbar/home/components/profile.vue:470","刷新失败:",o),e.index.showToast({title:"刷新失败",icon:"none",duration:1500})}finally{l.value=!1}},w=()=>{e.index.__f__("log","at pages/tabbar/home/components/profile.vue:482","刷新动画结束"),l.value=!1},C=o=>o?o.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):"未绑定手机号";return(o,n)=>e.e({a:r.value},r.value?e.e({b:_.value.head_img},_.value.head_img?{c:o.$imgBaseUrl+_.value.head_img}:{d:e.t(_.value.nickname||"")},{e:e.t(_.value.nick_name||""),f:e.t(C(_.value.phone)||"未绑定手机号"),g:e.o(S)}):{h:a._imports_0$15,i:a._imports_1$6,j:a._imports_2$4,k:e.o(I)},{l:d.value+"px",m:a._imports_0$13,n:e.o(c=>u("all")),o:a._imports_4$1,p:t.value.pending>0},t.value.pending>0?{q:e.t(t.value.pending)}:{},{r:e.o(c=>u("pending_payment")),s:a._imports_5$1,t:t.value.pending_service>0},t.value.pending_service>0?{v:e.t(t.value.pending_service)}:{},{w:e.o(c=>u("pending_service")),x:a._imports_6,y:t.value.inProgress>0},t.value.inProgress>0?{z:e.t(t.value.inProgress)}:{},{A:e.o(c=>u("in_service")),B:a._imports_7$1,C:e.o(c=>u("completed")),D:e.unref(s).switch===1&&r.value},e.unref(s).switch===1&&r.value?e.e({E:a._imports_8$3,F:i.value&&i.value.status==="approved"},i.value&&i.value.status==="approved"?{}:{},{G:a._imports_0$13,H:e.o(y)}):{},{I:a._imports_8$2,J:a._imports_0$13,K:e.o(()=>{}),L:e.o(P),M:a._imports_9,N:a._imports_0$13,O:e.o(T),P:p.value!==""},p.value!==""?{Q:e.t(p.value)}:{},{R:l.value,S:e.o(k),T:e.o(w)})}},A=e._export_sfc(L,[["__scopeId","data-v-aee450e5"]]);wx.createComponent(A);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/pages/tabbar/home/components/profile.js.map
