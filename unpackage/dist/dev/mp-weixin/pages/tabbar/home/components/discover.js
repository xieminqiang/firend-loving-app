"use strict";const e=require("../../../../common/vendor.js"),O=require("../../../../common/assets.js"),B=require("../../../../stores/city.js"),E=require("../../../../stores/user.js"),F=require("../../../../api/discover.js");if(!Array){const T=e.resolveComponent("u-list-item"),m=e.resolveComponent("u-list"),d=e.resolveComponent("uni-transition");(T+m+d)()}const G=()=>"../../../../uni_modules/uview-plus/components/u-list-item/u-list-item.js",J=()=>"../../../../uni_modules/uview-plus/components/u-list/u-list.js",K=()=>"../../../../uni_modules/uni-transition/components/uni-transition/uni-transition.js";Math||(e.unref(Q)+e.unref(W)+G+J+K)();const Q=()=>"./cpns/square-nav.js",W=()=>"./cpns/square-item.js",k="https://sbx-server.oss-cn-shenzhen.aliyuncs.com/img/cum/squarebg.png",X={__name:"discover",emits:["playVideo"],setup(T,{expose:m,emit:d}){const I=d,p=e.ref(!1),q=B.useCityStore(),f=E.useUserStore(),c=e.ref(null),g=e.ref(!1),u=e.ref([]),n=e.ref(!1),b=e.ref(!0),i=e.ref({page:1,page_size:20}),h=e.ref(0),l=e.ref(0),_=e.ref(!1),r=e.ref(!1);e.computed(()=>p.value?{backgroundImage:`url(${k})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}:{background:"#ffffff"});const C=()=>new Promise(o=>{g.value=!0,e.index.getLocation({type:"wgs84",success:t=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:115","获取位置成功:",t),c.value={latitude:t.latitude,longitude:t.longitude},g.value=!1,o({latitude:t.latitude,longitude:t.longitude})},fail:t=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:127","获取位置失败:",t),c.value=null,g.value=!1,o(null)}})}),j=()=>{p.value=!1,e.index.getImageInfo({src:k,success:()=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:146","背景图片加载成功"),p.value=!0},fail:o=>{e.index.__f__("error","at pages/tabbar/home/components/discover.vue:150","背景图片加载失败:",o)}})};e.ref([{name:"动态",value:1},{name:"喜欢的人",value:2}]),e.ref(0);const P=e.ref(!0),z=e.ref(1),v=e.ref(1),A=e.computed(()=>f.userInfo&&Object.keys(f.userInfo).length>0&&f.token),y=async(o=1)=>{if(e.index.__f__("log","at pages/tabbar/home/components/discover.vue:200","开始获取动态列表数据，参数:",{page:o,listType:v.value,loading:n.value}),!n.value)try{n.value=!0;const t={list_type:v.value,page:o,page_size:i.value.page_size};e.index.__f__("log","at pages/tabbar/home/components/discover.vue:217","调用API参数:",t);const a=await F.getMomentsList(t);if(e.index.__f__("log","at pages/tabbar/home/components/discover.vue:219","API响应:",a),a.data&&a.data.code===0){const s=a.data.data.moments_list||[];e.index.__f__("log","at pages/tabbar/home/components/discover.vue:223","获取到的数据:",s),o===1?u.value=s:u.value=[...u.value,...s],b.value=s.length===i.value.page_size,b.value&&i.value.page++}else e.index.__f__("error","at pages/tabbar/home/components/discover.vue:239","API返回错误:",a)}catch(t){e.index.__f__("error","at pages/tabbar/home/components/discover.vue:242","获取动态列表失败:",t),e.index.showToast({icon:"none",title:"获取数据失败，请重试"})}finally{n.value=!1}},M=o=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:254","播放视频:",o),I("playVideo",o)},D=async o=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:260","打招呼:",o)},V=()=>{e.index.navigateTo({url:"/subPackages/login/index"})},S=()=>A.value?!0:(e.index.showModal({title:"提示",content:"请先登录后再查看动态",confirmText:"去登录",cancelText:"取消",success:o=>{o.confirm&&V()}}),!1),R=o=>{l.value=o.detail.scrollTop},$=()=>{b.value&&!n.value&&y(i.value.page)},U=o=>{h.value=l.value,e.nextTick$1(()=>{h.value=0})},H=async()=>{if(e.index.__f__("log","at pages/tabbar/home/components/discover.vue:313","刷新中~"),!_.value){if(!S()){r.value=!1;return}_.value=!0,r.value=!0,await y(1),_.value=!1,r.value=!1}},N=()=>{r.value="restore"},x=async()=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:337","discover组件初始化数据"),S()&&(_.value=!1,i.value.page=1,e.index.__f__("log","at pages/tabbar/home/components/discover.vue:348","onShow0"),j(),e.index.__f__("log","at pages/tabbar/home/components/discover.vue:351","onShow1"),C(),e.index.__f__("log","at pages/tabbar/home/components/discover.vue:354","onShow2"),await y(1),e.index.__f__("log","at pages/tabbar/home/components/discover.vue:358","discover组件显示，当前状态:",{isActive:P.value,listType:z.value,listTypeDesc:v.value,userLocation:c.value}))};e.onMounted(async()=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:368","discover组件挂载完成"),await x()});const L=e.ref(!1);return m({showComponent:async()=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:377","discover组件被显示"),L.value=!0,await x()},hideComponent:()=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:384","discover组件被隐藏"),L.value=!1},initData:x}),(o,t)=>({a:e.f(u.value,(a,s,w)=>({a:e.o(D,s),b:e.o(M,s),c:"102a3b38-3-"+w+","+("102a3b38-2-"+w),d:e.p({item:a,listType:v.value,userLocation:c.value,cityStore:e.unref(q)}),e:s,f:"102a3b38-2-"+w+",102a3b38-1"})),b:e.p({height:"100%"}),c:h.value,d:r.value,e:e.o(R),f:e.o($),g:e.o(H),h:e.o(N),i:O._imports_0$14,j:e.sr("ani","102a3b38-4"),k:e.p({"custom-class":"transition","mode-class":"slide-right",show:l.value>1e3}),l:l.value>1e3,m:e.o(U)})}};wx.createComponent(X);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/pages/tabbar/home/components/discover.js.map
