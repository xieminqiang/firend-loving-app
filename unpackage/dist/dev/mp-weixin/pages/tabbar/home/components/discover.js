"use strict";const e=require("../../../../common/vendor.js"),k=require("../../../../common/assets.js"),B=require("../../../../stores/city.js"),E=require("../../../../stores/user.js"),F=require("../../../../api/discover.js");if(!Array){const T=e.resolveComponent("u-list-item"),p=e.resolveComponent("u-list"),g=e.resolveComponent("uni-transition");(T+p+g)()}const G=()=>"../../../../uni_modules/uview-plus/components/u-list-item/u-list-item.js",J=()=>"../../../../uni_modules/uview-plus/components/u-list/u-list.js",K=()=>"../../../../uni_modules/uni-transition/components/uni-transition/uni-transition.js";Math||(e.unref(Q)+e.unref(W)+G+J+K)();const Q=()=>"./cpns/square-nav.js",W=()=>"./cpns/square-item.js",q="https://sbx-server.oss-cn-shenzhen.aliyuncs.com/img/cum/squarebg.png",X={__name:"discover",emits:["playVideo"],setup(T,{expose:p,emit:g}){const C=g,f=e.ref(!1),j=B.useCityStore(),b=E.useUserStore(),c=e.ref(null),h=e.ref(!1),u=e.ref([]),n=e.ref(!1),y=e.ref(!0),i=e.ref({page:1,page_size:20}),x=e.ref(0),l=e.ref(0),_=e.ref(!1),r=e.ref(!1);e.computed(()=>f.value?{backgroundImage:`url(${q})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}:{background:"#ffffff"});const P=()=>new Promise(o=>{h.value=!0,e.index.getLocation({type:"wgs84",success:a=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:127","获取位置成功:",a),c.value={latitude:a.latitude,longitude:a.longitude},h.value=!1,o({latitude:a.latitude,longitude:a.longitude})},fail:a=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:139","获取位置失败:",a),c.value=null,h.value=!1,o(null)}})}),z=()=>{f.value=!1,e.index.getImageInfo({src:q,success:()=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:158","背景图片加载成功"),f.value=!0},fail:o=>{e.index.__f__("error","at pages/tabbar/home/components/discover.vue:162","背景图片加载失败:",o)}})};e.ref([{name:"动态",value:1},{name:"喜欢的人",value:2}]),e.ref(0);const A=e.ref(!0),D=e.ref(1),v=e.ref(1),m=e.computed(()=>b.userInfo&&Object.keys(b.userInfo).length>0&&b.token),w=async(o=1)=>{if(e.index.__f__("log","at pages/tabbar/home/components/discover.vue:212","开始获取动态列表数据，参数:",{page:o,listType:v.value,loading:n.value}),!n.value)try{n.value=!0;const a={list_type:v.value,page:o,page_size:i.value.page_size};e.index.__f__("log","at pages/tabbar/home/components/discover.vue:229","调用API参数:",a);const t=await F.getMomentsList(a);if(e.index.__f__("log","at pages/tabbar/home/components/discover.vue:231","API响应:",t),t.data&&t.data.code===0){const s=t.data.data.moments_list||[];e.index.__f__("log","at pages/tabbar/home/components/discover.vue:235","获取到的数据:",s),o===1?u.value=s:u.value=[...u.value,...s],y.value=s.length===i.value.page_size,y.value&&i.value.page++}else e.index.__f__("error","at pages/tabbar/home/components/discover.vue:251","API返回错误:",t)}catch(a){e.index.__f__("error","at pages/tabbar/home/components/discover.vue:254","获取动态列表失败:",a),e.index.showToast({icon:"none",title:"获取数据失败，请重试"})}finally{n.value=!1}},M=o=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:266","播放视频:",o),C("playVideo",o)},$=async o=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:272","打招呼:",o)},V=()=>{e.index.navigateTo({url:"/subPackages/login/index"})},R=o=>{l.value=o.detail.scrollTop},U=()=>{y.value&&!n.value&&w(i.value.page)},H=o=>{x.value=l.value,e.nextTick$1(()=>{x.value=0})},N=async()=>{if(e.index.__f__("log","at pages/tabbar/home/components/discover.vue:311","刷新中~"),!_.value){if(!m.value){r.value=!1;return}_.value=!0,r.value=!0,await w(1),_.value=!1,r.value=!1}},O=()=>{r.value="restore"},d=async()=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:335","discover组件初始化数据"),m.value&&(_.value=!1,i.value.page=1,e.index.__f__("log","at pages/tabbar/home/components/discover.vue:346","onShow0"),z(),e.index.__f__("log","at pages/tabbar/home/components/discover.vue:349","onShow1"),P(),e.index.__f__("log","at pages/tabbar/home/components/discover.vue:352","onShow2"),await w(1),e.index.__f__("log","at pages/tabbar/home/components/discover.vue:356","discover组件显示，当前状态:",{isActive:A.value,listType:D.value,listTypeDesc:v.value,userLocation:c.value}))},L=async o=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:366","discover组件收到登录成功事件:",o),await d()};e.onMounted(async()=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:373","discover组件挂载完成"),await d(),e.index.$on("loginSuccess",L)}),e.onUnmounted(()=>{e.index.$off("loginSuccess",L)});const I=e.ref(!1);return p({showComponent:async()=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:390","discover组件被显示"),I.value=!0,await d()},hideComponent:()=>{e.index.__f__("log","at pages/tabbar/home/components/discover.vue:397","discover组件被隐藏"),I.value=!1},initData:d}),(o,a)=>e.e({a:!m.value},m.value?{d:e.f(u.value,(t,s,S)=>({a:e.o($,s),b:e.o(M,s),c:"102a3b38-3-"+S+","+("102a3b38-2-"+S),d:e.p({item:t,listType:v.value,userLocation:c.value,cityStore:e.unref(j)}),e:s,f:"102a3b38-2-"+S+",102a3b38-1"})),e:e.p({height:"100%"}),f:x.value,g:r.value,h:e.o(R),i:e.o(U),j:e.o(N),k:e.o(O),l:k._imports_1$6,m:e.sr("ani","102a3b38-4"),n:e.p({"custom-class":"transition","mode-class":"slide-right",show:l.value>1e3}),o:l.value>1e3,p:e.o(H)}:{b:k._imports_3,c:e.o(V)})}};wx.createComponent(X);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/pages/tabbar/home/components/discover.js.map
