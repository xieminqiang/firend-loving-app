"use strict";const e=require("../../../common/vendor.js");require("../../../config/http.js");Math||(m+v+h)();const h=()=>"../../../components/mq-tabbar/mq-tabbar.js",m=()=>"./components/home.js",v=()=>"./components/profile.js",d={__name:"page",setup(w,{expose:u}){const a=e.ref("home"),r=e.reactive(new Set(["home"])),o=e.ref(!1),l=s=>{r.add(s),a.value=s,e.index.__f__("log","at pages/tabbar/page/page.vue:49",`切换到 ${s} tab，已访问的tab:`,Array.from(r))};e.onMounted(()=>{e.index.__f__("log","at pages/tabbar/page/page.vue:54","页面挂载完成，当前tab:",a.value),e.index.__f__("log","at pages/tabbar/page/page.vue:55","已访问的tab:",Array.from(r))}),e.onPullDownRefresh(async()=>{if(o.value){e.index.__f__("log","at pages/tabbar/page/page.vue:62","刷新操作正在进行中，忽略重复请求"),e.index.stopPullDownRefresh();return}o.value=!0,e.index.__f__("log","at pages/tabbar/page/page.vue:68","页面级下拉刷新触发，当前tab:",a.value);const s=new Promise((n,i)=>{setTimeout(()=>i(new Error("刷新超时")),1e4)});try{const n=(async()=>{var i,p,_,g;if(a.value==="home"){if(r.has("home")){const t=(p=(i=e.getCurrentInstance())==null?void 0:i.refs)==null?void 0:p.homeRef;t&&t.refreshCurrentTab&&await t.refreshCurrentTab()}}else if(a.value==="profile"&&r.has("profile")){const t=(g=(_=e.getCurrentInstance())==null?void 0:_.refs)==null?void 0:g.profileRef;t&&t.refreshCurrentTab&&await t.refreshCurrentTab()}})();await Promise.race([n,s]),await new Promise(i=>setTimeout(i,300)),e.index.showToast({title:"刷新成功",icon:"success",duration:1500})}catch(n){e.index.__f__("error","at pages/tabbar/page/page.vue:111","页面级下拉刷新失败:",n),e.index.showToast({title:n.message==="刷新超时"?"刷新超时，请重试":"刷新失败，请重试",icon:"error",duration:2e3})}finally{await e.nextTick$1(),setTimeout(()=>{e.index.stopPullDownRefresh(),o.value=!1,e.index.__f__("log","at pages/tabbar/page/page.vue:125","下拉刷新已停止")},100)}}),e.onShow(()=>{e.index.__f__("log","at pages/tabbar/page/page.vue:132","页面显示，当前tab:",a.value),o.value&&(e.index.__f__("log","at pages/tabbar/page/page.vue:135","检测到异常刷新状态，强制重置"),f())}),e.onHide(()=>{e.index.__f__("log","at pages/tabbar/page/page.vue:142","页面隐藏"),f()});const b=()=>{e.index.__f__("log","at pages/tabbar/page/page.vue:149","手动刷新当前tab:",a.value)},c=()=>Array.from(r),f=()=>{o.value&&(e.index.stopPullDownRefresh(),o.value=!1,e.index.__f__("log","at pages/tabbar/page/page.vue:162","强制停止刷新状态"))};return u({refreshCurrentTab:b,getVisitedTabs:c,currentTab:a,forceStopRefresh:f}),(s,n)=>e.e({a:r.has("home")},r.has("home")?{b:e.sr("homeRef","bf699e6f-0")}:{},{c:a.value==="home",d:r.has("profile")},r.has("profile")?{e:e.sr("profileRef","bf699e6f-1")}:{},{f:a.value==="profile",g:e.o(l),h:e.p({currentTab:a.value})})}},x=e._export_sfc(d,[["__scopeId","data-v-bf699e6f"]]);wx.createPage(x);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/tabbar/page/page.js.map
