"use strict";const e=require("../../../../common/vendor.js"),y=require("../../../../common/assets.js"),b=require("../../../../api/friends.js"),C=require("../../../../stores/city.js"),x=require("../../../../stores/user.js");Math||($+I)();const $=()=>"../../../../components/common/CitySelector.js",I=()=>"../../../../components/common/CityPicker.js",S={__name:"home",setup(w,{expose:g}){x.useUserStore();const v=e.ref(0),m=e.ref(44);e.onMounted(async()=>{const a=e.index.getSystemInfoSync();v.value=a.statusBarHeight||0,m.value=44,await r.initCityData(),await l()});const r=C.useCityStore();e.computed(()=>r.currentCity);const d=e.computed(()=>r.currentCityCode);e.computed(()=>r.cityList),e.computed(()=>r.cityIndex);const n=e.ref([]),i=e.ref({}),c=e.ref(!1),_=e.ref(!1);e.onUnmounted(()=>{});const l=async()=>{var a;try{_.value=!0,e.index.__f__("log","at pages/tabbar/page/components/home.vue:158","开始加载城市服务数据，当前城市代码:",d.value);const s={city_code:d.value,application_id:15};e.index.__f__("log","at pages/tabbar/page/components/home.vue:165","城市服务请求参数:",s);const t=await b.getCityServices(s);if(t.data&&t.data.code===0&&t.data.data){const o=t.data.data;e.index.__f__("log","at pages/tabbar/page/components/home.vue:171","城市服务数据:",o),o&&(i.value={avatar:o.avatar,nickname:o.nickname||"未知用户",verified:!0,age:o.age,weight:o.weight,height:o.height,distance:o.distance,tags:o.tags||[],level_order:o.level_order,levelIcon:"",gender:o.gender||"",application_id:o.application_id||15}),o.services&&o.services.length>0?(n.value=o.services,e.index.__f__("log","at pages/tabbar/page/components/home.vue:194","服务数据加载成功，共",n.value.length,"条")):(n.value=[],e.index.__f__("log","at pages/tabbar/page/components/home.vue:197","服务数据为空"))}else e.index.__f__("error","at pages/tabbar/page/components/home.vue:200","获取城市服务失败:",((a=t.data)==null?void 0:a.message)||"未知错误"),n.value=[];c.value=!0}catch(s){e.index.__f__("error","at pages/tabbar/page/components/home.vue:205","获取城市服务异常:",s),n.value=[],c.value=!0}finally{_.value=!1}},f=a=>{e.index.__f__("log","at pages/tabbar/page/components/home.vue:215","跳转到服务详情页面，服务信息:",a),e.index.navigateTo({url:`/subPackages/py/fr_detail?service_id=${a.service_id}&price_template_id=${a.price_template_id||""}&companion_id=${i.value.application_id||15}&level_order=${i.value.level_order||""}&nickname=${i.value.nickname||""}&service_name=${encodeURIComponent(a.service_name)}&service_image_url=${encodeURIComponent(a.service_image_url)}&price=${a.price||0}&unit=${a.unit||"小时"}&service_tags=${encodeURIComponent(JSON.stringify(a.service_tags||[]))}`})};e.ref(!1),e.ref(!1);const u=e.ref(!1);function h(a){r.cityIndex!==a&&(e.index.__f__("log","at pages/tabbar/page/components/home.vue:270",`手动选择城市: ${r.cityList[a].name}`),l())}return g({refreshCurrentTab:async()=>{e.index.__f__("log","at pages/tabbar/page/components/home.vue:277","Home组件刷新方法被调用");try{return r.cityList.length===0&&(e.index.__f__("log","at pages/tabbar/page/components/home.vue:282","城市列表为空，重新加载城市列表"),await r.loadCityList()),e.index.__f__("log","at pages/tabbar/page/components/home.vue:287","刷新服务数据"),await l(),!0}catch(a){throw e.index.__f__("error","at pages/tabbar/page/components/home.vue:292","Home组件刷新失败:",a),a}}}),(a,s)=>e.e({a:e.o(t=>u.value=!0),b:v.value+"px",c:_.value},_.value?{}:n.value.length>0?{e:e.f(n.value,(t,o,L)=>({a:a.$imgBaseUrl+t.service_image_url,b:e.t(t.service_name),c:e.f(t.service_tags,(p,U,H)=>({a:e.t(p),b:p})),d:e.t(t.price||0),e:e.t(t.unit||"小时"),f:t.service_id,g:e.o(p=>f(t),t.service_id)}))}:c.value&&n.value.length===0?{g:y._imports_3}:{},{d:n.value.length>0,f:c.value&&n.value.length===0,h:e.o(h),i:e.o(t=>u.value=t),j:e.p({visible:u.value})})}},k=e._export_sfc(S,[["__scopeId","data-v-53c08f20"]]);wx.createComponent(k);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/pages/tabbar/page/components/home.js.map
