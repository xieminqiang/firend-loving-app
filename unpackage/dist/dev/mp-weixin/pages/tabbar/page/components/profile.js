"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../../common/assets.js"),x=require("../../../../api/user.js"),q=require("../../../../api/order.js"),L=require("../../../../stores/user.js"),R={__name:"profile",setup(B,{expose:h}){const s=L.useUserStore(),l=e.ref(0),c=e.ref(!1),d=e.ref(null),$=e.ref(""),r=e.computed(()=>s.userInfo&&Object.keys(s.userInfo).length>0),p=e.computed(()=>{if(r.value)return s.userInfo}),t=e.ref({pending:0,inProgress:0}),f=a=>{e.index.__f__("log","at pages/tabbar/page/components/profile.vue:205","收到登录成功事件:",a),g(),u()},v=()=>{e.index.__f__("log","at pages/tabbar/page/components/profile.vue:214","收到退出登录事件"),t.value={pending:0,inProgress:0},d.value=null,$.value=""},m=a=>{e.index.__f__("log","at pages/tabbar/page/components/profile.vue:227","收到申请状态变化事件:",a),b()};e.onMounted(()=>{const a=e.index.getSystemInfoSync();l.value=a.statusBarHeight||0,g(),e.index.$on("loginSuccess",f),e.index.$on("logoutSuccess",v),e.index.$on("applicationStatusChanged",m)}),e.onShow(()=>{r.value&&u()}),e.onUnmounted(()=>{e.index.$off("loginSuccess",f),e.index.$off("logoutSuccess",v),e.index.$off("applicationStatusChanged",m)});const g=async()=>{var a;if(e.index.__f__("log","at pages/tabbar/page/components/profile.vue:273","开始加载用户数据 - isLoggedIn:",r.value),e.index.__f__("log","at pages/tabbar/page/components/profile.vue:274","当前用户状态:",s.userInfo),r.value){try{e.index.__f__("log","at pages/tabbar/page/components/profile.vue:279","用户已登录，开始请求用户信息");const n=await x.getUserInfo();if(e.index.__f__("log","at pages/tabbar/page/components/profile.vue:281","用户信息请求成功:",n),n.data&&n.data.code===0){const i=n.data.data;e.index.__f__("log","at pages/tabbar/page/components/profile.vue:286","解析用户数据:",i);const U={...i,access_token:s.userInfo.access_token||"",refresh_token:s.userInfo.refresh_token||""};s.setUserInfo(U)}else e.index.__f__("warn","at pages/tabbar/page/components/profile.vue:302","获取用户信息失败:",((a=n.data)==null?void 0:a.msg)||"未知错误")}catch(n){e.index.__f__("error","at pages/tabbar/page/components/profile.vue:305","获取用户信息失败:",n)}await b(),await u()}else e.index.__f__("log","at pages/tabbar/page/components/profile.vue:313","用户未登录，跳过获取用户信息")},b=async()=>{try{e.index.__f__("log","at pages/tabbar/page/components/profile.vue:320","开始请求申请信息");const a=await x.getApplicatioInfo();e.index.__f__("log","at pages/tabbar/page/components/profile.vue:322","申请信息请求成功:",a),a.data&&a.data.code===0&&(d.value=a.data.data)}catch{}},u=async()=>{try{e.index.__f__("log","at pages/tabbar/page/components/profile.vue:336","开始请求订单数量统计");const a=await q.getOrderCount();if(e.index.__f__("log","at pages/tabbar/page/components/profile.vue:338","订单数量统计请求成功:",a),a.data&&a.data.code===0){const n=a.data.data;e.index.__f__("log","at pages/tabbar/page/components/profile.vue:342","待服务订单数:",n.pending_service_count),e.index.__f__("log","at pages/tabbar/page/components/profile.vue:343","待付款订单数:",n.pending_payment_count),e.index.__f__("log","at pages/tabbar/page/components/profile.vue:344","进行中订单数:",n.in_service_count),t.value={pending:n.pending_payment_count||0,pending_service:n.pending_service_count||0,inProgress:n.in_service_count||0}}}catch(a){e.index.__f__("error","at pages/tabbar/page/components/profile.vue:354","获取订单数量失败:",a)}},y=()=>{e.index.navigateTo({url:"/subPackages/login/index"})},I=()=>{if(!r.value){e.index.showModal({title:"提示",content:"请先登录后再设置头像",confirmText:"去登录",cancelText:"取消",success:a=>{a.confirm&&e.index.navigateTo({url:"/subPackages/login/index"})}});return}e.index.navigateTo({url:"/subPackages/settings/pages/index/edit"})},_=a=>{e.index.__f__("log","at pages/tabbar/page/components/profile.vue:398","跳转到订单页面，状态:",a);const n=encodeURIComponent(a);e.index.navigateTo({url:`/subPackages/order/index?status=${n}`})},S=()=>{e.index.navigateTo({url:"/subPackages/profile/customer-service/index"})},w=()=>{e.index.navigateTo({url:"/subPackages/settings/pages/index/index"})},P=async()=>{e.index.__f__("log","at pages/tabbar/page/components/profile.vue:444","开始下拉刷新"),c.value=!0;try{await g(),await new Promise(a=>setTimeout(a,800))}catch(a){e.index.__f__("error","at pages/tabbar/page/components/profile.vue:455","刷新失败:",a),e.index.showToast({title:"刷新失败",icon:"none",duration:1500})}finally{c.value=!1}},T=()=>{e.index.__f__("log","at pages/tabbar/page/components/profile.vue:467","刷新动画结束"),c.value=!1},k=async()=>{e.index.__f__("log","at pages/tabbar/page/components/profile.vue:473","Profile组件刷新方法被调用");try{return await g(),!0}catch(a){throw e.index.__f__("error","at pages/tabbar/page/components/profile.vue:480","Profile组件刷新失败:",a),a}},C=a=>a?a.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):"未绑定手机号";return h({refreshCurrentTab:k}),(a,n)=>e.e({a:r.value},r.value?e.e({b:p.value.head_img},p.value.head_img?{c:a.$imgBaseUrl+p.value.head_img}:{d:e.t(p.value.nickname||"")},{e:e.t(p.value.nick_name||""),f:e.t(C(p.value.phone)||"未绑定手机号"),g:e.o(I)}):{h:o._imports_0$15,i:o._imports_1$6,j:o._imports_2$4,k:e.o(y)},{l:l.value+"px",m:o._imports_0$13,n:e.o(i=>_("all")),o:o._imports_4$1,p:t.value.pending>0},t.value.pending>0?{q:e.t(t.value.pending)}:{},{r:e.o(i=>_("pending_payment")),s:o._imports_5$1,t:t.value.pending_service>0},t.value.pending_service>0?{v:e.t(t.value.pending_service)}:{},{w:e.o(i=>_("pending_service")),x:o._imports_6,y:t.value.inProgress>0},t.value.inProgress>0?{z:e.t(t.value.inProgress)}:{},{A:e.o(i=>_("in_service")),B:o._imports_7$1,C:e.o(i=>_("completed")),D:o._imports_8$2,E:o._imports_0$13,F:e.o(()=>{}),G:e.o(S),H:o._imports_9,I:o._imports_0$13,J:e.o(w),K:c.value,L:e.o(P),M:e.o(T)})}},A=e._export_sfc(R,[["__scopeId","data-v-81bba057"]]);wx.createComponent(A);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/pages/tabbar/page/components/profile.js.map
