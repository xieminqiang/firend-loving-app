"use strict";const e=require("../../common/vendor.js"),p=require("../../common/assets.js"),S=require("../../api/friends.js"),$=require("../../stores/level.js"),q={__name:"detail",setup(L){const r=e.ref({}),_=$.useLevelStore(),g=e.ref(0),l=e.ref({}),h=e.ref([]),o=e.ref([]),v=e.computed(()=>!l.value.level_order||!_.sortedServiceLevels.length?null:_.sortedServiceLevels.find(i=>i.level_order===l.value.level_order)),f=[],x=i=>{e.index.navigateTo({url:`/subPackages/order/submit?service_id=${i.service_id}&price_template_id=${i.price_template_id||""}&companion_id=${r.value.id}&level_order=${l.value.level_order||""}&nickname=${l.value.nickname}`})},y=async()=>{var i;try{const n={city_code:r.value.city_code,application_id:r.value.id};r.value.latitude&&r.value.longitude&&(n.latitude=parseFloat(r.value.latitude),n.longitude=parseFloat(r.value.longitude));const u=await S.getCityServices(n);if(e.index.__f__("log","at subPackages/friend/detail.vue:194","城市服务信息响应:",u),u.data&&u.data.code===0){const a=u.data.data;e.index.__f__("log","at subPackages/friend/detail.vue:199","城市服务数据:",a),a&&(l.value={avatar:a.avatar,nickname:a.nickname||"未知用户",verified:!0,age:a.age,weight:a.weight,height:a.height,distance:a.distance,tags:a.tags||[],level_order:a.level_order,levelIcon:"",gender:a.gender||""},a.photos&&a.photos.length>0&&(h.value=a.photos.map(c=>({img:c}))),a.services&&a.services.length>0&&(o.value=a.services))}else e.index.__f__("error","at subPackages/friend/detail.vue:233","获取城市服务失败:",((i=u.data)==null?void 0:i.message)||"未知错误")}catch(n){e.index.__f__("error","at subPackages/friend/detail.vue:236","获取城市服务异常:",n)}};return e.onMounted(async()=>{await _.fetchServiceLevels();const i=getCurrentPages(),n=i[i.length-1];r.value=n.options||{},e.index.__f__("log","at subPackages/friend/detail.vue:251","页面参数:",r.value),e.index.__f__("log","at subPackages/friend/detail.vue:252","经纬度参数:",{latitude:r.value.latitude,longitude:r.value.longitude}),r.value.id&&r.value.city_code&&y()}),(i,n)=>{var u,a,c,b;return e.e({a:l.value.avatar,b:e.t(l.value.nickname),c:l.value.verified&&v.value},l.value.verified&&v.value?{d:(u=v.value)==null?void 0:u.icon_url}:{},{e:(a=v.value)==null?void 0:a.level_name},(c=v.value)!=null&&c.level_name?{f:e.t((b=v.value)==null?void 0:b.level_name)}:{},{g:e.f(h.value,(t,d,k)=>({a:t.img,b:d})),h:o.value.length>0},o.value.length>0?{i:e.f(o.value,(t,d,k)=>({a:i.$imgBaseUrl+t.service_image_url,b:e.t(t.service_name),c:e.f(t.service_tags,(s,m,P)=>({a:e.t(s),b:s})),d:e.t(t.price),e:e.t(t.unit||"小时"),f:e.o(s=>x(t),t.title),g:t.title}))}:{j:p._imports_3},{k:g.value===0,l:p._imports_3,m:g.value===1,n:f.length>0},f.length>0?{o:e.f(f,(t,d,k)=>({a:t.avatar,b:e.t(t.name),c:e.f(5,(s,m,P)=>({a:s,b:e.n({filled:s<=t.stars})})),d:e.t(t.stars>=4?"好评":"中评"),e:e.f(t.tags,(s,m,P)=>({a:e.t(s),b:s})),f:e.t(t.content),g:e.t(t.date),h:d}))}:{p:p._imports_3},{q:g.value===2})}}},w=e._export_sfc(q,[["__scopeId","data-v-21c5b98b"]]);wx.createPage(w);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/subPackages/friend/detail.js.map
