"use strict";const e=require("../../common/vendor.js"),c=require("../../common/assets.js"),Q=require("../../api/friends.js"),R=require("../../api/discover.js"),V=require("../../stores/level.js"),W=require("../../stores/user.js"),X={__name:"detail",setup(Z){const o=e.ref({}),{proxy:g}=e.getCurrentInstance(),x=V.useLevelStore(),y=W.useUserStore(),I=e.computed(()=>y.userInfo&&Object.keys(y.userInfo).length>0);e.computed(()=>{if(I.value)return y.userInfo});const z=()=>{e.index.navigateTo({url:"/subPackages/login/index"})},A=["提供项目","TA的动态","客户评价"],v=e.ref(0);function E(i){v.value=i}const n=e.ref({}),b=e.ref([]),k=e.ref([]),f=e.ref([]),P=e.ref(!1),d=e.computed(()=>!n.value.level_order||!x.sortedServiceLevels.length?null:x.sortedServiceLevels.find(i=>i.level_order===n.value.level_order)),q=[],G=i=>{if(!I.value){e.index.showToast({title:"请先登录",icon:"none",duration:2e3}),z();return}e.index.navigateTo({url:`/subPackages/order/submit?service_id=${i.service_id}&price_template_id=${i.price_template_id||""}&companion_id=${o.value.id}&level_order=${n.value.level_order||""}&nickname=${n.value.nickname}`})},H=async()=>{var i;try{const s={city_code:o.value.city_code,application_id:o.value.id};o.value.latitude&&o.value.longitude&&(s.latitude=parseFloat(o.value.latitude),s.longitude=parseFloat(o.value.longitude));const r=await Q.getCityServices(s);if(e.index.__f__("log","at subPackages/friend/detail.vue:304","城市服务信息响应:",r),r.data&&r.data.code===0){const a=r.data.data;e.index.__f__("log","at subPackages/friend/detail.vue:309","城市服务数据:",a),a&&(n.value={avatar:a.avatar,nickname:a.nickname||"未知用户",verified:!0,age:a.age,weight:a.weight,height:a.height,distance:a.distance,tags:a.tags||[],level_order:a.level_order,levelIcon:"",gender:a.gender||""},a.photos&&a.photos.length>0&&(b.value=a.photos.map($=>({img:$}))),a.services&&a.services.length>0&&(k.value=a.services))}else e.index.__f__("error","at subPackages/friend/detail.vue:343","获取城市服务失败:",((i=r.data)==null?void 0:i.message)||"未知错误")}catch(s){e.index.__f__("error","at subPackages/friend/detail.vue:346","获取城市服务异常:",s)}},O=async()=>{var i;if(o.value.id)try{P.value=!0;const s={companion_id:parseInt(o.value.id),page:1,page_size:10},r=await R.getMomentsByCompanion(s);if(e.index.__f__("log","at subPackages/friend/detail.vue:363","动态列表响应:",r),r.data&&r.data.code===0){const a=r.data.data;a&&a.moments_list&&(f.value=a.moments_list,e.index.__f__("log","at subPackages/friend/detail.vue:369","动态列表数据:",f.value))}else e.index.__f__("error","at subPackages/friend/detail.vue:372","获取动态列表失败:",((i=r.data)==null?void 0:i.message)||"未知错误")}catch(s){e.index.__f__("error","at subPackages/friend/detail.vue:375","获取动态列表异常:",s)}finally{P.value=!1}},J=i=>{e.index.previewImage({urls:b.value.map(s=>g.$imgBaseUrl+s.img),current:g.$imgBaseUrl+b.value[i].img,indicator:"number",loop:!0,show:!0,success:function(s){e.index.__f__("log","at subPackages/friend/detail.vue:390","图片预览成功",s)},fail:function(s){e.index.__f__("error","at subPackages/friend/detail.vue:393","图片预览失败",s)}})},K=(i,s)=>{const r=s.filter(a=>!a.is_video).map(a=>a.path);r.length>0&&e.index.previewImage({urls:r,current:r[i],indicator:"number",loop:!0,show:!0,success:function(a){e.index.__f__("log","at subPackages/friend/detail.vue:412","动态图片预览成功",a)},fail:function(a){e.index.__f__("error","at subPackages/friend/detail.vue:415","动态图片预览失败",a)}})};return e.onMounted(async()=>{await x.fetchServiceLevels();const i=getCurrentPages(),s=i[i.length-1];o.value=s.options||{},e.index.__f__("log","at subPackages/friend/detail.vue:431","页面参数:",o.value),e.index.__f__("log","at subPackages/friend/detail.vue:432","经纬度参数:",{latitude:o.value.latitude,longitude:o.value.longitude}),o.value.id&&o.value.city_code&&H(),o.value.id&&O()}),(i,s)=>{var r,a,$,S;return e.e({a:e.unref(g).$imgBaseUrl+n.value.avatar,b:e.t(n.value.nickname),c:n.value.verified&&d.value},n.value.verified&&d.value?{d:(r=d.value)==null?void 0:r.icon_url}:{},{e:(a=d.value)==null?void 0:a.level_name},($=d.value)!=null&&$.level_name?{f:e.t((S=d.value)==null?void 0:S.level_name)}:{},{g:n.value.tags&&n.value.tags.length>0},n.value.tags&&n.value.tags.length>0?{h:e.f(n.value.tags,(t,l,m)=>({a:e.t(t),b:t}))}:{},{i:n.value.gender==="女"?"/static/icons/friend/white_nv.png":"/static/icons/friend/white_nan.png",j:e.t(n.value.age),k:e.t(n.value.weight),l:e.t(n.value.height),m:n.value.distance!==""},n.value.distance!==""?{n:c._imports_0$7,o:e.t(n.value.distance)}:{},{p:e.f(b.value,(t,l,m)=>({a:e.unref(g).$imgBaseUrl+t.img,b:e.o(u=>J(l),l),c:l})),q:c._imports_1$3,r:c._imports_2$1,s:c._imports_3$4,t:e.f(A,(t,l,m)=>e.e({a:e.t(t),b:v.value===l},v.value===l?{}:{},{c:t,d:e.n({active:v.value===l}),e:e.o(u=>E(l),t)})),v:k.value.length>0},k.value.length>0?{w:e.f(k.value,(t,l,m)=>({a:e.unref(g).$imgBaseUrl+t.service_image_url,b:e.t(t.service_name),c:e.f(t.service_tags,(u,p,h)=>({a:e.t(u),b:u})),d:e.t(t.price),e:e.t(t.unit||"小时"),f:e.o(u=>G(t),t.title),g:t.title}))}:{x:c._imports_3},{y:v.value===0,z:P.value},P.value?{}:f.value.length>0?{B:e.f(f.value,(t,l,m)=>{var u,p,h,L,T,B,U,C,M,j,D,F;return e.e({a:e.t((u=t.moments_info)==null?void 0:u.time_date),b:e.t((p=t.moments_info)==null?void 0:p.time_time),c:e.t((h=t.moments_info)==null?void 0:h.content),d:((L=t.moments_info)==null?void 0:L.file_list)&&t.moments_info.file_list.length>0},(T=t.moments_info)!=null&&T.file_list&&t.moments_info.file_list.length>0?{e:e.f(t.moments_info.file_list,(_,w,N)=>e.e({a:!_.is_video},_.is_video?{d:_.path,e:_.poster||_.cover}:{b:_.path,c:e.o(ee=>K(w,t.moments_info.file_list),w)},{f:w}))}:{},{f:((B=t.moments_info)==null?void 0:B.topic_list)&&t.moments_info.topic_list.length>0},(U=t.moments_info)!=null&&U.topic_list&&t.moments_info.topic_list.length>0?{g:e.f(t.moments_info.topic_list,(_,w,N)=>e.e({a:_.topic_icon},_.topic_icon?{b:_.topic_icon}:{},{c:e.t(_.topic_desc),d:_.topic_id}))}:{},{h:e.t((M=(C=t.moments_info)==null?void 0:C.moments_status)==null?void 0:M.title),i:(j=t.moments_info)!=null&&j.is_praised?"/static/square/active-love.png":"/static/square/love.png",j:e.t(((D=t.moments_info)==null?void 0:D.praise_num)||0),k:e.t(((F=t.moments_info)==null?void 0:F.comments_num)||0),l})}),C:c._imports_3$3}:{D:c._imports_3},{A:f.value.length>0,E:v.value===1,F:q.length>0},q.length>0?{G:e.f(q,(t,l,m)=>({a:t.avatar,b:e.t(t.name),c:e.f(5,(u,p,h)=>({a:u,b:e.n({filled:u<=t.stars})})),d:e.t(t.stars>=4?"好评":"中评"),e:e.f(t.tags,(u,p,h)=>({a:e.t(u),b:u})),f:e.t(t.content),g:e.t(t.date),h:l}))}:{H:c._imports_3},{I:v.value===2})}}},Y=e._export_sfc(X,[["__scopeId","data-v-21c5b98b"]]);wx.createPage(Y);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/subPackages/friend/detail.js.map
