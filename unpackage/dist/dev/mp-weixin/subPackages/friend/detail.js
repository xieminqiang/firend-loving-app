"use strict";const e=require("../../common/vendor.js"),_=require("../../common/assets.js"),ue=require("../../api/friends.js"),B=require("../../api/discover.js"),le=require("../../stores/level.js"),_e=require("../../stores/user.js");if(!Array){const q=e.resolveComponent("u-tabs"),o=e.resolveComponent("u-avatar"),c=e.resolveComponent("u-popup");(q+o+c)()}const ce=()=>"../../uni_modules/uview-plus/components/u-tabs/u-tabs.js",de=()=>"../../uni_modules/uview-plus/components/u-avatar/u-avatar.js",fe=()=>"../../uni_modules/uview-plus/components/u-popup/u-popup.js";Math||(ce+me+de+fe)();const me=()=>"../../components/common/PictureDisplay.js",ve={__name:"detail",setup(q){const o=e.ref({}),{proxy:c}=e.getCurrentInstance(),w=le.useLevelStore(),$=_e.useUserStore(),M=e.computed(()=>$.userInfo&&Object.keys($.userInfo).length>0);e.computed(()=>{if(M.value)return $.userInfo});const G=()=>{e.index.navigateTo({url:"/subPackages/login/index"})},I=["提供项目","TA的动态","客户评价"],g=e.ref(0),J=e.computed(()=>I.map(a=>({name:a}))),K=a=>{let t,i;if(typeof a=="object"&&a!==null)t=a.index,i=a.name;else if(typeof a=="number")t=a,i=I[t];else{e.index.__f__("error","at subPackages/friend/detail.vue:301","Invalid tab change item:",a);return}if(t<0||t>=I.length){e.index.__f__("error","at subPackages/friend/detail.vue:307","Invalid tab index:",t);return}if(!i){e.index.__f__("error","at subPackages/friend/detail.vue:312","Tab not found for index:",t,"item:",a);return}e.index.__f__("log","at subPackages/friend/detail.vue:316","Tab changed to:",i,"index:",t),g.value=t},r=e.ref({}),x=e.ref([]),P=e.ref([]),p=e.ref([]),k=e.ref(!1),b=e.ref([]),y=e.ref(!1),T=e.ref(!1),C=e.ref(""),S=e.ref(!1),m=e.computed(()=>!r.value.level_order||!w.sortedServiceLevels.length?null:w.sortedServiceLevels.find(a=>a.level_order===r.value.level_order)),N=async()=>{var a;if(o.value.id)try{y.value=!0;const t={companion_id:parseInt(o.value.id),page:1,rating:5,page_size:20},i=await B.getCompanionCommentList(t);if(e.index.__f__("log","at subPackages/friend/detail.vue:361","评论列表响应:",i),i.data&&i.data.code===0){const s=i.data.data;s&&s.list&&(b.value=s.list,e.index.__f__("log","at subPackages/friend/detail.vue:367","评论列表数据:",b.value))}else e.index.__f__("error","at subPackages/friend/detail.vue:370","获取评论列表失败:",((a=i.data)==null?void 0:a.message)||"未知错误")}catch(t){e.index.__f__("error","at subPackages/friend/detail.vue:373","获取评论列表异常:",t)}finally{y.value=!1}},X=a=>{if(!M.value){e.index.showToast({title:"请先登录",icon:"none",duration:2e3}),G();return}e.index.navigateTo({url:`/subPackages/order/submit?service_id=${a.service_id}&price_template_id=${a.price_template_id||""}&companion_id=${o.value.id}&level_order=${r.value.level_order||""}&nickname=${r.value.nickname}`})},Y=async()=>{var a;try{const t={city_code:o.value.city_code,application_id:o.value.id};o.value.latitude&&o.value.longitude&&(t.latitude=parseFloat(o.value.latitude),t.longitude=parseFloat(o.value.longitude));const i=await ue.getCityServices(t);if(e.index.__f__("log","at subPackages/friend/detail.vue:419","城市服务信息响应:",i),re(),i.data&&i.data.code===0){const s=i.data.data;e.index.__f__("log","at subPackages/friend/detail.vue:424","城市服务数据:",s),s&&(r.value={avatar:s.avatar,nickname:s.nickname||"未知用户",verified:!0,age:s.age,weight:s.weight,height:s.height,distance:s.distance,tags:s.tags||[],level_order:s.level_order,levelIcon:"",gender:s.gender||""},s.photos&&s.photos.length>0&&(x.value=s.photos.map(d=>({img:d}))),s.services&&s.services.length>0&&(P.value=s.services))}else e.index.__f__("error","at subPackages/friend/detail.vue:458","获取城市服务失败:",((a=i.data)==null?void 0:a.message)||"未知错误")}catch(t){e.index.__f__("error","at subPackages/friend/detail.vue:461","获取城市服务异常:",t)}},Z=async()=>{var a;if(o.value.id)try{k.value=!0;const t={companion_id:parseInt(o.value.id),page:1,page_size:50},i=await B.getMomentsByCompanion(t);if(e.index.__f__("log","at subPackages/friend/detail.vue:478","动态列表响应:",i),i.data&&i.data.code===0){const s=i.data.data;s&&s.moments_list&&(p.value=s.moments_list,e.index.__f__("log","at subPackages/friend/detail.vue:484","动态列表数据:",p.value))}else e.index.__f__("error","at subPackages/friend/detail.vue:487","获取动态列表失败:",((a=i.data)==null?void 0:a.message)||"未知错误")}catch(t){e.index.__f__("error","at subPackages/friend/detail.vue:490","获取动态列表异常:",t)}finally{k.value=!1}},ee=a=>{e.index.previewImage({urls:x.value.map(t=>c.$imgBaseUrl+t.img),current:c.$imgBaseUrl+x.value[a].img,indicator:"number",loop:!0,show:!0,success:function(t){e.index.__f__("log","at subPackages/friend/detail.vue:505","图片预览成功",t)},fail:function(t){e.index.__f__("error","at subPackages/friend/detail.vue:508","图片预览失败",t)}})},ae=a=>{e.index.__f__("log","at subPackages/friend/detail.vue:538","播放视频:",a),C.value=a,T.value=!0},te=()=>{T.value=!1,C.value=""},U=async a=>{try{const t=a.moments_info.is_praised;a.moments_info.is_praised=!t,a.moments_info.is_praised?a.moments_info.praise_num=parseInt(a.moments_info.praise_num)+1:a.moments_info.praise_num=Math.max(0,parseInt(a.moments_info.praise_num)-1);const i=await B.praiseMoment({target_id:a.moments_info.moments_id});i.data&&i.data.code===0?e.index.__f__("log","at subPackages/friend/detail.vue:569","点赞成功"):(a.moments_info.is_praised=t,t?a.moments_info.praise_num=parseInt(a.moments_info.praise_num)+1:a.moments_info.praise_num=Math.max(0,parseInt(a.moments_info.praise_num)-1),e.index.showToast({title:"点赞失败，请重试",icon:"none"}))}catch(t){e.index.__f__("error","at subPackages/friend/detail.vue:585","点赞失败:",t);const i=a.moments_info.is_praised;a.moments_info.is_praised=!i,i?a.moments_info.praise_num=parseInt(a.moments_info.praise_num)+1:a.moments_info.praise_num=Math.max(0,parseInt(a.moments_info.praise_num)-1),e.index.showToast({title:"网络错误，请重试",icon:"none"})}},ne=a=>{e.index.navigateTo({url:"/subPackages/record/comment",success(t){t.eventChannel.emit("getRecord",{data:a})}})},se=a=>{if(!a)return"";const t=new Date(a),s=new Date-t,d=Math.floor(s/(1e3*60*60*24));return d===0?"今天":d===1?"昨天":d<7?`${d}天前`:a.split(" ")[0]},ie=(a,t)=>{const i=t.map(s=>c.$imgBaseUrl+s);e.index.previewImage({urls:i,current:a,indicator:"number",loop:!0,show:!0,success:function(s){e.index.__f__("log","at subPackages/friend/detail.vue:644","评论图片预览成功",s)},fail:function(s){e.index.__f__("error","at subPackages/friend/detail.vue:647","评论图片预览失败",s)}})},oe=a=>{a.detail.scrollTop>=D.value?S.value=!0:S.value=!1},D=e.ref(0),re=()=>{e.index.createSelectorQuery().select(".profile-tabs").boundingClientRect(a=>{a&&(D.value=a.top)}).exec()};return e.onMounted(async()=>{await w.fetchServiceLevels();const a=getCurrentPages(),t=a[a.length-1];o.value=t.options||{},e.index.__f__("log","at subPackages/friend/detail.vue:685","页面参数:",o.value),e.index.__f__("log","at subPackages/friend/detail.vue:686","经纬度参数:",{latitude:o.value.latitude,longitude:o.value.longitude}),o.value.id&&o.value.city_code&&Y(),o.value.id&&Z(),o.value.id&&N()}),e.onUnmounted(()=>{}),(a,t)=>{var i,s,d,j;return e.e({a:e.unref(c).$imgBaseUrl+r.value.avatar,b:e.t(r.value.nickname),c:r.value.verified&&m.value},r.value.verified&&m.value?{d:(i=m.value)==null?void 0:i.icon_url}:{},{e:(s=m.value)==null?void 0:s.level_name},(d=m.value)!=null&&d.level_name?{f:e.t((j=m.value)==null?void 0:j.level_name)}:{},{g:r.value.tags&&r.value.tags.length>0},r.value.tags&&r.value.tags.length>0?{h:e.f(r.value.tags,(n,u,v)=>({a:e.t(n),b:n}))}:{},{i:r.value.gender==="女"?"/static/icons/friend/white_nv.png":"/static/icons/friend/white_nan.png",j:e.t(r.value.age),k:e.t(r.value.weight),l:e.t(r.value.height),m:r.value.distance!==""},r.value.distance!==""?{n:_._imports_0$7,o:e.t(r.value.distance)}:{},{p:e.f(x.value,(n,u,v)=>({a:e.unref(c).$imgBaseUrl+n.img,b:e.o(l=>ee(u),u),c:u})),q:_._imports_1$3,r:_._imports_2$2,s:_._imports_3$3,t:e.o(K),v:e.p({list:J.value,current:g.value,lineWidth:"60",lineHeight:"2",lineColor:"linear-gradient(90deg, rgba(115, 99, 255, 1) 0%, rgba(255, 105, 222, 1) 100%)",activeStyle:{color:"#7363FF",fontWeight:"500",fontSize:"28rpx"},inactiveStyle:{color:"#1A1A1A",fontWeight:"400",fontSize:"28rpx"},itemStyle:"padding: 16rpx 50rpx; height: auto; border-radius: 30rpx;"}),w:S.value?1:"",x:P.value.length>0},P.value.length>0?{y:e.f(P.value,(n,u,v)=>({a:e.unref(c).$imgBaseUrl+n.service_image_url,b:e.t(n.service_name),c:e.f(n.service_tags,(l,f,h)=>({a:e.t(l),b:l})),d:e.t(n.price),e:e.t(n.unit||"小时"),f:e.o(l=>X(n),n.title),g:n.title}))}:{z:_._imports_3},{A:g.value===0,B:k.value},k.value?{}:p.value.length>0?{D:e.f(p.value,(n,u,v)=>{var l,f,h,L,A,z,F,H,R,V,W,O,Q;return e.e({a:e.t((l=n.moments_info)==null?void 0:l.time_date),b:e.t((f=n.moments_info)==null?void 0:f.time_time),c:e.t((h=n.moments_info)==null?void 0:h.content),d:(L=n.moments_info)==null?void 0:L.file_list},(A=n.moments_info)!=null&&A.file_list?{e:e.o(ae,u),f:"21c5b98b-1-"+v,g:e.p({list:(z=n.moments_info)==null?void 0:z.file_list,topicList:(F=n.moments_info)==null?void 0:F.topic_list})}:{},{h:!((H=n.moments_info)!=null&&H.is_praised)},(R=n.moments_info)!=null&&R.is_praised?{}:{i:_._imports_0$4,j:e.o(E=>U(n),u)},{k:(V=n.moments_info)==null?void 0:V.is_praised},(W=n.moments_info)!=null&&W.is_praised?{l:_._imports_1$1,m:e.o(E=>U(n),u)}:{},{n:e.t(((O=n.moments_info)==null?void 0:O.praise_num)||0),o:e.t(((Q=n.moments_info)==null?void 0:Q.comments_num)||0),p:e.o(E=>ne(n),u),q:u})}),E:_._imports_2$1}:{F:_._imports_3},{C:p.value.length>0,G:g.value===1,H:y.value},y.value?{}:b.value.length>0?{J:e.f(b.value,(n,u,v)=>e.e({a:"21c5b98b-2-"+v,b:e.p({src:n.is_anonymous?"":e.unref(c).$imgBaseUrl+n.user_img,size:"40",shape:"circle"}),c:e.t(n.is_anonymous?"匿名用户":n.user_nickname),d:e.f(5,(l,f,h)=>({a:l,b:e.n({filled:l<=n.rating})})),e:e.t(se(n.comment_time)),f:e.t(n.comment),g:n.comment_images&&n.comment_images.length>0},n.comment_images&&n.comment_images.length>0?{h:e.f(n.comment_images,(l,f,h)=>({a:e.unref(c).$imgBaseUrl+l,b:f,c:e.o(L=>ie(f,n.comment_images),f)}))}:{},{i:n.id}))}:{K:_._imports_3},{I:b.value.length>0,L:g.value===2,M:e.o(oe),N:C.value,O:_._imports_8,P:e.o(te),Q:e.p({show:T.value,mode:"center",safeAreaInsetBottom:!1})})}}},ge=e._export_sfc(ve,[["__scopeId","data-v-21c5b98b"]]);wx.createPage(ge);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/subPackages/friend/detail.js.map
