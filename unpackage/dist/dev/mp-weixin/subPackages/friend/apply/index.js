"use strict";const e=require("../../../common/vendor.js"),I=require("../../../common/assets.js"),M=require("../../../api/user.js"),fe=require("../../../api/home.js"),E=require("../../../api/file.js"),ge=require("../../../stores/user.js"),O=5*60*1e3,pe={__name:"index",setup(he){const j=ge.useUserStore(),{proxy:L}=e.getCurrentInstance();e.ref(!1);const w=e.ref(!1),_=e.ref(!1),i=e.reactive({nickname:"",gender:"",age:"",height:"",weight:"",city:"æ·±åœ³å¸‚"}),b=e.ref(!1),o=e.ref([]),u=e.ref([]),h=e.ref([]),P=e.ref(!1),v=e.ref([]),x=e.ref([]),m=e.ref([]),T=e.ref(!1),f=e.ref([]),c=e.ref([]),k=e.ref(!1),d=e.ref([]),g=e.ref(!1),z=e.ref(4),y=e.ref([]),$=e.ref(new Map),B=e.ref(new Map),N=e.ref([{type:4,name:"ä¸ªæ€§ç‰¹è´¨"},{type:5,name:"æˆ‘çš„çˆ±å¥½"},{type:6,name:"å¤–è²Œé£æ ¼"},{type:7,name:"ä¸“ä¸šæŠ€èƒ½"},{type:8,name:"çƒ­é—¨æ¨è"}]),R=async()=>{if(o.value.length===0){x.value=[],f.value=[];return}T.value=!0;try{const n=o.value.map(a=>{const s=h.value.find(l=>l.name===a);return s?s.code:null}).filter(a=>a!==null);if(n.length===0){e.index.__f__("warn","at subPackages/friend/apply/index.vue:511","æœªæ‰¾åˆ°æœ‰æ•ˆçš„åŸå¸‚ä»£ç "),x.value=[],f.value=[];return}const t=await M.getServicesByCities(n);t.data&&t.data.code===0&&t.data.data?(x.value=t.data.data,G(),e.index.__f__("log","at subPackages/friend/apply/index.vue:525","æœåŠ¡æŠ€èƒ½åˆ—è¡¨åŠ è½½æˆåŠŸ:",x.value),e.index.__f__("log","at subPackages/friend/apply/index.vue:526","æœåŠ¡æŠ€èƒ½åˆ†ç»„:",f.value)):(e.index.__f__("warn","at subPackages/friend/apply/index.vue:528","è·å–æœåŠ¡æŠ€èƒ½åˆ—è¡¨å¤±è´¥"),x.value=[],f.value=[])}catch(n){e.index.__f__("error","at subPackages/friend/apply/index.vue:533","è·å–æœåŠ¡æŠ€èƒ½åˆ—è¡¨å¤±è´¥:",n),x.value=[],f.value=[]}finally{T.value=!1}},G=()=>{const n={};x.value.forEach(t=>{const a=t.category,s=t.category_name||"å…¶ä»–";n[a]||(n[a]={id:a,name:s,services:[]}),n[a].services.push(t)}),f.value=Object.values(n).sort((t,a)=>t.id-a.id)},V=async()=>{P.value=!0;try{const n=await fe.getCityList();n.data&&n.data.code===0&&n.data.data?(h.value=n.data.data.map(t=>({name:t.name,code:t.city_code})),e.index.__f__("log","at subPackages/friend/apply/index.vue:578","ç”³è¯·é¡µé¢åŒºåŸŸåˆ—è¡¨åŠ è½½æˆåŠŸ:",h.value)):(e.index.__f__("warn","at subPackages/friend/apply/index.vue:580","è·å–åŒºåŸŸåˆ—è¡¨å¤±è´¥"),h.value=[])}catch(n){e.index.__f__("error","at subPackages/friend/apply/index.vue:584","è·å–åŒºåŸŸåˆ—è¡¨å¤±è´¥:",n),h.value=[]}finally{P.value=!1}},A=n=>{i.gender=n},H=()=>{u.value=[...o.value],b.value=!0},q=()=>{u.value=[],b.value=!1},J=n=>{const t=u.value.indexOf(n);t>-1?u.value.splice(t,1):u.value.push(n),e.index.vibrateShort({type:"light"})},K=n=>{const t=o.value.indexOf(n);t>-1&&(o.value.splice(t,1),e.index.vibrateShort({type:"light"}))},Q=async()=>{if(u.value.length===0){e.index.showToast({title:"è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæœåŠ¡åŒºåŸŸ",icon:"none"});return}o.value=[...u.value],i.city=o.value[0],b.value=!1,u.value=[],m.value=[],f.value=[],await R()},W=()=>{const n=6-v.value.length;if(n<=0){e.index.showToast({title:"æœ€å¤šåªèƒ½ä¸Šä¼ 6å¼ ç…§ç‰‡",icon:"none"});return}e.index.chooseImage({count:n,sizeType:["compressed"],sourceType:["album","camera"],success:async t=>{e.index.showLoading({title:"ä¸Šä¼ ä¸­...",mask:!0});try{const a=t.tempFilePaths.map(async(l,r)=>{try{const p=await X(l);if(e.index.__f__("log","at subPackages/friend/apply/index.vue:699","fileInfo",p),e.index.__f__("log","at subPackages/friend/apply/index.vue:700","filePath",l),!p||!p.extension)throw new Error("æ— æ³•è·å–æ–‡ä»¶ä¿¡æ¯");const U=await E.uploadFile({filePath:l,name:`photo_${Date.now()}_${r}.${p.extension}`}),S=E.getUploadResult(U);if(!S||!S.url)throw new Error("ä¸Šä¼ ç»“æœè§£æå¤±è´¥");return S.url}catch(p){throw e.index.__f__("error","at subPackages/friend/apply/index.vue:719",`ç¬¬${r+1}å¼ ç…§ç‰‡ä¸Šä¼ å¤±è´¥:`,p),p}}),s=await Promise.all(a);v.value.push(...s),e.index.showToast({title:`æˆåŠŸä¸Šä¼ ${s.length}å¼ ç…§ç‰‡`,icon:"success"})}catch(a){e.index.__f__("error","at subPackages/friend/apply/index.vue:736","ç…§ç‰‡ä¸Šä¼ å¤±è´¥:",a),e.index.showToast({title:"ç…§ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}finally{e.index.hideLoading()}},fail:t=>{e.index.__f__("error","at subPackages/friend/apply/index.vue:746","é€‰æ‹©ç…§ç‰‡å¤±è´¥:",t),e.index.showToast({title:"é€‰æ‹©ç…§ç‰‡å¤±è´¥",icon:"none"})}})},X=n=>new Promise((t,a)=>{e.index.getFileInfo({filePath:n,success:s=>{const l=n.split(".").pop().toLowerCase();t({size:s.size,extension:l})},fail:s=>{e.index.__f__("error","at subPackages/friend/apply/index.vue:769","è·å–æ–‡ä»¶ä¿¡æ¯å¤±è´¥:",s);const l=n.split(".").pop().toLowerCase()||"jpg";t({size:0,extension:l})}})}),Y=n=>{e.index.previewImage({urls:v.value.map(t=>L.$imgBaseUrl+t),current:L.$imgBaseUrl+v.value[n],indicator:"number",loop:!0,show:!0,success:function(t){e.index.__f__("log","at subPackages/friend/apply/index.vue:790","å›¾ç‰‡é¢„è§ˆæˆåŠŸ",t)},fail:function(t){e.index.__f__("error","at subPackages/friend/apply/index.vue:793","å›¾ç‰‡é¢„è§ˆå¤±è´¥",t)}})},Z=n=>{v.value.splice(n,1)},ee=n=>{const t=n.id,a=m.value.indexOf(t);a>-1?m.value.splice(a,1):m.value.push(t),e.index.vibrateShort({type:"light"})},ae=()=>{_.value=!_.value,e.index.vibrateShort({type:"light"})},ne=()=>{e.index.navigateTo({url:"/subPackages/login/rz-agreement"})},te=async()=>{if(w.value)return;if(!_.value){e.index.showToast({title:"è¯·å…ˆåŒæ„å‹ä¼´æœåŠ¡åè®®",icon:"none",duration:2e3});return}if(!i.nickname.trim()){e.index.showToast({title:"è¯·è¾“å…¥æ˜µç§°",icon:"none"});return}if(i.nickname.length>50){e.index.showToast({title:"æ˜µç§°ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦",icon:"none"});return}if(!i.gender){e.index.showToast({title:"è¯·é€‰æ‹©æ€§åˆ«",icon:"none"});return}const n=parseInt(i.age),t=parseInt(i.height),a=parseInt(i.weight);if(!n||n<18||n>65){e.index.showToast({title:"å¹´é¾„å¿…é¡»åœ¨18-65å²ä¹‹é—´",icon:"none"});return}if(!t||t<100||t>250){e.index.showToast({title:"èº«é«˜å¿…é¡»åœ¨100-250cmä¹‹é—´",icon:"none"});return}if(!a||a<30||a>200){e.index.showToast({title:"è¯·è¾“å…¥åˆç†çš„ä½“é‡",icon:"none"});return}if(o.value.length===0){e.index.showToast({title:"è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæœåŠ¡åŒºåŸŸ",icon:"none"});return}if(v.value.length===0){e.index.showToast({title:"è¯·ä¸Šä¼ è‡³å°‘ä¸€å¼ ç”Ÿæ´»ç…§",icon:"none"});return}if(v.value.length>9){e.index.showToast({title:"æœ€å¤šåªèƒ½ä¸Šä¼ 9å¼ ç…§ç‰‡",icon:"none"});return}if(m.value.length===0){e.index.showToast({title:"è¯·è‡³å°‘é€‰æ‹©ä¸€é¡¹æœåŠ¡æŠ€èƒ½",icon:"none"});return}e.index.showModal({title:"ç¡®è®¤æäº¤",content:"ç¡®å®šè¦æäº¤å…¥é©»ç”³è¯·å—ï¼Ÿæäº¤åå°†è¿›å…¥å®¡æ ¸æµç¨‹ã€‚",success:async s=>{s.confirm&&await se()}})},se=async()=>{w.value=!0;try{const n=o.value.map(s=>{const l=h.value.find(r=>r.name===s);return l?String(l.code):null}).filter(s=>s!==null);if(n.length===0){e.index.showToast({title:"æœåŠ¡åŒºåŸŸæ•°æ®å¼‚å¸¸ï¼Œè¯·é‡æ–°é€‰æ‹©",icon:"none"});return}const t={nickname:i.nickname.trim(),gender:i.gender==="male"?"ç”·":"å¥³",age:parseInt(i.age),height:parseInt(i.height),weight:parseInt(i.weight),service_areas:n,services:m.value,can_accept_orders:"N",photos:v.value,tags:c.value.map(s=>s.tag_name),phone:j.userInfo.phone||""};e.index.__f__("log","at subPackages/friend/apply/index.vue:983","æäº¤æ•°æ®:",t);const a=await M.createCompanionApplication(t);if(e.index.__f__("log","at subPackages/friend/apply/index.vue:988","æ¥å£å“åº”:",a),a&&a.data&&a.data.code===0)e.index.showModal({title:"å…¥é©»æˆåŠŸ ğŸ‰",content:"æ­å–œæ‚¨ï¼å…¥é©»ç”³è¯·å·²é€šè¿‡ï¼Œæ‚¨å·²æˆåŠŸæˆä¸ºå‹ä¼´å¸ˆã€‚",showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",success:()=>{e.index.$emit("applicationStatusChanged",{status:"approved",message:"å…¥é©»ç”³è¯·å·²é€šè¿‡"}),e.index.navigateBack()}});else{const s=a&&a.data&&a.data.message||"æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";e.index.showModal({title:"æäº¤å¤±è´¥",content:s,showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†"})}}catch(n){e.index.__f__("error","at subPackages/friend/apply/index.vue:1025","æäº¤å¤±è´¥:",n);let t="æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";n&&n.message&&(n.message.includes("ç½‘ç»œ")?t="ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•":n.message.includes("å‚æ•°")?t="æäº¤ä¿¡æ¯æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•":n.message.includes("é‡å¤")?t="æ‚¨å·²æäº¤è¿‡ç”³è¯·ï¼Œè¯·å‹¿é‡å¤æäº¤":t=n.message),e.index.showModal({title:"æäº¤å¤±è´¥",content:t,showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†"})}finally{w.value=!1}};e.onMounted(async()=>{await V(),e.index.__f__("log","at subPackages/friend/apply/index.vue:1058","æ ‡ç­¾ç¼“å­˜é…ç½®:",{expireTime:`${O/1e3/60}åˆ†é’Ÿ`,cacheSize:$.value.size})});const ie=()=>{d.value=[...c.value],k.value=!0,F(4)},D=()=>{d.value=[],k.value=!1},le=n=>{z.value=n,F(n)},oe=n=>{const t=B.value.get(n);return t?Date.now()-t<O:!1},re=n=>$.value.get(n)||[],ue=(n,t)=>{$.value.set(n,t),B.value.set(n,Date.now()),e.index.__f__("log","at subPackages/friend/apply/index.vue:1106",`æ ‡ç­¾ç±»å‹${n}å·²ç¼“å­˜ï¼Œæ•°æ®é‡: ${t.length}`)},F=async(n,t=!1)=>{if(!t&&oe(n)){const a=re(n);if(a.length>0){e.index.__f__("log","at subPackages/friend/apply/index.vue:1131",`ä½¿ç”¨ç¼“å­˜æ•°æ® - æ ‡ç­¾ç±»å‹${n}ï¼Œæ•°æ®é‡: ${a.length}`),y.value=a;return}}g.value=!0;try{e.index.__f__("log","at subPackages/friend/apply/index.vue:1139",`å¼€å§‹åŠ è½½æ ‡ç­¾ç±»å‹: ${n}`);const a={tag_type:n,page:1,pageSize:60};e.index.__f__("log","at subPackages/friend/apply/index.vue:1147","è¯·æ±‚å‚æ•°:",a);const s=await M.getPersonalityTags(a);if(e.index.__f__("log","at subPackages/friend/apply/index.vue:1150","APIå“åº”:",s),s.data&&s.data.code===0&&s.data.data){const l=s.data.data.list||s.data.data;y.value=l,ue(n,l),e.index.__f__("log","at subPackages/friend/apply/index.vue:1160",`æ ‡ç­¾ç±»å‹${n}åŠ è½½æˆåŠŸ:`,l)}else e.index.__f__("warn","at subPackages/friend/apply/index.vue:1162",`è·å–æ ‡ç­¾ç±»å‹${n}å¤±è´¥ï¼Œå“åº”æ•°æ®:`,s),y.value=[]}catch(a){e.index.__f__("error","at subPackages/friend/apply/index.vue:1166",`è·å–æ ‡ç­¾ç±»å‹${n}å¤±è´¥:`,a),e.index.__f__("error","at subPackages/friend/apply/index.vue:1167","é”™è¯¯è¯¦æƒ…:",a.response||a),y.value=[]}finally{g.value=!1}},C=n=>d.value.some(t=>t.id===n),ce=n=>{const t=d.value.findIndex(a=>a.id===n.id);if(t>-1)d.value.splice(t,1);else{if(d.value.length>=5){e.index.showToast({title:"æœ€å¤šåªèƒ½é€‰æ‹©5ä¸ªæ ‡ç­¾",icon:"none"});return}d.value.push(n)}e.index.vibrateShort({type:"light"})},de=()=>{c.value=[...d.value],k.value=!1,d.value=[],e.index.showToast({title:`å·²é€‰æ‹©${c.value.length}ä¸ªæ ‡ç­¾`,icon:"success"})},ve=n=>{const t=c.value.findIndex(a=>a.id===n.id);t>-1&&(c.value.splice(t,1),e.index.vibrateShort({type:"light"}))};return(n,t)=>e.e({a:i.nickname,b:e.o(a=>i.nickname=a.detail.value),c:I._imports_4,d:i.gender==="male"?1:"",e:e.o(a=>A("male")),f:I._imports_3$2,g:i.gender==="female"?1:"",h:e.o(a=>A("female")),i:i.age,j:e.o(a=>i.age=a.detail.value),k:i.height,l:e.o(a=>i.height=a.detail.value),m:i.weight,n:e.o(a=>i.weight=a.detail.value),o:o.value.length===0},o.value.length===0?{}:{p:e.t(o.value.length)},{q:e.o(H),r:o.value.length>0},o.value.length>0?{s:e.f(o.value,(a,s,l)=>({a:e.t(a),b:a,c:e.o(r=>K(a),a)}))}:{},{t:e.f(v.value,(a,s,l)=>({a:n.$imgBaseUrl+a,b:e.o(r=>Z(s),s),c:s,d:e.o(r=>Y(s),s)})),v:v.value.length<6},v.value.length<6?{w:I._imports_0$5,x:e.o(W)}:{},{y:T.value},T.value?{}:o.value.length===0?{}:f.value.length>0?{B:e.f(f.value,(a,s,l)=>({a:e.t(a.name),b:e.f(a.services,(r,p,U)=>({a:e.t(r.name),b:m.value.includes(r.id)?1:"",c:r.id,d:e.o(S=>ee(r),r.id)})),c:a.id}))}:{},{z:o.value.length===0,A:f.value.length>0,C:c.value.length>0},c.value.length>0?{D:e.f(c.value,(a,s,l)=>({a:e.t(a.tag_name),b:a.id,c:e.o(r=>ve(a),a.id)}))}:{},{E:e.t(c.value.length),F:c.value.length>=5?1:"",G:e.o(a=>c.value.length<5?ie():null),H:_.value},_.value?{}:{},{I:_.value?1:"",J:e.o(ne),K:e.o(ae),L:!w.value},w.value?{}:{},{M:w.value||!_.value?1:"",N:e.o(te),O:b.value},b.value?e.e({P:e.o(q),Q:P.value},P.value?{}:{R:e.f(h.value,(a,s,l)=>e.e({a:e.t(a.name),b:u.value.includes(a.name)},u.value.includes(a.name)?{}:{},{c:s,d:e.n({active:u.value.includes(a.name)}),e:e.o(r=>J(a.name),s)}))},{S:e.t(u.value.length),T:e.o(Q),U:e.o(()=>{}),V:e.o(q)}):{},{W:k.value},k.value?e.e({X:e.o(D),Y:e.f(N.value,(a,s,l)=>({a:e.t(a.name),b:a.type,c:e.n({active:z.value===a.type}),d:e.o(r=>le(a.type),a.type)})),Z:!g.value&&d.value.length>=5},!g.value&&d.value.length>=5?{}:{},{aa:g.value},g.value?{}:{ab:e.f(y.value,(a,s,l)=>e.e({a:e.t(a.tag_name),b:C(a.id)},C(a.id)?{}:{},{c:a.id,d:e.n({selected:C(a.id)}),e:e.o(r=>ce(a),a.id)}))},{ac:!g.value&&y.value.length===0},!g.value&&y.value.length===0?{}:{},{ad:e.t(d.value.length),ae:e.o(de),af:e.o(()=>{}),ag:e.o(D)}):{})}},_e=e._export_sfc(pe,[["__scopeId","data-v-eb2c0b40"]]);wx.createPage(_e);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/subPackages/friend/apply/index.js.map
