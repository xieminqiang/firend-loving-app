"use strict";const e=require("../../../common/vendor.js"),F=require("../../../common/assets.js"),M=require("../../../api/user.js"),ve=require("../../../api/home.js"),E=require("../../../api/file.js"),fe=require("../../../stores/user.js"),O=5*60*1e3,ge={__name:"index",setup(he){const U=fe.useUserStore();e.ref(!1);const w=e.ref(!1),h=e.ref(!1),i=e.reactive({nickname:"",gender:"",age:"",height:"",weight:"",city:"æ·±åœ³å¸‚"}),b=e.ref(!1),o=e.ref([]),u=e.ref([]),_=e.ref([]),P=e.ref(!1),v=e.ref([]),x=e.ref([]),m=e.ref([]),T=e.ref(!1),f=e.ref([]),c=e.ref([]),k=e.ref(!1),d=e.ref([]),g=e.ref(!1),I=e.ref(4),y=e.ref([]),$=e.ref(new Map),L=e.ref(new Map),j=e.ref([{type:4,name:"ä¸ªæ€§ç‰¹è´¨"},{type:5,name:"æˆ‘çš„çˆ±å¥½"},{type:6,name:"å¤–è²Œé£æ ¼"},{type:7,name:"ä¸“ä¸šæŠ€èƒ½"},{type:8,name:"çƒ­é—¨æ¨è"}]),N=async()=>{if(o.value.length===0){x.value=[],f.value=[];return}T.value=!0;try{const n=o.value.map(a=>{const s=_.value.find(l=>l.name===a);return s?s.code:null}).filter(a=>a!==null);if(n.length===0){e.index.__f__("warn","at subPackages/friend/apply/index.vue:508","æœªæ‰¾åˆ°æœ‰æ•ˆçš„åŸå¸‚ä»£ç "),x.value=[],f.value=[];return}const t=await M.getServicesByCities(n);t.data&&t.data.code===0&&t.data.data?(x.value=t.data.data,R(),e.index.__f__("log","at subPackages/friend/apply/index.vue:522","æœåŠ¡æŠ€èƒ½åˆ—è¡¨åŠ è½½æˆåŠŸ:",x.value),e.index.__f__("log","at subPackages/friend/apply/index.vue:523","æœåŠ¡æŠ€èƒ½åˆ†ç»„:",f.value)):(e.index.__f__("warn","at subPackages/friend/apply/index.vue:525","è·å–æœåŠ¡æŠ€èƒ½åˆ—è¡¨å¤±è´¥"),x.value=[],f.value=[])}catch(n){e.index.__f__("error","at subPackages/friend/apply/index.vue:530","è·å–æœåŠ¡æŠ€èƒ½åˆ—è¡¨å¤±è´¥:",n),x.value=[],f.value=[]}finally{T.value=!1}},R=()=>{const n={};x.value.forEach(t=>{const a=t.category,s=t.category_name||"å…¶ä»–";n[a]||(n[a]={id:a,name:s,services:[]}),n[a].services.push(t)}),f.value=Object.values(n).sort((t,a)=>t.id-a.id)},G=async()=>{P.value=!0;try{const n=await ve.getCityList();n.data&&n.data.code===0&&n.data.data?(_.value=n.data.data.map(t=>({name:t.name,code:t.city_code})),e.index.__f__("log","at subPackages/friend/apply/index.vue:575","ç”³è¯·é¡µé¢åŒºåŸŸåˆ—è¡¨åŠ è½½æˆåŠŸ:",_.value)):(e.index.__f__("warn","at subPackages/friend/apply/index.vue:577","è·å–åŒºåŸŸåˆ—è¡¨å¤±è´¥"),_.value=[])}catch(n){e.index.__f__("error","at subPackages/friend/apply/index.vue:581","è·å–åŒºåŸŸåˆ—è¡¨å¤±è´¥:",n),_.value=[]}finally{P.value=!1}},z=n=>{i.gender=n},V=()=>{u.value=[...o.value],b.value=!0},A=()=>{u.value=[],b.value=!1},H=n=>{const t=u.value.indexOf(n);t>-1?u.value.splice(t,1):u.value.push(n),e.index.vibrateShort({type:"light"})},J=n=>{const t=o.value.indexOf(n);t>-1&&(o.value.splice(t,1),e.index.vibrateShort({type:"light"}))},K=async()=>{if(u.value.length===0){e.index.showToast({title:"è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæœåŠ¡åŒºåŸŸ",icon:"none"});return}o.value=[...u.value],i.city=o.value[0],b.value=!1,u.value=[],m.value=[],f.value=[],await N()},Q=()=>{const n=6-v.value.length;if(n<=0){e.index.showToast({title:"æœ€å¤šåªèƒ½ä¸Šä¼ 6å¼ ç…§ç‰‡",icon:"none"});return}e.index.chooseImage({count:n,sizeType:["compressed"],sourceType:["album","camera"],success:async t=>{e.index.showLoading({title:"ä¸Šä¼ ä¸­...",mask:!0});try{const a=t.tempFilePaths.map(async(l,r)=>{try{const p=await W(l);if(e.index.__f__("log","at subPackages/friend/apply/index.vue:696","fileInfo",p),e.index.__f__("log","at subPackages/friend/apply/index.vue:697","filePath",l),!p||!p.extension)throw new Error("æ— æ³•è·å–æ–‡ä»¶ä¿¡æ¯");const D=await E.uploadFile({filePath:l,name:`photo_${Date.now()}_${r}.${p.extension}`}),S=E.getUploadResult(D);if(!S||!S.url)throw new Error("ä¸Šä¼ ç»“æœè§£æå¤±è´¥");return S.url}catch(p){throw e.index.__f__("error","at subPackages/friend/apply/index.vue:716",`ç¬¬${r+1}å¼ ç…§ç‰‡ä¸Šä¼ å¤±è´¥:`,p),p}}),s=await Promise.all(a);v.value.push(...s),e.index.showToast({title:`æˆåŠŸä¸Šä¼ ${s.length}å¼ ç…§ç‰‡`,icon:"success"})}catch(a){e.index.__f__("error","at subPackages/friend/apply/index.vue:733","ç…§ç‰‡ä¸Šä¼ å¤±è´¥:",a),e.index.showToast({title:"ç…§ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}finally{e.index.hideLoading()}},fail:t=>{e.index.__f__("error","at subPackages/friend/apply/index.vue:743","é€‰æ‹©ç…§ç‰‡å¤±è´¥:",t),e.index.showToast({title:"é€‰æ‹©ç…§ç‰‡å¤±è´¥",icon:"none"})}})},W=n=>new Promise((t,a)=>{e.index.getFileInfo({filePath:n,success:s=>{const l=n.split(".").pop().toLowerCase();t({size:s.size,extension:l})},fail:s=>{e.index.__f__("error","at subPackages/friend/apply/index.vue:766","è·å–æ–‡ä»¶ä¿¡æ¯å¤±è´¥:",s);const l=n.split(".").pop().toLowerCase()||"jpg";t({size:0,extension:l})}})}),X=n=>{e.index.previewImage({urls:v.value,current:n})},Y=n=>{v.value.splice(n,1)},Z=n=>{const t=n.id,a=m.value.indexOf(t);a>-1?m.value.splice(a,1):m.value.push(t),e.index.vibrateShort({type:"light"})},ee=()=>{h.value=!h.value,e.index.vibrateShort({type:"light"})},ae=()=>{e.index.showToast({title:"åè®®åŠŸèƒ½å¾…å¼€å‘",icon:"none"})},ne=async()=>{if(w.value)return;if(!h.value){e.index.showToast({title:"è¯·å…ˆåŒæ„å‹ä¼´æœåŠ¡åè®®",icon:"none",duration:2e3});return}if(!i.nickname.trim()){e.index.showToast({title:"è¯·è¾“å…¥æ˜µç§°",icon:"none"});return}if(i.nickname.length>50){e.index.showToast({title:"æ˜µç§°ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦",icon:"none"});return}if(!i.gender){e.index.showToast({title:"è¯·é€‰æ‹©æ€§åˆ«",icon:"none"});return}const n=parseInt(i.age),t=parseInt(i.height),a=parseInt(i.weight);if(!n||n<18||n>65){e.index.showToast({title:"å¹´é¾„å¿…é¡»åœ¨18-65å²ä¹‹é—´",icon:"none"});return}if(!t||t<100||t>250){e.index.showToast({title:"èº«é«˜å¿…é¡»åœ¨100-250cmä¹‹é—´",icon:"none"});return}if(!a||a<30||a>200){e.index.showToast({title:"è¯·è¾“å…¥åˆç†çš„ä½“é‡",icon:"none"});return}if(o.value.length===0){e.index.showToast({title:"è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæœåŠ¡åŒºåŸŸ",icon:"none"});return}if(v.value.length===0){e.index.showToast({title:"è¯·ä¸Šä¼ è‡³å°‘ä¸€å¼ ç”Ÿæ´»ç…§",icon:"none"});return}if(v.value.length>9){e.index.showToast({title:"æœ€å¤šåªèƒ½ä¸Šä¼ 9å¼ ç…§ç‰‡",icon:"none"});return}if(m.value.length===0){e.index.showToast({title:"è¯·è‡³å°‘é€‰æ‹©ä¸€é¡¹æœåŠ¡æŠ€èƒ½",icon:"none"});return}e.index.showModal({title:"ç¡®è®¤æäº¤",content:"ç¡®å®šè¦æäº¤å…¥é©»ç”³è¯·å—ï¼Ÿæäº¤åå°†è¿›å…¥å®¡æ ¸æµç¨‹ã€‚",success:async s=>{s.confirm&&await te()}})},te=async()=>{w.value=!0;try{const n=o.value.map(s=>{const l=_.value.find(r=>r.name===s);return l?String(l.code):null}).filter(s=>s!==null);if(n.length===0){e.index.showToast({title:"æœåŠ¡åŒºåŸŸæ•°æ®å¼‚å¸¸ï¼Œè¯·é‡æ–°é€‰æ‹©",icon:"none"});return}const t={nickname:i.nickname.trim(),gender:i.gender==="male"?"ç”·":"å¥³",age:parseInt(i.age),height:parseInt(i.height),weight:parseInt(i.weight),service_areas:n,services:m.value,can_accept_orders:"N",photos:v.value,tags:c.value.map(s=>s.tag_name),phone:U.userInfo.phone||""};e.index.__f__("log","at subPackages/friend/apply/index.vue:972","æäº¤æ•°æ®:",t);const a=await M.createCompanionApplication(t);if(e.index.__f__("log","at subPackages/friend/apply/index.vue:977","æ¥å£å“åº”:",a),a&&a.data&&a.data.code===0)e.index.showModal({title:"å…¥é©»æˆåŠŸ ğŸ‰",content:"æ­å–œæ‚¨ï¼å…¥é©»ç”³è¯·å·²é€šè¿‡ï¼Œæ‚¨å·²æˆåŠŸæˆä¸ºå‹ä¼´å¸ˆã€‚",showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",success:()=>{e.index.$emit("applicationStatusChanged",{status:"approved",message:"å…¥é©»ç”³è¯·å·²é€šè¿‡"}),e.index.navigateBack()}});else{const s=a&&a.data&&a.data.message||"æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";e.index.showModal({title:"æäº¤å¤±è´¥",content:s,showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†"})}}catch(n){e.index.__f__("error","at subPackages/friend/apply/index.vue:1014","æäº¤å¤±è´¥:",n);let t="æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";n&&n.message&&(n.message.includes("ç½‘ç»œ")?t="ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•":n.message.includes("å‚æ•°")?t="æäº¤ä¿¡æ¯æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•":n.message.includes("é‡å¤")?t="æ‚¨å·²æäº¤è¿‡ç”³è¯·ï¼Œè¯·å‹¿é‡å¤æäº¤":t=n.message),e.index.showModal({title:"æäº¤å¤±è´¥",content:t,showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†"})}finally{w.value=!1}};e.onMounted(async()=>{await G(),e.index.__f__("log","at subPackages/friend/apply/index.vue:1047","æ ‡ç­¾ç¼“å­˜é…ç½®:",{expireTime:`${O/1e3/60}åˆ†é’Ÿ`,cacheSize:$.value.size})});const se=()=>{d.value=[...c.value],k.value=!0,B(4)},q=()=>{d.value=[],k.value=!1},ie=n=>{I.value=n,B(n)},le=n=>{const t=L.value.get(n);return t?Date.now()-t<O:!1},oe=n=>$.value.get(n)||[],re=(n,t)=>{$.value.set(n,t),L.value.set(n,Date.now()),e.index.__f__("log","at subPackages/friend/apply/index.vue:1095",`æ ‡ç­¾ç±»å‹${n}å·²ç¼“å­˜ï¼Œæ•°æ®é‡: ${t.length}`)},B=async(n,t=!1)=>{if(!t&&le(n)){const a=oe(n);if(a.length>0){e.index.__f__("log","at subPackages/friend/apply/index.vue:1120",`ä½¿ç”¨ç¼“å­˜æ•°æ® - æ ‡ç­¾ç±»å‹${n}ï¼Œæ•°æ®é‡: ${a.length}`),y.value=a;return}}g.value=!0;try{e.index.__f__("log","at subPackages/friend/apply/index.vue:1128",`å¼€å§‹åŠ è½½æ ‡ç­¾ç±»å‹: ${n}`);const a={tag_type:n,page:1,pageSize:60};e.index.__f__("log","at subPackages/friend/apply/index.vue:1136","è¯·æ±‚å‚æ•°:",a);const s=await M.getPersonalityTags(a);if(e.index.__f__("log","at subPackages/friend/apply/index.vue:1139","APIå“åº”:",s),s.data&&s.data.code===0&&s.data.data){const l=s.data.data.list||s.data.data;y.value=l,re(n,l),e.index.__f__("log","at subPackages/friend/apply/index.vue:1149",`æ ‡ç­¾ç±»å‹${n}åŠ è½½æˆåŠŸ:`,l)}else e.index.__f__("warn","at subPackages/friend/apply/index.vue:1151",`è·å–æ ‡ç­¾ç±»å‹${n}å¤±è´¥ï¼Œå“åº”æ•°æ®:`,s),y.value=[]}catch(a){e.index.__f__("error","at subPackages/friend/apply/index.vue:1155",`è·å–æ ‡ç­¾ç±»å‹${n}å¤±è´¥:`,a),e.index.__f__("error","at subPackages/friend/apply/index.vue:1156","é”™è¯¯è¯¦æƒ…:",a.response||a),y.value=[]}finally{g.value=!1}},C=n=>d.value.some(t=>t.id===n),ue=n=>{const t=d.value.findIndex(a=>a.id===n.id);if(t>-1)d.value.splice(t,1);else{if(d.value.length>=5){e.index.showToast({title:"æœ€å¤šåªèƒ½é€‰æ‹©5ä¸ªæ ‡ç­¾",icon:"none"});return}d.value.push(n)}e.index.vibrateShort({type:"light"})},ce=()=>{c.value=[...d.value],k.value=!1,d.value=[],e.index.showToast({title:`å·²é€‰æ‹©${c.value.length}ä¸ªæ ‡ç­¾`,icon:"success"})},de=n=>{const t=c.value.findIndex(a=>a.id===n.id);t>-1&&(c.value.splice(t,1),e.index.vibrateShort({type:"light"}))};return(n,t)=>e.e({a:i.nickname,b:e.o(a=>i.nickname=a.detail.value),c:F._imports_4$2,d:i.gender==="male"?1:"",e:e.o(a=>z("male")),f:F._imports_3$2,g:i.gender==="female"?1:"",h:e.o(a=>z("female")),i:i.age,j:e.o(a=>i.age=a.detail.value),k:i.height,l:e.o(a=>i.height=a.detail.value),m:i.weight,n:e.o(a=>i.weight=a.detail.value),o:o.value.length===0},o.value.length===0?{}:{p:e.t(o.value.length)},{q:e.o(V),r:o.value.length>0},o.value.length>0?{s:e.f(o.value,(a,s,l)=>({a:e.t(a),b:a,c:e.o(r=>J(a),a)}))}:{},{t:e.f(v.value,(a,s,l)=>({a:n.$imgBaseUrl+a,b:e.o(r=>Y(s),s),c:s,d:e.o(r=>X(s),s)})),v:v.value.length<6},v.value.length<6?{w:e.o(Q)}:{},{x:T.value},T.value?{}:o.value.length===0?{}:f.value.length>0?{A:e.f(f.value,(a,s,l)=>({a:e.t(a.name),b:e.f(a.services,(r,p,D)=>({a:e.t(r.name),b:m.value.includes(r.id)?1:"",c:r.id,d:e.o(S=>Z(r),r.id)})),c:a.id}))}:{},{y:o.value.length===0,z:f.value.length>0,B:c.value.length>0},c.value.length>0?{C:e.f(c.value,(a,s,l)=>({a:e.t(a.tag_name),b:a.id,c:e.o(r=>de(a),a.id)}))}:{},{D:e.t(c.value.length),E:c.value.length>=5?1:"",F:e.o(a=>c.value.length<5?se():null),G:h.value},h.value?{}:{},{H:h.value?1:"",I:e.o(ae),J:e.o(ee),K:!w.value},w.value?{}:{},{L:w.value||!h.value?1:"",M:e.o(ne),N:b.value},b.value?e.e({O:e.o(A),P:P.value},P.value?{}:{Q:e.f(_.value,(a,s,l)=>e.e({a:e.t(a.name),b:u.value.includes(a.name)},u.value.includes(a.name)?{}:{},{c:s,d:e.n({active:u.value.includes(a.name)}),e:e.o(r=>H(a.name),s)}))},{R:e.t(u.value.length),S:e.o(K),T:e.o(()=>{}),U:e.o(A)}):{},{V:k.value},k.value?e.e({W:e.o(q),X:e.f(j.value,(a,s,l)=>({a:e.t(a.name),b:a.type,c:e.n({active:I.value===a.type}),d:e.o(r=>ie(a.type),a.type)})),Y:!g.value&&d.value.length>=5},!g.value&&d.value.length>=5?{}:{},{Z:g.value},g.value?{}:{aa:e.f(y.value,(a,s,l)=>e.e({a:e.t(a.tag_name),b:C(a.id)},C(a.id)?{}:{},{c:a.id,d:e.n({selected:C(a.id)}),e:e.o(r=>ue(a),a.id)}))},{ab:!g.value&&y.value.length===0},!g.value&&y.value.length===0?{}:{},{ac:e.t(d.value.length),ad:e.o(ce),ae:e.o(()=>{}),af:e.o(q)}):{})}},pe=e._export_sfc(ge,[["__scopeId","data-v-eb2c0b40"]]);wx.createPage(pe);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/subPackages/friend/apply/index.js.map
