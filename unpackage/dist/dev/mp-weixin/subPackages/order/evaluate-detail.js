"use strict";const e=require("../../common/vendor.js"),l=require("../../api/order.js"),y={__name:"evaluate-detail",setup(k){const{proxy:c}=e.getCurrentInstance(),s=e.ref(""),i=e.ref({}),a=e.ref({rating:0,comment:"",comment_images:[],created_at:"",is_anonymous:!1});e.onLoad(t=>{t.orderId&&(s.value=t.orderId,d(),g())});const d=async()=>{try{e.index.showLoading({title:"加载中..."});const t=await l.getOrderDetail({order_id:Number(s.value)});if(t.data.code===0){const o=t.data.data.order;i.value={service_name:o.service_name,service_image:o.service_image_url,unit_price:o.unit_price,unit:o.unit,quantity:o.quantity,total_amount:o.total_amount},e.index.__f__("log","at subPackages/order/evaluate-detail.vue:209","订单详情加载成功:",o)}else throw new Error(t.data.msg||"获取订单详情失败")}catch(t){e.index.__f__("error","at subPackages/order/evaluate-detail.vue:217","加载订单详情失败:",t),e.index.showToast({title:t.message||"加载失败",icon:"none"})}finally{e.index.hideLoading()}},g=async()=>{try{const t=await l.getOrderCommentList({order_id:Number(s.value)});if(t.data.code===0){const o=t.data.data.list||[],n=o.find(m=>m.is_companion===0),r=o.find(m=>m.is_companion===1);n&&(a.value={rating:n.rating||5,comment:n.comment||"",comment_images:n.comment_images||[],created_at:n.comment_time||n.updated_at||"",is_anonymous:n.is_anonymous===1,user_nickname:n.user_nickname||n.user_name||"用户",user_avatar:n.head_image||""}),r&&(a.value.companion_reply={comment:r.comment||"",comment_images:r.comment_images||[],created_at:r.comment_time||r.updated_at||"",companion_nickname:r.user_nickname||r.user_name||"友伴师",companion_avatar:r.companion_img||""}),e.index.__f__("log","at subPackages/order/evaluate-detail.vue:262","评价列表加载成功:",o),e.index.__f__("log","at subPackages/order/evaluate-detail.vue:263","处理后的评价信息:",a.value)}else e.index.__f__("warn","at subPackages/order/evaluate-detail.vue:265","获取评价列表失败:",t.data.message)}catch(t){e.index.__f__("error","at subPackages/order/evaluate-detail.vue:268","加载评价列表失败:",t)}},v=t=>{e.index.__f__("log","at subPackages/order/evaluate-detail.vue:274","commentInfo.value.comment_images",a.value.comment_images);const o=a.value.comment_images.map(n=>c.$imgBaseUrl+n);e.index.previewImage({urls:o,current:t})},p=t=>{const o=a.value.companion_reply.comment_images.map(n=>c.$imgBaseUrl+n);e.index.previewImage({urls:o,current:t})},_=t=>{if(!t)return"未知时间";const o=new Date(t),n=o.getFullYear(),r=String(o.getMonth()+1).padStart(2,"0"),m=String(o.getDate()).padStart(2,"0"),u=String(o.getHours()).padStart(2,"0"),f=String(o.getMinutes()).padStart(2,"0");return`${n}-${r}-${m} ${u}:${f}`};return(t,o)=>e.e({a:e.unref(c).$imgBaseUrl+i.value.service_image,b:e.t(i.value.service_name),c:e.t(i.value.unit_price),d:e.t(i.value.unit),e:e.t(i.value.quantity),f:e.t(i.value.total_amount),g:e.f(5,(n,r,m)=>({a:n,b:n<=a.value.rating?1:""})),h:e.t(a.value.rating),i:e.t(a.value.comment||"暂无评价内容"),j:a.value.comment_images&&a.value.comment_images.length>0},a.value.comment_images&&a.value.comment_images.length>0?{k:e.f(a.value.comment_images,(n,r,m)=>({a:e.unref(c).$imgBaseUrl+n,b:r,c:e.o(u=>v(r),r)}))}:{},{l:e.t(_(a.value.created_at)),m:a.value.is_anonymous},a.value.is_anonymous?{}:{},{n:a.value.companion_reply},a.value.companion_reply?e.e({o:e.unref(c).$imgBaseUrl+a.value.companion_reply.companion_avatar,p:e.t(a.value.companion_reply.companion_nickname),q:e.t(_(a.value.companion_reply.created_at)),r:e.t(a.value.companion_reply.comment),s:a.value.companion_reply.comment_images&&a.value.companion_reply.comment_images.length>0},a.value.companion_reply.comment_images&&a.value.companion_reply.comment_images.length>0?{t:e.f(a.value.companion_reply.comment_images,(n,r,m)=>({a:e.unref(c).$imgBaseUrl+n,b:r,c:e.o(u=>p(r),r)}))}:{}):{})}},h=e._export_sfc(y,[["__scopeId","data-v-29943a6c"]]);wx.createPage(h);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/subPackages/order/evaluate-detail.js.map
