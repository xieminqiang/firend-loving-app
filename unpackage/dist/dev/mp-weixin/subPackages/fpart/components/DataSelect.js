"use strict";const e=require("../../../common/vendor.js"),g=require("../../../api/user.js"),W={__name:"DataSelect",setup(H){const d=e.ref(null),y=e.ref(!0),c=e.ref(0),l=e.ref([]),r=e.ref(0),_=e.ref([]),v=e.ref([{key:"monday",name:"周一"},{key:"tuesday",name:"周二"},{key:"wednesday",name:"周三"},{key:"thursday",name:"周四"},{key:"friday",name:"周五"},{key:"saturday",name:"周六"},{key:"sunday",name:"周日"}]),p=()=>{const t=getCurrentPages(),a=t[t.length-1].options;a.companion_id?(d.value=parseInt(a.companion_id),e.index.__f__("log","at subPackages/fpart/components/DataSelect.vue:107","获取到companion_id:",d.value)):(e.index.__f__("error","at subPackages/fpart/components/DataSelect.vue:109","未获取到companion_id参数"),e.index.showToast({title:"参数错误",icon:"none"}))},h=async()=>{var t;if(!d.value){e.index.__f__("error","at subPackages/fpart/components/DataSelect.vue:120","companion_id为空，无法调用接口");return}try{e.index.__f__("log","at subPackages/fpart/components/DataSelect.vue:125","开始调用getCompanionSchedule接口，companion_id:",d.value);let n={companion_id:d.value};e.index.__f__("log","at subPackages/fpart/components/DataSelect.vue:130","obj:",n);const a=await g.getCompanionSchedule(n);e.index.__f__("log","at subPackages/fpart/components/DataSelect.vue:132","接口调用成功:",a),a.data&&a.data.code===0?(l.value=a.data.data,_.value=JSON.parse(JSON.stringify(a.data.data)),e.index.__f__("log","at subPackages/fpart/components/DataSelect.vue:138","解析后的数据:",l.value),m()):e.index.showToast({title:((t=a.data)==null?void 0:t.msg)||"获取数据失败",icon:"none"})}catch(n){e.index.__f__("error","at subPackages/fpart/components/DataSelect.vue:149","接口调用失败:",n),e.index.showToast({title:"网络错误",icon:"none"})}finally{y.value=!1}},m=()=>{const t=l.value.find(n=>n.is_today===!0);t?(c.value=t.day_of_week-1,e.index.__f__("log","at subPackages/fpart/components/DataSelect.vue:167","设置为今天:",t.day_of_week,"选中索引:",c.value)):(c.value=0,e.index.__f__("log","at subPackages/fpart/components/DataSelect.vue:171","未找到今天数据，默认选中周一"))},k=t=>{c.value!==t&&D(),c.value=t},D=()=>{const t=c.value+1,n=_.value.find(o=>o.day_of_week===t),a=l.value.find(o=>o.day_of_week===t);n&&a&&(a.schedule=JSON.parse(JSON.stringify(n.schedule)),e.index.__f__("log","at subPackages/fpart/components/DataSelect.vue:193","重置星期数据:",t,"为原始状态"))},S=t=>{const n=t+1,a=l.value.find(o=>o.day_of_week===n);return a?a.is_today:!1},x=()=>v.value[c.value].name,b=()=>{const t=c.value+1,n=l.value.find(a=>a.day_of_week===t);return n?n.schedule:{}},w=t=>{const n=t+1,a=l.value.find(f=>f.day_of_week===n);if(!a)return"未设置";const o=a.schedule,i=Object.values(o).filter(f=>f===1).length,s=Object.values(o).filter(f=>f===3).length;let u="";return s>0?u=`${s}个已约`:i===48?u="全天可约":i===0?u="全天休息":u=`${i}个可约`,a.is_today&&(u=u),u},P=t=>{switch(t){case 1:return"available";case 2:return"unavailable";case 3:return"booked";default:return"unavailable"}},O=t=>{switch(t){case 1:return"可约";case 2:return"休息";case 3:return"已约";default:return"休息"}},T=t=>{const n=c.value+1,a=l.value.find(i=>i.day_of_week===n);if(!a)return;const o=a.schedule[t];if(o===3){e.index.showToast({title:"已约时间段不能修改",icon:"none"});return}a.schedule[t]=o===1?2:1},C=()=>{const t=c.value+1,n=l.value.find(a=>a.day_of_week===t);n&&Object.keys(n.schedule).forEach(a=>{n.schedule[a]!==3&&(n.schedule[a]=1)})},N=()=>{const t=c.value+1,n=l.value.find(a=>a.day_of_week===t);n&&Object.keys(n.schedule).forEach(a=>{n.schedule[a]!==3&&(n.schedule[a]=2)})},I=async()=>{var i;if(!d.value){e.index.showToast({title:"用户信息不完整",icon:"none"});return}const t=c.value+1,n=l.value.find(s=>s.day_of_week===t);if(!n){e.index.showToast({title:"未找到当前星期的数据",icon:"none"});return}const a=_.value.find(s=>s.day_of_week===t);if(a&&JSON.stringify(a.schedule)===JSON.stringify(n.schedule)){e.index.showToast({title:"没有修改内容",icon:"none"});return}const o={companion_id:d.value,day_of_week:t,schedule:n.schedule};e.index.__f__("log","at subPackages/fpart/components/DataSelect.vue:354","准备保存的数据:",o);try{e.index.showLoading({title:"保存中..."});const s=await g.saveCompanionSchedule(o);if(e.index.hideLoading(),s.data&&s.data.code===0){const u=_.value.findIndex(f=>f.day_of_week===t);u!==-1&&(_.value[u]=JSON.parse(JSON.stringify(n))),e.index.showToast({title:"保存成功",icon:"success"}),e.index.__f__("log","at subPackages/fpart/components/DataSelect.vue:376","保存成功:",s.data),e.index.$emit("scheduleDataUpdated",{companion_id:d.value,day_of_week:t,schedule:n.schedule})}else e.index.showToast({title:((i=s.data)==null?void 0:i.msg)||"保存失败",icon:"none"}),e.index.__f__("error","at subPackages/fpart/components/DataSelect.vue:389","保存失败:",s.data)}catch(s){e.index.hideLoading(),e.index.showToast({title:"网络错误，请重试",icon:"none"}),e.index.__f__("error","at subPackages/fpart/components/DataSelect.vue:397","保存接口调用失败:",s)}},J=()=>{const n=e.index.getSystemInfoSync().windowHeight;r.value=n-10,e.index.__f__("log","at subPackages/fpart/components/DataSelect.vue:411","timeGridHeight.value:",r.value),e.index.createSelectorQuery().select(".time-grid-header").boundingClientRect(a=>{a&&(r.value=r.value-a.bottom)}).exec(),e.index.createSelectorQuery().select(".bottom-fixed").boundingClientRect(a=>{a&&(e.index.__f__("log","at subPackages/fpart/components/DataSelect.vue:426","rect:",a.height),r.value=r.value-a.height)}).exec()};return e.onMounted(()=>{e.index.__f__("log","at subPackages/fpart/components/DataSelect.vue:438","DataSelect组件mounted"),p(),h(),J()}),(t,n)=>({a:e.f(v.value,(a,o,i)=>({a:e.t(a.name),b:e.t(w(o)),c:a.key,d:c.value===o?1:"",e:S(o)?1:"",f:e.o(s=>k(o),a.key)})),b:e.t(x()),c:e.o(C),d:e.o(N),e:e.f(b(),(a,o,i)=>({a:e.t(o),b:e.t(O(a)),c:o,d:e.n(P(a)),e:e.o(s=>T(o),o)})),f:r.value+"px",g:e.o(I)})}},j=e._export_sfc(W,[["__scopeId","data-v-2c55f86f"]]);wx.createPage(j);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/subPackages/fpart/components/DataSelect.js.map
