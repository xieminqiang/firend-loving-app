"use strict";const e=require("../../../common/vendor.js"),k=require("../../../api/user.js"),m=require("../../../api/file.js"),y={__name:"VideoUploadModal",props:{show:{type:Boolean,default:!1},applicationInfo:{type:Object,default:null}},emits:["close","success"],setup(t,{emit:h}){const i=t,f=h,n=e.ref(""),s=e.ref(!1),d=e.ref(0);e.watch(()=>i.show,o=>{var a;o&&i.applicationInfo&&i.applicationInfo.intro_video_url?n.value=i.applicationInfo.intro_video_url:o||((a=i.applicationInfo)!=null&&a.intro_video_url||(n.value=""),s.value=!1,d.value=0)});const w=()=>{l()},l=()=>{f("close")},v=()=>{n.value="",e.index.chooseVideo({count:1,sizeType:["compressed"],sourceType:["album","camera"],maxDuration:60,camera:"back",success:async o=>{const a=o.tempFilePath,u=o.duration,r=o.size;if(u<3||u>60){e.index.showToast({title:"视频时长必须在3-60秒之间",icon:"none"});return}if(r>500*1024*1024){e.index.showToast({title:"视频文件大小不能超过500MB",icon:"none"});return}e.index.showLoading({title:"上传中...",mask:!0});try{const c=await x(a),T=await m.uploadFile({filePath:a,name:`intro_video_${Date.now()}.${c.extension}`}),p=m.getUploadResult(T);if(!p||!p.url)throw new Error("上传结果解析失败");n.value=p.url,e.index.hideLoading()}catch(c){e.index.hideLoading(),e.index.__f__("error","at subPackages/fpart/components/VideoUploadModal.vue:204","视频上传失败:",c),e.index.showToast({title:"上传失败，请重试",icon:"none"})}},fail:o=>{e.index.__f__("error","at subPackages/fpart/components/VideoUploadModal.vue:212","选择视频失败:",o),o.errMsg&&!o.errMsg.includes("cancel")&&e.index.showToast({title:"选择视频失败",icon:"none"})}})},g=async()=>{if(!n.value){e.index.showToast({title:"请先选择视频",icon:"none"});return}if(!s.value)try{e.index.showLoading({title:"提交审核中..."});let o=n.value;const a=await k.uploadCompanionVideo({intro_video_url:o});e.index.hideLoading(),e.index.showToast({title:"视频提交成功，等待审核",icon:"success"}),l(),f("success",{type:"video_uploaded",message:"视频已提交审核"})}catch(o){e.index.hideLoading(),e.index.__f__("error","at subPackages/fpart/components/VideoUploadModal.vue:266","提交视频失败:",o),o.data||e.index.showToast({title:"提交失败，请重试",icon:"none"})}},x=o=>new Promise((a,u)=>{e.index.getFileInfo({filePath:o,success:r=>{const c=o.split(".").pop().toLowerCase();a({size:r.size,extension:c})},fail:r=>{e.index.__f__("error","at subPackages/fpart/components/VideoUploadModal.vue:291","获取文件信息失败:",r);const c=o.split(".").pop().toLowerCase()||"mp4";a({size:0,extension:c})}})}),_=o=>{switch(o){case"pending":return"待审核";case"approved":return"已通过";case"rejected":return"已拒绝";default:return"未知状态"}},I=o=>{switch(o){case"pending":return"您的视频正在审核中，请耐心等待";case"approved":return"视频审核已通过，可以正常上线接单";case"rejected":return i.applicationInfo.remark!=""?"原因："+i.applicationInfo.remark:"视频审核未通过，请重新上传";default:return"请上传自我介绍视频"}},b=o=>{switch(o){case"pending":return"status-pending";case"approved":return"status-approved";case"rejected":return"status-rejected";default:return""}};return(o,a)=>e.e({a:t.show},t.show?e.e({b:e.o(l),c:t.applicationInfo&&t.applicationInfo.intro_video_url},t.applicationInfo&&t.applicationInfo.intro_video_url?{d:e.t(_(t.applicationInfo.video_review_status)),e:e.n(b(t.applicationInfo.video_review_status)),f:e.t(I(t.applicationInfo.video_review_status))}:{},{g:n.value&&n.value!=""},n.value&&n.value!=""?{h:o.$imgBaseUrl+n.value,i:e.o(v)}:{j:e.o(v)},{k:s.value},s.value?{l:d.value+"%",m:e.t(d.value)}:{},{n:e.o(l),o:t.applicationInfo&&t.applicationInfo.intro_video_url},t.applicationInfo&&t.applicationInfo.intro_video_url?{p:e.t(s.value?"上传中...":"重新提交")}:{q:e.t(s.value?"上传中...":"提交审核")},{r:!n.value||s.value?1:"",s:e.o(g),t:e.o(()=>{}),v:e.o(w)}):{})}},U=e._export_sfc(y,[["__scopeId","data-v-39b3bd17"]]);wx.createComponent(U);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/subPackages/fpart/components/VideoUploadModal.js.map
