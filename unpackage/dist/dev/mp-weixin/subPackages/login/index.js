"use strict";const e=require("../../common/vendor.js"),h=require("../../common/assets.js"),y=require("../../api/user.js"),P=require("../../stores/user.js"),b=require("../../stores/level.js");Array||e.resolveComponent("uni-popup")();const w=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||w();const k={__name:"index",setup(r){const u=P.useUserStore(),d=b.useLevelStore(),n=e.ref(null),l=e.ref(!0),p=e.ref(!1);e.onLoad(async()=>{const o=e.index.getSystemInfoSync();e.index.__f__("log","at subPackages/login/index.vue:93","系统信息:",o),setTimeout(()=>{n.value&&n.value.open()},500)});const i=()=>{e.index.navigateBack({delta:1})},_=()=>{n.value.close(),setTimeout(()=>{i()},300)},g=()=>{p.value=!0,n.value.close()},m=o=>{l.value=o.show},f=()=>{e.index.navigateTo({url:"/subPackages/login/agreement"})},x=()=>{e.index.navigateTo({url:"/subPackages/login/policy"})},v=async o=>{var c;e.index.__f__("log","at subPackages/login/index.vue:153","getPhoneNumber event:",o);const a=o.detail;if(!a.code){e.index.showToast({title:"授权失败，请重试",icon:"none"});return}try{const t=await e.index.login({provider:"weixin"});e.index.showLoading({title:"登录中...",mask:!0});const s=await y.wxLogin({login_code:t.code,phone_code:a.code});e.index.hideLoading(),s.data&&s.data.code===0?(u.setUserInfo(s.data.data.token),d.clearServiceLevels(),e.index.$emit("loginSuccess",{userInfo:s.data.data}),e.index.showToast({title:"登录成功",icon:"success"}),setTimeout(()=>{e.index.navigateBack({delta:1})},1500)):e.index.showToast({title:((c=s.data)==null?void 0:c.msg)||"登录失败",icon:"none"})}catch(t){e.index.hideLoading(),e.index.__f__("error","at subPackages/login/index.vue:223","登录失败:",t),e.index.showToast({title:"登录失败，请重试",icon:"none"})}};return(o,a)=>({a:h._imports_0$3,b:e.o(i),c:o.$imgBaseUrl+"/img/20250812/fa380b9964f9fabea946752d163ad1a1/c2bde904-004a-414d-84eb-a95da538b9f7.png",d:e.o(v),e:e.o(f),f:e.o(x),g:e.o(_),h:e.o(g),i:e.sr(n,"a7cd18e8-0",{k:"popup"}),j:e.o(m),k:e.p({safeArea:!1,type:"center"})})}},T=e._export_sfc(k,[["__scopeId","data-v-a7cd18e8"]]);wx.createPage(T);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/subPackages/login/index.js.map
