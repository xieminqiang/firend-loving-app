"use strict";const e=require("../../common/vendor.js"),f=require("../../api/user.js"),h=require("../../stores/user.js"),y=require("../../stores/level.js");Array||e.resolveComponent("uni-popup")();const P=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||P();const k={__name:"index",setup(r){const i=h.useUserStore(),u=y.useLevelStore(),s=e.ref(null),d=e.ref(!0),l=e.ref(!1);e.onLoad(async()=>{const o=e.index.getSystemInfoSync();e.index.__f__("log","at subPackages/login/index.vue:67","系统信息:",o),setTimeout(()=>{s.value&&s.value.open()},500)});const p=()=>{s.value.close(),setTimeout(()=>{e.index.navigateBack({delta:1})},300)},_=()=>{l.value=!0,s.value.close()},g=o=>{d.value=o.show},m=()=>{e.index.navigateTo({url:"/subPackages/login/agreement"})},x=()=>{e.index.navigateTo({url:"/subPackages/login/policy"})},v=async o=>{var c;e.index.__f__("log","at subPackages/login/index.vue:123","getPhoneNumber event:",o);const t=o.detail;if(!t.code){e.index.showToast({title:"授权失败，请重试",icon:"none"});return}try{const a=await e.index.login({provider:"weixin"});e.index.showLoading({title:"登录中...",mask:!0});const n=await f.wxLogin({login_code:a.code,phone_code:t.code});e.index.hideLoading(),n.data&&n.data.code===0?(i.setUserInfo(n.data.data.token),i.setToken(n.data.data.token.access_token),u.clearServiceLevels(),e.index.$emit("loginSuccess",{userInfo:n.data.data}),e.index.showToast({title:"登录成功",icon:"success"}),setTimeout(()=>{e.index.navigateBack({delta:1})},1500)):e.index.showToast({title:((c=n.data)==null?void 0:c.msg)||"登录失败",icon:"none"})}catch(a){e.index.hideLoading(),e.index.__f__("error","at subPackages/login/index.vue:199","登录失败:",a),e.index.showToast({title:"登录失败，请重试",icon:"none"})}};return(o,t)=>({a:o.$imgBaseUrl+"/img/cum/logo_small_01.jpeg",b:e.o(v),c:e.o(m),d:e.o(x),e:e.o(p),f:e.o(_),g:e.sr(s,"a7cd18e8-0",{k:"popup"}),h:e.o(g),i:e.p({safeArea:!1,type:"center"})})}},w=e._export_sfc(k,[["__scopeId","data-v-a7cd18e8"]]);wx.createPage(w);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/subPackages/login/index.js.map
