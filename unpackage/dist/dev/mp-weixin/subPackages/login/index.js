"use strict";const e=require("../../common/vendor.js"),h=require("../../common/assets.js"),k=require("../../api/user.js"),y=require("../../stores/user.js"),P=require("../../stores/level.js");Array||e.resolveComponent("uni-popup")();const w=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||w();const T={__name:"index",setup(u){const i=y.useUserStore(),d=P.useLevelStore(),s=e.ref(null),l=e.ref(!0),p=e.ref(!1);e.onLoad(async()=>{const o=e.index.getSystemInfoSync();e.index.__f__("log","at subPackages/login/index.vue:93","系统信息:",o),setTimeout(()=>{s.value&&s.value.open()},500)});const c=()=>{e.index.navigateBack({delta:1})},_=()=>{s.value.close(),setTimeout(()=>{c()},300)},g=()=>{p.value=!0,s.value.close()},m=o=>{l.value=o.show},x=()=>{e.index.navigateTo({url:"/subPackages/login/agreement"})},v=()=>{e.index.navigateTo({url:"/subPackages/login/policy"})},f=async o=>{var r;e.index.__f__("log","at subPackages/login/index.vue:153","getPhoneNumber event:",o);const t=o.detail;if(!t.code){e.index.showToast({title:"授权失败，请重试",icon:"none"});return}try{const a=await e.index.login({provider:"weixin"});e.index.showLoading({title:"登录中...",mask:!0});const n=await k.wxLogin({login_code:a.code,phone_code:t.code});e.index.hideLoading(),n.data&&n.data.code===0?(i.setUserInfo(n.data.data.token),i.setToken(n.data.data.token.access_token),d.clearServiceLevels(),e.index.$emit("loginSuccess",{userInfo:n.data.data}),e.index.showToast({title:"登录成功",icon:"success"}),setTimeout(()=>{e.index.navigateBack({delta:1})},1500)):e.index.showToast({title:((r=n.data)==null?void 0:r.msg)||"登录失败",icon:"none"})}catch(a){e.index.hideLoading(),e.index.__f__("error","at subPackages/login/index.vue:229","登录失败:",a),e.index.showToast({title:"登录失败，请重试",icon:"none"})}};return(o,t)=>({a:h._imports_0,b:e.o(c),c:o.$imgBaseUrl+"/img/cum/logo_small.jpeg",d:e.o(f),e:e.o(x),f:e.o(v),g:e.o(_),h:e.o(g),i:e.sr(s,"a7cd18e8-0",{k:"popup"}),j:e.o(m),k:e.p({safeArea:!1,type:"center"})})}},b=e._export_sfc(T,[["__scopeId","data-v-a7cd18e8"]]);wx.createPage(b);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/subPackages/login/index.js.map
