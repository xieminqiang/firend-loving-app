"use strict";const a=require("../../common/vendor.js"),p=require("../../common/assets.js"),g=require("../../api/user.js"),x=require("../../api/order.js");if(!Array){const i=a.resolveComponent("u-button"),o=a.resolveComponent("u-modal");(i+o)()}const B=()=>"../../uni_modules/uview-plus/components/u-button/u-button.js",F=()=>"../../uni_modules/uview-plus/components/u-modal/u-modal.js";Math||(B+F)();const y={__name:"Withdraw",setup(i){const o=a.ref(""),s=a.ref(!1),u=a.ref({balance:0,available_balance:0,frozen_balance:0}),r=a.ref(!1),f=()=>{s.value=!0},h=()=>{s.value=!1},l=async()=>{try{const e=await x.getCompanionBalanceDetail({});e.data&&e.data.code===0&&(u.value=e.data.data||{balance:0,available_balance:0,frozen_balance:0})}catch(e){a.index.__f__("error","at subPackages/balance/Withdraw.vue:106","获取余额详情失败:",e)}},m=async()=>{const e=parseFloat(o.value);if(!e||e<=0){a.index.showToast({title:"请输入有效的提现金额",icon:"none"});return}const t=u.value.available_balance/100;if(e>t){a.index.showToast({title:`提现金额不能超过可用余额${d(u.value.available_balance)}元`,icon:"none"});return}try{a.index.showLoading({title:"提现中..."});const n=Math.round(e*100),c=await g.companionWithdraw({withdraw_amount:n});a.index.hideLoading(),c.data&&c.data.code===0?(a.index.showToast({title:"提现申请成功",icon:"success"}),o.value="",await l(),v(c.data)):a.index.showToast({title:c.message||"提现失败",icon:"none"})}catch(n){a.index.hideLoading(),a.index.__f__("error","at subPackages/balance/Withdraw.vue:170","提现失败:",n)}},v=e=>{a.wx$1.canIUse("requestMerchantTransfer")?a.wx$1.requestMerchantTransfer({mchId:"1724024386",appId:a.wx$1.getAccountInfoSync().miniProgram.appId,package:e.data.wx_package_info,success:t=>{a.index.__f__("log","at subPackages/balance/Withdraw.vue:190","微信转账成功:",t),r.value=!0},fail:t=>{a.index.__f__("log","at subPackages/balance/Withdraw.vue:195","微信转账失败:",t),a.index.$emit("refreshPendingWithdrawList"),a.index.navigateBack({delta:1})}}):a.wx$1.showModal({content:"你的微信版本过低，请更新至最新版本。",showCancel:!1})},d=e=>{if(!e&&e!==0)return"0.00";e.toString();const t=Math.floor(e/100),n=e%100;return n===0?t+".00":n<10?t+".0"+n:t+"."+n},w=()=>{const e=u.value.available_balance/100;o.value=e.toFixed(2)},_=()=>{r.value=!1,setTimeout(()=>{a.index.navigateBack({delta:1})},1e3)},b=()=>{a.index.navigateTo({url:"/subPackages/balance/record"})};return a.onMounted(()=>{l(),setTimeout(()=>{s.value=!0},300)}),(e,t)=>({a:p._imports_0$10,b:a.o(b),c:s.value,d:a.o(f),e:a.o(h),f:o.value,g:a.o(n=>o.value=n.detail.value),h:a.t(d(u.value.available_balance)),i:a.o(w),j:a.o(m),k:a.o(_),l:a.p({text:"确定",type:"success",shape:"circle"}),m:a.o(_),n:a.p({title:"提现已提交成功",show:r.value,content:"您的提现请求已成功提交。提现状态会在后台处理后更新，请稍后查看账户余额或联系客服确认。",closeOnClickOverlay:!0,showCancelButton:!0})})}},A=a._export_sfc(y,[["__scopeId","data-v-6c0fa363"]]);wx.createPage(A);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/subPackages/balance/Withdraw.js.map
