"use strict";const e=require("../../../common/vendor.js"),I=require("../../../common/assets.js"),M=require("../../../api/user.js"),ge=require("../../../api/home.js"),E=require("../../../api/file.js"),pe=require("../../../stores/user.js"),O=5*60*1e3,fe={__name:"index",setup(he){const j=pe.useUserStore(),{proxy:L}=e.getCurrentInstance();e.ref(!1);const w=e.ref(!1),_=e.ref(!1),l=e.reactive({nickname:"",gender:"",age:"",height:"",weight:"",city:"æ·±åœ³å¸‚"}),b=e.ref(!1),o=e.ref([]),r=e.ref([]),h=e.ref([]),P=e.ref(!1),v=e.ref([]),x=e.ref([]),y=e.ref([]),T=e.ref(!1),g=e.ref([]),c=e.ref([]),k=e.ref(!1),d=e.ref([]),p=e.ref(!1),z=e.ref(4),m=e.ref([]),$=e.ref(new Map),B=e.ref(new Map),N=e.ref([{type:4,name:"ä¸ªæ€§ç‰¹è´¨"},{type:5,name:"æˆ‘çš„çˆ±å¥½"},{type:6,name:"å¤–è²Œé£æ ¼"},{type:7,name:"ä¸“ä¸šæŠ€èƒ½"},{type:8,name:"çƒ­é—¨æ¨è"}]),R=async()=>{if(o.value.length===0){x.value=[],g.value=[];return}T.value=!0;try{const t=o.value.map(a=>{const s=h.value.find(i=>i.name===a);return s?s.code:null}).filter(a=>a!==null);if(t.length===0){e.index.__f__("warn","at subPackages/py/apply/index.vue:511","æœªæ‰¾åˆ°æœ‰æ•ˆçš„åŸå¸‚ä»£ç "),x.value=[],g.value=[];return}const n=await M.getServicesByCities(t);n.data&&n.data.code===0&&n.data.data?(x.value=n.data.data,G(),e.index.__f__("log","at subPackages/py/apply/index.vue:525","æœåŠ¡æŠ€èƒ½åˆ—è¡¨åŠ è½½æˆåŠŸ:",x.value),e.index.__f__("log","at subPackages/py/apply/index.vue:526","æœåŠ¡æŠ€èƒ½åˆ†ç»„:",g.value)):(e.index.__f__("warn","at subPackages/py/apply/index.vue:528","è·å–æœåŠ¡æŠ€èƒ½åˆ—è¡¨å¤±è´¥"),x.value=[],g.value=[])}catch(t){e.index.__f__("error","at subPackages/py/apply/index.vue:533","è·å–æœåŠ¡æŠ€èƒ½åˆ—è¡¨å¤±è´¥:",t),x.value=[],g.value=[]}finally{T.value=!1}},G=()=>{const t={};x.value.forEach(n=>{const a=n.category,s=n.category_name||"å…¶ä»–";t[a]||(t[a]={id:a,name:s,services:[]}),t[a].services.push(n)}),g.value=Object.values(t).sort((n,a)=>n.id-a.id)},V=async()=>{P.value=!0;try{const t=await ge.getCityList();t.data&&t.data.code===0&&t.data.data?(h.value=t.data.data.map(n=>({name:n.name,code:n.city_code})),e.index.__f__("log","at subPackages/py/apply/index.vue:578","ç”³è¯·é¡µé¢åŒºåŸŸåˆ—è¡¨åŠ è½½æˆåŠŸ:",h.value)):(e.index.__f__("warn","at subPackages/py/apply/index.vue:580","è·å–åŒºåŸŸåˆ—è¡¨å¤±è´¥"),h.value=[])}catch(t){e.index.__f__("error","at subPackages/py/apply/index.vue:584","è·å–åŒºåŸŸåˆ—è¡¨å¤±è´¥:",t),h.value=[]}finally{P.value=!1}},A=t=>{l.gender=t},H=()=>{r.value=[...o.value],b.value=!0},q=()=>{r.value=[],b.value=!1},J=t=>{const n=r.value.indexOf(t);n>-1?r.value.splice(n,1):r.value.push(t),e.index.vibrateShort({type:"light"})},K=t=>{const n=o.value.indexOf(t);n>-1&&(o.value.splice(n,1),e.index.vibrateShort({type:"light"}))},Q=async()=>{if(r.value.length===0){e.index.showToast({title:"è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæœåŠ¡åŒºåŸŸ",icon:"none"});return}o.value=[...r.value],l.city=o.value[0],b.value=!1,r.value=[],y.value=[],g.value=[],await R()},W=()=>{const t=6-v.value.length;if(t<=0){e.index.showToast({title:"æœ€å¤šåªèƒ½ä¸Šä¼ 6å¼ ç…§ç‰‡",icon:"none"});return}e.index.chooseImage({count:t,sizeType:["compressed"],sourceType:["album","camera"],success:async n=>{e.index.showLoading({title:"ä¸Šä¼ ä¸­...",mask:!0});try{const a=n.tempFilePaths.map(async(i,u)=>{try{const f=await X(i);if(e.index.__f__("log","at subPackages/py/apply/index.vue:699","fileInfo",f),e.index.__f__("log","at subPackages/py/apply/index.vue:700","filePath",i),!f||!f.extension)throw new Error("æ— æ³•è·å–æ–‡ä»¶ä¿¡æ¯");const U=await E.uploadFile({filePath:i,name:`photo_${Date.now()}_${u}.${f.extension}`}),S=E.getUploadResult(U);if(!S||!S.url)throw new Error("ä¸Šä¼ ç»“æœè§£æå¤±è´¥");return S.url}catch(f){throw e.index.__f__("error","at subPackages/py/apply/index.vue:719",`ç¬¬${u+1}å¼ ç…§ç‰‡ä¸Šä¼ å¤±è´¥:`,f),f}}),s=await Promise.all(a);v.value.push(...s),e.index.showToast({title:`æˆåŠŸä¸Šä¼ ${s.length}å¼ ç…§ç‰‡`,icon:"success"})}catch(a){e.index.__f__("error","at subPackages/py/apply/index.vue:736","ç…§ç‰‡ä¸Šä¼ å¤±è´¥:",a),e.index.showToast({title:"ç…§ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}finally{e.index.hideLoading()}},fail:n=>{e.index.__f__("error","at subPackages/py/apply/index.vue:746","é€‰æ‹©ç…§ç‰‡å¤±è´¥:",n),e.index.showToast({title:"é€‰æ‹©ç…§ç‰‡å¤±è´¥",icon:"none"})}})},X=t=>new Promise((n,a)=>{e.index.getFileInfo({filePath:t,success:s=>{const i=t.split(".").pop().toLowerCase();n({size:s.size,extension:i})},fail:s=>{e.index.__f__("error","at subPackages/py/apply/index.vue:769","è·å–æ–‡ä»¶ä¿¡æ¯å¤±è´¥:",s);const i=t.split(".").pop().toLowerCase()||"jpg";n({size:0,extension:i})}})}),Y=t=>{e.index.previewImage({urls:v.value.map(n=>L.$imgBaseUrl+n),current:L.$imgBaseUrl+v.value[t],indicator:"number",loop:!0,show:!0,success:function(n){e.index.__f__("log","at subPackages/py/apply/index.vue:790","å›¾ç‰‡é¢„è§ˆæˆåŠŸ",n)},fail:function(n){e.index.__f__("error","at subPackages/py/apply/index.vue:793","å›¾ç‰‡é¢„è§ˆå¤±è´¥",n)}})},Z=t=>{v.value.splice(t,1)},ee=t=>{const n=t.id,a=y.value.indexOf(n);a>-1?y.value.splice(a,1):y.value.push(n),e.index.vibrateShort({type:"light"})},ae=()=>{_.value=!_.value,e.index.vibrateShort({type:"light"})},te=()=>{e.index.navigateTo({url:"/subPackages/login/rz-agreement"})},ne=async()=>{if(w.value)return;if(!_.value){e.index.showToast({title:"è¯·å…ˆåŒæ„å‹ä¼´æœåŠ¡åè®®",icon:"none",duration:2e3});return}if(!l.nickname.trim()){e.index.showToast({title:"è¯·è¾“å…¥æ˜µç§°",icon:"none"});return}if(l.nickname.length>50){e.index.showToast({title:"æ˜µç§°ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦",icon:"none"});return}if(!l.gender){e.index.showToast({title:"è¯·é€‰æ‹©æ€§åˆ«",icon:"none"});return}const t=parseInt(l.age),n=parseInt(l.height),a=parseInt(l.weight);if(!t||t<18||t>65){e.index.showToast({title:"å¹´é¾„å¿…é¡»åœ¨18-65å²ä¹‹é—´",icon:"none"});return}if(!n||n<100||n>250){e.index.showToast({title:"èº«é«˜å¿…é¡»åœ¨100-250cmä¹‹é—´",icon:"none"});return}if(!a||a<30||a>200){e.index.showToast({title:"è¯·è¾“å…¥åˆç†çš„ä½“é‡",icon:"none"});return}if(o.value.length===0){e.index.showToast({title:"è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæœåŠ¡åŒºåŸŸ",icon:"none"});return}if(v.value.length===0){e.index.showToast({title:"è¯·ä¸Šä¼ è‡³å°‘ä¸€å¼ ç”Ÿæ´»ç…§",icon:"none"});return}if(v.value.length>9){e.index.showToast({title:"æœ€å¤šåªèƒ½ä¸Šä¼ 9å¼ ç…§ç‰‡",icon:"none"});return}if(y.value.length===0){e.index.showToast({title:"è¯·è‡³å°‘é€‰æ‹©ä¸€é¡¹æœåŠ¡æŠ€èƒ½",icon:"none"});return}e.index.showModal({title:"ç¡®è®¤æäº¤",content:"ç¡®å®šè¦æäº¤å…¥é©»ç”³è¯·å—ï¼Ÿæäº¤åå°†è¿›å…¥å®¡æ ¸æµç¨‹ã€‚",success:async s=>{s.confirm&&await se()}})},se=async()=>{w.value=!0;try{const t=o.value.map(s=>{const i=h.value.find(u=>u.name===s);return i?String(i.code):null}).filter(s=>s!==null);if(t.length===0){e.index.showToast({title:"æœåŠ¡åŒºåŸŸæ•°æ®å¼‚å¸¸ï¼Œè¯·é‡æ–°é€‰æ‹©",icon:"none"});return}const n={nickname:l.nickname.trim(),gender:l.gender==="male"?"ç”·":"å¥³",age:parseInt(l.age),height:parseInt(l.height),weight:parseInt(l.weight),service_areas:t,services:y.value,can_accept_orders:"N",photos:v.value,tags:c.value.map(s=>s.tag_name),phone:j.userInfo.phone||""};e.index.__f__("log","at subPackages/py/apply/index.vue:983","æäº¤æ•°æ®:",n);const a=await M.createCompanionApplication(n);if(e.index.__f__("log","at subPackages/py/apply/index.vue:988","æ¥å£å“åº”:",a),a&&a.data&&a.data.code===0)e.index.showModal({title:"å…¥é©»æˆåŠŸ ğŸ‰",content:"æ­å–œæ‚¨ï¼å…¥é©»ç”³è¯·å·²é€šè¿‡ï¼Œæ‚¨å·²æˆåŠŸæˆä¸ºå‹ä¼´å¸ˆã€‚",showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",success:()=>{e.index.$emit("applicationStatusChanged",{status:"approved",message:"å…¥é©»ç”³è¯·å·²é€šè¿‡"}),e.index.navigateBack()}});else{const s=a&&a.data&&a.data.message||"æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";e.index.showModal({title:"æäº¤å¤±è´¥",content:s,showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†"})}}catch(t){e.index.__f__("error","at subPackages/py/apply/index.vue:1025","æäº¤å¤±è´¥:",t);let n="æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";t&&t.message&&(t.message.includes("ç½‘ç»œ")?n="ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•":t.message.includes("å‚æ•°")?n="æäº¤ä¿¡æ¯æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•":t.message.includes("é‡å¤")?n="æ‚¨å·²æäº¤è¿‡ç”³è¯·ï¼Œè¯·å‹¿é‡å¤æäº¤":n=t.message),e.index.showModal({title:"æäº¤å¤±è´¥",content:n,showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†"})}finally{w.value=!1}};e.onMounted(async()=>{await V(),e.index.__f__("log","at subPackages/py/apply/index.vue:1058","æ ‡ç­¾ç¼“å­˜é…ç½®:",{expireTime:`${O/1e3/60}åˆ†é’Ÿ`,cacheSize:$.value.size})});const le=()=>{d.value=[...c.value],k.value=!0,F(4)},D=()=>{d.value=[],k.value=!1},ie=t=>{z.value=t,F(t)},oe=t=>{const n=B.value.get(t);return n?Date.now()-n<O:!1},ue=t=>$.value.get(t)||[],re=(t,n)=>{$.value.set(t,n),B.value.set(t,Date.now()),e.index.__f__("log","at subPackages/py/apply/index.vue:1106",`æ ‡ç­¾ç±»å‹${t}å·²ç¼“å­˜ï¼Œæ•°æ®é‡: ${n.length}`)},F=async(t,n=!1)=>{if(!n&&oe(t)){const a=ue(t);if(a.length>0){e.index.__f__("log","at subPackages/py/apply/index.vue:1131",`ä½¿ç”¨ç¼“å­˜æ•°æ® - æ ‡ç­¾ç±»å‹${t}ï¼Œæ•°æ®é‡: ${a.length}`),m.value=a;return}}p.value=!0;try{e.index.__f__("log","at subPackages/py/apply/index.vue:1139",`å¼€å§‹åŠ è½½æ ‡ç­¾ç±»å‹: ${t}`);const a={tag_type:t,page:1,pageSize:60};e.index.__f__("log","at subPackages/py/apply/index.vue:1147","è¯·æ±‚å‚æ•°:",a);const s=await M.getPersonalityTags(a);if(e.index.__f__("log","at subPackages/py/apply/index.vue:1150","APIå“åº”:",s),s.data&&s.data.code===0&&s.data.data){const i=s.data.data.list||s.data.data;m.value=i,re(t,i),e.index.__f__("log","at subPackages/py/apply/index.vue:1160",`æ ‡ç­¾ç±»å‹${t}åŠ è½½æˆåŠŸ:`,i)}else e.index.__f__("warn","at subPackages/py/apply/index.vue:1162",`è·å–æ ‡ç­¾ç±»å‹${t}å¤±è´¥ï¼Œå“åº”æ•°æ®:`,s),m.value=[]}catch(a){e.index.__f__("error","at subPackages/py/apply/index.vue:1166",`è·å–æ ‡ç­¾ç±»å‹${t}å¤±è´¥:`,a),e.index.__f__("error","at subPackages/py/apply/index.vue:1167","é”™è¯¯è¯¦æƒ…:",a.response||a),m.value=[]}finally{p.value=!1}},C=t=>d.value.some(n=>n.id===t),ce=t=>{const n=d.value.findIndex(a=>a.id===t.id);if(n>-1)d.value.splice(n,1);else{if(d.value.length>=5){e.index.showToast({title:"æœ€å¤šåªèƒ½é€‰æ‹©5ä¸ªæ ‡ç­¾",icon:"none"});return}d.value.push(t)}e.index.vibrateShort({type:"light"})},de=()=>{c.value=[...d.value],k.value=!1,d.value=[],e.index.showToast({title:`å·²é€‰æ‹©${c.value.length}ä¸ªæ ‡ç­¾`,icon:"success"})},ve=t=>{const n=c.value.findIndex(a=>a.id===t.id);n>-1&&(c.value.splice(n,1),e.index.vibrateShort({type:"light"}))};return(t,n)=>e.e({a:l.nickname,b:e.o(a=>l.nickname=a.detail.value),c:I._imports_4,d:l.gender==="male"?1:"",e:e.o(a=>A("male")),f:I._imports_3$2,g:l.gender==="female"?1:"",h:e.o(a=>A("female")),i:l.age,j:e.o(a=>l.age=a.detail.value),k:l.height,l:e.o(a=>l.height=a.detail.value),m:l.weight,n:e.o(a=>l.weight=a.detail.value),o:o.value.length===0},o.value.length===0?{}:{p:e.t(o.value.length)},{q:e.o(H),r:o.value.length>0},o.value.length>0?{s:e.f(o.value,(a,s,i)=>({a:e.t(a),b:a,c:e.o(u=>K(a),a)}))}:{},{t:e.f(v.value,(a,s,i)=>({a:t.$imgBaseUrl+a,b:e.o(u=>Z(s),s),c:s,d:e.o(u=>Y(s),s)})),v:v.value.length<6},v.value.length<6?{w:I._imports_0$4,x:e.o(W)}:{},{y:T.value},T.value?{}:o.value.length===0?{}:g.value.length>0?{B:e.f(g.value,(a,s,i)=>({a:e.t(a.name),b:e.f(a.services,(u,f,U)=>({a:e.t(u.name),b:y.value.includes(u.id)?1:"",c:u.id,d:e.o(S=>ee(u),u.id)})),c:a.id}))}:{},{z:o.value.length===0,A:g.value.length>0,C:c.value.length>0},c.value.length>0?{D:e.f(c.value,(a,s,i)=>({a:e.t(a.tag_name),b:a.id,c:e.o(u=>ve(a),a.id)}))}:{},{E:e.t(c.value.length),F:c.value.length>=5?1:"",G:e.o(a=>c.value.length<5?le():null),H:_.value},_.value?{}:{},{I:_.value?1:"",J:e.o(te),K:e.o(ae),L:!w.value},w.value?{}:{},{M:w.value||!_.value?1:"",N:e.o(ne),O:b.value},b.value?e.e({P:e.o(q),Q:P.value},P.value?{}:{R:e.f(h.value,(a,s,i)=>e.e({a:e.t(a.name),b:r.value.includes(a.name)},r.value.includes(a.name)?{}:{},{c:s,d:e.n({active:r.value.includes(a.name)}),e:e.o(u=>J(a.name),s)}))},{S:e.t(r.value.length),T:e.o(Q),U:e.o(()=>{}),V:e.o(q)}):{},{W:k.value},k.value?e.e({X:e.o(D),Y:e.f(N.value,(a,s,i)=>({a:e.t(a.name),b:a.type,c:e.n({active:z.value===a.type}),d:e.o(u=>ie(a.type),a.type)})),Z:!p.value&&d.value.length>=5},!p.value&&d.value.length>=5?{}:{},{aa:p.value},p.value?{}:{ab:e.f(m.value,(a,s,i)=>e.e({a:e.t(a.tag_name),b:C(a.id)},C(a.id)?{}:{},{c:a.id,d:e.n({selected:C(a.id)}),e:e.o(u=>ce(a),a.id)}))},{ac:!p.value&&m.value.length===0},!p.value&&m.value.length===0?{}:{},{ad:e.t(d.value.length),ae:e.o(de),af:e.o(()=>{}),ag:e.o(D)}):{})}},_e=e._export_sfc(fe,[["__scopeId","data-v-80f15022"]]);wx.createPage(_e);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/subPackages/py/apply/index.js.map
