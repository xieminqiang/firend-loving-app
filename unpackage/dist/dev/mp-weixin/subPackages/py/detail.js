"use strict";const e=require("../../common/vendor.js"),_=require("../../common/assets.js"),ue=require("../../api/friends.js"),B=require("../../api/discover.js"),le=require("../../stores/level.js"),_e=require("../../stores/user.js");if(!Array){const q=e.resolveComponent("u-tabs"),i=e.resolveComponent("u-avatar"),c=e.resolveComponent("u-popup");(q+i+c)()}const ce=()=>"../../uni_modules/uview-plus/components/u-tabs/u-tabs.js",de=()=>"../../uni_modules/uview-plus/components/u-avatar/u-avatar.js",me=()=>"../../uni_modules/uview-plus/components/u-popup/u-popup.js";Math||(ce+pe+de+me)();const pe=()=>"../../components/common/PictureDisplay.js",ve={__name:"detail",setup(q){const i=e.ref({}),{proxy:c}=e.getCurrentInstance(),w=le.useLevelStore(),$=_e.useUserStore(),M=e.computed(()=>$.userInfo&&Object.keys($.userInfo).length>0);e.computed(()=>{if(M.value)return $.userInfo});const G=()=>{e.index.navigateTo({url:"/subPackages/login/index"})},I=["提供项目","TA的动态","客户评价"],f=e.ref(0),J=e.computed(()=>I.map(a=>({name:a}))),K=a=>{let t,o;if(typeof a=="object"&&a!==null)t=a.index,o=a.name;else if(typeof a=="number")t=a,o=I[t];else{e.index.__f__("error","at subPackages/py/detail.vue:301","Invalid tab change item:",a);return}if(t<0||t>=I.length){e.index.__f__("error","at subPackages/py/detail.vue:307","Invalid tab index:",t);return}if(!o){e.index.__f__("error","at subPackages/py/detail.vue:312","Tab not found for index:",t,"item:",a);return}e.index.__f__("log","at subPackages/py/detail.vue:316","Tab changed to:",o,"index:",t),f.value=t},r=e.ref({}),y=e.ref([]),x=e.ref([]),g=e.ref([]),P=e.ref(!1),h=e.ref([]),k=e.ref(!1),T=e.ref(!1),C=e.ref(""),S=e.ref(!1),p=e.computed(()=>!r.value.level_order||!w.sortedServiceLevels.length?null:w.sortedServiceLevels.find(a=>a.level_order===r.value.level_order)),N=async()=>{var a;if(i.value.id)try{k.value=!0;const t={companion_id:parseInt(i.value.id),page:1,rating:5,page_size:20},o=await B.getCompanionCommentList(t);if(e.index.__f__("log","at subPackages/py/detail.vue:361","评论列表响应:",o),o.data&&o.data.code===0){const n=o.data.data;n&&n.list&&(h.value=n.list,e.index.__f__("log","at subPackages/py/detail.vue:367","评论列表数据:",h.value))}else e.index.__f__("error","at subPackages/py/detail.vue:370","获取评论列表失败:",((a=o.data)==null?void 0:a.message)||"未知错误")}catch(t){e.index.__f__("error","at subPackages/py/detail.vue:373","获取评论列表异常:",t)}finally{k.value=!1}},X=a=>{if(!M.value){e.index.showToast({title:"请先登录",icon:"none",duration:2e3}),G();return}e.index.navigateTo({url:`/subPackages/order/submit?service_id=${a.service_id}&price_template_id=${a.price_template_id||""}&companion_id=${i.value.id}&level_order=${r.value.level_order||""}&nickname=${r.value.nickname}`})},Y=async()=>{var a;try{const t={city_code:i.value.city_code,application_id:i.value.id};i.value.latitude&&i.value.longitude&&(t.latitude=parseFloat(i.value.latitude),t.longitude=parseFloat(i.value.longitude));const o=await ue.getCityServices(t);if(e.index.__f__("log","at subPackages/py/detail.vue:419","城市服务信息响应:",o),re(),o.data&&o.data.code===0){const n=o.data.data;e.index.__f__("log","at subPackages/py/detail.vue:424","城市服务数据:",n),n&&(r.value={avatar:n.avatar,nickname:n.nickname||"未知用户",verified:!0,age:n.age,weight:n.weight,height:n.height,distance:n.distance,tags:n.tags||[],level_order:n.level_order,levelIcon:"",gender:n.gender||""},n.photos&&n.photos.length>0&&(y.value=n.photos.map(d=>({img:d}))),n.services&&n.services.length>0&&(x.value=n.services))}else e.index.__f__("error","at subPackages/py/detail.vue:458","获取城市服务失败:",((a=o.data)==null?void 0:a.message)||"未知错误")}catch(t){e.index.__f__("error","at subPackages/py/detail.vue:461","获取城市服务异常:",t)}},Z=async()=>{var a;if(i.value.id)try{P.value=!0;const t={companion_id:parseInt(i.value.id),page:1,page_size:50},o=await B.getMomentsByCompanion(t);if(e.index.__f__("log","at subPackages/py/detail.vue:478","动态列表响应:",o),o.data&&o.data.code===0){const n=o.data.data;n&&n.moments_list&&(g.value=n.moments_list,e.index.__f__("log","at subPackages/py/detail.vue:484","动态列表数据:",g.value))}else e.index.__f__("error","at subPackages/py/detail.vue:487","获取动态列表失败:",((a=o.data)==null?void 0:a.message)||"未知错误")}catch(t){e.index.__f__("error","at subPackages/py/detail.vue:490","获取动态列表异常:",t)}finally{P.value=!1}},ee=a=>{e.index.previewImage({urls:y.value.map(t=>c.$imgBaseUrl+t.img),current:c.$imgBaseUrl+y.value[a].img,indicator:"number",loop:!0,show:!0,success:function(t){e.index.__f__("log","at subPackages/py/detail.vue:505","图片预览成功",t)},fail:function(t){e.index.__f__("error","at subPackages/py/detail.vue:508","图片预览失败",t)}})},ae=a=>{e.index.__f__("log","at subPackages/py/detail.vue:538","播放视频:",a),C.value=a,T.value=!0},te=()=>{T.value=!1,C.value=""},U=async a=>{try{const t=a.moments_info.is_praised;a.moments_info.is_praised=!t,a.moments_info.is_praised?a.moments_info.praise_num=parseInt(a.moments_info.praise_num)+1:a.moments_info.praise_num=Math.max(0,parseInt(a.moments_info.praise_num)-1);const o=await B.praiseMoment({target_id:a.moments_info.moments_id});o.data&&o.data.code===0?e.index.__f__("log","at subPackages/py/detail.vue:569","点赞成功"):(a.moments_info.is_praised=t,t?a.moments_info.praise_num=parseInt(a.moments_info.praise_num)+1:a.moments_info.praise_num=Math.max(0,parseInt(a.moments_info.praise_num)-1),e.index.showToast({title:"点赞失败，请重试",icon:"none"}))}catch(t){e.index.__f__("error","at subPackages/py/detail.vue:585","点赞失败:",t);const o=a.moments_info.is_praised;a.moments_info.is_praised=!o,o?a.moments_info.praise_num=parseInt(a.moments_info.praise_num)+1:a.moments_info.praise_num=Math.max(0,parseInt(a.moments_info.praise_num)-1),e.index.showToast({title:"网络错误，请重试",icon:"none"})}},se=a=>{e.index.navigateTo({url:"/subPackages/record/comment",success(t){t.eventChannel.emit("getRecord",{data:a})}})},ne=a=>{if(!a)return"";const t=new Date(a),n=new Date-t,d=Math.floor(n/(1e3*60*60*24));return d===0?"今天":d===1?"昨天":d<7?`${d}天前`:a.split(" ")[0]},oe=(a,t)=>{const o=t.map(n=>c.$imgBaseUrl+n);e.index.previewImage({urls:o,current:a,indicator:"number",loop:!0,show:!0,success:function(n){e.index.__f__("log","at subPackages/py/detail.vue:644","评论图片预览成功",n)},fail:function(n){e.index.__f__("error","at subPackages/py/detail.vue:647","评论图片预览失败",n)}})},ie=a=>{a.detail.scrollTop>=D.value?S.value=!0:S.value=!1},D=e.ref(0),re=()=>{e.index.createSelectorQuery().select(".profile-tabs").boundingClientRect(a=>{a&&(D.value=a.top)}).exec()};return e.onMounted(async()=>{await w.fetchServiceLevels();const a=getCurrentPages(),t=a[a.length-1];i.value=t.options||{},e.index.__f__("log","at subPackages/py/detail.vue:685","页面参数:",i.value),e.index.__f__("log","at subPackages/py/detail.vue:686","经纬度参数:",{latitude:i.value.latitude,longitude:i.value.longitude}),i.value.id&&i.value.city_code&&Y(),i.value.id&&Z(),i.value.id&&N()}),e.onUnmounted(()=>{}),(a,t)=>{var o,n,d,j;return e.e({a:e.unref(c).$imgBaseUrl+r.value.avatar,b:e.t(r.value.nickname),c:r.value.verified&&p.value},r.value.verified&&p.value?{d:(o=p.value)==null?void 0:o.icon_url}:{},{e:(n=p.value)==null?void 0:n.level_name},(d=p.value)!=null&&d.level_name?{f:e.t((j=p.value)==null?void 0:j.level_name)}:{},{g:r.value.tags&&r.value.tags.length>0},r.value.tags&&r.value.tags.length>0?{h:e.f(r.value.tags,(s,u,v)=>({a:e.t(s),b:s}))}:{},{i:r.value.gender==="女"?"/static/icons/friend/white_nv.png":"/static/icons/friend/white_nan.png",j:e.t(r.value.age),k:e.t(r.value.weight),l:e.t(r.value.height),m:r.value.distance!==""},r.value.distance!==""?{n:_._imports_0$6,o:e.t(r.value.distance)}:{},{p:e.f(y.value,(s,u,v)=>({a:e.unref(c).$imgBaseUrl+s.img,b:e.o(l=>ee(u),u),c:u})),q:_._imports_1$3,r:_._imports_2$2,s:_._imports_3$3,t:e.o(K),v:e.p({list:J.value,current:f.value,lineWidth:"60",lineHeight:"2",lineColor:"linear-gradient(90deg, rgba(115, 99, 255, 1) 0%, rgba(255, 105, 222, 1) 100%)",activeStyle:{color:"#7363FF",fontWeight:"500",fontSize:"28rpx"},inactiveStyle:{color:"#1A1A1A",fontWeight:"400",fontSize:"28rpx"},itemStyle:"padding: 16rpx 50rpx; height: auto; border-radius: 30rpx;"}),w:S.value?1:"",x:x.value.length>0},x.value.length>0?{y:e.f(x.value,(s,u,v)=>({a:e.unref(c).$imgBaseUrl+s.service_image_url,b:e.t(s.service_name),c:e.f(s.service_tags,(l,m,b)=>({a:e.t(l),b:l})),d:e.t(s.price),e:e.t(s.unit||"小时"),f:e.o(l=>X(s),s.title),g:s.title}))}:{z:_._imports_3},{A:f.value===0,B:P.value},P.value?{}:g.value.length>0?{D:e.f(g.value,(s,u,v)=>{var l,m,b,L,A,z,F,H,R,V,W,O,Q;return e.e({a:e.t((l=s.moments_info)==null?void 0:l.time_date),b:e.t((m=s.moments_info)==null?void 0:m.time_time),c:e.t((b=s.moments_info)==null?void 0:b.content),d:(L=s.moments_info)==null?void 0:L.file_list},(A=s.moments_info)!=null&&A.file_list?{e:e.o(ae,u),f:"aebc55d5-1-"+v,g:e.p({list:(z=s.moments_info)==null?void 0:z.file_list,topicList:(F=s.moments_info)==null?void 0:F.topic_list})}:{},{h:!((H=s.moments_info)!=null&&H.is_praised)},(R=s.moments_info)!=null&&R.is_praised?{}:{i:_._imports_0$3,j:e.o(E=>U(s),u)},{k:(V=s.moments_info)==null?void 0:V.is_praised},(W=s.moments_info)!=null&&W.is_praised?{l:_._imports_1$1,m:e.o(E=>U(s),u)}:{},{n:e.t(((O=s.moments_info)==null?void 0:O.praise_num)||0),o:e.t(((Q=s.moments_info)==null?void 0:Q.comments_num)||0),p:e.o(E=>se(s),u),q:u})}),E:_._imports_2$1}:{F:_._imports_3},{C:g.value.length>0,G:f.value===1,H:k.value},k.value?{}:h.value.length>0?{J:e.f(h.value,(s,u,v)=>e.e({a:"aebc55d5-2-"+v,b:e.p({src:s.is_anonymous?"":e.unref(c).$imgBaseUrl+s.user_img,size:"40",shape:"circle"}),c:e.t(s.is_anonymous?"匿名用户":s.user_nickname),d:e.f(5,(l,m,b)=>({a:l,b:e.n({filled:l<=s.rating})})),e:e.t(ne(s.comment_time)),f:e.t(s.comment),g:s.comment_images&&s.comment_images.length>0},s.comment_images&&s.comment_images.length>0?{h:e.f(s.comment_images,(l,m,b)=>({a:e.unref(c).$imgBaseUrl+l,b:m,c:e.o(L=>oe(m,s.comment_images),m)}))}:{},{i:s.id}))}:{K:_._imports_3},{I:h.value.length>0,L:f.value===2,M:e.o(ie),N:C.value,O:_._imports_8,P:e.o(te),Q:e.p({show:T.value,mode:"center",safeAreaInsetBottom:!1})})}}},fe=e._export_sfc(ve,[["__scopeId","data-v-aebc55d5"]]);wx.createPage(fe);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/subPackages/py/detail.js.map
