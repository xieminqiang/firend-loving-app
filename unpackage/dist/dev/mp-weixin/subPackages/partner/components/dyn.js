"use strict";const e=require("../../../common/vendor.js"),p=require("../../../common/assets.js"),T=require("../../../api/discover.js");Array||e.resolveComponent("u-popup")();const F=()=>"../../../uni_modules/uview-plus/components/u-popup/u-popup.js";Math||(G+F)();const G=()=>"../../../components/common/PictureDisplay.js",H={__name:"dyn",setup(S){const r=e.ref({}),a=e.ref([]),c=e.ref(!1),_=e.ref(1),g=e.ref(20),m=e.ref(!1),u=e.ref(!1),l=e.ref(!1),f=e.ref(!1),d=e.ref(""),v=async(n=!1)=>{var s;if(r.value.companion_id)try{n?(l.value=!0,_.value=1,u.value=!1):_.value===1?c.value=!0:m.value=!0;const o={companion_id:parseInt(r.value.companion_id),page:_.value,page_size:g.value},t=await T.getMomentsByCompanion(o);if(e.index.__f__("log","at subPackages/partner/components/dyn.vue:138","动态列表响应:",t),t.data&&t.data.code===0){const i=t.data.data;i&&i.moments_list&&(n||_.value===1?a.value=i.moments_list:a.value=[...a.value,...i.moments_list],i.moments_list.length<g.value&&(u.value=!0),e.index.__f__("log","at subPackages/partner/components/dyn.vue:156","动态列表数据:",a.value))}else e.index.__f__("error","at subPackages/partner/components/dyn.vue:159","获取动态列表失败:",((s=t.data)==null?void 0:s.message)||"未知错误"),!n&&_.value>1&&_.value--}catch(o){e.index.__f__("error","at subPackages/partner/components/dyn.vue:166","获取动态列表异常:",o),!n&&_.value>1&&_.value--}finally{c.value=!1,m.value=!1,l.value=!1}},V=n=>{e.index.__f__("log","at subPackages/partner/components/dyn.vue:180","播放视频:",n),d.value=n,f.value=!0},z=()=>{f.value=!1,d.value=""},y=async n=>{try{const s=n.moments_info.is_praised;n.moments_info.is_praised=!s,n.moments_info.is_praised?n.moments_info.praise_num=parseInt(n.moments_info.praise_num)+1:n.moments_info.praise_num=Math.max(0,parseInt(n.moments_info.praise_num)-1);const o=await T.praiseMoment({target_id:n.moments_info.moments_id});o.data&&o.data.code===0?e.index.__f__("log","at subPackages/partner/components/dyn.vue:211","点赞成功"):(n.moments_info.is_praised=s,s?n.moments_info.praise_num=parseInt(n.moments_info.praise_num)+1:n.moments_info.praise_num=Math.max(0,parseInt(n.moments_info.praise_num)-1),e.index.showToast({title:"点赞失败，请重试",icon:"none"}))}catch(s){e.index.__f__("error","at subPackages/partner/components/dyn.vue:227","点赞失败:",s);const o=n.moments_info.is_praised;n.moments_info.is_praised=!o,o?n.moments_info.praise_num=parseInt(n.moments_info.praise_num)+1:n.moments_info.praise_num=Math.max(0,parseInt(n.moments_info.praise_num)-1),e.index.showToast({title:"网络错误，请重试",icon:"none"})}},A=n=>{e.index.navigateTo({url:"/subPackages/record/comment",success(s){s.eventChannel.emit("getRecord",{data:n})}})},B=()=>{e.index.__f__("log","at subPackages/partner/components/dyn.vue:259","触发上拉加载"),!(m.value||u.value)&&(_.value++,v())},E=()=>{e.index.__f__("log","at subPackages/partner/components/dyn.vue:270","触发下拉刷新"),v(!0)};return e.onMounted(async()=>{const n=getCurrentPages(),s=n[n.length-1];r.value=s.options||{},e.index.__f__("log","at subPackages/partner/components/dyn.vue:281","页面参数:",r.value),r.value.companion_id&&v()}),(n,s)=>e.e({a:c.value&&a.value.length===0},c.value&&a.value.length===0?{}:a.value.length>0?e.e({c:e.f(a.value,(o,t,i)=>{var P,h,b,x,k,w,M,I,$,q,j,C,D;return e.e({a:e.t((P=o.moments_info)==null?void 0:P.time_date),b:e.t((h=o.moments_info)==null?void 0:h.time_time),c:e.t((b=o.moments_info)==null?void 0:b.content),d:(x=o.moments_info)==null?void 0:x.file_list},(k=o.moments_info)!=null&&k.file_list?{e:e.o(V,t),f:"ceda863b-0-"+i,g:e.p({list:(w=o.moments_info)==null?void 0:w.file_list,topicList:(M=o.moments_info)==null?void 0:M.topic_list})}:{},{h:!((I=o.moments_info)!=null&&I.is_praised)},($=o.moments_info)!=null&&$.is_praised?{}:{i:p._imports_0$4,j:e.o(L=>y(o),t)},{k:(q=o.moments_info)==null?void 0:q.is_praised},(j=o.moments_info)!=null&&j.is_praised?{l:p._imports_1$1,m:e.o(L=>y(o),t)}:{},{n:e.t(((C=o.moments_info)==null?void 0:C.praise_num)||0),o:e.t(((D=o.moments_info)==null?void 0:D.comments_num)||0),p:e.o(L=>A(o),t),q:t})}),d:p._imports_2$1,e:m.value},m.value?{}:u.value&&a.value.length>0?{}:{},{f:u.value&&a.value.length>0}):{g:p._imports_3},{b:a.value.length>0,h:d.value,i:p._imports_8,j:e.o(z),k:e.p({show:f.value,mode:"center",safeAreaInsetBottom:!1}),l:e.o(B),m:l.value,n:e.o(E)})}},J=e._export_sfc(H,[["__scopeId","data-v-ceda863b"]]);wx.createPage(J);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/subPackages/partner/components/dyn.js.map
