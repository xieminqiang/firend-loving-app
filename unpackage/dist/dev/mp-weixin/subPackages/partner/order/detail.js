"use strict";const e=require("../../../common/vendor.js"),N=require("../../../common/assets.js"),c=require("../../../api/order.js"),D=require("../../../stores/user.js"),E={__name:"detail",setup(j){const _=D.useUserStore(),o=e.ref({}),p=e.ref(null),i=e.ref(null);e.onLoad(t=>{if(!_.userInfo||Object.keys(_.userInfo).length===0||!_.token){e.index.showToast({title:"请先登录",icon:"none"}),setTimeout(()=>{e.index.navigateTo({url:"/subPackages/login/index"})},1500);return}t.orderId&&(p.value=t.orderId),t.companion_id&&(i.value=t.companion_id),d()});const d=async()=>{try{e.index.showLoading({title:"加载中..."});const t=await c.getCompanionOrderDetail({order_id:Number(p.value),companion_id:Number(i.value)});if(t.data.code===0)o.value={...t.data.data.order,logs:t.data.data.logs||[]};else throw new Error(t.data.msg||"获取订单详情失败")}catch(t){e.index.__f__("error","at subPackages/partner/order/detail.vue:189","加载订单详情失败:",t),e.index.showToast({title:t.message||"加载失败",icon:"none"})}finally{e.index.hideLoading()}},h=(t,n)=>({2:[{text:"拒绝",action:"reject",type:"secondary"},{text:"接单",action:"accept",type:"primary"}],3:[{text:"电话联系",action:"contact",type:"secondary"},{text:"我已到达服务地点",action:"arrived",type:"primary"}],4:[{text:"电话联系",action:"call",type:"secondary"}],5:[{text:"电话联系",action:"contact",type:"secondary"},{text:"结束服务",action:"end",type:"primary"}],6:[...n.is_comment===1?[{text:"查看评价",action:"review",type:"secondary"}]:[],{text:"删除订单",action:"delete",type:"secondary"}],7:[{text:"删除订单",action:"delete",type:"secondary"}],8:[{text:"删除订单",action:"delete",type:"secondary"}],9:[{text:"订单已取消，给客户退款中",action:"info",type:"info"}],11:[{text:"电话联系",action:"contact",type:"secondary"},{text:"我已出发",action:"depart",type:"depart"}]})[t]||[],v=(t,n)=>{switch(t){case"contact":f(n);break;case"accept":g(n);break;case"reject":w(n);break;case"arrived":y(n);break;case"depart":b(n);break;case"call":T(n);break;case"start":k(n);break;case"end":S(n);break;case"review":L(n);break;case"rebook":$(n);break;case"delete":P(n);break}},f=t=>{t.user&&t.user.phone&&e.index.showModal({title:"电话联系",content:`是否拨打客户 ${t.user.nick_name} 的电话？`,confirmText:"拨打",cancelText:"取消",success:n=>{n.confirm&&e.index.makePhoneCall({phoneNumber:t.user.phone})}})},g=t=>{e.index.showModal({title:"确认接单",content:"确定要接受这个订单吗？",confirmText:"接单",cancelText:"取消",success:async n=>{if(n.confirm)try{e.index.showLoading({title:"处理中..."});const a=await c.acceptCompanionOrder({order_id:t.id,companion_id:Number(i.value)});if(a.data.code===0)e.index.showToast({title:"接单成功",icon:"success"}),setTimeout(()=>{d()},1500);else throw new Error(a.data.msg||"接单失败")}catch(a){e.index.__f__("error","at subPackages/partner/order/detail.vue:368","接单失败:",a),e.index.showToast({title:a.message||"接单失败",icon:"none"})}finally{e.index.hideLoading()}}})},w=t=>{e.index.showModal({title:"拒绝订单",content:"确定要拒绝这个订单吗？",confirmText:"拒绝",cancelText:"取消",success:async n=>{if(n.confirm)try{e.index.showLoading({title:"处理中..."});const a=await c.rejectCompanionOrder({order_id:t.id,companion_id:Number(i.value)});if(a.data.code===0)e.index.showToast({title:"已拒绝订单",icon:"success"}),setTimeout(()=>{d()},1500);else throw new Error(a.data.msg||"拒绝订单失败")}catch(a){e.index.__f__("error","at subPackages/partner/order/detail.vue:414","拒绝订单失败:",a),e.index.showToast({title:a.message||"操作失败",icon:"none"})}finally{e.index.hideLoading()}}})},y=t=>{e.index.showModal({title:"确认到达",content:"确认您已到达服务地点？",confirmText:"确认",cancelText:"取消",success:async n=>{if(n.confirm)try{e.index.showLoading({title:"更新中..."});const a=await c.arrivedCompanionOrder({order_id:t.id,companion_id:Number(i.value)});if(a.data.code===0)e.index.showToast({title:"已确认到达",icon:"success"}),setTimeout(()=>{d()},1500);else throw new Error(a.data.msg||"确认到达失败")}catch(a){e.index.__f__("error","at subPackages/partner/order/detail.vue:460","确认到达失败:",a),e.index.showToast({title:a.message||"操作失败",icon:"none"})}finally{e.index.hideLoading()}}})},T=t=>{t.user&&t.user.phone&&e.index.showModal({title:"电话联系",content:`是否拨打客户 ${t.user.nick_name} 的电话？`,confirmText:"拨打",cancelText:"取消",success:n=>{n.confirm&&e.index.makePhoneCall({phoneNumber:t.user.phone})}})},b=t=>{e.index.showModal({title:"确认出发",content:"确认您已开始出发前往服务地点？",confirmText:"确认",cancelText:"取消",success:async n=>{if(n.confirm)try{e.index.showLoading({title:"更新中..."});const a=await c.departCompanionOrder({order_id:t.id,companion_id:Number(i.value)});if(a.data.code===0)e.index.showToast({title:"已确认出发",icon:"success"}),setTimeout(()=>{d()},1500);else throw new Error(a.data.msg||"确认出发失败")}catch(a){e.index.__f__("error","at subPackages/partner/order/detail.vue:525","确认出发失败:",a),e.index.showToast({title:a.message||"操作失败",icon:"none"})}finally{e.index.hideLoading()}}})},k=t=>{e.index.showModal({title:"开始服务",content:"确定要开始服务吗？",confirmText:"开始",cancelText:"取消",success:async n=>{if(n.confirm)try{e.index.showLoading({title:"更新中..."});const a=await c.startCompanionService({order_id:t.id,companion_id:Number(i.value)});if(a.data.code===0)e.index.showToast({title:"服务已开始",icon:"success"}),setTimeout(()=>{d()},1500);else throw new Error(a.data.msg||"开始服务失败")}catch(a){e.index.__f__("error","at subPackages/partner/order/detail.vue:571","开始服务失败:",a),e.index.showToast({title:a.message||"操作失败",icon:"none"})}finally{e.index.hideLoading()}}})},S=t=>{e.index.showModal({title:"结束服务",content:"确定要结束服务吗？",confirmText:"结束",cancelText:"取消",success:async n=>{if(n.confirm)try{e.index.showLoading({title:"更新中..."});const a=await c.endCompanionService({order_id:t.id,companion_id:Number(i.value)});if(a.data.code===0)e.index.showToast({title:"服务已结束",icon:"success"}),setTimeout(()=>{d()},1500);else throw new Error(a.data.msg||"结束服务失败")}catch(a){e.index.__f__("error","at subPackages/partner/order/detail.vue:617","结束服务失败:",a),e.index.showToast({title:a.message||"操作失败",icon:"none"})}finally{e.index.hideLoading()}}})},L=t=>{e.index.navigateTo({url:`/subPackages/partner/order/partner-evaluate?orderId=${t.id}&companion_id=${i.value}`})},$=t=>{e.index.navigateTo({url:`/subPackages/partner/rebook?orderId=${t.id}`})},P=t=>{e.index.showModal({title:"删除订单",content:"确定要删除这个订单吗？删除后不可恢复。",confirmText:"删除",cancelText:"取消",success:async n=>{if(n.confirm)try{e.index.showLoading({title:"删除中..."});const a=await c.deleteCompanionOrder({order_id:t.id,companion_id:Number(i.value)});if(a.data.code===0)e.index.showToast({title:"订单已删除",icon:"success"}),setTimeout(()=>{e.index.navigateBack()},1500);else throw new Error(a.data.msg||"删除订单失败")}catch(a){e.index.__f__("error","at subPackages/partner/order/detail.vue:677","删除订单失败:",a),e.index.showToast({title:a.message||"删除失败",icon:"none"})}finally{e.index.hideLoading()}}})},m=t=>{if(!t)return"";const n=new Date(t),a=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),l=String(n.getDate()).padStart(2,"0"),u=String(n.getHours()).padStart(2,"0"),s=String(n.getMinutes()).padStart(2,"0");return`${a}-${r}-${l} ${u}:${s}`},C=t=>{if(!t){e.index.showToast({title:"订单号为空",icon:"none"});return}e.index.setClipboardData({data:t,success:()=>{e.index.showToast({title:"订单号已复制",icon:"success"})},fail:()=>{e.index.showToast({title:"复制失败",icon:"none"})}})},M=t=>{t.user_latitude&&t.user_longitude?e.index.openLocation({latitude:Number(t.user_latitude),longitude:Number(t.user_longitude),address:t.service_address}):e.index.showToast({title:"暂无位置信息",icon:"none"})},O=(t,n)=>{if(!t&&!n)return"待确认";let a="";if(t){const r=new Date(t),l=r.getFullYear(),u=String(r.getMonth()+1).padStart(2,"0"),s=String(r.getDate()).padStart(2,"0"),x=["周日","周一","周二","周三","周四","周五","周六"][r.getDay()];a+=`${l}-${u}-${s} ${x}`}return n&&(a&&(a+=" "),a+=n),a||"待确认"};return(t,n)=>{var a,r,l,u;return e.e({a:t.$imgBaseUrl+o.value.service_image_url,b:e.t(o.value.service_name),c:e.t(o.value.unit_price),d:e.t(o.value.unit),e:e.t(o.value.quantity),f:e.t(o.value.total_amount),g:e.t((r=(a=o.value)==null?void 0:a.user)==null?void 0:r.nick_name),h:e.t((u=(l=o.value)==null?void 0:l.user)==null?void 0:u.phone),i:e.t(o.value.service_address),j:[2,3,4,5,11].includes(o.value.status)},[2,3,4,5,11].includes(o.value.status)?{k:e.o(s=>M(o.value))}:{},{l:e.t(O(o.value.service_date,o.value.service_time)),m:e.t(o.value.order_no),n:N._imports_0$6,o:e.o(s=>C(o.value.order_no)),p:o.value.start_time},o.value.start_time?{q:e.t(m(o.value.start_time))}:{},{r:o.value.end_time},o.value.end_time?{s:e.t(m(o.value.end_time))}:{},{t:e.t(m(o.value.created_at)),v:o.value.payment_time},o.value.payment_time?{w:e.t(m(o.value.payment_time))}:{},{x:o.value.remark},o.value.remark?{y:e.t(o.value.remark)}:{},{z:e.f(h(o.value.status,o.value),(s,x,q)=>({a:e.t(s.text),b:x,c:e.n(s.type),d:e.o(A=>v(s.action,o.value),x)}))})}}},I=e._export_sfc(E,[["__scopeId","data-v-0df60276"]]);wx.createPage(I);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/subPackages/partner/order/detail.js.map
