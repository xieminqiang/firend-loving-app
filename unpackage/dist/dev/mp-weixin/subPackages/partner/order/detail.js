"use strict";const e=require("../../../common/vendor.js"),D=require("../../../common/assets.js"),C=require("../../../api/order.js"),O={__name:"detail",setup(N){const n=e.ref({}),x=e.ref(null),m=e.ref(null);e.onLoad(t=>{t.orderId&&(x.value=t.orderId),t.companion_id&&(m.value=t.companion_id),s()});const s=async()=>{try{e.index.showLoading({title:"加载中..."});const t=await C.getCompanionOrderDetail({order_id:Number(x.value),companion_id:Number(m.value)});if(t.data.code===0)n.value={...t.data.data.order,logs:t.data.data.logs||[]};else throw new Error(t.data.msg||"获取订单详情失败")}catch(t){e.index.__f__("error","at subPackages/partner/order/detail.vue:164","加载订单详情失败:",t),e.index.showToast({title:t.message||"加载失败",icon:"none"})}finally{e.index.hideLoading()}},h=t=>({2:[{text:"拒绝",action:"reject",type:"secondary"},{text:"接单",action:"accept",type:"primary"}],3:[{text:"电话联系",action:"contact",type:"secondary"},{text:"我已到达服务地点",action:"arrived",type:"primary"}],4:[{text:"电话联系",action:"call",type:"secondary"}],5:[{text:"电话联系",action:"contact",type:"secondary"},{text:"结束服务",action:"end",type:"primary"}],6:[{text:"查看评价",action:"review",type:"secondary"},{text:"删除订单",action:"delete",type:"secondary"}],7:[{text:"删除订单",action:"delete",type:"secondary"}],8:[{text:"删除订单",action:"delete",type:"secondary"}],9:[{text:"订单已取消，给客户退款中",action:"info",type:"info"}],11:[{text:"电话联系",action:"contact",type:"secondary"},{text:"我已出发",action:"depart",type:"depart"}]})[t]||[],_=(t,a)=>{switch(t){case"contact":p(a);break;case"accept":f();break;case"reject":g();break;case"arrived":v();break;case"depart":w();break;case"call":y(a);break;case"start":T();break;case"end":k();break;case"review":b(a);break;case"rebook":L(a);break;case"delete":$();break}},p=t=>{t.user&&t.user.phone&&e.index.showModal({title:"电话联系",content:`是否拨打客户 ${t.user.nick_name} 的电话？`,confirmText:"拨打",cancelText:"取消",success:a=>{a.confirm&&e.index.makePhoneCall({phoneNumber:t.user.phone})}})},f=t=>{e.index.showModal({title:"确认接单",content:"确定要接受这个订单吗？",confirmText:"接单",cancelText:"取消",success:async a=>{if(a.confirm)try{e.index.showLoading({title:"处理中..."}),e.index.showToast({title:"接单成功",icon:"success"}),setTimeout(()=>{s()},1500)}catch(o){e.index.__f__("error","at subPackages/partner/order/detail.vue:335","接单失败:",o),e.index.showToast({title:o.message||"接单失败",icon:"none"})}finally{e.index.hideLoading()}}})},g=t=>{e.index.showModal({title:"拒绝订单",content:"确定要拒绝这个订单吗？",confirmText:"拒绝",cancelText:"取消",success:async a=>{if(a.confirm)try{e.index.showLoading({title:"处理中..."}),e.index.showToast({title:"已拒绝订单",icon:"success"}),setTimeout(()=>{s()},1500)}catch(o){e.index.__f__("error","at subPackages/partner/order/detail.vue:373","拒绝订单失败:",o),e.index.showToast({title:o.message||"操作失败",icon:"none"})}finally{e.index.hideLoading()}}})},v=t=>{e.index.showModal({title:"确认到达",content:"确认您已到达服务地点？",confirmText:"确认",cancelText:"取消",success:async a=>{if(a.confirm)try{e.index.showLoading({title:"更新中..."}),e.index.showToast({title:"已确认到达",icon:"success"}),setTimeout(()=>{s()},1500)}catch(o){e.index.__f__("error","at subPackages/partner/order/detail.vue:411","确认到达失败:",o),e.index.showToast({title:o.message||"操作失败",icon:"none"})}finally{e.index.hideLoading()}}})},y=t=>{t.user&&t.user.phone&&e.index.showModal({title:"电话联系",content:`是否拨打客户 ${t.user.nick_name} 的电话？`,confirmText:"拨打",cancelText:"取消",success:a=>{a.confirm&&e.index.makePhoneCall({phoneNumber:t.user.phone})}})},w=t=>{e.index.showModal({title:"确认出发",content:"确认您已开始出发前往服务地点？",confirmText:"确认",cancelText:"取消",success:async a=>{if(a.confirm)try{e.index.showLoading({title:"更新中..."}),e.index.showToast({title:"已确认出发",icon:"success"}),setTimeout(()=>{s()},1500)}catch(o){e.index.__f__("error","at subPackages/partner/order/detail.vue:468","确认出发失败:",o),e.index.showToast({title:o.message||"操作失败",icon:"none"})}finally{e.index.hideLoading()}}})},T=t=>{e.index.showModal({title:"开始服务",content:"确定要开始服务吗？",confirmText:"开始",cancelText:"取消",success:async a=>{if(a.confirm)try{e.index.showLoading({title:"更新中..."}),e.index.showToast({title:"服务已开始",icon:"success"}),setTimeout(()=>{s()},1500)}catch(o){e.index.__f__("error","at subPackages/partner/order/detail.vue:506","开始服务失败:",o),e.index.showToast({title:o.message||"操作失败",icon:"none"})}finally{e.index.hideLoading()}}})},k=t=>{e.index.showModal({title:"结束服务",content:"确定要结束服务吗？",confirmText:"结束",cancelText:"取消",success:async a=>{if(a.confirm)try{e.index.showLoading({title:"更新中..."}),e.index.showToast({title:"服务已结束",icon:"success"}),setTimeout(()=>{s()},1500)}catch(o){e.index.__f__("error","at subPackages/partner/order/detail.vue:544","结束服务失败:",o),e.index.showToast({title:o.message||"操作失败",icon:"none"})}finally{e.index.hideLoading()}}})},b=t=>{e.index.navigateTo({url:`/subPackages/partner/review?orderId=${t.id}`})},L=t=>{e.index.navigateTo({url:`/subPackages/partner/rebook?orderId=${t.id}`})},$=t=>{e.index.showModal({title:"删除订单",content:"确定要删除这个订单吗？删除后不可恢复。",confirmText:"删除",cancelText:"取消",success:async a=>{if(a.confirm)try{e.index.showLoading({title:"删除中..."}),e.index.showToast({title:"订单已删除",icon:"success"}),setTimeout(()=>{e.index.navigateBack()},1500)}catch(o){e.index.__f__("error","at subPackages/partner/order/detail.vue:596","删除订单失败:",o),e.index.showToast({title:o.message||"删除失败",icon:"none"})}finally{e.index.hideLoading()}}})},l=t=>{if(!t)return"";const a=new Date(t),o=a.getFullYear(),i=String(a.getMonth()+1).padStart(2,"0"),c=String(a.getDate()).padStart(2,"0"),d=String(a.getHours()).padStart(2,"0"),r=String(a.getMinutes()).padStart(2,"0");return`${o}-${i}-${c} ${d}:${r}`},S=t=>{if(!t){e.index.showToast({title:"订单号为空",icon:"none"});return}e.index.setClipboardData({data:t,success:()=>{e.index.showToast({title:"订单号已复制",icon:"success"})},fail:()=>{e.index.showToast({title:"复制失败",icon:"none"})}})},M=t=>{t.user_latitude&&t.user_longitude?e.index.openLocation({latitude:Number(t.user_latitude),longitude:Number(t.user_longitude),address:t.service_address}):e.index.showToast({title:"暂无位置信息",icon:"none"})},P=(t,a)=>{if(!t&&!a)return"待确认";let o="";if(t){const i=new Date(t),c=i.getFullYear(),d=String(i.getMonth()+1).padStart(2,"0"),r=String(i.getDate()).padStart(2,"0"),u=["周日","周一","周二","周三","周四","周五","周六"][i.getDay()];o+=`${c}-${d}-${r} ${u}`}return a&&(o&&(o+=" "),o+=a),o||"待确认"};return(t,a)=>{var o,i,c,d;return e.e({a:t.$imgBaseUrl+n.value.service_image_url,b:e.t(n.value.service_name),c:e.t(n.value.unit_price),d:e.t(n.value.unit),e:e.t(n.value.quantity),f:e.t(n.value.total_amount),g:e.t((i=(o=n.value)==null?void 0:o.user)==null?void 0:i.nick_name),h:e.t((d=(c=n.value)==null?void 0:c.user)==null?void 0:d.phone),i:e.t(n.value.service_address),j:[2,3,4,5,11].includes(n.value.status)},[2,3,4,5,11].includes(n.value.status)?{k:e.o(r=>M(n.value))}:{},{l:e.t(P(n.value.service_date,n.value.service_time)),m:e.t(n.value.order_no),n:D._imports_0$6,o:e.o(r=>S(n.value.order_no)),p:n.value.start_time},n.value.start_time?{q:e.t(l(n.value.start_time))}:{},{r:n.value.end_time},n.value.end_time?{s:e.t(l(n.value.end_time))}:{},{t:e.t(l(n.value.created_at)),v:n.value.payment_time},n.value.payment_time?{w:e.t(l(n.value.payment_time))}:{},{x:n.value.remark},n.value.remark?{y:e.t(n.value.remark)}:{},{z:e.f(h(n.value.status),(r,u,q)=>({a:e.t(r.text),b:u,c:e.n(r.type),d:e.o(j=>_(r.action,n.value),u)}))})}}},I=e._export_sfc(O,[["__scopeId","data-v-0df60276"]]);wx.createPage(I);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/subPackages/partner/order/detail.js.map
