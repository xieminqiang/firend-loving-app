"use strict";const e=require("../../common/vendor.js"),w=require("../../common/assets.js"),h=require("../../api/discover.js");if(!Array){const F=e.resolveComponent("u-avatar"),P=e.resolveComponent("u-icon"),$=e.resolveComponent("u-input"),D=e.resolveComponent("u-popup");(F+P+$+D)()}const Z=()=>"../../uni_modules/uview-plus/components/u-avatar/u-avatar.js",ee=()=>"../../uni_modules/uview-plus/components/u-icon/u-icon.js",ae=()=>"../../uni_modules/uview-plus/components/u-input/u-input.js",ne=()=>"../../uni_modules/uview-plus/components/u-popup/u-popup.js";Math||(Z+oe+ee+ae+ne)();const oe=()=>"../../components/common/PictureDisplay.js",te={__name:"comment",props:{userLocation:{type:Object,default:null},cityStore:{type:Object,default:null}},setup(F){const P=e.ref(e.getCurrentInstance().proxy),$=e.ref(0),D=e.ref(0),y=e.ref(""),M=e.ref(1),d=e.ref(0),b=e.ref(!1),c=e.ref({}),m=e.ref([]),o=e.ref([]),l=e.ref(""),i=e.ref(""),_=e.ref("友好发言，文明聊天"),v=e.ref(!1),f=e.ref(!1),k=e.ref(0),g=e.ref(0),C=e.ref(!1);e.onLoad(n=>{P.value.getOpenerEventChannel().on("getRecord",async a=>{y.value=a.data.moments_info.moments_id,L()}),i.value="",_.value="友好发言，文明聊天"});const L=async n=>{var s;try{const a=await h.getMomentsDetail({moments_id:y.value});if(a.data&&a.data.code===0){const t=a.data.data;t.companion_info&&(c.value={user_id:t.companion_info.id,nick_name:t.companion_info.nickname,head_img:t.companion_info.avatar,icon_list:[{icon:{color:t.companion_info.gender==="女"?"rgba(252, 139, 198, 1)":"rgba(19, 98, 235, 1)",icon:t.companion_info.gender==="女"?"/static/find/nd_icon.png":"/static/find/nand_icon.png"},data:`${t.companion_info.age}岁`},{icon:{color:"rgba(62, 178, 240, 1)"},data:`${t.companion_info.height}cm`},{icon:{color:"linear-gradient(180deg, rgba(155, 59, 235, 1) 0%, rgba(230, 126, 188, 1) 100%)"},data:`${t.companion_info.weight}kg`}]}),t.moments_info&&(o.value=t.moments_info),j(1)}else e.index.__f__("error","at subPackages/record/comment.vue:327","获取动态详情失败:",(s=a.data)==null?void 0:s.message),e.index.showToast({title:"获取动态详情失败",icon:"none"})}catch(a){e.index.__f__("error","at subPackages/record/comment.vue:334","获取动态详情出错:",a),e.index.showToast({title:"网络错误，请重试",icon:"none"})}},j=async n=>{var s;try{const a=await h.getMomentCommentList({moments_id:y.value,page:n,page_size:10});if(a.data&&a.data.code===0){const t=a.data.data;n===1?(m.value=t.comments_list||[],d.value=t.total||0,b.value=!0):t.comments_list&&t.comments_list.length>0&&(m.value.push(...t.comments_list),M.value=t.page)}else e.index.__f__("error","at subPackages/record/comment.vue:365","获取评论列表失败:",(s=a.data)==null?void 0:s.message),S()}catch(a){e.index.__f__("error","at subPackages/record/comment.vue:370","获取评论列表出错:",a),S()}},S=()=>{m.value=[],d.value=0,b.value=!0},O=()=>{e.index.__f__("log","at subPackages/record/comment.vue:385","监听页面滚动到底部"),j(M.value+1)},x=n=>{i.value=n.comments_id,_.value="回复@"+n.nick_name,v.value=!0},B=async()=>{var s;if(!(l.value||"")){e.index.__f__("log","at subPackages/record/comment.vue:405","输入内容为空，显示错误提示"),e.index.showToast({title:"请输入评论内容",icon:"none",duration:1e3});return}try{const a={moments_id:y.value,content:l.value};i.value&&(a.reply_comments_id=i.value);const t=await h.pushMomentComment(a);if(t.data&&t.data.code===0){const u=t.data.data.res_data;i.value?(m.value.forEach(r=>{r.comments_id==u.parent_id&&r.comments_list.push(u)}),i.value="",_.value="友好发言，文明聊天"):m.value.unshift(u),d.value=u.total,o.value.comments_num=u.total,l.value="",I(),e.index.showToast({title:"评论成功!",icon:"none",duration:500})}else e.index.showToast({title:((s=t.data)==null?void 0:s.message)||"评论失败!",icon:"none",duration:1e3})}catch(a){e.index.__f__("error","at subPackages/record/comment.vue:464","发布评论出错:",a),e.index.showToast({title:"网络错误，请重试",icon:"none",duration:1e3})}},U=async n=>{var s;e.index.__f__("log","at subPackages/record/comment.vue:475","展开更多回复",n);try{const a=await h.getMoreMomentCommentList({comments_id:n.comments_id,page:1,page_size:10});if(a.data&&a.data.code===0){const t=a.data.data;n.comments_list=t.more_list||[],n.has_more=t.has_more||!1}else e.index.__f__("error","at subPackages/record/comment.vue:488","获取更多回复失败:",(s=a.data)==null?void 0:s.message)}catch(a){e.index.__f__("error","at subPackages/record/comment.vue:491","获取更多回复出错:",a)}},q=n=>{D.value=n.detail.scrollTop},E=()=>{},R=n=>{},A=n=>{f.value=!0},N=n=>{f.value=!1},H=n=>{e.index.__f__("log","at subPackages/record/comment.vue:519","handleInputChange 被调用，接收到的值:",n),l.value=n,e.index.__f__("log","at subPackages/record/comment.vue:521","rplContent 更新为:",l.value)},V=n=>{C.value=!0,k.value=n.touches[0].clientY,g.value=n.touches[0].clientY},G=n=>{if(!C.value)return;g.value=n.touches[0].clientY,g.value-k.value>0&&n.preventDefault()},J=n=>{if(!C.value)return;g.value-k.value>50&&I(),C.value=!1,k.value=0,g.value=0},K=()=>{e.index.navigateTo({url:"/pages/detail/detail",animationType:"slide-in-bottom",animationDuration:200,success(n){n.eventChannel.emit("getUserId",{val:c.value.user_id})}})},z=n=>{e.index.navigateTo({url:"/pages/detail/detail",animationType:"slide-in-bottom",animationDuration:200,success(s){s.eventChannel.emit("getUserId",{val:n.user_id})}})},Q=()=>{v.value=!0,setTimeout(()=>{f.value=!0},350)},I=()=>{f.value=!1,v.value=!1,l.value="",i.value="",_.value="友好发言，文明聊天"},p=(n,s="add",a=1)=>{const t=parseInt(n)||0;return s==="add"?t+a:s==="subtract"?Math.max(0,t-a):t},W=async n=>{try{const s=o.value.is_praised;o.value.is_praised=!s,o.value.is_praised?o.value.praise_num=p(o.value.praise_num,"add",1):o.value.praise_num=p(o.value.praise_num,"subtract",1);const a=await h.praiseMoment({target_id:n.target_id});a.data&&a.data.code===0?e.index.__f__("log","at subPackages/record/comment.vue:664","点赞成功"):(o.value.is_praised=s,s?o.value.praise_num=p(o.value.praise_num,"add",1):o.value.praise_num=p(o.value.praise_num,"subtract",1),e.index.showToast({title:"点赞失败，请重试",icon:"none"}))}catch(s){e.index.__f__("error","at subPackages/record/comment.vue:680","点赞失败:",s);const a=o.value.is_praised;o.value.is_praised=!a,a?o.value.praise_num=p(o.value.praise_num,"add",1):o.value.praise_num=p(o.value.praise_num,"subtract",1),e.index.showToast({title:"网络错误，请重试",icon:"none"})}};return(n,s)=>e.e({a:e.p({src:n.$imgBaseUrl+c.value.head_img,size:"38",shape:"circle",mode:"aspectFill"}),b:e.o(a=>K()),c:e.t(c.value.nick_name),d:c.value.icon_list},c.value.icon_list?{e:e.f(c.value.icon_list,(a,t,u)=>{var r,T;return e.e({a:a.icon.icon},a.icon.icon?{b:(r=a.icon)==null?void 0:r.icon}:{},{c:e.t(a.data),d:`${(T=a.icon)==null?void 0:T.color}`,e:a})})}:{},{f:e.t(o.value.content),g:o.value.file_list&&o.value.file_list.length>0},o.value.file_list&&o.value.file_list.length>0?{h:e.p({list:o.value.file_list,topicList:o.value.topic_list})}:{},{i:!o.value.is_praised},o.value.is_praised?{}:{j:w._imports_0$3},{k:o.value.is_praised},o.value.is_praised?{l:w._imports_1$1}:{},{m:e.t(o.value.praise_num||0),n:e.o(a=>W({target_id:o.value.moments_id})),o:b.value},b.value?e.e({p:e.t(d.value),q:d.value==0},d.value==0?{r:w._imports_2}:{s:e.f(m.value,(a,t,u)=>e.e({a:"45c029ce-2-"+u,b:e.p({src:n.$imgBaseUrl+(o.value.user_id===a.user_id?c.value.head_img:a.head_img),size:"32",shape:"circle",mode:"aspectFill"}),c:e.o(r=>z(a),a.comments_id),d:e.t(o.value.user_id===a.user_id?c.value.nick_name:a.nick_name),e:e.t(a.content),f:e.t(a.content_time),g:e.o(r=>x(a),a.comments_id),h:e.o(r=>x(a),a.comments_id),i:e.f(a.comments_list,(r,T,X)=>({a:"45c029ce-3-"+u+"-"+X,b:e.p({src:n.$imgBaseUrl+(o.value.user_id===r.user_id?c.value.head_img:r.head_img),size:"22",shape:"circle"}),c:e.o(Y=>z(r),r.comments_id),d:e.t(o.value.user_id===r.user_id?c.value.nick_name:r.nick_name),e:e.t(o.value.user_id===r.reply_user_id?c.value.nick_name:r.reply_nick_name),f:e.t(r.content),g:e.t(r.content_time),h:e.o(Y=>x(r),r.comments_id),i:e.o(Y=>x(r),r.comments_id),j:r.comments_id})),j:a.has_more},a.has_more?{k:"45c029ce-4-"+u,l:e.p({name:"arrow-down",color:"#7363FF",size:"14"}),m:e.o(r=>U(a),a.comments_id)}:{},{n:a.comments_id})),t:w._imports_3$1}):{},{v:$.value,w:e.o(q),x:e.o(O),y:e.o(R),z:e.o(E),A:e.p({placeholder:_.value,border:"surround",value:l.value,fontSize:"24rpx",color:"#1a1a1a",shape:"circle",adjustPosition:!0,disabled:!0,customStyle:{paddingLeft:"24rpx",background:"#F2F2F2"}}),B:e.o(()=>{}),C:e.o(Q),D:e.o(V),E:e.o(G),F:e.o(J),G:e.o(A),H:e.o(N),I:e.o(H),J:e.o(a=>l.value=a),K:e.p({focus:v.value&&f.value,placeholder:_.value,border:"surround",fontSize:"24rpx",color:"#1a1a1a",shape:"circle",adjustPosition:!0,customStyle:{paddingLeft:"24rpx",background:"#F2F2F2",transition:"all 0.2s ease"},modelValue:l.value}),L:l.value.trim()?1:"",M:e.o(B),N:e.o(()=>{}),O:e.o(I),P:e.p({show:v.value,round:"10",closeOnClickOverlay:!0,closeOnClickModal:!0,zIndex:999,overlay:!0,overlayStyle:{backgroundColor:"rgba(0, 0, 0, 0.5)"},duration:300,mode:"bottom",safeAreaInsetBottom:!0,customStyle:{transition:"all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)",transform:v.value?"translateY(0)":"translateY(100%)"}})})}},se=e._export_sfc(te,[["__scopeId","data-v-45c029ce"]]);wx.createPage(se);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/subPackages/record/comment.js.map
