"use strict";const e=require("../../common/vendor.js"),b=require("../../common/assets.js"),f=require("../../api/discover.js");if(!Array){const P=e.resolveComponent("u-avatar"),k=e.resolveComponent("u-icon"),w=e.resolveComponent("u-input"),x=e.resolveComponent("u-popup");(P+k+w+x)()}const V=()=>"../../uni_modules/uview-plus/components/u-avatar/u-avatar.js",A=()=>"../../uni_modules/uview-plus/components/u-icon/u-icon.js",H=()=>"../../uni_modules/uview-plus/components/u-input/u-input.js",N=()=>"../../uni_modules/uview-plus/components/u-popup/u-popup.js";Math||(V+G+A+H+N)();const G=()=>"../../components/common/PictureDisplay.js",J={__name:"comment",props:{userLocation:{type:Object,default:null},cityStore:{type:Object,default:null}},setup(P){const k=e.ref(e.getCurrentInstance().proxy),w=e.ref(0),x=e.ref(0),g=e.ref(""),$=e.ref(1),u=e.ref(0),h=e.ref(!1),r=e.ref({}),m=e.ref([]),n=e.ref([]),c=e.ref(""),_=e.ref(""),v=e.ref("友好发言，文明聊天"),d=e.ref(!1);e.onLoad(t=>{k.value.getOpenerEventChannel().on("getRecord",async a=>{g.value=a.data.moments_info.moments_id,L()}),_.value="",v.value="友好发言，文明聊天"});const L=async t=>{var s;try{const a=await f.getMomentsDetail({moments_id:g.value});if(a.data&&a.data.code===0){const o=a.data.data;o.companion_info&&(r.value={user_id:o.companion_info.id,nick_name:o.companion_info.nickname,head_img:o.companion_info.avatar,icon_list:[{icon:{color:o.companion_info.gender==="女"?"rgba(252, 139, 198, 1)":"rgba(19, 98, 235, 1)",icon:o.companion_info.gender==="女"?"/static/find/nd_icon.png":"/static/find/nand_icon.png"},data:`${o.companion_info.age}岁`},{icon:{color:"rgba(62, 178, 240, 1)"},data:`${o.companion_info.height}cm`},{icon:{color:"linear-gradient(180deg, rgba(155, 59, 235, 1) 0%, rgba(230, 126, 188, 1) 100%)"},data:`${o.companion_info.weight}kg`}]}),o.moments_info&&(n.value={moments_id:o.moments_info.moments_id,content:o.moments_info.content,file_list:o.moments_info.file_list||[],topic_list:o.moments_info.topic_list||[],is_praised:o.moments_info.is_praised,praise_num:o.moments_info.praise_num,comments_num:o.moments_info.comments_num,is_liked:o.moments_info.is_liked}),T(1)}else e.index.__f__("error","at subPackages/record/comment.vue:286","获取动态详情失败:",(s=a.data)==null?void 0:s.message),e.index.showToast({title:"获取动态详情失败",icon:"none"})}catch(a){e.index.__f__("error","at subPackages/record/comment.vue:293","获取动态详情出错:",a),e.index.showToast({title:"网络错误，请重试",icon:"none"})}},T=async t=>{var s;try{const a=await f.getMomentCommentList({moments_id:g.value,page:t,page_size:10});if(a.data&&a.data.code===0){const o=a.data.data;t===1?(m.value=o.comments_list||[],u.value=o.total||0,h.value=!0):o.comments_list&&o.comments_list.length>0&&(m.value.push(...o.comments_list),$.value=o.page)}else e.index.__f__("error","at subPackages/record/comment.vue:324","获取评论列表失败:",(s=a.data)==null?void 0:s.message),D()}catch(a){e.index.__f__("error","at subPackages/record/comment.vue:329","获取评论列表出错:",a),D()}},D=()=>{m.value=[],u.value=0,h.value=!0},z=()=>{e.index.__f__("log","at subPackages/record/comment.vue:344","监听页面滚动到底部"),T($.value+1)},y=t=>{_.value=t.comments_id,v.value="回复@"+t.nick_name,d.value=!0},S=async()=>{var t;if(d.value=!1,!c.value.trim()){e.index.showToast({title:"请输入评论内容",icon:"none",duration:1e3});return}try{const s={moments_id:g.value,content:c.value};_.value&&(s.reply_comments_id=_.value);const a=await f.pushMomentComment(s);if(a.data&&a.data.code===0){const o=a.data.data.res_data;_.value?(m.value.forEach(l=>{l.comments_id==o.parent_id&&l.comments_list.push(o)}),_.value="",v.value="友好发言，文明聊天"):m.value.unshift(o),u.value=o.total,n.value.comments_num=o.total,c.value="",e.index.showToast({title:"评论成功!",icon:"none",duration:500})}else e.index.showToast({title:((t=a.data)==null?void 0:t.message)||"评论失败!",icon:"none",duration:1e3})}catch(s){e.index.__f__("error","at subPackages/record/comment.vue:418","发布评论出错:",s),e.index.showToast({title:"网络错误，请重试",icon:"none",duration:1e3})}},O=async t=>{var s;e.index.__f__("log","at subPackages/record/comment.vue:429","展开更多回复",t);try{const a=await f.getMoreMomentCommentList({comments_id:t.comments_id,page:1,page_size:10});if(a.data&&a.data.code===0){const o=a.data.data;t.comments_list=o.more_list||[],t.has_more=o.has_more||!1}else e.index.__f__("error","at subPackages/record/comment.vue:442","获取更多回复失败:",(s=a.data)==null?void 0:s.message)}catch(a){e.index.__f__("error","at subPackages/record/comment.vue:445","获取更多回复出错:",a)}},B=t=>{x.value=t.detail.scrollTop},j=()=>{},M=t=>{},U=()=>{e.index.navigateTo({url:"/pages/detail/detail",animationType:"slide-in-bottom",animationDuration:200,success(t){t.eventChannel.emit("getUserId",{val:r.value.user_id})}})},I=t=>{e.index.navigateTo({url:"/pages/detail/detail",animationType:"slide-in-bottom",animationDuration:200,success(s){s.eventChannel.emit("getUserId",{val:t.user_id})}})},q=()=>{d.value=!0},p=(t,s="add",a=1)=>{const o=parseInt(t)||0;return s==="add"?o+a:s==="subtract"?Math.max(0,o-a):o},R=async t=>{try{const s=n.value.is_praised;n.value.is_praised=!s,n.value.is_praised?n.value.praise_num=p(n.value.praise_num,"add",1):n.value.praise_num=p(n.value.praise_num,"subtract",1);const a=await f.praiseMoment({target_id:t.target_id});a.data&&a.data.code===0?e.index.__f__("log","at subPackages/record/comment.vue:551","点赞成功"):(n.value.is_praised=s,s?n.value.praise_num=p(n.value.praise_num,"add",1):n.value.praise_num=p(n.value.praise_num,"subtract",1),e.index.showToast({title:"点赞失败，请重试",icon:"none"}))}catch(s){e.index.__f__("error","at subPackages/record/comment.vue:567","点赞失败:",s);const a=n.value.is_praised;n.value.is_praised=!a,a?n.value.praise_num=p(n.value.praise_num,"add",1):n.value.praise_num=p(n.value.praise_num,"subtract",1),e.index.showToast({title:"网络错误，请重试",icon:"none"})}};return(t,s)=>e.e({a:e.p({src:t.$imgBaseUrl+r.value.head_img,size:"38",shape:"circle"}),b:e.o(a=>U()),c:e.t(r.value.nick_name),d:r.value.icon_list},r.value.icon_list?{e:e.f(r.value.icon_list,(a,o,l)=>{var i,C;return e.e({a:a.icon.icon},a.icon.icon?{b:(i=a.icon)==null?void 0:i.icon}:{},{c:e.t(a.data),d:`${(C=a.icon)==null?void 0:C.color}`,e:a})})}:{},{f:e.t(n.value.content),g:n.value.file_list&&n.value.file_list.length>0},n.value.file_list&&n.value.file_list.length>0?{h:e.p({list:n.value.file_list,topicList:n.value.topic_list})}:{},{i:!n.value.is_praised},n.value.is_praised?{}:{j:b._imports_0$4},{k:n.value.is_praised},n.value.is_praised?{l:b._imports_1$1}:{},{m:e.t(n.value.praise_num||0),n:e.o(a=>R({target_id:n.value.moments_id})),o:h.value},h.value?e.e({p:e.t(u.value),q:u.value==0},u.value==0?{r:b._imports_2}:{s:e.f(m.value,(a,o,l)=>e.e({a:"45c029ce-2-"+l,b:e.p({src:t.$imgBaseUrl+a.head_img,size:"32",shape:"circle"}),c:e.o(i=>I(a),a.comments_id),d:e.t(a.nick_name),e:e.t(a.content),f:e.t(a.content_time),g:e.o(i=>y(a),a.comments_id),h:e.o(i=>y(a),a.comments_id),i:e.f(a.comments_list,(i,C,E)=>({a:"45c029ce-3-"+l+"-"+E,b:e.p({src:t.$imgBaseUrl+i.head_img,size:"22",shape:"circle"}),c:e.o(F=>I(i),i.comments_id),d:e.t(i.nick_name),e:e.t(i.reply_nick_name),f:e.t(i.content),g:e.t(i.content_time),h:e.o(F=>y(i),i.comments_id),i:e.o(F=>y(i),i.comments_id),j:i.comments_id})),j:a.has_more},a.has_more?{k:"45c029ce-4-"+l,l:e.p({name:"arrow-down",color:"#7363FF",size:"14"}),m:e.o(i=>O(a),a.comments_id)}:{},{n:a.comments_id})),t:b._imports_3$1}):{},{v:w.value,w:e.o(B),x:e.o(z),y:e.o(M),z:e.o(j),A:e.o(a=>c.value=a),B:e.p({placeholder:v.value,border:"surround",fontSize:"24rpx",color:"#1a1a1a",shape:"circle",adjustPosition:!0,disabled:!0,customStyle:{paddingLeft:"24rpx",background:"#F2F2F2"},modelValue:c.value}),C:e.o(()=>{}),D:e.o(q),E:e.o(M),F:e.o(j),G:e.o(a=>c.value=a),H:e.p({focus:d.value,placeholder:v.value,border:"surround",fontSize:"24rpx",color:"#1a1a1a",shape:"circle",adjustPosition:!0,customStyle:{paddingLeft:"24rpx",background:"#F2F2F2"},modelValue:c.value}),I:c.value,J:e.o(S),K:e.o(()=>{}),L:e.o(a=>d.value=!1),M:e.p({show:d.value,round:"10"})})}},K=e._export_sfc(J,[["__scopeId","data-v-45c029ce"]]);wx.createPage(K);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/subPackages/record/comment.js.map
